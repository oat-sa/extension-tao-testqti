{"version":3,"mappings":"AAyBAA,mDACA,SACA,gBACA,wBACA,aAEA,kBACA,UACA,oBACA,sBACA,gBACA,uBACA,CAYA,yCAEA,GC/BAA,wDACA,SACA,SACA,UACAC,EACAC,OACA,CACA,aAEA,oIACA,GCEAF,yDACA,SACA,aACA,gBAMAG,eASAC,aAUAC,UAUAC,UAUAC,QAUAC,SAYAC,QAUAC,OAWAC,gBAaAC,WAYAC,OASAC,OAUAC,qBAOAC,UAQAC,OAQAC,OACA,EAEAC,kBAKAC,2BACA,mBACA,EAQAC,6CAiBA,MAhBApB,kBACA,0CACAqB,SAGAA,4CAGA,YACArB,6CAGAqB,QAFAA,8CAMAA,IACA,EAQAC,uCAKA,OAJAtB,mBACAqB,6CAGAA,MACA,sBACA,yBACA,6BACA,gBAEA,0BACA,qBACA,4BACA,WACA,SACA,YACA,UAGA,cAEA,0BACA,6BAEA,wBACA,4BAEA,0CACArB,6BAGA,SAFAuB,sBAGA,CAGA,YACA,EAsBAC,mDACA,uCACA,iBACA,+BAEA,cACA,4BAEA,cACA,4BAEA,YACA,0BAEA,aACA,2BAEA,YACA,0BAEA,WACA,yBAEA,mBACA,kCAEA,eACA,6BAEA,WACA,yBAEA,UACA,wBAEA,sBACA,sCAEA,aACA,2BAEA,UACA,wBAEA,WACA,yBAEA,QACA,UAEA,EASAC,sEACAC,YACAxB,wBACA,aAFAwB,WAIAxB,qBACA,UALAwB,WAOAxB,qBACA,UARAwB,WAUAxB,mBACA,QAXAwB,WAaAxB,oBACA,SAdAwB,WAgBAxB,mBACA,QAjBAwB,WAmBAxB,kBACA,OApBAwB,WAsBAxB,2BACA,eAvBAwB,WAyBAxB,sBACA,WA1BAwB,WA4BAxB,kBACA,OA7BAwB,WA+BAxB,iBACA,MAhCAwB,WAkCAxB,+BACA,kBAnCAwB,WAqCAxB,qBArCAwB,WAsCAxB,iBACAyB,SACA,MAEA,WA1CAD,WA6CAxB,oBACA,MAKA,CACA,gCAEA,qBACA,GC3WAH,4DACA,SACA,aACA,gBAMA6B,kBAMAC,SAOAC,WAOAC,UAOAC,SAQAf,OAQAD,KACA,EAEAiB,qBAKAd,2BACA,sBACA,EAQAC,2DAiBA,MAhBApB,yBACA,oDACAkC,gBAGAA,6DAGA,mBACAlC,+EAGAkC,mCAFAA,mFAMAA,WACA,EAQAV,mDACA,uCACA,aACA,8BAEA,eACA,gCAEA,cACA,+BAEA,aACA,8BAEA,WACA,4BAEA,UACA,2BAEA,QACA,UAEA,EAQAC,6DACAC,YACAE,uBACA,SAFAF,WAIAE,yBACA,WALAF,WAOAE,wBACA,UARAF,WAUAE,uBACA,SAXAF,WAaAE,qBACA,SAdAF,WAgBAE,sBACA,KAKA,CACA,mCAEA,wBACA,GCnLA7B,iEACA,SACA,aACA,aAaA,wCACA,kFACA,CASA,kEACAoC,gFACAC,kFAOA,MALAC,gBACAA,iEACAF,2EAGA,iCACA,CASA,iEACA,8BAOA,MANAnC,sCACA,0DAEA,MADAsC,YAGA,GACAA,KACA,CA9CA,sDAgDA,OACAC,sCACAC,kCACAC,+BACA,CACA,GC9DA1C,2DACA,SACA,yDACA,8BACA,aAmHA,2BAOA,MANA2C,SACAA,UAEA1C,mBACA0C,eAEAA,KACA,CAzHA,sBASAC,mDACA,aACA,eACA,EAEA,8CACA,0DAQA,GALA3C,8BACA4C,sBACAC,iBAGAA,YACA,oDACA,4DAEAC,6BACA,CAEA,uCACA,EASAC,oCAIA,+BACA,4CAEA,MADAC,oBAGA,IARAA,YACAC,uBAeA,MANAjD,uBACAA,gCACAkD,YACAC,sBAGAH,KACA,EAUAI,gEACAC,4CACAC,+BACAC,iBACAC,IACAC,IAEAC,aACAA,4CACAA,cACAD,4CACAC,qBAIA,iBACA,EAUAC,8DACAC,aACAP,2CACAQ,yBACAf,4DAMA,MAJAA,kCACAc,8BAGAA,MACA,CACA,EAiBA,uBACA,GChIA7D,wDACA,SACA,yDACA,mDACA,iDACA,oDACA,gFACA,aAEA,mBAQA+D,mFACA,oFACA,EASAC,+EACA,qFACA,EAOAC,4DACA,yDACA,EAOAC,kEACA,sDACA,mBACA,EAOAC,wEACA,2FACA,gBACA,EAOAC,uEACAnE,6DACA,EAOAoE,6EACApE,gEACA,EAOAqE,iGACA,2CACArE,0BACAA,4CACAsE,iBACAC,mBAEAD,0BACAE,6CACAF,4BACAE,8CAGA,CAEAA,qEACA,EAQAC,iDACA,gBASA,MARAzE,oBACAuE,SAEAG,mEACA,mBACAC,0DAEA,GACAA,QACA,EAQAC,8DACAC,8DACAC,yDACAC,MAEA/E,uBACA+E,gBAEAJ,6EACA,cACA,GAEAI,wCACA,6DACA,GAGAF,cACA7E,6BAGA8E,OACA9E,qBAEA,EAUAgF,kEAEA,oDACA,4DAGA,gEACAC,SACAC,kBACAC,sBACAC,iBACAC,iBACAC,gBACApD,6EACAqD,2DACA,EACA,EAUAC,gFACA,kDAEA,qDACA,yEAaA,MAVAC,mBAKA,kCACAA,oCALAA,+DACAC,eACA,GACAC,+CAKAF,oDACAnB,cACA,EAUAsB,iEACA,+CAEA,sEACA,yDAGA,mBACA,qGACA,yEAGAlB,4DACA,CAQA,MANAG,gBACAA,gBACAc,4CAGAd,2BACAgB,OACA,EAQAC,6DACA,8BACA,4CACA,4FACA,wDAGAH,qEACA,CACA,mFACA,+EACA,gEAGAA,8BACAA,0EAEAA,2FACA,CACA,CACA,CACA,EAEA,oBACA,GC7QA5F,yDACA,SACA,aACA,aAQA,oCACA,+CACA,CAOA,sCACAC,iDACAA,kEACAA,2DACAA,gDACAuE,oBACA,EACA,EACA,EACA,EACA,CAEA,OAOAwB,8BASAC,kDACA,kBAMA,MALAD,6CACAE,6BACAC,wBAEA,GACAlG,kBACA,EAQAmG,4CACA,eAMA,MALAJ,6CACAE,6BACAG,qBAEA,GACApG,eACA,CACA,CACA,GC5EAD,sDACA,SACA,kBACA,iBACA,iDACA,oDACA,gDACA,iDACA,gGACA,aAQA,4CACA,mBAKAsG,6BACA,YACA,EASAC,qCAQA,MAPAC,gBAMAC,wCACA,IACA,EAMAC,+BACA,aACA,EAaAC,2CACA,+EACA,OACAC,4BACAtF,4DACAa,wEACA,CACA,EACA,EAMA0E,6CACA,+EACA,6BACA,EACA,EAMAC,uCACA,2CACA,EAMAC,iCACA,wCACA,CACA,EAIA,MAFAC,2DAEAC,oCACA,CAEA,2BACA,GCxGAjH,uDACA,SACA,kBACA,2CACA,8CACA,+DACA,aAOA,sDAYA,6BAIA,MAHA,wBACAyG,kDAEAA,aACA,CAMA,0BAUA,MATAS,cACAA,yCACA,mBACA,yDACA,6DACA,qDACA,8DACA,IAEAA,UACA,IAjCAC,aAEAC,WACAZ,MACAU,WACAT,cA8BA,qCACA,wDAuBA,MApBAW,8BAEAD,aACAE,sCACAb,OACA,EAEAc,uCACA,uBACA,EAEAC,6CACA,0BACA,EAEAC,2CACA,kFACA,CACA,EAEAC,uBACA,CAEA,yBACA,GC7EAzH,wCACA,SACA,OACA,WACA,4BACA,gCACA,aAKA,mBACA0H,gBACAC,wDACA,EACAC,UACAD,kDACA,EACAE,wBACAF,qDACA,CACA,EAQA,gDAOA,MALAX,6CAKA,CAMAU,yCACA,yCACA,EAOAE,mCACA,0CACA,EAOAC,iEACA,qEACA,CACA,CACA,CACA,GCnEA7H,mDACA,SACA,SACA,OACA,cACA,gCACA,uBACA,cACA,8FACA,kBAKA8H,uDAKAC,2CAMAC,8BACAF,kBACAG,4EACA,EAEAC,yDAOA,0CACAC,iCACAC,gBACA9G,iBACA+G,8DACAC,kEACAC,kBACAC,SACA,CACAC,aACAC,aACApH,YACA,EACA,CACA6G,OACA,EAGAQ,oEACAC,uBACAxB,0CACA,qBACA,EACA,GACAwB,4BAEAb,iBACAH,iBACAiB,aAEA,yBACA,GACAC,cACA,GACAF,oCAGAb,iBACAF,iCACAgB,eACA,2BACA,GACAC,cACA,GACAF,6BASAxB,iDACA,GAGAW,iBACAL,iBACAmB,uBACAT,+BACAA,sCACA,GACAS,gBAEA,uEACA,GACAA,uBAEAT,8BACA,GACAS,gBAEAT,kDACAO,2DACA,GACAA,sDACA,GACAG,cACA,CACA,GCzIA9I,0FACA,qEACA,iCACA+I,6DACA,uIAkCA,MA/BAC,uBACAC,2EACAA,mHACAD,iCACA,wHACAC,2EACAA,mHACAD,iCACA,+CACAC,2EACAA,mHACAD,iCACA,2dACAE,8MACA,oPACAA,oLACA,sKACAA,wLACA,uOACAA,sMACA,sBACAD,2EACAA,mHACAD,iCACA,oVACAC,2EACAA,mHACAD,iCACA,oYACAE,4LACA,0CACAF,MACA,EACA,GCxCAhJ,yFACA,qEACA,iCACA+I,6DACA,uIA0CA,MAvCAC,uBACAC,2EACAA,mHACAD,iCACA,6JACAC,sEACAA,8GACAD,iCACA,0dACAE,kMACA,wPACAA,8MACA,+BACAD,2EACAA,mHACAD,iCACA,2PACAE,0MACA,2PACAA,oLACA,6KACAA,wLACA,8OACAA,kMACA,6WACAD,2EACAA,mHACAD,iCACA,4FACAE,gMACA,kRACAA,sMACA,0HACAA,gLACA,gLACAA,0NACA,gGACAA,0NACA,8KACAF,MACA,EACA,GChDAhJ,6FACA,qEACA,iCACA+I,6DACA,wGAQA,MALAC,yaACAE,oNACA,uOACAA,4MACA,yWACAF,MACA,EACA,GCdAhJ,yFACA,qEACA,iCACA+I,6DACA,uIAuBA,MApBAC,qBACAC,2EACAA,mHACAD,iCACA,gBACAC,qEACAA,6GACAD,iCACA,wDACAG,qNACAA,sCACAH,gcACAE,wNACA,uOACAA,oLACA,6JACAA,wLACA,0NACAA,gNACA,8SACAF,MACA,EACA,GC7BAhJ,0FACA,qEAKA,+BAEA,4BAcA,MAbAgJ,+EACAC,qEACAA,6GACAD,iCACA,8CACAC,qEACAA,6GACAD,iCACA,8CACAC,4EACAA,oHACAD,iCACA,uBACAA,MACA,CAEA,+BAEA,6BAIA,MAHAA,+EACAE,8NACA,uBACAF,MACA,CA9BA,iCACAD,6DACA,iJAuCA,MATAC,sEACAE,0LACA,2CACAA,8KACA,2CACAA,4LACA,mBACAC,qJACAA,sCACAH,MACA,EACA,GC7CAhJ,4FACA,qEAKA,+BAEA,6BAYA,MAXAgJ,uFACAE,4LACA,8RACAA,sMACA,wgBACAA,0OACA,6PACAA,oNACA,qnBACAA,8VACA,iGACAF,MACA,CAEA,+BAEA,oCAwBA,MAvBAA,yOACAE,0MACA,gQACAC,8HACAA,sCACAH,4RACAE,gSACA,8PACAA,kMACA,qkBACAA,gPACA,+OACAA,kNACA,4dACAA,4WACA,uQACAA,kLACA,6eACAA,4QACA,sMACAC,8HACAA,sCACAH,6DACAA,MACA,CACA,+BAEA,4BAaA,MAZAA,mDACAC,oEACAA,4GACAD,iCACA,MACAG,kIACAA,sCACAH,aACAC,sEACAA,8GACAD,iCACA,8BACAA,MACA,CACA,+BAGA,6BACA,CAEA,+BAEA,4BAUA,MATAA,2GACAC,oEACAA,4GACAD,iCACA,oFACAC,4EACAA,oHACAD,iCACA,6CACAA,MACA,CArFA,iCACAD,6DACA,iJA0HA,MArCAC,wQACAE,0LACA,kBACAA,kMACA,sDACAD,2EACAA,mHACAD,iCACA,yDACAC,2EACAA,mHACAD,iCACA,iNACAC,2EACAA,mHACAD,iCACA,wOACAE,gPACA,yLACAA,gLACA,kBACAA,kMACA,4YACAA,oMACA,2DACAC,wIACAA,sCACAH,gFACAE,oLACA,6CACAC,mIACAA,sCACAH,6FACAE,8MACA,6VACAA,0LACA,0HACAF,MACA,EACA,GChIAhJ,gGACA,qEAKA,+BAGA,eACA,CAEA,+BAEA,6BAMA,MALAgJ,kLACAE,gMACA,sqBACAA,gVACA,qGACAF,MACA,CAEA,+BAEA,6BAMA,MALAA,kLACAE,gMACA,sqBACAA,kfACA,qGACAF,MACA,CAEA,+BAEA,6BAMA,MALAA,mLACAE,kMACA,+rBACAA,8UACA,qGACAF,MACA,CAEA,+BAEA,6BAYA,MAXAA,+FACAE,4LACA,gVACAA,sMACA,ikBACAA,8OACA,4UACAA,oNACA,4qBACAA,gYACA,qHACAF,MACA,CA1DA,iCACAD,6DACA,iJAmJA,MAzFAC,sCACAC,2EACAA,mHACAD,iCACA,yDACAC,2EACAA,mHACAD,iCACA,oNACAE,0LACA,kBACAA,kMACA,0DACAD,2EACAA,mHACAD,iCACA,yDACAC,2EACAA,mHACAD,iCACA,+NACAC,2EACAA,mHACAD,iCACA,4PACAE,wNACA,yNACAA,0LACA,kBACAA,kMACA,mQACAC,kRACAA,sCACAH,8QACAE,kLACA,2NACAC,kRACAA,sCACAH,0JACAE,0LACA,+QACAA,khBACA,0NACAA,0LACA,kBACAA,kMACA,mQACAC,kRACAA,sCACAH,8QACAE,0LACA,2NACAC,kRACAA,sCACAH,0JACAE,8LACA,+QACAA,4wBACA,uOACAA,0LACA,gbACAA,omBACA,4XACAA,8MACA,2UACAA,8LACA,8XACAD,4EACAA,oHACAD,iCACA,uaACAE,4SACA,6JACAC,iJACAA,sCACAH,qGACAG,iJACAA,sCACAH,8FACAG,kJACAA,sCACAH,mPACAE,0MACA,soBACAA,wRACA,yGACAC,wIACAA,sCACAH,gCACAA,MACA,EACA,GCzJAhJ,+FACA,qEAKA,+BAEA,6BAMA,MALAgJ,yIACAE,4MACA,4VACAA,kXACA,yDACAF,MACA,CAEA,+BAEA,6BAMA,MALAA,qKACAE,gMACA,ynBACAA,gVACA,qFACAF,MACA,CAEA,+BAEA,6BAMA,MALAA,qKACAE,gMACA,0nBACAA,kfACA,qFACAF,MACA,CAEA,+BAEA,6BAMA,MALAA,sKACAE,kMACA,+oBACAA,8UACA,qFACAF,MACA,CAEA,+BAEA,6BAYA,MAXAA,0FACAE,4LACA,iUACAA,sMACA,giBACAA,0OACA,qUACAA,oNACA,goBACAA,4XACA,iGACAF,MACA,CA/DA,iCACAD,6DACA,iJA+JA,MAhGAC,qCACAC,2EACAA,mHACAD,iCACA,wDACAC,sEACAA,8GACAD,iCACA,sLACAE,0LACA,kBACAA,kMACA,sDACAD,2EACAA,mHACAD,iCACA,yDACAC,2EACAA,mHACAD,iCACA,kNACAC,2EACAA,mHACAD,iCACA,wOACAE,kOACA,uNACAA,gLACA,kBACAA,kMACA,6YACAA,0MACA,oPACAA,oLACA,kBACAA,kMACA,miBACAA,oSACA,uPACAA,gMACA,qiBACAA,0qBACA,2DACAC,sIACAA,sCACAH,mKACAE,0LACA,gZACAA,gmBACA,oVACAA,wLACA,yQACAA,sMACA,seACAA,kLACA,kBACAA,kMACA,mgBACAA,8PACA,+RACAA,sMACA,6kBACAA,sVACA,oJACAA,sLACA,iUACAA,oLACA,4jBACAA,sbACA,gKACAA,8MACA,yVACAA,8LACA,yVACAD,4EACAA,oHACAD,iCACA,uYACAE,4SACA,+JACAC,iJACAA,sCACAH,mHACAG,iJACAA,sCACAH,4GACAG,kJACAA,sCACAH,wPACAE,0MACA,ulBACAA,wRACA,qFACAC,wIACAA,sCACAH,mBACAA,MACA,EACA,GCrKAhJ,+FACA,qEAKA,+BAEA,6BAMA,MALAgJ,qKACAE,gMACA,ynBACAA,gVACA,qFACAF,MACA,CAEA,+BAEA,6BAMA,MALAA,qKACAE,gMACA,0nBACAA,kfACA,qFACAF,MACA,CAEA,+BAEA,6BAMA,MALAA,sKACAE,kMACA,+oBACAA,8UACA,qFACAF,MACA,CAEA,+BAEA,oCAkCA,MAjCAA,sFACAE,4LACA,2RACAA,sMACA,4gBACAA,kVACA,iCACAA,4SACA,iCACAA,oXACA,uKACAA,sQACA,yMACAA,sMACA,2bACAC,kIACAA,sCACAH,mGACAE,sMACA,weACAA,oOACA,sMACAC,mIACAA,sCACAH,2FACAE,sMACA,4eACAA,oOACA,qTACAA,oNACA,olBACAA,sXACA,iFACAF,MACA,CACA,+BAGA,cACA,CA/EA,iCACAD,6DACA,iJAiKA,MAlFAC,qCACAC,2EACAA,mHACAD,iCACA,yDACAG,qNACAA,sCACAH,0MACAE,0LACA,kBACAA,kMACA,sDACAD,2EACAA,mHACAD,iCACA,yDACAC,2EACAA,mHACAD,iCACA,oNACAC,2EACAA,mHACAD,iCACA,wOACAE,gPACA,iOACAA,wLACA,kBACAA,kMACA,uYACAA,kMACA,0PACAA,sLACA,qgBACAA,8RACA,oPACAA,gLACA,+fACAA,wPACA,2MACAA,0LACA,iHACAA,wMACA,kRACAA,4RACA,2kBACAA,oLACA,uJACAA,0LACA,6FACAA,gLACA,kQACAA,sUACA,iXACAA,sMACA,8IACAA,8MACA,iXACAA,8LACA,2VACAD,4EACAA,oHACAD,iCACA,uYACAE,4SACA,2KACAC,iJACAA,sCACAH,+HACAG,iJACAA,sCACAH,wHACAG,kJACAA,sCACAH,oQACAE,0MACA,ulBACAA,wRACA,qFACAC,wIACAA,sCACAH,mBACAA,MACA,EACA,GCvKAhJ,sGACA,qEACA,iCACA+I,6DACA,2FAgBA,MAbAC,6LACAC,2EACAA,mHACAD,iCACA,+BACAC,2EACAA,mHACAD,iCACA,kJACAC,sEACAA,8GACAD,iCACA,gPACAA,MACA,EACA,GCtBAhJ,mGACA,qEAKA,+BAEA,6BAcA,MAbAgJ,2SACAE,wLACA,wjBACAA,sPACA,oTACAA,oLACA,4fACAA,oRACA,+TACAA,4LACA,mgBACAA,0SACA,iFACAF,MACA,CArBA,iCACAD,6DACA,iJA2DA,MAtCAC,wEACAE,8LACA,MACAD,2EACAA,mHACAD,iCACA,sNACAE,gLACA,kBACAA,kMACA,8LACAA,kLACA,0DACAA,wLACA,wDACAA,oLACA,uDACAA,kLACA,gEACAA,sMACA,sDACAA,gLACA,qQACAA,0QACA,iPACAA,gLACA,ycACAA,8PACA,8OACAA,0LACA,mcACAA,wQACA,oIACAA,kMACA,wGACAC,oIACAA,sCACAH,mBACAA,MACA,EACA,GCjEAhJ,kGACA,qEAKA,sCAEA,4BAiBA,MAhBAgJ,mFACAC,wEACAA,gHACAD,iCACA,OACAC,2EACAA,mHACAD,iCACA,gDACAC,wEACAA,gHACAD,iCACA,oBACAG,gJACAA,sCACAH,uBACAA,MACA,CACA,sCAEA,oCA6BA,MA5BAA,gGACAC,4EACAA,oHACAD,iCACA,+KACAC,mEACAA,2GACAD,iCACA,wCACAC,4EACAA,oHACAD,iCACA,+BACAG,qUACAA,sCACAH,wMACAC,mEACAA,2GACAD,iCACA,OACAC,sEACAA,8GACAD,iCACA,8OACAC,4EACAA,oHACAD,iCACA,yDACAA,MACA,CACA,+BAGA,eACA,CA9DA,iCACAD,6DACA,8HA8DAI,qJACAA,0BACA,EACA,EACA,GCtEAnJ,4FACA,qEACA,iCACA+I,6DACA,uIA0CA,MAvCAC,uBACAC,2EACAA,mHACAD,iCACA,sGACAC,sEACAA,8GACAD,iCACA,0dACAE,kMACA,wPACAA,8MACA,+BACAD,2EACAA,mHACAD,iCACA,2PACAE,0MACA,2PACAA,oLACA,gLACAA,wLACA,mQACAA,wMACA,mXACAD,2EACAA,mHACAD,iCACA,4FACAE,gMACA,kRACAA,sMACA,0HACAA,gLACA,gLACAA,0NACA,gGACAA,0NACA,4KACAF,MACA,EACA,GC5BAhJ,wDACA,gDACA,uDACA,sDACA,0DACA,sDACA,uDACA,yDACA,6DACA,4DACA,4DACA,mEACA,gEACA,+DACA,yDACA,CACA,SACAoJ,SACAC,SACAC,QACAC,YACAC,QACA5E,SACA6E,UACAC,cACAC,aACAC,aACAC,mBACAC,iBACAC,gBACAC,WACA,CACA,aAEA,8EAMA,OACAC,8CACAX,4CACAY,4CACAC,oDACAvF,8CACAoF,kDACAnH,YACAuH,2CACAH,mDACAX,iDACAY,iDACAG,6DACAF,yDACAG,4DACAN,mDAEA,CACA,CACA,GC3DAhK,0JACAuK,EACAC,GACAC,WACAC,UACA,CACA,aAcA,iDAmGA,0BACAC,oDACAC,6CACAC,2DAGAC,uDACAC,0GAEA,wBACAC,4BAEAT,2CACAA,kEAEAA,8EAGAA,2CACAA,oEAEAA,+EAGA,GAEAI,wDACA,MA7HAvD,qCACA6D,wCACA,eAKAC,0BACA,qBACAR,8BACA,EACAtD,mEACAuD,+DAGAH,4BAGA,2DACAW,kBAEAC,iBAEAT,mCAMA,iEACAA,qCACA,4CACAU,kCAEA,EACA,EAMAC,+BACA,YACA,EAMAC,6BACA,mCACA,EAMAC,+BACAb,yCACAc,oBACAjH,IACA,EACA,EAMAkH,iCACAf,0CACAc,oBACAjH,IACA,EACA,EAKAmH,+BACAhB,cACA,EAKAiB,6BACAxE,8EACAmE,SACAZ,2CAEAA,yCAEA,EAmCA,OACAO,UACAI,gBACAC,cACAC,cACAE,gBACAC,gBACAC,aACA,CACA,EAEA,eACA,GCpKA5L,4FACA,aAQA,4CACA,oDACA,CAOA,yCACA,kDACA,CAOA,kCACA,gEACA,CAOA,4CACA,kEACA,CAOA,0CACA,iDACA,CAOA,uCACA,sCACA,CAOA,sCACA6L,oCACAC,8BAEAC,gCACA,CAOA,6CACA,kGACA,CAQA,mDACAC,8CACAC,4DACAC,4FACA,sCACA,0CACA,MACAC,oDACAC,kFACA,0DACA,CACA,CAEA,OACAP,sBACAQ,mBACAC,eACAC,uBACAC,sBACAT,oBACAD,iBACAW,UACAC,uBACA,CACA,GCzGA1M,sDACA,SACA,+CACA,mDACA,4CACA,aAaA,kDACA,kBACAoH,4DACAqE,mBACA,mBACAlB,kCACAoC,YAEA,iBACAvF,iCACAuF,0BAEAC,sCACAA,gBAEAA,2BACAxF,iCACAuF,yBACA,GACAC,4BACAxF,oCACAuF,4BACA,GAEA,uBACAnI,cAGAoI,kBAGA,EACA,CAQA,iEACAC,uDACAzF,kDAGAmD,iDACA,0BAGAkB,sBACAoB,+DAKAC,kDACAb,gCACA,SACAY,0BACAA,SACAE,qEACAC,4CACA,GAEA,GAGAzC,mDACA,0BAGAkB,sBACAoB,+DAKAC,kDACAb,gCACAA,8CACAY,0BACAA,SACAI,oEACAD,4CACA,GAEA,EACA,CAQA,6DACA5F,gCACAuF,cACAO,mDAEAjB,6BACAkB,uCACAC,2CAGA,uBACAD,gCACAC,mCAGA,WACAD,gCACAC,sCAGAnB,4BACAmB,kCACAD,qCAIAA,mCACAC,qCAEA,EACA,CAOA,kDACAhG,gCACAuF,cACAO,mDACAG,4CAEA,mDACAA,gCAEAA,kCAEA,EACA,CAOA,gDAEA,sBACAjG,qFAEA,CAOA,+CACAA,4GACA,CAQA,2CACAuF,4CACAW,mEACAA,iBACAX,YAEAA,WAEA,CAMA,gDACA,gEACA,kDACA,kDACAY,iEACA,CACA,CASA,qIACAC,mCACAC,+DACA,2BAIA,qDACA,cACA,eACAd,YACA,MAEA,cACA,oFACAW,kBACAX,YACAc,mDAEAd,YAEA,CACA,CACA,CAMA,iCACAe,2BACAf,cACAgB,iDAEA,kCACAC,mCACA3B,wCACA0B,8BACA,KACAA,iEAEA,EACA,MA/PAE,0BACAC,qBACAC,2BAoQA,OACAlL,WACAmL,KACAC,UACAC,QACAC,QACAC,OACAC,mBACAC,qBACAC,uBACAC,gBACA,CACA,GC3RAxO,0GACA,aAMA,uCACAyO,oEACAjI,wBAEA,CAMA,2CACA,gEACAiI,6EACAjI,yBAEAiI,kGACAjI,kCAEAiI,kGACAjI,kCAEAiI,mGACAjI,kCAEA,CAMA,0CACA,+DACAiI,4EACAjI,yBAEAiI,iGACAjI,kCAEAiI,iGACAjI,kCAEAiI,kGACAjI,kCAEA,CAMA,0CACA,+DACAiI,4EACAjI,yBAEAiI,iGACAjI,kCAEAiI,iGACAjI,kCAEAiI,kGACAjI,kCAEA,CAQA,wHACAkI,4EACAC,uEACA,mBAgBA,MAfAC,qCACAC,gDACAJ,qEACA,EACAI,uBACAA,uCACA,wDACA,2DACAJ,4DACA,EACAK,qCACA,CACA,IAGAD,cACA,CAEA,OACAE,uBACAC,2BACAC,0BACAC,0BACAC,oBACA,CACA,GCtGAnP,iEACA,SACA,SACA,OACA,kBACA,aACA,gDACA,0DACA,UACA,iEACA,aAMA,6CAWA,4BACA,GAGAoP,2BACApM,uCACAqM,UACAC,yBACA,uBACA,GACAC,+BACAvM,6CACAqM,UACAC,yBACA,uBACA,GACAE,qHACAH,UACAC,yBACA,4DACA,GACAG,kHACAJ,UACAC,yBACA,4DACA,GAxBAI,mBACAC,yBAyBAD,yDACAC,yEAOA,2EACA,CA9CA,GAEAC,wDAEAC,kEAJAC,iBAGAC,mBA4IA,MA/FAD,mBAQAE,wDACA,cACAC,gDACAC,yEAEA,+EAEAN,yBACAK,2CACA,CAEAL,yCACA,oDACAO,UAEAC,iBACAD,gCACAA,mCAEAlQ,mBACAoQ,2BACA,GAEA,GAGAR,iCACAS,aACAC,sBACAC,YACAC,8BACAC,2BACA,oCACA,EACAC,qBACA,0BACAN,2BACA,GAGAO,0BACA,EAOAC,iEACA,qBAEAC,gCAEAZ,sFAIAH,6DACAA,mCACA,wBAEA,sBACA,gBAEA,qCAEA,kCACA,iBAFA,qBAIA,GAIAF,wDAEAA,yGACAkB,aACAC,+BACA,qCACAD,uBAEA,EACA,CACA,EAEAtJ,6BAEAqI,gBACA,CAgCA,wCACA,gDACA,oDACA,4BACA,KACA,CA1LA,kBACAmB,2BA2LA,MAlBAC,iEACAjR,qBACAkR,mBACAF,uDAEA,EAaAC,uBACA,GCjNAlR,gEACA,SACA,OACA,oBACA,6BAEA,aAUA,oCACA,gGACA,CAUA,+CAEA,GAEAoR,wCAFAC,SACAC,MAGAC,oBAGAF,sEAGAC,0DAEA9K,yDACAA,gDAGAgL,2BACAC,gCACA,CAQA,8BACA,GAKAC,aALAvL,WACAwL,OACAC,MACAC,WACAN,QACA,MAEAO,6BAIA3L,sDACA,yFACA,oCAEA,GAEA,YACA4L,qDAIAJ,4BACAC,iCAGAC,6CAGAN,uCAEAQ,4CAvBAC,mEAwBA,CASA,yCACAF,2BACA7R,4CACA,4CACA,iCACAuJ,uBAEAA,0DAEA,GAEAwI,mEAEA,CASA,4CACAF,2BACA7R,4CACA,2EACAuJ,+DAEA,GAEAwI,mEAEA,CAEA,qOACA,oBACAC,QACAJ,sBACAN,eACA,uBACA,wBACA,EACA,CApIA,2BAsIA,OACAO,wCACAI,4BACApL,4BACA0K,4BACAC,iCACA,CACA,GCpJAzR,2DACA,0BACA,SACA,SACA,OACA,gDACA,mDACA,sDACA,0EACA,aAWA,6BACA,OACA4G,gBACAuL,0CACAC,kCACA,6BACAC,kCAEA,CACA,CACA,CAMA,iCACA,+BACA,OACAzL,oBACAuL,mEACAC,kCACA,6BACAC,sCAEA,CACA,CACA,CAOA,6CACA,OACAzL,uBACAuL,2CACAC,0CACA,4BACA1O,yBACA4O,8EAIAC,qEACA,gCACA,iDAIAF,SACA,iCACA,4DAEA,CACA,KACA,0DAEA,CACA,CACA,CAMA,2CAEAG,oDACAA,4DACAA,6EACA,CAOA,8BACA,iEACA,2BACA,4DACA,sBAUA,GARAvS,eACAwS,sBACAC,2BACA,UACAC,uBACAC,0BAEA,GACA,wBACA,qGAGA3S,6CACAA,kEACAA,+DACA,mDACAsJ,YACA,gCACA,UACA,CACA,6DACA,gBACAsJ,GACA,+EACAC,gCACA,CAGA,EACA,EACA,EACA,CAQA,uEACAR,gBAEAS,kCACAhQ,uEACA,+EACAuP,kBACAxP,4CACAkQ,sCACA1R,yBACAmH,uCACA,GAGAxI,wCACAA,sDACA,yEACA8S,mBAGA,EACA,EAQA,OANA9S,4CACAgT,8BACAC,wCAEAH,gBAEAT,WACA,CAQA,sDACAA,+EACA5O,wBACAyP,2CACA,gDACA,MAhLAC,oCAGAC,2FA8KA,OACAA,qBACAC,mBACAC,mBACAC,cACAC,kBACA,CACA,GChMAzT,uJACA,aAMA,qBAQA0T,6EACA,wGACA,EAQAC,0DACA,2CACA,EAQAC,iDACA,kDACA,EAOAC,oEACA5T,mCACA,gEACAA,gBACA6T,aACAnR,8BAGAA,uBAGA1C,iBACA,mDACAA,mBACA,6BAEA,EACA,EAOA8T,kDAkDA,MAjDAvN,qDACAvG,6CACAoJ,qEACApJ,kEAGA+T,4BACA,wDACA,yCAEA,kCAIAA,2EACA/T,wDAEAgU,iBACAhU,6BACA,6DAEAgU,mBAEA,GAGAD,4EAGA,2CACA,2CACA,qDAEA,sCACA,yCAEA/T,+DACAsJ,+BAKA,GAGA,EAEA,GAEA/C,KACA,EAQA0N,iFACA,YACA,kBACApR,YACAqR,QAEAA,QADAlU,oDACA,2DAEA,qCAGAmU,+BAEA,EACAtR,0CAEA7C,8CACAsK,4BAGA,iBACA,CACA,EAEA,oBACA,GCxJAvK,sDACA,SACA,SACA,OACA,8CACA,yDACA,wDACA,gDACA,0DACA,gDACA,UACAuK,EACAtK,EACA4S,GACAwB,QACAnD,wBACAoD,gBACAC,cACAC,kBACA9J,UACA,CAsBA,wEAmCA,yCACAC,0BAGA8J,gDACAC,gDACAC,sDACAC,iDACAC,+DACAC,iEACAC,iEAMAC,+CACAD,iCACAA,yDACA9U,mBACA8U,+CACA,EACA,OAMAE,+CACAH,iCACAA,yDACA7U,mBACA6U,+CACA,EACA,OAKAI,iCACAN,QACAO,wBACAC,mBACAC,sDAGAP,yDAGAA,gDACAC,+CACA,EAKAO,qCACAV,QACAO,sBACAC,qBACAC,qEAEAR,mCACAC,+CACA,EAKAS,qDACAC,+CACAA,4CACAf,qCACAC,qCACAC,2CACAG,6EACAI,aAEAN,+BACAnJ,mBAEAmJ,2BACAU,eAEAJ,YAEA,IACAM,mBACAb,wCACAF,wCACAC,0CAEAC,wCACAF,qCACAC,wCAEA,EAGAjO,8CACA8O,sBACA,GAEAA,uBAGAV,6CAEA,+BACA,+BACAW,wDAEAV,kFAEAA,oFAEA,EACA,CAOA,mCACA,oDACAW,yDAEA3F,0CACAA,sDAEAnF,wCACAmF,qDACA,GAEAA,yDAEA2F,uCACAA,iCAEAhP,iDACA,EACA,CAKA,mCACA,6BACAiP,uDACAC,6CAEAhL,yDACA,iBACAhI,QACA,oBACAG,WACA,4BACA,SACAyR,gEACA,EACA9I,mBAEAiK,2CACAF,mCACAE,0CAEA/K,sBACA,EACA,CAOA,+BACA,wEACAiL,WACAC,oBACAA,wCACAA,yCACA,CACAC,sCAEA,mDACAlJ,kBAEA,EAEAmJ,uCACAC,0BACAC,6BAEAJ,sEACA,IArOApP,iDACAO,qCACAkG,wCAGAsI,8BACAA,gCAEAvV,wEAEAuV,+CAGAhB,sDAEAH,oEACAA,oDAKApU,gCACAiW,4CACA5F,kDACA/F,mCACA,MA6MA,CAKA,6BACAA,+BACA8J,2DACA,GAEA9J,YACA3B,2BAEAuN,qBADAvI,QAEAuI,8BACAvI,qCAEA,GACAhF,wEAEAuN,qBADAvI,SAEAuI,6DACAvI,wFACAyG,mCACAA,8CAEA,EACA,CAvRA,aAKA,2CACA+B,8BACAF,wCACA5F,+CACA/F,mCACA,OAoRA,OACA8L,YACAC,mCACA,CACA,GCvTAtW,yDACA,SACA,SACA,mDACA,iDACA,uBACA,mDACA,aAoCA,+BACA,sBACA,WACA,UACA,UACA,OACA,QACA,CACA,CAOA,+BACA,yDACAC,6EACAsW,8BAEAA,GACA,KACA,CASA,qCACA,0DACA,8CACA,MAhEAC,kBACAC,8BACAC,sCACAC,oBACAC,kCACAC,sBACAC,mCACA,EAMAC,iBACAC,iBACAlU,oDACAmU,gDACAC,mDACAjL,oDACAkL,+CACAC,2CACAC,qDACA,CACA,EAgDA,OAOAC,4BACA,cACAC,SAEA,yBACA,kDACA,gCACA,MAWA,MAVAtX,gDACA,mCACAuX,oBAEAD,yEACAC,mBACAD,6EAEAA,eAGA,aACA,EAOAE,gCACAC,WACAC,yDACA9T,UACA,aAqCA,MAnCA5D,oCACA,WACA,iBACA,mCACA4D,+CACA,0CACA,UACA,IAEA,mBACA+T,yCAEAC,iDACA,MACA,SACA,WACA,QACA,QACA,GACA5X,+CACA,iDACA6X,WACAf,+DACAR,qFAEAA,8BAGA,IACA,0BACAsB,4CAEAhU,oBAEA,GACAA,MACA,CACA,CACA,GCjKA7D,0DACA,SACA,SACA,WACA,8CACA,+CACA,sDACA,aAEA,OACA4C,6DACA8U,WACAK,gBACA7Q,0CACAT,gDAEAuR,mGAQA,CAEAC,SACA,CACArR,mBACAsR,iDACA,GACAtR,cACAsR,6CACA,GACAtR,aACAsR,cACA,EACA,IACA,CACAtR,cACAsR,gBACA,GACAtR,iBACAsR,kHACA,EACA,CAEAC,sEAEAC,mCACAlR,sBACA8Q,4BACAC,gBACAI,UACAC,mCACA,uCACA,CACA,EACAC,8BACAC,iBACAC,YACA,GAGAC,sDACAhB,uCACA,GAEAtQ,oCACA,EAKAuE,oDACA,yCAIA,MAHAoM,WACAW,iCAEAN,mCACA,CACA,CACA,GCnFApY,0DACA,SACA,SACA,OACA,WACA,kBACA,iBACA,8CACA,UACA,iDACA,mDACA,kDACA,WACA,sHACA,aAOA,OAQAqW,8DAYA,qCAEA,MADAsC,mEACAC,mCACA,CAOA,0BAQA,MAPAC,yBACA,0DACAA,4BAEA,mBACAA,4BAEAA,IACA,CAKA,gCACAC,4EACAC,8FACA/H,gDAEA+H,QACAA,wBAEAD,sBAEA,CAKA,4BACAA,gFACAC,8FACA/H,+CACA6H,gDAGAG,8EAEAC,+BAGAD,6DACAT,sCACAW,4BACA,CACA,EACA,EACA,CAOA,qCACAC,wCACAJ,8FAyBA,MAvBAI,YAEAJ,SASAA,2CACAA,wCATAK,oDACApI,kDACAqI,mCACAvW,+BACAkO,2BACA,GACA,IAKAsI,iBAGAP,UACAK,oCACAE,iBAIAH,SACA,CAOA,+BAQA,mCACAI,6CACAA,0CACA,CAGA,6BACAH,wBACA,iBACAxM,kBAEA,CAGA,uCACA,kEACA4M,qDAEA,CAGA,6BACAL,gEAEAvU,+DACA,OACA4I,QACAiM,SACA,CACA,GAGAC,0BACAC,2BACArJ,aACAsJ,aACA,GAGAT,WACAU,sCAEAL,yBACA,IAlDA7O,0BACAmP,yDACAC,2DACAL,oDACAG,+CAgDAtP,gCACAoP,2BACArJ,YACA,GAEA3F,wCACAqP,wEACAA,uEACAA,mDACAA,oDACAN,yBACAO,gBACA,GACAD,oDACAE,qCACAD,gBACA,GAEAT,qCACAS,iBACAE,cACA,CAOA,iCACA,4CAEAH,uEACA,mCACAI,0BAEA,GAEA,mCACAA,0BAEA,IA3MA3T,iDACAS,0CACA+R,2DA2MAG,gDACAA,iCACAA,sBACAD,kGACArT,iHACAuU,4GACA,EAEA5T,cACA6T,mDACA,uEACAC,gFAEA9T,yEACA2S,kCACAA,gCACAc,qCACAM,yCAGAA,uCAEA,GACA5R,+CAEAnC,mCAEAgU,wGACAhU,mCAEA,GAEA4N,uEAEAiF,gBAIAU,2CACAhB,6DACA,GAEAC,gDAEA/R,yFACA,GAGAA,qFACAwT,4CACA,EACA,CACA,CACA,GCtQA1a,0DACA,SACA,oBACA,0BACA,aASA,sCACAC,8CACA0a,oCACA,EACA,CAOA,8CACA1a,0DACA2a,kCACA,EACA,CAOA,4CACA3a,uDAEA,sDAEA2a,2CACA,wDACA,+BACA,sBACApW,YAEAwN,+CAEA,CACA,EACA,CA5CA,uBA8CA,OACA6I,eACAF,mBACAC,iBACA,CACA,GCvFA5a,iEACA,SACA,OACA,wDACA,kDACA,oBACA,6DACA,aAUA,qCACA,0BACA,gCACAC,qCACAuG,qFACA,CAUA,kHAEA4K,wCAKAC,sEAGAC,0DAEA9K,yDACAA,gDAGAgL,2BACAC,gCACA,CAeA,8BACA,gCACA,4DAGA,gBAMA,2BAOA,GANAqJ,mDACA,4CACAC,qDAEA,GAEA,WACA,2DACA,KAGAnJ,6CAEAC,wDAEAN,uCAEA,iDACA,CASA,yCACAyJ,4BACAF,mDACA7a,gCACAuJ,uBAEAA,yDACA,GAEAwI,oDAEA,CASA,4CACAgJ,4BACAF,mDACA7a,gCACAuJ,+DAEA,GAEAwI,oDAEA,CASA,qOACA,oBACAC,QACAJ,sBACAN,eACA,uBACA,wBACA,EACA,CA9IA,8BAgJA,OACAyJ,0CACA9I,4BACApL,4BACA0K,4BACAC,iCACA,CACA,GChKAzR,kEACA,SACA,OACA,oBACA,6BAEA,aAYA,uCACAwG,yBACA,CASA,oCAEA,eACAmB,WACArG,WACAsY,MACAtQ,wBACA,EACA2R,eAEA,GACAC,gBACAlJ,oEACA,EAEA,CApCA,4BAsCA,OACAmJ,0BACAC,yBACA,CACA,GCjDApb,yDACA,SACA,SACA,MACA,OACA,gDACA,8CACA,8CACA,kDACA,gDACA,gDACA,yDACA,wDACA,0DACA,oBACA,mDACA,mDACA,UACAuK,EACAtK,EACAyI,IACAmK,GACAzJ,SACAiL,QACAgH,YACAC,gBACA5Q,UACA6J,cACArD,wBACAoD,gBACAiH,iBACAC,cACAC,kBACAjJ,WACA,CACA,aASA,wEA4CA,+BAqDA,gDACAoD,+EAEAE,sCAOA,mDACAlJ,kBAEA,MAjEAjC,0BAGA+Q,8DACAC,kDACAC,6DAIAC,2FAEAC,2CACA,yCACAH,uCACAC,4CAEAD,wCACAC,uCAEA,EACAF,gDACAA,sDACAA,qCACAC,wBACAC,qCACA,iCAEA,GAEAF,2EAGA,sDACA/Q,qCACA,2EACAoR,kCAEA,GAIAC,0EAGAjG,0BAEA,kDACAkG,yBAGA5H,2CAgBA,CAKA,uBACA6H,+BACAA,iCAGAT,mEACAU,sBACAlQ,sCACAiQ,sCACAA,wCAGA7F,sFACA,EACA,CAKA,oBACA6F,+BACAA,iCAEA3R,oDACAsL,kBACA5J,kCACAiQ,sCACAA,wCAGAb,kBACA3C,eACAwD,oCACAA,gBACAE,aACAvG,SACA,CACAA,6EACA,EACA,CAOA,0BACA,2DAGAwG,+DACAC,yDACAC,wCAEA,oBACAD,aACAE,OACAC,aACA7T,sBAEA,yBAGAsT,oCACA,iEAGAQ,gFAIAA,8DAEAzc,mCACA,0BACA,CACA0c,cACAlU,iBACA,8BACA,EACAiU,gBACA,CAEAzc,6BACA2c,iEAGAC,yDACA,GAEAR,4CAEAE,iCACA,GAEAA,iCAEA,GAIAhS,YACAkS,mFACA7T,GACA,aACA,iEACA,qBACA,GACA,wBACAiN,8BACAA,oEACA,MACA5J,mCACA6Q,iDAGAzB,qFAMA5U,8CACA,CACA,EAEA,CAQA,6CACA,qCACAwF,2BACA2Q,yDACAnW,yBACA,oBACA,OACA,CACAmW,uBACA,8CACA,QACA/G,yCAEAA,4BAEAkH,2CACA,CAMA,wBACAb,+BACAA,iCAEA3R,kDACAiQ,sBACAvO,sCACAiQ,sCACAA,wCAGAZ,sFACA,GAGA,uCACA/Q,oDAEA,CAOA,0BACAA,sCACAyS,qCACAhM,8BACAiM,0BACAzY,IACA,yBACAyH,0CACA+E,WACA9L,SACA,EACA,CACA,GAIAqF,YACAkS,+EACA7T,GACA,aACA,6DACA,yBACA,GACA,wBACA4R,sCACAA,wEACA,MACAvO,uCACAmN,oDAEA7O,6DACA+Q,+DAMA7U,+CACA,CACA,EAEA,CAQA,mCACA,gEACAqJ,gDAEAA,4CACAe,kCAEAlG,wCACAkG,iCACA,GAEAlG,6CACAuR,iDACArL,iCACA,GAEAf,uEACAwE,sEAEA7N,wCACA,EACA,CAEA,2CACA,gEACAqJ,0EACA,CAOA,kCAyCA,yBACA,+CACAyL,iBACAH,mEACA8B,uBACAjd,iBACA,iCACAic,mCACA9B,qDACAA,0BAGA,EAEA,CAOA,iCACAmB,wDACA,CA/DA,kDACAnB,QACA+C,SACAC,MACAzV,iCACAsT,gBACAoC,UACAC,cACA1D,sBACA,OACA9W,iBACA,CACA,EACAya,uBACA,WACA,CACA,EACAC,qBACAlN,aACAE,YACAiN,cACAC,qCACAhN,2BACA,8BACA,EACAC,qBACA,GACA/H,wBACAuS,mBACA,GAEAwC,gBACAhT,wCACAgT,eACA,EA8BA,CAEA,yBACA,4BACAC,SACAC,QACAC,aACAC,eACA,CACA,CACA,EAEAxT,8CACAyS,4CACAhM,6BACAiM,0BAEA,oBACAjB,iCACAgC,4CACAhC,sCAEAxX,IACA,+BACA1B,gDACA2D,yBACA,oBACA,aACA,CACAwX,oCACAhS,QACA+R,aACAE,UACA,EACA,EACAC,qCACA,GACAjC,iCACA3H,iFACA,MAEAnI,wEACAgS,kBACA,uGACAhS,gBACA8P,sBACA,uBACA9S,8BACA,CACAiV,oBAEA9T,yDACAyR,sEACA,GACAsC,gBAEA/T,wCAIA2R,+CACA1J,kEACAhJ,wDACA/C,yBACA,oBACA,OACA,CAEA,GACAuV,qEACAE,gCACAqC,YACA,IACA,EACA/C,yEACAgD,SACAxb,iBACAyb,sBACAA,mCACA,KACA,yEACAzC,wEAEAuC,YAEA,CACA,GAIAhU,YACAkS,oEACA7T,2FACA,GACA,wBACAuT,qCACAA,2CACA,MAEAuC,kDACAC,gEAEA3C,sCACA2C,gEACA3C,2CAIA3F,oEAEAhC,wCACAA,4CAEAA,uCAMA5N,qDACA,CACA,EACA,MApjBAmY,4DACAC,6CACAC,6CAEArY,gDACAO,iCAGAkV,qCACAA,uCAEAA,6BACAA,kDAEAjc,+EAEAA,0CACAic,iCAEA7H,4EACAA,2DACAA,wCACAA,gDAEA0K,cACAC,WACAC,iBACAC,eACAC,iBAEA1D,mDAEAlR,wCACAA,0DAEA6U,eAkhBA,CAKA,6BACA7U,kCACA,4CAEA8J,qCACAA,gDACAA,sCACA,GAEA9J,YACA3B,wBACA,0BACA,mCACA,mDACA0V,gBACAjK,oCACAA,wCAEA,4CACAA,sCACA,MACA,CACA,GACAzL,yDACA,0BACA,oEACA,oEAIA,GAHAyL,qCACAA,gDAEA,yCACAzG,8CACAyR,+CACAhL,gDACAA,oCACAA,uCACA,CACA,CACA,EACA,CAMA,OACAgC,YACAC,mCACA,CACA,GCtpBAtW,sDACA,SACA,SACA,MACA,OACA,gDACA,8CACA,8CACA,kDACA,gDACA,gDACA,yDACA,yDACA,wDACA,0DACA,iDACA,oBACA,mDACA,mDACA,0DACA,UACAuK,EACAtK,EACAyI,IACAmK,GACAzJ,SACAiL,QACAgH,YACAC,gBACA5Q,UACA6J,cACArD,wBACAoO,iBACAhL,gBACAiH,iBACAgE,eACA/D,cACAC,kBACAjJ,WACAgC,kBACA,CAWA,+DA0CA,+BAqDA,gDACAoB,yEAEAE,sCAOA,mDACAlJ,kBAEA,MAjEAjC,0BAGA+Q,8DACAC,kDACAC,6DAIAC,qFAEAC,2CACA,yCACAH,uCACAC,4CAEAD,wCACAC,uCAEA,EACAF,gDACAA,sDACAA,qCACAC,wBACAC,qCACA,8BAEA,GAEAF,2EAGA,sDACA/Q,qCACA,wEACAoR,+BAEA,GAIAyD,uEAGAzJ,0BAEA,+CACAkG,yBAGA5H,wCAgBA,CAMA,uBACA+H,4BACAA,8BAGAX,gEACAO,qBACA/P,qCACAmQ,mCACAA,qCAGAmD,8FACA,EACA,CAKA,oBACAnD,4BACAA,8BAEA7R,oDACAsL,kBACA5J,kCACAmQ,mCACAA,qCAGAf,mGACAxF,6EACA,EACA,CAOA,0BACA,2DAGAwG,+DACAC,yDACAC,wCAEA,oBACAD,aACAE,OACAC,aACA7T,sBAEA,yBAGAwT,iCACA,8DAGAM,6EAIAA,8DAEAzc,mCACA,0BACA,CACA0c,cACAlU,iBACA,8BACA,EACAiU,gBACA,CAEAzc,6BACA2c,iEAGAC,yDACA,GAEAR,4CAEAE,iCACA,GAEAA,iCAEA,GAIAhS,YACAkS,gFACA7T,GACA,aACA,8DACA,qBACA,GACA,wBACAiN,8BACA,wCACA,MACA5J,mCACA6Q,8CAGAzB,+EAMA5U,8CACA,CACA,EAEA,CAQA,6CACA,qCACAwF,2BACA2Q,yDACAnW,yBACA,oBACA,OACA,CACAmW,uBACA,8CACA,QACA/G,yCAEAA,4BAEAkH,2CACA,CAMA,wBACAX,4BACAA,8BAEA7R,kDACAiQ,sBACAvO,sCACAmQ,mCACAA,qCAGAd,mFACA,GAGA,oCACA/Q,oDAEA,CAOA,0BACAA,sCACAyS,qCACAhM,8BACAiM,0BACAzY,IACA,yBACAyH,0CACA+E,WACA9L,SACA,EACA,CACA,GAIAqF,YACAkS,4EACA7T,GACA,aACA,0DACA,yBACA,GACA,wBACA4R,sCACA,4CACA,MACAvO,uCACAmN,iDAEA7O,6DACA+Q,+DAMA7U,+CACA,CACA,EAEA,CAQA,mCACA,6DACAqJ,gDAEAA,sDACAe,kCAEAlG,wCACAkG,iCACA,GAEAlG,6CACAyR,8CACAvL,iCACA,GAEAf,uEACAwE,mEAEA7N,wCACA,EACA,CAEA,2CACA,6DACAqJ,0EACA,CAOA,kCAyCA,yBACA,4CACAyL,iBACAH,gEACA8B,uBACAjd,iBACA,8BACAmc,gCACAhC,qDACAA,0BAGA,EAEA,CAOA,iCACAmB,qDACA,CA/DA,kDACAnB,QACA+C,SACAC,MACAzV,iCACAsT,gBACAoC,UACAC,cACA1D,sBACA,OACA9W,iBACA,CACA,EACAya,uBACA,WACA,CACA,EACAC,qBACAlN,aACAE,YACAiN,cACAC,qCACAhN,2BACA,8BACA,EACAC,qBACA,GACA/H,wBACAuS,mBACA,GAEAwC,gBACAhT,wCACAgT,eACA,EA8BA,CAEA,yBACA,4BACAC,SACAC,QACAC,aACAC,eACA,CACA,CACA,EAEAxT,8CACAyS,yCACAhM,6BACAiM,0BAEA,oBACAuC,8BACAxB,yCACAwB,mCAEAhb,IACA,+BACA1B,gDACA2D,yBACA,oBACA,aACA,CACAwX,oCACAhS,QACA+R,aACAE,UACA,EACA,EACAC,qCACA,GACA/B,8BACA7H,8EACA,MAEA3G,uCACA3B,4CACAmS,kBACA,uGACA,cACAhC,mBACA,gBACAhT,8BACA,CACAiV,oBAEA9T,yDACAiV,mEACA,GACAlB,gBAEA/T,wCAIA6R,4CACA5J,kEACAhJ,wDACA/C,yBACA,oBACA,OACA,CAEA,GACA+Y,+DACApD,6BACAmC,YACA,IACA,EACA/C,yEACAgD,SACAxb,iBACAyb,sBACAA,mCACA,KACA,mEACAe,kEAEAjB,YAEA,CACA,GAIAhU,YACAkS,iEACA7T,uFACA,GACA,wBACAoT,oCACA,2CACA,MAEA5P,gDACA8P,2DAEAsD,mCACAtD,4DACAsD,wCAIAD,8EAEAlL,qCACAA,yCAEAA,sCAMA5N,oDACA,CACA,EACA,MA9iBAmY,yDACAC,0CACAC,0CAEArY,gDACAO,iCAMA,GAHAoV,kCACAA,oCAEA,0BAEA,+DACAA,iFACA,CACAnc,yEAEAA,0CACAmc,8BAIA5H,0DAEAH,yEACAA,qDACAA,qCAEA0K,cACAC,WACAC,iBACAC,eACAC,iBACAC,eA6gBA,CAKA,6BACA7U,+BACA,sCAEA8J,kCACAA,0CACAA,mCACA,GAEA9J,YACA3B,wBACA,YACA,0BACAuN,8BACAvI,qCACAyG,+CACAiK,gBAEA,gEACAjK,iDACA,OAEA,GACAzL,yDACA,0BACA,mEACA6W,sFACAC,2CAGA,GAFArL,kCACAA,0CACA,oCACA,2EACAA,iDACA,yBACA,wDACAA,qCACA,CACA,CACA,GACAzL,6CACA,yBACA2B,wCAEA,GACA3B,8CACA,yBACA2B,2CAEA,EACA,CAOA,MAxnBA,aAwnBA,CACA8L,YACAC,mCACA,CACA,GCrqBAtW,uDACA,SACA,SACA,gDACA,8CACA,8CACA,gDACA,gDACA,yDACA,yDACA,0DACA,UACAuK,EACAtK,EACAmJ,SACAiL,QACAsL,YACAjV,UACA6J,cACA+K,iBACApO,wBACAsD,kBACA,CAYA,mDAmBA,oCACA7J,0BAGAU,0DACAV,2CACA,yDACAU,mCAMA5E,mDAEA,GAGAmZ,8EACA,iEACAhT,kBAEA,GAGAmJ,0BAEA1B,oDACA,CAMA,oBACAwL,+BACAA,iCAEAtV,6CACAiV,kBACAvT,kCACA4T,sCACAA,wCAGAF,wFACA,EACA,CAOA,sBACApV,qCACAyS,gCACAhM,0BACAiM,0BAEAzY,IACA,+BACA1B,gDACA2D,yBACA,oBACA2C,2BACA,CACA6U,oCACAhS,QACA+R,gBACAE,UACA,EACA,CACA,GAIA3T,YACAkS,2DACA7T,8EACA,8DACAqD,mCACAmQ,iDAGAuD,kEAMAlZ,iDACA,CACA,EACA,CAQA,wCACAqZ,6DACAhQ,gDAEAA,8DACAe,kCAEAlG,wCACAkG,iCACA,GAEAlG,6CACAkV,2CACAhP,iCACA,GAEAf,uEACAwP,iEAEA7Y,wCACA,EACA,CAEA,2CACA,kEACAqJ,wFACA,MAlJA5C,oCACA4R,2CACArY,gDAGA+N,wDAGAH,sEACAA,sDACA0L,WACAC,YAwIA,CAKA,6BACA,8BAEA3L,mCACAA,4CAEA9J,gBACA3B,wBACA,0BACAuN,8BACA9B,oCAEA,GACAzL,yDACA,2BAEAuN,+DAEA8J,0BAGA5L,mCACAA,4CAEA,EACA,CA7LA,aAEA,mCAkMA,OACAgC,YACAC,mCACA,CACA,GChOAtW,mDACA,SACA,SACA,OACA,WACA,cACA,oBACA,gDACA,8CACA,+CACA,gDACA,gDACA,0DACA,UACAuK,EACAtK,EACA4S,GACA0G,MACAtR,SACAwG,SACArF,SACAiL,QACA6L,aACAxV,UACA6J,cACAC,kBACA,CASA,kCAiBA,qBACA5O,sBACAA,wBAEA2E,kCACAqV,mBACA3T,mCACArG,6BACAA,+BAGAsa,uEACA,EACA,CAQA,+BAUA,mCACAC,gFACAC,wCAEA7G,yEACAA,2CACAA,8CACAA,0BACAA,iFAEA8G,gCAKA5Z,kDAEA4Z,4BACA,CAEA,0BACA,4CAEAC,2EACA,IAjCA3V,0BACA4V,mDACAC,yCACAC,yDACAC,8DACAC,yDACA5E,sDACAsE,+CA4BA9V,mDACAoP,2BACArJ,YACA,GAEAqQ,gCACAA,mDACAla,cACAmC,yCACAnC,8CACAwB,WACAiV,mDACAtU,wBACA+X,wDACA,EACA,GACAC,yBACA,GAEAjW,2CACA,+DACAkW,6BAGA9E,yBAEA,GAEAtV,iDAEAoa,iCACA5G,gBACA,CAOA,uBACA1P,4BACAyS,uBACAhM,2BACAiM,0BAEA,wCACAzY,IACA,sBACA1B,gDACA2D,yBACA,WACA2C,wBACA,CACA6C,oBACA6U,yCACAC,yCACAC,oBACA,CACA,+BACAle,gDACA2D,yBACA,oBACA2C,2BACA,CACA6U,oCACAhS,QACA+R,gBACAE,UACA,EAEA,EACA,CACA,GAGA3T,YACAkS,+BACA7T,yDACA,cACA,yDACAiX,2CAGAK,uDAEA7L,kDAMA5N,4CAEA,EACA,IAvKAA,iDACAb,mCAGA4O,oDAEAH,8EACA4M,YACAC,aAgKA,CAEA,MAnLA,aAmLAC,QACA,GC7MAnhB,+DACA,SACA,yDACA,mDACA,iDACA,oDACA,gFACA,aAkUA,6DACA,uEAOA,MALAuE,8BACAA,6BAEA6c,2DAEA7c,cACA,CAaA,8DACA,uEAOA,MALAA,8BACAA,6BAEA6c,2DAEA7c,cACA,CASA,oEAYA,MAXAtE,2BACAuF,wDAGAvF,6BACAkC,wCAGAoC,6DACAA,sDAEAA,cACA,CASA,2EAIA,MAHAA,gEACAA,+DAEAA,cACA,CASA,gEACA,sBACA,2DACA,mEAEAA,kDACA,KACAA,qCAGA,qBACA,CASA,8DACA,qBACA,0DACA,mEAEAA,gDACA,KACAA,oCAGA,qBACA,CAQA,wCACA,oDACA,4DAEA,iBACA,CAQA,kCACA,8CACA,6DAEA,cACA,CAQA,uCACA,gDACA,sEAEA,eACA,CAOA,2BAOA,MANA5B,SACAA,UAEA1C,mBACA0C,eAEAA,KACA,CAjeA,0BAWAC,mDACA,4FAMA,MAJAye,aACAC,8DAGA/c,cACA,EAQAgd,gEACAhd,iBACAtE,uBACAsE,4BACAA,gCAEAA,6DAEAA,6BACAA,iCAEA8c,aACA9c,wDAIA,EAQAid,gEACAjd,6BACAA,4BACAA,iEACAA,gCAGAtE,sBACAsE,0GAEAA,2BACAA,4CAEAA,sDAIA,EAUAkd,gEACA,+FACA,EASAC,6BACA,uCACA,EASAC,6BACA,uCACA,EASAC,mCACA,0CACA,EAQAC,wBACA,6EAOA,MALAtd,8BACAA,8BACAA,qHACAA,+EAEAA,cACA,EAYAud,2GACA,gEAQA,MANAvd,kEACAA,sDACAwd,qDACAC,wCACAxQ,kEAEAjN,cACA,EAWA0d,wGACA,iEAQA,MANA1d,iEAEAwd,qDACAC,wCACAxQ,kEAEAjN,cACA,EAQA2d,8EACA,kEAKA,MAHAF,yCACAxQ,kEAEAjN,cACA,EAQA4d,yCACA,4DAKA,MAHA5d,4EACAA,4EAEAA,cACA,EAUA6d,wDACA,0FAIA,MAFAL,sDAEAxd,cACA,EASA8d,iCACA,uFACA,EAQAC,mCACA,kFACA,EASAC,kEACA,mEAEA,+DACA,mEAGA,gFACA,qEAUA,MAPAhe,oCACAA,iCAEAie,cACAje,wCAGAA,cACA,EASAke,qDACA,4DASA,MAPAxiB,0BACAyiB,2BAGAne,sDACAA,6DAEAA,cACA,EAQAie,8CACA,8DAQA,MANAviB,0BACAyiB,2BAGAne,6DAEAA,cACA,CAEA,EA+KA,2BACA,GC7eAvE,wDACA,SACA,OACA,cACA,iDACA,gDACA,uDACA,yEACA,0BA0sBA2iB,SAnXA,4EACA7c,sEACAvB,+DACA+c,yBACAA,yGACA,CACA,CAEA3c,sDACA,CAWA,0EACAmB,sEACAvB,+DACA+c,yBACAA,4FACA,CACA,CACA3c,sDACA,CAUA,6EACAmB,sEACAyc,uDACAjB,+BACAA,4BACAA,6CACA,CACAA,gDACAA,uDACA,CACA,CACAA,iCACAA,gDACAA,4BACAA,+CACAA,6CACA,CACA,CACA,CACA,CAEA3c,wCACAA,0DACA,CAWA,2FACAmB,wEACAvB,+DACA+c,yBACAA,4BACAA,+CACAA,+CACA,CACAA,8DACA,CACA,CAEA3c,sDACA,CAWA,iFACAmB,wEACAvB,+DACA+c,yBACAA,+CACAA,8DACA,CACA,CAEA3c,sDACA,CAWA,iFACArD,gCACAwE,qDACAvB,qDACA+c,+BACAA,2BACAA,wCACAA,0DACA,CACAA,gDACAA,4CACA,CACA,CACAA,iCACAA,gDACAA,+CACA,CACA,CACA,CAEA3c,wCACAA,wDACA,CAQA,kDACA,8CACA,CASA,0DACA,aAcA,MAbAie,uDACAP,SACAQ,gBACA5iB,4CACA,oCACA6F,iDACAA,gDAEA,MADAuc,YAGA,IAGAA,KACA,CASA,wDAKA,+CACA,oBA4CA,MAzCAO,sDACA3iB,4CA8BA,GA5BA6F,kCACA,sEACA,oEAEAK,YAEAlG,wCAYA,GAXA6F,4BACAhD,wEACAggB,gBACAhd,0BACAhD,sEACAggB,gBACAhd,0BACAhD,wEACAggB,iBAGAA,aACA,QAEA,GAGAA,gBAIAA,aACA,QAEA,GAGA,gCACAA,6EAGAA,YACA,IAlDAC,yCACAV,SAsEA,MAlBApiB,yCACA,sBAQA,GAPAA,yCACA,8BAEA,MADA+iB,qBAGA,GAEAA,iBACAX,mDAEA,QACA,QAGA,GAEAA,KACA,CAOA,mCACA,kBAGAO,QACAA,kBACAG,kCAEAH,uDAGA,iBACA,CAOA,gCACA,mBAGAA,QACAA,kBACAK,oDAEAL,uDAGA,kBACA,CAQA,uCACA9f,wDACAogB,UAOA,MANAjjB,sDACA,+CAEA,MADAijB,yBAGA,GACAA,IACA,CAOA,oCACA,aAOA,MANAjjB,sCACA,sCACA2iB,SACAO,qBAEA,GACAljB,aACA,CAOA,yCACA,mCACA,oDACA,CAOA,mCACA,wBAUA,MATAA,oFACA,sEACAA,qDACA,kDAEA,MADAmjB,uBAGA,EACA,GACAA,gBACA,CAOA,4BACA,mFACA,6FACA,4BAIA,MAHAnjB,qBACAojB,0BAEA,yBACA,CAOA,oCACA,cAQA,MAPA1e,mFACA,+EACA0e,4CAEA,GACAA,0CAEAA,0BACA,CAOA,gDACA7c,gCACA8c,gEACA3d,4DAGAb,mDACAye,0CACAC,2CACAC,2BAIA/d,2BAHAge,SAmCA,MA7BAD,8BACAA,MAGAxjB,kBACA,UAEAyjB,YACAzjB,sCACA0jB,sDACAD,4CAEA,GACAH,6CACAE,0BAGA,YAEA/d,gCAGA,kHACAA,8BApBAA,0BA0BAA,iBACA,CAOA,sCACA,mCACA,OACAyd,sBACAS,wBACAC,4CACAC,4BACAC,wCACAre,qDACA,CACA,CAMA,8BACA,oGACA,cACA,GAEAf,qDAGA,2CACA1E,0BACAA,4CACAsE,iBACAyf,sEACA3B,UAGA,mCACA5d,6CAEA,oCACAA,8CAEA,qCACAA,+CAEA,kCACAA,4CAEA,oCACAA,8CAGA,CA1BA,aAiCA,MALA,yCACAA,2BAEA4d,qEAEAA,KACA,EACA,CAOA,4BACA,OACAiB,2EACA5d,mBACAC,sEACA,CACA,CACA,IAx1BAse,oBAMAC,+BAMAC,iBACAC,MACA1gB,WACA+E,iBACA4b,0EACA,EACAC,QACA5gB,aACA+E,mBACA4b,2FACA,EACAE,OACA7gB,YACA+E,wBACA4b,wKACA,IACAxR,uLACA,EACA2R,KACA9gB,UACA+E,sBACA4b,wQACA,IACAxR,sLACA,CACA,EAMA8Q,iBACAS,MACA1gB,WACA+gB,QACA,EACAH,QACA5gB,aACA+gB,QACA,EACAF,OACA7gB,YACAghB,+CACA9f,WACA+f,eACA7hB,yBACA8hB,gCACAC,uCACAC,6CACA,GACAH,aACA7hB,6BACA8hB,oCACAC,2CACAC,iDACA,GACAH,eACA7hB,yBACA8hB,gCACAhB,iBACAW,oBACAQ,qBACA,EACAC,eACAT,6BACAQ,8BACA,CACA,GACAN,QACA,EACAD,KACA9gB,UACAuhB,gBACAP,8CACA9f,WACA+f,aACA7hB,sBACAmF,8BACAid,oBACAC,4BACAN,sCACAO,6CACA,GACAX,QACA,CACA,EAMAY,iBAOAC,wDACAC,iHACAC,0BAEAD,0GAEA,EASAhB,mEAEAkB,iEACAC,+CACAD,+DAIAC,2CACAzlB,wCACAwlB,kHACAC,uDACAD,+GAEA,EAEA,EASAV,+DAEAY,+DACAD,+CACAC,6DAIAD,2CACAzlB,wCACA0lB,gHACAD,uDACAC,6GAEA,EAEA,EASAnB,kEACAV,2BACA8B,iDACArB,iDACAQ,6CACAO,iDACAO,8DACAC,oCAsCA,MAnCAC,oFAGAL,qBACAM,yBACAphB,SACA8gB,oBACAA,sBACAA,sBACAA,0BACA,CAIAA,2CACAzlB,2CACAgmB,kFACAC,wFACAC,+EACAC,6EAEAC,iHAEAX,6BACAM,yBACAphB,SACA0hB,4DACAJ,0BACAR,sBACAA,0BAGA,GAGA9gB,QACA,CACA,EAEA2hB,eAWAC,kCACA,UAEA,yDACA,8DAGAhgB,+BAGAA,2CAEAC,cACAmC,sDAQAnC,+EACA,GACAmC,yCACAjE,8CAOA8B,4CACA,GAMAma,6BACA,EASA6F,0CACA,4DAEA,yDACA,8DAQA,GALAjgB,+BACAgf,sBACA5gB,4BAGA4gB,QAEA,GADAkB,yDACAA,cAEAA,qBAEAC,wBAIAC,kCAGAC,kCACA1gB,0CAIAlG,mCACA,0CACA0kB,0CACA,OAGA,8EAIA,eACA,CACA,EAqhBA,oBACA,GC32BA3kB,8DACA,SACA,SACA,OACA,WACA,kBACA,YACA,cACA,UACAuK,EACAtK,EACA4S,GACAiU,KACArf,WACAsf,OACA9e,SACA,CACA,aA8CA,uIAGA,qCAMA+e,WAHAC,aAQA,gCAKAT,OAGA,MAFAS,uCAEA,IACA,EAMAC,UA8DA,MA7DA,aACAF,UAGAzc,UACA3B,iCACA,8BACA,qBAEA,GAEAA,8BAGA2B,mBACA3B,yBACA,2FACA6C,6BACAA,mBAEAtE,8BACA,uCACA0B,gBACA,0BACA,iBACA4C,gBACA,GACA3C,cAEA,2BACAD,gBACA,0BACA,iBACA4C,gBACA,GAEA3C,cAGA,GAEA3B,YACAyB,sDACA0R,qCACA,0BAIA,MAHAnT,iCACAggB,kCAEA,kDACA,yBACA,KACA7M,6EACAnT,8BACAc,oJACA,IAEA,yBAEA,IACAqS,8CAEA,IACA,EAOA8M,qBACAC,+BACAlgB,2BAEA,EAOAmgB,YAQA,MANA/c,oBACAkS,aACAlS,uBACAA,gCACApD,yBAEA,IACA,EAUAogB,uBAIA,MAFApV,oCAEA,+BACA,UACA,gBAGA,sBACA,iBAGA6U,UACA,eAIAQ,WADArV,oCACA4U,QACA5U,gBACAyL,qBACA6J,cACAC,eACAC,2CACAC,iBACAJ,kBACAK,mBACA,CACA,GAEAd,QACA5U,gBACAyL,0BACA6J,cACAC,eACAI,uCACAH,2CACAC,iBACAJ,kBACAK,mBACA,CACA,GAEAL,2CACA,EACA,EAMAO,aACA,2CACA,0EACA,EAMAC,oBACA,kBACA,IAEAC,qEAGAA,2CACA,YACAA,eACA,CACA,iBACA,CACA,GAEA,8BACA,MAtPAC,WACAC,qEACAC,0EACAC,oEACAC,0IACA,EACAC,eACA/a,cACAlM,eACAmH,gBACA+f,QACA,GACAhb,YACAlM,eACAmH,eACA+f,QACA,GACAC,oBACAjb,cACAlM,eACAmH,uBACA+f,QACA,GACAhb,YACAlM,eACAmH,mBACA+f,QACA,GACAhb,UACAlM,YACAmH,iBACA+f,QACA,GAwNA,2BACA,GChRAxoB,gDACA,SACA,SACA,SACA,UACA,OACA,oBACA,cACA,0BACA,+CACA,2CACA,2CACA,+CACA,8CACA,8CACA,iDACA,gDACA,gDACA,gDACA,yDACA,mDACA,sDACA,0DACA,6BACA,cACA,iDACA,UACAE,OACAqK,EACAtK,EACA8I,QACA8J,GACApE,SACAxG,SACAygB,mBACAC,sBACAC,SACAzH,SACAjB,aACAP,YACAkJ,YACAC,eACApe,UACA6J,cACAgS,cACAzW,iBACA0C,WACAuW,cACAvU,kBACAwU,iBACAC,cACA1J,eACA,CACA,kBACAzX,uDAOAohB,YACAC,UAWAC,oBACAhiB,+BACAiiB,mBACAC,2BACAC,6BAEA7Q,gBACA8Q,OACAC,cACAhjB,cAEA,oBAEAJ,6CACAA,kCACAA,kCACAA,gGACAA,uDAEAyJ,uDAGAyZ,qBACA9d,mBACAiN,sCACA,GAGAgR,oCACAJ,oDAEAA,0BACA7d,mBACA6d,iCACA5Q,iCAEA,GACA,8BACAtR,0DACAkiB,4DAGAA,uDAGA,CAGAV,8DAGAxhB,wDACA,8CACAX,mCAEA,GAGAgjB,sCACAthB,SACAwhB,wEACAC,uEACA,EACAC,UACAC,sBACA,EACApf,oBACAqf,kBAEAxV,uCAGAA,sCAGA,IACA/B,+BACA,YAGA,MAFA6W,oDACAphB,qEAEA,CACA,QACA,CACA,GAGAuhB,4EACA9Q,iDACAhQ,gBACAmV,sBACAsL,sBACAa,yCACA,GACAtR,mCACAjS,gDAGA8f,kCAGA/T,6CAGA2O,yBAGAjB,iCACAP,gCACAJ,mCACAsJ,gCAEAE,kEAEArQ,oCACA2Q,8BACAA,gDACAG,YACA,WACAH,mDACAphB,qCACAgiB,sBACAvR,+BACA,EACA,WACA2Q,kDACA,EACA,CAEA,GAEA3Q,uCACA,kEACAwR,6BACAC,iDACAnjB,uBACA,qEACAojB,YACAC,YACAC,oCACA,eACAxiB,kBACAG,iBACA4K,2EAEA,EACA,CACA,GAEA6F,sCACAA,+BACA6R,qBACA,EACA,GAGAlB,kCACA3Q,kCACA8R,uBACAviB,mBACA4K,+HACA,EAEA6F,8BAEA,EACA,CACA,EAEA,iBACA,GCnPA1Y,gIACA,aAmBA,mDAKA,MAJAqG,qBAEAA,qBAEAokB,oDACA,EAEA,OACA/jB,mBACA,CACA,GC9BA1G,oDACA,aAEA,OACA0qB,SACAjM,cACApK,SACApI,kCACA,CACA,EACA0e,WACAtW,SACAuW,8BACA,CACA,CACA,CACA,GCpCA5qB,4DCsBAA,8CACA,SACA,SACA,OACA,UACA,SACA,cACA,cACA,qBACA,cACA,WACA,cACA,iCACA,yBACA,oCACA,UACAuK,EACAtK,EACA4S,GACAgY,QACA3qB,OACA4qB,OACA7B,cACA8B,WACA9iB,SACA+iB,QACAC,OACAC,eACAC,OACA,CACA,aAMA,uBACA,iBACA,kBACA,gBACA,YACA,UACA,YACA,CAKA,OAaA/B,cACA,oBACAhiB,yBAEAU,0CACAsjB,mCACAC,uEACA,MAEAC,oBACAC,wBAOAlD,kCACA,+BACA,gBACAmD,SACA,SACAC,iBAEAC,qBACA/jB,+BAEA4iB,mBACA,EAOAviB,6CACA2jB,sCACA,EAOAC,iDACAD,wCACA,EAQAA,6DACAE,UACAC,SACAhkB,cACAG,kBACA,EACA8jB,OACAjkB,eACAG,gBACA,CACA,EACA+jB,0CACAC,wDAEAC,4CAEAjsB,6BACAisB,+CAEAnB,kBAEAiB,kDAEA,kDACAE,kHACA7D,mCAEA,mBACAkD,2DAEA,EAEAY,mCAEApB,oBAGAxgB,6EAGA6hB,uEAKAD,oFACArB,0CAIA9jB,kEAGAkkB,gDACAriB,uBAEA,oDAGA,GAFAwjB,qCAEA9O,uEACA,0DACA8O,gDACA,CAEAvkB,cACAd,wBACAslB,0BACA,uBAGAnB,gEACAviB,oBACAA,wBACAA,sBACA3I,mBACAmH,gCACA,EACA,GACAwB,0BACAgR,oBACA2S,uBAEA,GACAC,2BACA,0BAGAnE,gBACA,GAGAzf,sCACA2iB,eACAA,sBAEAD,kBACA,GAGA1iB,qCACA0iB,kBACA,GACA9E,MACA,GACA1d,oBACAd,oEACA,IAjEAA,2EAkEA,CACA,CACA,GChOAhI,8CACA,SACA,SACA,oBACA,eACA,oCAEA,aAiDA,mCACA,iDACA,CAMA,iCACAysB,uBACAA,iBAEA,CAiBA,2EAYA,MATAC,iBACAC,eAEA1sB,yBACA2sB,YACAC,eACA,GAGA,8BACAC,0BAEAC,4CAEAC,SACAC,aAEAC,mBAEAL,gDAGAI,mEACAA,sBACAJ,yBACAI,uBAIAJ,mBAEAF,eAGAK,sBAGAG,wCAGAH,8CAGAN,cACAU,yBAIAC,gBAEArb,2DACAqb,cAGA,cACArb,2EACAqb,aACA,IAGArb,kEACAqb,cAEA,EACA,CASA,+CAGAC,6BADAC,eAGA,eAEAnmB,2BAEA,gBAEAA,6BAIAkmB,wBACArtB,eA+CAmH,4BA7CAA,+CAEA,iBACAomB,0BAEA,mBAEAC,aACAF,gBAEA,qBAEAE,aACAF,gBAEA,CAIA,GAFAC,0BAEAvtB,8BAIA,MAHAwtB,cACAF,eAGAC,eACAD,YACAC,eACAD,YACAE,aAGA,CAEA,GAEAF,OACAA,sBACAE,QACAA,wBAEArmB,4BAQA,CAWA,2BACA,iGACA,yCACA,KACA,IApOAsmB,sBAOAC,iBAOAhB,SAOAD,gBAiNA,MA9MAiB,wEACAjB,gBACAzsB,+BACAmtB,uBACA,EACA,GAyMA,CACApiB,sBACA4iB,uBACA,CACA,GC3PA5tB,+CACA,SACA,SACA,kBACA,eACA,sCACA,gDACA,gBAkBA6tB,iBAKAC,kCACA,4BAOA,kDAEAC,iCAOA,gDACA,EAMAC,iDACA,6BACA,EAOAC,yCACA,iDACA,EAOAC,uCACA,oDACA,EAOAC,qBACA,6BACA,EAMAC,qBACA,6BACA,EASAC,qEACA3W,WACAtQ,wBACAknB,YASA,oEAEAruB,0DACAquB,yFACA,GAEAC,4CACA,aACAC,YAEAvuB,gCACAwsB,OACAE,iBACA6B,4BAEA,GAEAvuB,wBACAoS,iEAWAqF,wEACA,EACA,CACA,EAnIAqW,mBAMAS,SA+HA,iCACA,GCtKAxuB,6EACA,qEAKA,+BAGA,eACA,CARA,iCACA+I,6DACA,iJAkDA,MA1CAC,sDACAC,uEACAA,+GACAD,iCACA,qCACAG,gIACAA,sCACAH,qJACAE,wNACA,4FACAA,oNACA,8MACAA,4LACA,wQACAA,8LACA,yNACAA,kLACA,uNACAA,oMACA,2NACAA,sLACA,yNACAA,sMACA,6NACAA,0LACA,sNACAA,gOACA,0NACAA,oLACA,kdACAA,gMACA,kCACAA,4KACA,wNACAA,wOACA,qNACAA,sPACA,kSACAA,4QACA,wFACAA,4QACA,+DACAF,MACA,EACA,GCxDAhJ,iFACA,qEAKA,+BAEA,4BAoBA,MAnBAgJ,6EACAG,oJACAA,sCACAH,yBACAC,mEACAA,2GACAD,iCACA,6EACAC,sEACAA,8GACAD,iCACA,wEACAC,sEACAA,8GACAD,iCACA,iMACAG,gNACAA,sCACAH,4DACAA,MACA,CACA,+BAGA,cACA,CAEA,+BAGA,iBACA,CAEA,+BAEA,qBAKA,MAJAA,iIACAG,iIACAA,sCACAH,oEACAA,MACA,CACA,+BAEA,4BA0BA,MAzBAA,wFACAG,oJACAA,sCACAH,yBACAC,mEACAA,2GACAD,iCACA,qFACAC,sEACAA,8GACAD,iCACA,gFACAC,sEACAA,8GACAD,iCACA,uFACAC,yEACAA,iHACAD,iCACA,IACAE,+JACA,qLACAC,8HACAA,sCACAH,mHACAA,MACA,CACA,+BAEA,4BAgCA,MA/BAA,gFACAG,gIACAA,sCACAA,mIACAA,sCACAA,oIACAA,sCACAA,wJACAA,sCACAH,yBACAC,mEACAA,2GACAD,iCACA,uBACAC,yEACAA,iHACAD,iCACA,sGACAC,sEACAA,8GACAD,iCACA,0FACAG,yJACAA,sCACAH,wGACAE,wHACA,yDACAD,sEACAA,8GACAD,iCACA,qIACAA,MACA,CACA,+BAGA,eACA,CAEA,gCAGA,gBACA,CAEA,gCAGA,iBACA,CAEA,gCAGA,eACA,CAEA,gCAGA,eACA,CAEA,gCAGA,eACA,CAEA,gCAEA,iBACAG,0JACAA,0BACA,EACA,CACA,gCAGA,gBACA,CAEA,gCAEA,iBACAA,wJACAA,0BACA,EACA,CACA,gCAGA,cACA,CAEA,gCAGA,cACA,CAEA,gCAEA,oCAkBA,MAjBAH,sKACAE,4QACA,gHACAA,4QACA,oLACAD,uEACAA,+GACAD,iCACA,uBACAC,yEACAA,iHACAD,iCACA,cACAE,oMACA,+EACAA,oMACA,0NACAF,MACA,CA5MA,iCACAD,6DACA,kIAgNA,MAJAC,0EACAG,8HACAA,sCACAH,kCACAA,MACA,EACA,GCnMAhJ,2CACA,SACA,SACA,OACA,0CACA,8CACA,kBACA,2DACA,gBAOAyuB,UACAC,gBACAC,sBACAC,0BACAC,gBACAC,oBACAC,kBACAC,oBACAC,gBACAC,gBACAC,0BACAC,OACAhlB,kBACAf,2BACAgmB,gCACA,CACA,EAOAC,YACAC,2BACAC,mCACA7rB,2BACA8rB,4CACAC,oCACAC,8DACAC,0DACAC,kEACAC,4DACAC,gCACAC,6DACAC,4BACAC,wDACAnQ,kCACAoQ,8DACAjY,4BACAkY,wDACAC,sDACAC,4BACAC,gDACAC,kCACAC,kBACA7B,2BACA8B,uCACAxB,iBACAF,qBACAD,mBACA4B,4BACAC,8BACA/B,gBACA,EAQAgC,YACA5e,OACA6e,+BACA/B,8BACAC,gCACA+B,0BACA,EAOAC,aACA,0BACA,sCACA,yBACA,EAOAC,eACA7mB,YACAf,oBACAgmB,yBACA,EAMA6B,YAWA1K,uCACA2K,8CACAC,wCACAC,2CAeA,GAbA,yBACA,iBACA,iCACA,yBAGA,iBACA,yBAIA,2BACAA,2CACAA,aACAA,gDACAC,iCACAzC,kBACA,QAEA,0EAQA,MAJA,iBACA,mBACA,6BAEA,IACA,EAMA0C,oBACA,2DAGA,iEACA,6DACA,qEACA,+DAGA,2DACA,yCAGA,iDAGA,8DACA,EAMAC,uBACA,cAGA,qFACA9Z,gBAIAA,+CACAA,6CACAA,qBAEA,GAGA,sFACA,mBAIA,iDACAA,+CACA,GAGA,4EACA,sBAIA4I,0CACApV,gDAEAA,OACAoV,gCACA5I,qBAEAA,iEAGA,GAGA,+EACA,mBAIA,gDAEAA,8CACA,GAGA,iFACA,sBAIA+Z,yCACAtb,QAEAsb,mCACAtb,wBACAA,2EACA,iCACAuB,mBAGAA,oBACAA,oBAGA,GAGA,6EACA,mBAIA,iBAEAga,kCACAA,gCACAha,kBAEA,GAGA,gEACA,sBAIAga,cACAxO,uBAEAxL,0CACAA,+CACAga,8BAEAha,mBACA,EACA,EAOAia,8BACAC,sEACAC,4BACAA,QACAD,+CAEA,sCACA,2BACA,EASAE,mCAEAC,6FACAC,4CAUA,MAPA9mB,OACA,0BAIA,gEACA8mB,iDACAD,QACA,EAOAE,4BAEAF,+DACAC,4CAKA,MAFA,2BAEAD,QACA,EAQAG,gCACA,4EACAC,qCACA,EAQAC,8CACA,gDAWA,MATAC,mBACA,8DAGA1D,UACA2D,qCAEAA,kCAEA3D,SACA,EAQA4D,kCACAd,qEACA,EAOAe,mCACArD,WACAsD,2BACAC,SACAjE,gBACAA,iBACAA,eACA,CAEAxuB,gCACA,uBAEA,MADAkvB,YAGA,GAEA,0CACA,EAQAwD,iCACAlB,wCACA,2BACA,EAOAmB,yBACAC,yBACAC,oCACAC,sCAEA,wBAUA,+CACA,EAOAC,yBACAH,yBACAC,oCASA,0CACA,EAMAG,6CACAvb,WACAma,kDACA,wDACArS,kBACAoS,uCACAsB,gCACA3O,oBACA4O,0BACAzb,6DACA,EACA,EAMA0b,oCACAC,6DACAC,sCACAC,sBACAtzB,sCACAszB,sBACA,GACAD,YACAC,2BAEAA,+DACA,EAOAC,qCACA,yBACAvzB,qDACA,mCACAoG,2CAEA,EACA,EAKAotB,wBACA,iCACA3C,oDAGA,4EACA,oEACA,wEACA,yEACA,EASA4C,yCACAC,4BACA,EAQAC,4CACA,OACArP,iCACAyK,wCACAC,sCACAF,oCACA,CACA,EAQA8E,gDACA,OACAtP,qCACAyK,4CACAC,0CACAF,wCACA,CACA,EAQA+E,mDACA,OACAvP,wCACAyK,+CACAC,6CACAF,2CACA,CACA,EAMAgF,qCACAC,uCACAX,qCACAY,yCACAC,+CACAC,4BAIA,MAHAD,qCACAjgB,oDAEAA,WACA,EAGA+f,eACAC,uCAEAD,kDAGA,uBACA,yBACA,kCACA/D,kBACA,IAEA,6BAEA,gEAGA,uBACA,yBACA,oBAIA,mEACA,EAOAmE,mDACA3C,0FACA4C,6BAGA,6BAGAA,+DACA,0EACA,gCACA,EAQAC,2DACAC,0BACAC,yCACAC,qDACAC,4CAEAC,0BAGA10B,kDA0BA,GAzBAA,gDAoBA,GAnBAA,gDACA,UACA20B,2BACAC,cACAC,oBACAJ,cAEAE,kCACAG,iBACAC,uBACAP,iBAGAC,yBACA,QAGA,GAEAA,wBACA,QAEA,GAEAA,wBACA,QAEA,GAGAA,mCACAH,iCAEAG,yCACAH,sCAIAA,iCACAA,qCAGAt0B,iCACAmX,uBACAud,8BAEA,EACA,EAOAM,oDACA,gEACAC,+DACAD,oEACAZ,4DAEA,kBACA,EAOAc,oCAMA,MALA,mDACA,iCACA,+BACA,8BACA,wCACA,IACA,EAMAhnB,2BAGA,MAFA,kBACA,2CACA,IACA,EAMAC,yBAGA,MAFA,kBACA,8CACA,IACA,EAMAgnB,qBAIA,MAHA,kBACA,eACA,yCACA,IACA,EAMA5Y,qBAIA,MAHA,kBACA,eACA,4CACA,IACA,EAOA5Q,6BAWA,MAVA,iBACA4Q,kBAGAA,KACA,YAEA,YAGA,IACA,EAOA5T,0BACA,wBAKA,MAJAysB,MACAA,4BAGA,IACA,EAOA5Y,4BACA,wBAKA,MAJA4Y,MACAA,6BAGA,IACA,EAQAzU,oDACA,wBAeA,MAbA,4BACA0U,oBAEAr1B,6BACAq1B,mCAGAA,2BAEAD,KACAA,uCAGA,IACA,CACA,EAYAE,4CACA,qCACA,sCACA,EAEA,wBACA,GCr2BAv1B,gDACA,SACA,SACA,OACA,iBACA,kBACA,4BAsDA2iB,qBADAA,SA/CA6S,kBAQAhP,yCAGA,MAFA,+CACA,oCACA,IACA,EAQAiP,4BAGA,MAFA,gCACA,4CACA,IACA,EAOAN,gCACAO,+DACAC,wDACAV,yEACAZ,4DAGA,MADA,iDACAA,WACA,EAOAuB,+CACArR,4CACAe,0DACA,OACAA,YACA7c,eACA,CACA,EAOAotB,6CACAC,kDACAC,sBACA3rB,MACAma,oBACAyR,uBACA,EACA3sB,UACAkb,wBACAyR,2BACA,EACA3G,aACA9K,2BACAyR,8BACA,CACA,EACAC,uEACA1R,8CACAyR,yCACA,OACA1Q,uCACA7c,wCACA,CACA,CACA,EAQAytB,2DACA,yCACA,8CACA,EAEA,6BACA,GClFAl2B,6CACA,SACA,aACA,aAMA,8DAiGA,gBACAm2B,6CACAC,2CACA,CAMA,kCACA,iDACA,IACA7L,2CACA,qBACA,6CACA,sDACA,cACA9mB,6BACAC,IACAD,KACAC,wBACA,iDACA6mB,oCACA8L,WAGA,WACAC,6BAEA,mBAEA,KACA,mBAEA,CACA,CAMA,+BACA,wEACAzyB,4BAEA,aACA,CA9IA,GACA0yB,mCACAC,SAFAL,mBAIA,gDACA,4DAGA,kBACAM,mBACA,uBACA,SACA,qBACA,YACA,eACA,gBACA,SACA,EACAC,gBACA,aACA,eACA,gBACA,qBACA,cACA,iCACA,EAKAC,qDACA,yBACA,EAMAC,0DACAT,wBACA,EAMAU,+BACAL,WACAF,0CACA,EAOAQ,yCACAld,mBACA,qBACAmd,cAGAA,UACA92B,oBAEAu2B,0BAEAF,0CACA,EAOAU,2BACA,qBACA,EAMAC,+BACAT,SACAjM,iEACA,EAEA2M,iDACA,wCACA,CACA,EAuDA,MAFA1Q,QAEA4P,YACA,EAEA,0BACA,GC7LAp2B,mDACA,SACA,SACA,OACA,SACA,uCACA,mCACA,wCACA,qCACA,wBACA,6BACA,0BACA,iBACA,UACA,cACA,aACA,SACA,WACA,iBACA,CACA,SACAuK,EACAtK,EACA4S,GACA3S,OACA2tB,eACAqD,WACAiG,gBACAC,oBACAC,WACAC,gBACAC,aACAC,eACAC,QACAxvB,SACAyvB,QACAC,OACAC,MACA,CAEA,6BA6/BAjV,qBA3DAA,SAh8BAkV,YACAC,gBACAC,aACAC,aACAC,cAMAtK,iBACAuK,6CACAC,2DACAC,+CACAC,mDACAC,yEACAC,YAEA,qBACA,yBACA,4BACA,uBACA,oBACA,yBACA,4BACA,8BAMAC,oCAEAhB,iCAGA,kBAEAiB,4BACAA,+BACAA,+BAGA,6BACAna,sBAEA,EAKAoa,2BACA,iBAGAlB,mCACApB,sBACA,4CACA,EACA,EAMAuC,wBACA,cACAC,cACAlN,2BACA,kBAEA,qFACA,qCAEA,gCACAhU,8BACA,EAEA,EAMAmhB,iCACA,aACA,cACAD,uBACAlN,2BACAhU,uCACA,CACA,EAOAohB,sCACA,cAGAtB,iCAGA,kBAEAjtB,QACA5C,sCACAoxB,SACAC,SACA13B,YACA2Z,gBACArB,MACAmZ,UACAiD,iBACA,EACA9Y,uBAEAxF,kBACAA,2CACAA,oEACAA,2CACAA,mCAEAA,oCAIAA,iBAGA8f,kCACA,CACA,EACA,EAKAyB,uBAIA,yBACAvhB,mDACAA,qCAEAA,+BAEA,CATA,cACAkhB,qBAUA,kBAEA,0GACA,oCACA,0CACA,kBAEAM,gBAIA,gCACAxhB,8BACA,EAEA,EAKAyhB,uCACA,iFACA,EAKAC,2CACA,aACAC,sBACAC,yBACAC,gBACA,EAEA,wBACA1mB,2IACA2mB,WACAnzB,QAEA,EAKAozB,wBACA,cACAb,sBAEA,kBAEA,2FACA,sCAEA,gCACAlhB,+BACA,EAEA,EAOAgiB,0CACA,wCACAC,wBACAC,2EAEA,oBACA,mBACA,4BAGA1hB,iCACAyhB,wBACA,KACA,CACA,KAEAA,yBAGA,2BACA,EAQAE,6CACA,cAEAzD,gHACA1e,gCACAA,8BACA,EACA,EAOAoiB,yCACA,cACAC,8BACAC,8BACAD,WACAA,0BAEAriB,+BACA,EAEA,4DACA,0DACA,sCAEAsiB,qBAEA,wBACAnnB,iJACAmnB,mBACA,sBACA,CAGA,gBACA,EAKAC,0BACAviB,WACAqiB,8BACAG,yBACAxiB,wEACA,EAEAqiB,WACAA,0BAGA,kDACA,wBACAlnB,iJACAqnB,cACA,sBACA,CAEAA,gBAGA,gBACA,EAOAjF,kCACAkF,iBACA/vB,QACAf,gBACAgmB,qBACA,EACA+K,6CAEA,OACA7V,qDACAyK,4DACAC,0DACAF,wDACA,CACA,EAaAsL,uDACA3iB,WACArR,oBACA+oB,oBACAiK,6CACAC,0CACAC,+EAEAe,sCACAjG,uCACAkG,uDACAC,iCAuCA,MArCAjB,iBACAgB,+CACAA,kBAGAC,8BACAroB,uFACAooB,2BACAC,wBACA,cAEAA,eACAroB,0FAGAooB,kBACApoB,4FAKAmoB,2CACAA,wDACAA,sDACAA,+BAEAA,qFACAA,0BACA,GAEAA,wEACAA,2BACAr6B,sBACA24B,iBAEA,GAEA0B,WACA,EAOAG,mCACArE,sBACA,MACA,oCACA,kEACA,CACA,GACA,8BACA/jB,iBAEA,kCACA,EAMAqoB,+BACA,2CACA,EAQAC,iCACA,gBAOA,MANA16B,mDACA,iEAEA,MADA+uB,eAGA,GACAA,QACA,EAOA4L,2BACA,uDACA,EAMAC,2BACAC,+CACAC,8CACAC,oFACAC,yEACA,yDACA,EAMAC,0BACA,qDACAA,kBACA,iCACAC,uCACA,4DACAD,mBAIA,qBACA,EAMAE,kCACA,uCACAC,qCACAC,aAEA,4BACA,qCAGAD,8BAIA,mDACA,4DAGA,sDACAC,4DACA,KACA,CAIA,mBACA,EAKAC,gBACA,cACAC,kBACA9jB,kBACAA,uBACA,EAEA,mCACA,mCAEA8jB,QAEA,EAKAC,mBACA,cACA,kBACA,8BACA,mBAEA,gCACA,4CACA9G,6BACA+G,gEAEA/G,oEACAyB,oGAEAA,2FAGA1e,iBACAikB,8BACAD,8CACAC,0BACAjkB,0BACA,EACA,EACA,EAMAkkB,qCACA,6BACA,yDACA,+DACA,EAMAC,wBACAzF,kCACA0F,mDACA,EACA,EAMAC,kCAIA,MAHAC,uBACAA,0EAEAA,mBACA,EAMA7G,6BACA,cACAsD,8BAEA,yBACAwD,6BAEA,wCAEA,iCACA,qBACA,sBACA,wBACA,wBACA,yBACA,qBACA,8BACA,mBACA,wBACA,6BACA,oBAEAxD,wFACAA,qDAEA,uGACA9K,iEACAjW,uBACAA,mBACA+gB,gDACA,GAGA,gEAEA,IAKA/gB,sBAEA,EAKAwkB,6BAEA,gCACAj0B,4FAEA,sEACAA,iGAEA,EAMAk0B,iDACAC,aACAC,eACAC,2IAEA,sCACA,6BACAF,YAEAC,gBAIA5D,iCACAA,uCACAA,+CAEA5K,+DACA,EAOA0O,0BACA,4EACAC,oEACAC,4EAIA,MAFAC,uBACAA,qBACAA,MACA,EAKAC,0BACAjlB,WACAklB,UACAnE,gCAEA,kCACAoE,0BAQA,GALAhF,YACAC,gBACAC,aACAC,aAEA,iCACAtgB,uEAEAklB,oDACAnE,4DAEAmE,YAIA,uDAEA,4CAEA,iCAWA,GARAnE,sDAGAX,4BACAC,sBACAC,eACA8E,aAEAplB,gFACAqlB,gBACA98B,+EACAA,gDACA88B,mBACAz7B,WACA07B,wBACAC,sBACA,EAEA,GACA,4DACA,mEACAF,qDAEA,CAEA,0BACAlF,2DAWAlV,WAPA,GAFAqV,4EAEA,4BACA,sCACAF,kCACAE,uBACA,CAEAkF,uBACArkB,4DAEA,6BAEAif,2BACAqF,oCAGA1E,4BACA/gB,gBAEAqgB,+BAGA,iDAEA,yFACArgB,6BAGA,MACA,kBACA,CACA,CAEAwlB,mEACAzE,8BACA,CAEA,EAgBA2E,kCACA,eAEAV,0EACAD,qCAFAY,UAQA,OAJAZ,mFAEAY,8DAEAN,kBACA,wBACA5qB,oFACA,MACA,wBACAA,uFACA,MACA,eACAA,yFACA,MACA,qBACAA,mFACA,CAGAlK,kCAEA80B,qCACA,EAKAO,yBAGA,GAFA7E,iCAEA,mCAEAA,uDAEA,kDACAA,4DAKAA,mEAEA,MADAlO,0BAEA,GAEAkO,yDAEAhB,SACAA,qEAGA,CACA,EAKA8F,4BACA9E,uBAEA,8BACAA,8BACAA,4BAGAA,8BACAA,2BAEA,8DAEAA,gCAIAA,2BACA,sCACAA,+BAGAA,+BAGA,EAKA+E,4BACA,4DAEA,kBACA,sFACA,yCAEA,EAKAC,0BACA,4DAEAhF,6EAEAiF,kBACA,6CAEA,EAKAC,yBAEAlF,kDAGA,qGAEAA,sCACAA,4BACA,EAKAmF,4BAEAnF,uEACAA,kEACA,EAKAoF,0BACAC,yDAEAC,mHACAjD,sCAFAkD,mBAGAvF,0CACAA,4BACAA,oCACA,qBACAwF,qEACA,GAGAnD,qCACAkD,mEAEAA,iCACAF,aACAE,0EAEAA,gCAGAlD,2BACAA,4EAEArC,gDAEA,EAKAyF,sBACAzF,4CACA,iBACA,yBAEA,EAKA0F,qBACA1F,+CACA,iBACA,wBAEA,EAKA2F,mBACA3F,0CACA,iBACA,sBAEA,EAKA4F,mBACA5F,6CACA,iBACA,sBAEA,EAOA6F,qCACAC,sBACAC,gCACAC,6CACAC,mDAEA,WACAF,iBAEA,aACAC,qBAEA,aACAC,qBAGA,uCAEA,WACA,EAMAC,0CACA,cAGA,eACA,wBAGAnH,sCACArlB,sBACAymB,kBACAxC,cACAA,yBAEArK,qCAEArU,yBAGAA,sBAEA,CACA,EACA,EASAknB,wCACA,cACAlT,yDAEAmT,cACAnT,qCAEA,iCACAnhB,QACA5C,mCACAoxB,SACAnf,YACAof,SACA/d,gBACAiC,8BACAkZ,yBAEAzB,oBAGAA,2CACAjd,yBAGAA,yBANAA,8BAQA,CACA,EACA,EACA,EAOA2Q,gBACA,cACA+N,sBACA,6DACA,+DACA,GACA,wBACAvjB,6CACA,WACA6E,gCACAA,kCACA0e,wBACA,EACA,EACA,0DAEA,EAQA0I,uCACAtxB,KACA,gCAEA,EAKAuxB,iCACA,wBACA,EAMAC,+BACA,4BACA,CACA,EAEAh4B,uBA/nCAk2B,QACAzE,UACAqE,WACA1G,aACA4F,oBAgoCA,MAJAh1B,SACA6mB,yCAGA,CACAzE,4BAEAqP,WAEAwG,kDACAC,0CACAC,oDACAC,kDACAC,mCACAC,0CACAC,gEACAC,oEACAC,6CACAC,kCACAC,wCAGAC,kDACAC,sDACAC,gCAGA/jB,8CACAgkB,oDAGAC,iDAGAC,kCACAxH,6BACAyH,0BACAC,gCACAC,8BACAC,6BACAC,yDACAC,8DACA,EAGA9H,gEAEA9K,qCACA,oBACA6J,yCAEA,GAEAjN,gEACAgO,iCAEA5D,oBAMAA,kDACA6L,oBACApK,0BAIAmC,mDACAA,uCACAA,0BAEAA,4EACAA,+CAEAA,+BAlBAA,oCAqBA,EAEAA,8BACAA,mCAEAE,wCACAluB,8BACAguB,iBAEA,GAEAE,2CACAluB,8BACAguB,wBAEA,GAEAE,yCACAluB,8BACAguB,yBAEA,GAEAE,wCACAluB,8BACAguB,wBAEA,GAEAE,kCACAhtB,mBACA8sB,iBACA,GAEAhuB,4CACAguB,yBACAE,4BACA,QAEA9K,6BACA6J,gCACA,GAGA7J,+BACA6J,kCACA,GAEAe,4FAEA5D,2BACA4D,0DACAjH,wCACAzC,0DACAwE,oCACAoN,kDACAC,2CACA,sCACAnI,yBACA,2CACAA,uCACA,GACAE,wCAGAF,4BACAA,8BAEAf,sCAGAe,yBAEAE,iFAEAf,4BACAE,iBAGArtB,gEACAo2B,sBACApI,8DAEA,wCACA/qB,WACA+qB,wCAEA,wCACAE,mCACA,EAEA,CACA,CACA,GC52CA,gOACA,+g5DCDAz4B,2DACAA,MCFA","names":["define","_","module","baseTypeEnum","IDENTIFIER","BOOLEAN","INTEGER","FLOAT","STRING","POINT","PAIR","DIRECTED_PAIR","DURATION","FILE","URI","INT_OR_IDENTIFIER","COORDS","ANY","SAME","baseTypeHelper","asArray","getValid","type","getValue","parseInt","getConstantByName","getNameByConstant","constant","operator","cardinalityEnum","SINGLE","MULTIPLE","ORDERED","RECORD","cardinalityHelper","cardinality","validOutcome","validIdentifier","allowedTypes","valid","validateIdentifier","validateOutcomes","validateOutcome","value","create","properties","identifier","element","find","found","types","collection","checkType","lookupElement","steps","nodeNames","len","i","key","tree","lookupProperty","result","propertyName","getProcessingRuleExpression","getProcessingRuleProperty","getOutcomeIdentifier","getOutcomeDeclarations","getOutcomeProcessingRules","eachOutcomeDeclarations","eachOutcomeProcessingRules","eachOutcomeProcessingRuleExpressions","processingRule","cb","browseExpressions","listOutcomes","outcomeHelper","outcomes","removeOutcomes","declarations","rules","check","createOutcome","views","interpretation","longInterpretation","normalMaximum","normalMinimum","masteryValue","baseType","addOutcomeProcessing","outcomeProcessing","outcomeRules","testModel","addOutcome","outcome","replaceOutcomes","eachCategories","listCategories","isCategoryOption","categories","listOptions","options","getModel","setModel","model","modelOverseer","getConfig","getOutcomesList","name","getOutcomesNames","getCategories","getOptions","config","statifier","areaBroker","testCreator","$container","setTestModel","getAreaBroker","getModelOverseer","isTestHasErrors","eventifier","getItemClasses","url","getItems","getItemClassProperties","logger","testItemProvider","onError","feedback","ITEM_URI","filters","selectorConfig","selectionMode","selectAllPolicy","classUri","classes","label","uri","resourceSelector","on","then","catch","helpers","buffer","helper","escapeExpression","stack1","defaults","testPart","section","rubricBlock","itemRef","testProps","testPartProps","sectionProps","itemRefProps","itemRefPropsWeight","rubricBlockProps","categoryPresets","subsection","testpart","itemref","rubricblock","test","itemrefweight","categorypresets","$","ui","DataBinder","templates","$view","$warningIconSelector","$test","errors","currentTargetId","isValid","template","open","databinder","propValidation","$identifier","getView","isOpen","onOpen","e","onClose","destroy","toggle","isFistLevelSubsection","getParentSection","getParentSubsection","$parentSection","index","sectionIndex","$parentSubsection","subsectionIndex","isNestedSubsection","getSubsections","getSubsectionContainer","getSiblingSubsections","getParent","getSubsectionTitleIndex","$elt","propView","$element","$elements","insertBefore","fadeIn","insertAfter","$actionContainer","$moveUp","$moveDown","$delete","subsectionsCount","$deleteButton","id","$propertiesView","$list","$indexSpan","$parent","disabledClass","activeClass","btnOnClass","move","removable","movable","disable","enable","displayItemWrapper","updateDeleteSelector","displayCategoryPresets","updateTitleIndex","features","categoryGroupNamespace","categoryPresetNamespace","presetGroups","filteredGroups","filteredGroup","addTestVisibilityProps","addTestPartVisibilityProps","addSectionVisibilityProps","addItemRefVisibilityProps","filterVisiblePresets","presetSelected","toArray","map","presetIndeterminate","customSelected","customIndeterminate","selectedCategories","indeterminatedCategories","$presetsContainer","$customCategoriesSelect","categorySelector","$presetsCheckboxes","createForm","presetsTpl","customCategories","$checkbox","$preset","updateCategories","width","tags","multiple","tokenSeparators","formatNoMatches","maximumInputLength","tooltip","updateFormState","indeterminate","$li","content","allQtiCategoriesPresets","categorySelectorFactory","allPresets","currentCategories","toRemove","toAdd","partial","addCategories","removeCategories","itemCount","arrays","union","propagated","isValidSectionModel","createCategories","errorHandler","all","setCategories","message","validate","callback","identifiers","$idInUI","validators","countBy","forEach","nonUniqueIdentifiers","messageDetails","__","feedbackBlock","extract","originalIdentifier","excludeTypes","includesOnlyTypes","counts","qtiIdPattern","qtiTypesForUniqueIds","extractIdentifiers","registerValidators","validateModel","checkIfItemIdValid","getIdentifiers","getIdentifiersOf","filterQtiType","addMissingQtiType","parentType","consolidateModel","assessmentSection","part","getAvailableIdentifier","current","suggestion","actions","sectionCategory","qtiTestHelper","featureVisibility","$minTimeContainer","$maxTimeContainer","$lockedTimeContainer","$locker","$durationFields","$minTimeField","$maxTimeField","minToMaxHandler","maxToMinHandler","lockTimers","removeClass","addClass","attr","unlockTimers","toggleTimeContainers","refModel","$categoryField","$weightList","weightTpl","validIds","$itemRef","deletedNodeId","categoriesProperty","weightsProperty","timeLimitsProperty","$actions","$target","$refs","setUp","listenActionState","acc","normalizedNodes","feedbackblock","outcomeidentifier","showhide","printedvariable","powerform","mappingindicator","typedAttributes","printedVariable","powerForm","base","delimiter","field","mappingIndicator","encode","startTag","modelValue","decode","self","$nodeValue","nodeName","object","attrName","editorId","removePlugins","toolbar","items","qtiCommonRenderer","containerEditor","metadata","getOutcomes","change","resetRenderer","autofocus","creatorContext","eventName","$el","html","rubric","wrapper","qtiContentCreator","$rubricBlockContent","editorToModel","activated","rubricModel","outcomeIdentifier","modelToEditor","hider","changeFeedback","text","$feedbackOutcome","minimumResultsForSearch","data","$feedbackActivated","$feedbackOutcomeLine","$feedbackMatchLine","bindEvent","updateOutcomes","updateFeedback","rbViews","$select","matchValue","before","feedbackOutcome","$rubricBlock","dialogAlert","CKEDITOR","eachItemInTestPart","eachItemInSection","eachItemInTest","testModelHelper","itemRefCategories","isValidTestPartModel","dataType","fail","setBlueprint","getBlueprint","itemRefView","rubricBlockView","sectionBlueprint","confirmDialog","subsectionsHelper","$selectionSwitcher","$selectionSelect","$selectionWithRep","isSelectionFromServer","switchSelection","$title","$subsection","blueprintProperty","subsectionModel","$sub2section","sectionModel","$itemsPanel","$placeholder","$placeholders","show","off","defaultItemData","href","itemData","addItemRef","itemRefModel","$refList","target","templateData","success","select2","ajax","delay","method","results","minimumInputLength","allowClear","placeholder","initBlueprint","buttons","labels","ok","cancel","sectionParts","title","visible","checkAndCallAdd","confirmMessage","acceptFunction","setTimeout","executeAdd","getDom","css","sub2sectionIndex","sub2sectionModel","$itemRefsWrapper","$rubBlocks","$titleWithActions","subsections","itemRefs","acceptItemRefs","rubricBlocks","addRubricBlock","addSubsection","$AllNestedSubsections","testPartCategory","subsectionView","$section","$sectionsContainer","$sections","sectionView","$testPart","partModel","categoriesSummary","sections","addSection","$testParts","testPartView","noOptions","newScoringState","scoringState","$panel","$categoryScoreLine","$cutScoreLine","$weightIdentifierLine","$descriptions","$generate","trigger","changeScoring","navigationMode","submissionMode","assessmentSections","testParts","addTestPart","testView","addTypeAndCardinality","expression","processingRuleHelper","setExpression","addExpression","setOutcomeValue","gte","lte","divide","sum","testVariables","addWeightIdentifier","addSectionIdentifier","outcomeMaximum","numberPresented","baseValue","variable","match","isNull","outcomeCondition","outcomeElse","outcomeIf","instruction","Math","recipe","onlyCategories","outcomeMatch","signatures","signatureMatch","descriptors","mode","modes","categoryOutcomes","values","outcomeDeclarations","processing","diff","count","included","outcomesRecipes","scoreIdentifier","weightIdentifier","cutScore","categoryScore","scoringOutcomes","defaultCutScore","defaultScoreIdentifier","processingModes","none","description","custom","total","cut","clean","signature","writer","weighted","categoryIdentifier","categoryWeighted","max","scoreWeighted","include","feedbackOk","feedbackFailed","categoryFeedback","outcomesWriters","ratio","addRatioOutcomes","scoring","addTotalScoreOutcomes","descriptor","addMaxScoreOutcomes","totalModeOutcomes","whichOutcome","ratioIdentifier","addGlobalCutScoreOutcomes","addFeedbackScoreOutcomes","categoryOutcome","categoryOutcomeIdentifier","categoryScoreIdentifier","categoryCountIdentifier","addCutScoreOutcomes","formatCategoryOutcome","scoringHelper","init","generate","outcomeRecipe","removeScoring","recipes","handleCategories","uuid","dialog","asking","originalTest","install","leavingStatus","ifWantSave","whatToDo","uninstall","confirmBefore","confirmDlg","autoRender","autoDestroy","onDontsaveBtn","onCancelBtn","reject","onSaveBtn","hasChanged","getSerializedTest","serialized","messages","preview","leave","exit","leaveWhenInvalid","buttonsYesNo","close","buttonsCancelSave","DataBindController","qtiTestCreatorFactory","itemView","itemrefView","Dom2QtiEncoder","changeTracker","previewerFactory","loggerFactory","Controller","routes","start","$saver","$previewer","$back","binder","binderOptions","Object","isItemRef","isSection","encoders","dom2qti","beforeSave","guidedNavigation","isTestContainsItems","saveUrl","testUri","readOnly","fullPage","pluginsOptions","window","event","ckConfigurator","Creator","XmlEditor","edit","context","router","loadingBar","urlUtil","locale","providerLoader","runner","serviceCallId","plugins","preventFeedback","errorFeedback","reason","level","params","onFeedback","onWarning","typeMap","warning","error","loggerByType","feedbackByType","displayMessage","moduleConfig","requiredOptions","testRunnerConfig","providers","exitReason","after","tool","itemIsLoaded","tools","toolconfig","hook","isValidConfig","require","$button","$existingBtn","isValidHook","_appendInOrder","triggerItemLoaded","resolve","order","$after","_order","$before","_ns","$doc","initQtiTool","actionBarTools","register","registeredQtiTools","getRegisteredTools","getRegistered","isRegistered","get","list","render","promises","Promise","qtiTools","_cssCls","active","collapsed","collapsible","hidden","disabled","flagged","answered","viewed","unseen","icon","scope","testSection","_selectors","component","filterBar","collapseHandle","linearState","infoAnswered","infoViewed","infoUnanswered","infoFlagged","infoPanel","infoPanelLabels","parts","partLabels","sectionLabels","itemLabels","itemIcons","icons","linearStart","counters","actives","collapsiblePanels","notFlagged","notAnswered","_filterMap","unanswered","filtered","_optionsMap","_reviewScopes","testReview","initOptions","putOnRight","insertMethod","region","_loadDOM","_initEvents","$item","$btn","_filter","$items","filter","_select","selected","hierarchy","_openSelected","_openOnly","opened","_togglePanel","collapseSelector","panel","_setItemIcon","_adjustItemIcon","defaultIcon","iconCls","_toggleFlag","_mark","itemId","itemPosition","flag","_jump","_updateSectionCounters","$filtered","nb","_updateDisplayOptions","reviewScope","scopeClass","$root","_updateOptions","_updateInfos","_writeCount","$place","_getProgressionOfTest","_getProgressionOfTestPart","_getProgressionOfTestSection","_updateTree","navigatorMap","reviewScopePart","reviewScopeSection","_partsFilter","setItemFlag","progression","updateNumberFlagged","fields","currentPosition","currentFound","itemFound","testContext","item","itemPart","itemSection","currentPart","currentSection","getProgression","progressInfoMethod","update","hide","dom","extraParameters","testReviewFactory","progressUpdaters","write","progressIndicator","progressIndicatorMethod","percentageProgression","positionProgression","progressScope","progressScopeCounter","position","counter","progressUpdaterFactory","_testServiceCallId","testMetaData","removed","setLocalStorageData","_storageKeyPrefix","_data","SECTION_EXIT_CODE","TEST_EXIT_CODE","getTestServiceCallId","setTestServiceCallId","setData","addData","overwrite","getData","clearData","getLocalStorageKey","progressUpdater","testMetaDataFactory","ServiceApi","UserInfoService","StateStorage","iframeNotifier","MathJax","deleter","moment","modal","timerIds","currentTimes","lastDates","timeDiffs","waitingTime","optionNextSection","optionNextSectionWarning","optionReviewScreen","optionEndTestWarning","optionNoExitTimedSectionWarning","TestRunner","beforeTransition","$controls","afterTransition","jump","action","keepItemTimed","markForReview","cache","async","moveForward","doExitSection","shouldDisplayEndTestWarning","displayEndTestWarning","confirmLabel","cancelLabel","showItemCount","nextAction","moveBackward","isJumpOutOfSection","isJumpToOtherSection","isValidPosition","exitSection","exitTimedSection","qtiRunner","doExitTimedSection","nextSection","doNextSection","scopeSuffixMap","scopeSuffix","displayExitMessage","$confirmBox","unansweredCount","flaggedCount","killItemSession","isCurrentItemActive","isCurrentItemAnswered","hasOption","getQtiRunner","itemFrame","itemWindow","itemContainerFrame","itemContainerWindow","isTimedSection","timeConstraints","getCurrentSectionItems","navMap","sectionItems","skip","doSkip","timeout","confirmBtn","confirmBox","setTestContext","initMetadata","testServiceCallId","getSessionStateService","sessionStateService","$runner","updateInformation","updateTools","showSkip","showSkipEnd","showNextSection","createTimer","$label","$time","$timer","updateTimer","hasTimers","clearTimeout","timerIndex","cst","showed","point","$timers","clearInterval","timeWarning","remaining","updateRubrics","updateNavigation","updateTestReview","updateProgress","considerProgress","updateContext","updateExitButton","adjustFrame","rubricHeight","finalHeight","frameContentHeight","$sideBar","disableGui","enableGui","hideGui","showGui","formatTime","sec_num","hours","minutes","seconds","processError","actionCall","extraParams","setCurrentItemState","resetCurrentItemState","getCurrentItemState","$moveForward","$moveEnd","$moveBackward","$nextSection","$skip","$skipEnd","$exit","$logout","$naviButtons","$skipButtons","$forwardButtons","$progressBar","$progressLabel","$progressBox","$position","$timerWrapper","$contentPanel","$itemFrame","$rubricBlocks","$contentBox","$sideBars","$topActionBar","$bottomActionBar","serviceApi","preventsUnseen","canCollapse","responseId"],"sources":["../controller/creator/areaBroker.js","../controller/creator/config/defaults.js","../controller/creator/helpers/baseType.js","../controller/creator/helpers/cardinality.js","../controller/creator/helpers/outcomeValidator.js","../controller/creator/helpers/qtiElement.js","../controller/creator/helpers/outcome.js","../controller/creator/helpers/category.js","../controller/creator/modelOverseer.js","../controller/creator/qtiTestCreator.js","../provider/testItems.js","../controller/creator/views/item.js","../controller/creator/templates/testpart!tpl","../controller/creator/templates/section!tpl","../controller/creator/templates/rubricblock!tpl","../controller/creator/templates/itemref!tpl","../controller/creator/templates/outcomes!tpl","tpl!taoQtiTest/controller/creator/templates/test-props","tpl!taoQtiTest/controller/creator/templates/testpart-props","tpl!taoQtiTest/controller/creator/templates/section-props","tpl!taoQtiTest/controller/creator/templates/itemref-props","tpl!taoQtiTest/controller/creator/templates/itemref-props-weight","tpl!taoQtiTest/controller/creator/templates/rubricblock-props","tpl!taoQtiTest/controller/creator/templates/category-presets","../controller/creator/templates/subsection!tpl","../controller/creator/templates/index.js","../controller/creator/views/property.js","../controller/creator/helpers/subsection.js","../controller/creator/views/actions.js","../controller/creator/helpers/featureVisibility.js","../controller/creator/helpers/categorySelector.js","../controller/creator/helpers/sectionCategory.js","../controller/creator/helpers/validators.js","../controller/creator/helpers/qtiTest.js","../controller/creator/views/itemref.js","../controller/creator/encoders/dom2qti.js","../controller/creator/qtiContentCreator.js","../controller/creator/views/rubricblock.js","../controller/creator/helpers/testModel.js","../controller/creator/helpers/testPartCategory.js","../controller/creator/helpers/sectionBlueprints.js","../controller/creator/views/subsection.js","../controller/creator/views/section.js","../controller/creator/views/testpart.js","../controller/creator/views/test.js","../controller/creator/helpers/processingRule.js","../controller/creator/helpers/scoring.js","../controller/creator/helpers/changeTracker.js","../controller/creator/creator.js","../controller/creator/helpers/ckConfigurator.js","../controller/routes.js","css!taoQtiTestCss/new-test-runner","../controller/runner/runner.js","../testRunner/actionBarHook.js","../testRunner/actionBarTools.js","../testRunner/tpl/navigator!tpl","../testRunner/tpl/navigatorTree!tpl","../testRunner/testReview.js","../testRunner/progressUpdater.js","../testRunner/testMetaData.js","../controller/runtime/testRunner.js","onLayerEnd0.js","module-create.js","/github/workspace/tao/views/build/config-wrap-end-default.js"],"sourcesContent":["/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technlogies SA\n *\n */\n\n/**\n *\n * Defines the test creator areas\n *\n * @author Christophe Noël <christophe@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/areaBroker',[\n    'lodash',\n    'ui/areaBroker'\n], function (_, areaBroker) {\n    'use strict';\n\n    var requireAreas = [\n        'creator',\n        'itemSelectorPanel',\n        'contentCreatorPanel',\n        'propertyPanel',\n        'elementPropertyPanel'\n    ];\n\n    /**\n     * Creates an area broker with the required areas for the item creator\n     *\n     * @see ui/areaBroker\n     *\n     * @param {jQueryElement|HTMLElement|String} $container - the main container\n     * @param {Object} mapping - keys are the area names, values are jQueryElement\n     * @returns {broker} the broker\n     * @throws {TypeError} without a valid container\n     */\n    return _.partial(areaBroker, requireAreas);\n\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 (original work) Open Assessment Technologies SA;\n *\n * @author Sergei Mikhailov <sergei.mikhailov@taotesting.com>\n */\n\ndefine('taoQtiTest/controller/creator/config/defaults',[\n    'lodash',\n    'module',\n], function(\n    _,\n    module\n) {\n    'use strict';\n\n    return (config = {}) => _.defaults({}, module.config(), config);\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA ;\n */\n/**\n * The BaseType enumeration (port of \\qtism\\common\\enums\\BaseType).\n *\n * From IMS QTI:\n *\n * A base-type is simply a description of a set of atomic values (atomic to this specification).\n * Note that several of the baseTypes used to define the runtime data model have identical\n * definitions to those of the basic data types used to define the values for attributes\n * in the specification itself. The use of an enumeration to define the set of baseTypes\n * used in the runtime model, as opposed to the use of classes with similar names, is\n * designed to help distinguish between these two distinct levels of modelling.\n *\n * @author Jérôme Bogaerts <jerome@taotesting.com>\n * @author Jean-Sébastien Conan <jean-sebastien@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/helpers/baseType',[\n    'lodash'\n], function (_) {\n    'use strict';\n\n    /**\n     * The list of QTI base types\n     * @type {Object}\n     */\n    var baseTypeEnum = {\n        /**\n         * From IMS QTI:\n         *\n         * The set of identifier values is the same as the set of values\n         * defined by the identifier class.\n         *\n         * @type {Number}\n         */\n        IDENTIFIER: 0,\n\n        /**\n         * From IMS QTI:\n         *\n         * The set of boolean values is the same as the set of values defined\n         * by the boolean class.\n         *\n         * @type {Number}\n         */\n        BOOLEAN: 1,\n\n        /**\n         * From IMS QTI:\n         *\n         * The set of integer values is the same as the set of values defined\n         * by the integer class.\n         *\n         * @type {Number}\n         */\n        INTEGER: 2,\n\n        /**\n         * From IMS QTI:\n         *\n         * The set of float values is the same as the set of values defined by the\n         * float class.\n         *\n         * @type {Number}\n         */\n        FLOAT: 3,\n\n        /**\n         * From IMS QTI:\n         *\n         * The set of string values is the same as the set of values defined by the\n         * string class.\n         *\n         * @type {Number}\n         */\n        STRING: 4,\n\n        /**\n         * From IMS QTI:\n         *\n         * A point value represents an integer tuple corresponding to a graphic point.\n         * The two integers correspond to the horizontal (x-axis) and vertical (y-axis)\n         * positions respectively. The up/down and left/right senses of the axes are\n         * context dependent.\n         *\n         * @type {Number}\n         */\n        POINT: 5,\n\n        /**\n         * From IMS QTI:\n         *\n         * A pair value represents a pair of identifiers corresponding to an association\n         * between two objects. The association is undirected so (A,B) and (B,A) are equivalent.\n         *\n         * @type {Number}\n         */\n        PAIR: 6,\n\n        /**\n         * From IMS QTI:\n         *\n         * A directedPair value represents a pair of identifiers corresponding to a directed\n         * association between two objects. The two identifiers correspond to the source\n         * and destination objects.\n         *\n         * @type {Number}\n         */\n        DIRECTED_PAIR: 7,\n\n        /**\n         * From IMS QTI:\n         *\n         * A duration value specifies a distance (in time) between two time points.\n         * In other words, a time period as defined by [ISO8601], but represented as\n         * a single float that records time in seconds. Durations may have a fractional\n         * part. Durations are represented using the xsd:double datatype rather than\n         * xsd:dateTime for convenience and backward compatibility.\n         *\n         * @type {Number}\n         */\n        DURATION: 8,\n\n        /**\n         * From IMS QTI:\n         *\n         * A file value is any sequence of octets (bytes) qualified by a content-type and an\n         * optional filename given to the file (for example, by the candidate when uploading\n         * it as part of an interaction). The content type of the file is one of the MIME\n         * types defined by [RFC2045].\n         *\n         * @type {Number}\n         */\n        FILE: 9,\n\n        /**\n         * From IMS QTI:\n         *\n         * A URI value is a Uniform Resource Identifier as defined by [URI].\n         *\n         * @type {Number}\n         */\n        URI: 10,\n\n        /**\n         * From IMS QTI:\n         *\n         * An intOrIdentifier value is the union of the integer baseType and\n         * the identifier baseType.\n         *\n         * @type {Number}\n         */\n        INT_OR_IDENTIFIER: 11,\n\n        /**\n         * In qtism, we consider an extra 'coords' baseType.\n         *\n         * @type {Number}\n         */\n        COORDS: 12,\n\n        /**\n         * Express that the operands can have any BaseType from the BaseType enumeration and\n         * can be different.\n         *\n         * @type {Number}\n         */\n        ANY: 12,\n\n        /**\n         * Express that all the operands must have the same\n         * baseType.\n         *\n         * @type {Number}\n         */\n        SAME: 13\n    };\n\n    var baseTypeHelper = _({\n        /**\n         * Gets the the list of QTI base types\n         * @returns {Object}\n         */\n        asArray: function asArray() {\n            return baseTypeEnum;\n        },\n\n        /**\n         * Gets a valid type or the default\n         * @param {String|Number} type\n         * @param {String|Number} [defaultType]\n         * @returns {*}\n         */\n        getValid: function getValid(type, defaultType) {\n            if (_.isFinite(type)) {\n                if (!baseTypeHelper.getNameByConstant(type)) {\n                    type = false;\n                }\n            } else {\n                type = baseTypeHelper.getConstantByName(type);\n            }\n\n            if (false === type) {\n                if (!_.isUndefined(defaultType) && defaultType !== -1) {\n                    type = baseTypeHelper.getValid(defaultType, -1);\n                } else {\n                    type = -1;\n                }\n            }\n\n            return type;\n        },\n\n        /**\n         * Adjusts a value with respect to the type\n         * @param {String|Number} type\n         * @param {*} value\n         * @returns {*}\n         */\n        getValue: function getValue(type, value) {\n            if (_.isString(type)) {\n                type = baseTypeHelper.getConstantByName(type);\n            }\n\n            switch (type) {\n                case baseTypeEnum.URI:\n                case baseTypeEnum.STRING:\n                case baseTypeEnum.IDENTIFIER:\n                    return value + '';\n\n                case baseTypeEnum.BOOLEAN:\n                    if (_.isString(value)) {\n                        switch (value.toLowerCase()) {\n                            case 'true':\n                                return true;\n                            case 'false':\n                                return false;\n                        }\n                    }\n                    return !!value;\n\n                case baseTypeEnum.INTEGER:\n                    return parseInt(value, 10) || 0;\n\n                case baseTypeEnum.FLOAT:\n                    return parseFloat(value) || 0;\n\n                case baseTypeEnum.INT_OR_IDENTIFIER:\n                    if (!_.isNaN(parseInt(value, 10))) {\n                        return parseInt(value, 10) || 0;\n                    } else {\n                        return '' + value;\n                    }\n            }\n\n            return value;\n        },\n\n        /**\n         * Get a constant value from the BaseType enumeration by baseType name.\n         *\n         * * 'identifier' -> baseTypes.IDENTIFIER\n         * * 'boolean' -> baseTypes.BOOLEAN\n         * * 'integer' -> baseTypes.INTEGER\n         * * 'float' -> baseTypes.FLOAT\n         * * 'string' -> baseTypes.STRING\n         * * 'point' -> baseTypes.POINT\n         * * 'pair' -> baseTypes.PAIR\n         * * 'directedPair' -> baseTypes.DIRECTED_PAIR\n         * * 'duration' -> baseTypes.DURATION\n         * * 'file' -> baseTypes.FILE\n         * * 'uri' -> baseTypes.URI\n         * * 'intOrIdentifier' -> baseTypes.INT_OR_IDENTIFIER\n         * * extra 'coords' -> baseTypes.COORDS\n         *\n         * @param {String} name The baseType name.\n         * @return {Number|Boolean} The related enumeration value or `false` if the name could not be resolved.\n         */\n        getConstantByName: function getConstantByName(name) {\n            switch (String(name).trim().toLowerCase()) {\n                case 'identifier':\n                    return baseTypeEnum.IDENTIFIER;\n\n                case 'boolean':\n                    return baseTypeEnum.BOOLEAN;\n\n                case 'integer':\n                    return baseTypeEnum.INTEGER;\n\n                case 'float':\n                    return baseTypeEnum.FLOAT;\n\n                case 'string':\n                    return baseTypeEnum.STRING;\n\n                case 'point':\n                    return baseTypeEnum.POINT;\n\n                case 'pair':\n                    return baseTypeEnum.PAIR;\n\n                case 'directedpair':\n                    return baseTypeEnum.DIRECTED_PAIR;\n\n                case 'duration':\n                    return baseTypeEnum.DURATION;\n\n                case 'file':\n                    return baseTypeEnum.FILE;\n\n                case 'uri':\n                    return baseTypeEnum.URI;\n\n                case 'intoridentifier':\n                    return baseTypeEnum.INT_OR_IDENTIFIER;\n\n                case 'coords':\n                    return baseTypeEnum.COORDS;\n\n                case 'any':\n                    return baseTypeEnum.ANY;\n\n                case 'same':\n                    return baseTypeEnum.SAME;\n\n                default:\n                    return false;\n            }\n        },\n\n        /**\n         * Get the QTI name of a BaseType.\n         *\n         * @param {Number} constant A constant value from the BaseType enumeration.\n         * @param {Boolean} [operator] A flag that allow to switch between operator an value types to prevent duplicate name issue\n         * @return {String|Boolean} The QTI name or false if not match.\n         */\n        getNameByConstant: function getNameByConstant(constant, operator) {\n            switch (constant) {\n                case baseTypeEnum.IDENTIFIER:\n                    return 'identifier';\n\n                case baseTypeEnum.BOOLEAN:\n                    return 'boolean';\n\n                case baseTypeEnum.INTEGER:\n                    return 'integer';\n\n                case baseTypeEnum.FLOAT:\n                    return 'float';\n\n                case baseTypeEnum.STRING:\n                    return 'string';\n\n                case baseTypeEnum.POINT:\n                    return 'point';\n\n                case baseTypeEnum.PAIR:\n                    return 'pair';\n\n                case baseTypeEnum.DIRECTED_PAIR:\n                    return 'directedPair';\n\n                case baseTypeEnum.DURATION:\n                    return 'duration';\n\n                case baseTypeEnum.FILE:\n                    return 'file';\n\n                case baseTypeEnum.URI:\n                    return 'uri';\n\n                case baseTypeEnum.INT_OR_IDENTIFIER:\n                    return 'intOrIdentifier';\n\n                case baseTypeEnum.COORDS:\n                case baseTypeEnum.ANY:\n                    if (operator) {\n                        return 'any';\n                    } else {\n                        return 'coords';\n                    }\n\n                case baseTypeEnum.SAME:\n                    return 'same';\n\n                default:\n                    return false;\n            }\n        }\n    }).assign(baseTypeEnum).value();\n\n    return baseTypeHelper;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA ;\n */\n/**\n * The Cardinality enumeration (port of \\qtism\\common\\enums\\Cardinality).\n *\n * From IMS QTI:\n *\n * An expression or itemVariable can either be single-valued or multi-valued. A multi-valued\n * expression (or variable) is called a container. A container contains a list of values,\n * this list may be empty in which case it is treated as NULL. All the values in a multiple\n * or ordered container are drawn from the same value set, however, containers may contain\n * multiple occurrences of the same value. In other words, [A,B,B,C] is an acceptable value\n * for a container. A container with cardinality multiple and value [A,B,C] is equivalent\n * to a similar one with value [C,B,A] whereas these two values would be considered distinct\n * for containers with cardinality ordered. When used as the value of a response variable\n * this distinction is typified by the difference between selecting choices in a multi-response\n * multi-choice task and ranking choices in an order objects task. In the language of [ISO11404]\n * a container with multiple cardinality is a \"bag-type\", a container with ordered cardinality\n * is a \"sequence-type\" and a container with record cardinality is a \"record-type\".\n *\n * The record container type is a special container that contains a set of independent values\n * each identified by its own identifier and having its own base-type. This specification\n * does not make use of the record type directly however it is provided to enable\n * customInteractions to manipulate more complex responses and customOperators to\n * return more complex values, in addition to the use for detailed information about\n * numeric responses described in the stringInteraction abstract class.\n *\n * @author Jérôme Bogaerts <jerome@taotesting.com>\n * @author Jean-Sébastien Conan <jean-sebastien@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/helpers/cardinality',[\n    'lodash'\n], function (_) {\n    'use strict';\n\n    /**\n     * The list of QTI cardinalities\n     * @type {Object}\n     */\n    var cardinalityEnum = {\n        /**\n         * Single term cardinality\n         *\n         * @type {Number}\n         */\n        SINGLE: 0,\n\n        /**\n         * Multiple terms cardinality\n         *\n         * @type {Number}\n         */\n        MULTIPLE: 1,\n\n        /**\n         * Ordered terms cardinality\n         *\n         * @type {Number}\n         */\n        ORDERED: 2,\n\n        /**\n         * Record term cardinality\n         *\n         * @type {Number}\n         */\n        RECORD: 3,\n\n        /**\n         * Express that all the expressions involved in an operator have\n         * the same cardinality.\n         *\n         * @type {Number}\n         */\n        SAME: 4,\n\n        /**\n         * Express that all the expressions involved in an operator may\n         * have any cardinality.\n         *\n         * @type {Number}\n         */\n        ANY: 5\n    };\n\n    var cardinalityHelper = _({\n        /**\n         * Gets the the list of QTI cardinalities\n         * @returns {Object}\n         */\n        asArray: function asArray() {\n            return cardinalityEnum;\n        },\n\n        /**\n         * Gets a valid cardinality or the default\n         * @param {String|Number} cardinality\n         * @param {String|Number} [defaultCardinality]\n         * @returns {*}\n         */\n        getValid: function getValid(cardinality, defaultCardinality) {\n            if (_.isFinite(cardinality)) {\n                if (!cardinalityHelper.getNameByConstant(cardinality)) {\n                    cardinality = false;\n                }\n            } else {\n                cardinality = cardinalityHelper.getConstantByName(cardinality);\n            }\n\n            if (false === cardinality) {\n                if (!_.isUndefined(defaultCardinality) && defaultCardinality !== cardinalityEnum.SINGLE) {\n                    cardinality = cardinalityHelper.getValid(defaultCardinality, cardinalityEnum.SINGLE);\n                } else {\n                    cardinality = cardinalityEnum.SINGLE;\n                }\n            }\n\n            return cardinality;\n        },\n\n        /**\n         * Get a constant value from its name.\n         *\n         * @param {String} name The name of the constant, as per QTI spec.\n         * @return {Number|Boolean} The constant value or `false` if not found.\n         */\n        getConstantByName: function getConstantByName(name) {\n            switch (String(name).trim().toLowerCase()) {\n                case 'single':\n                    return cardinalityEnum.SINGLE;\n\n                case 'multiple':\n                    return cardinalityEnum.MULTIPLE;\n\n                case 'ordered':\n                    return cardinalityEnum.ORDERED;\n\n                case 'record':\n                    return cardinalityEnum.RECORD;\n\n                case 'same':\n                    return cardinalityEnum.SAME;\n\n                case 'any':\n                    return cardinalityEnum.ANY;\n\n                default:\n                    return false;\n            }\n        },\n\n        /**\n         * Get the name of a constant from its value.\n         *\n         * @param {Number} constant The constant value to search the name for.\n         * @return {String|Boolean} The name of the constant or false if not found.\n         */\n        getNameByConstant: function getNameByConstant(constant) {\n            switch (constant) {\n                case cardinalityEnum.SINGLE:\n                    return 'single';\n\n                case cardinalityEnum.MULTIPLE:\n                    return 'multiple';\n\n                case cardinalityEnum.ORDERED:\n                    return 'ordered';\n\n                case cardinalityEnum.RECORD:\n                    return 'record';\n\n                case cardinalityEnum.SAME:\n                    return 'same';\n\n                case cardinalityEnum.ANY:\n                    return 'any';\n\n                default:\n                    return false;\n            }\n        }\n    }).assign(cardinalityEnum).value();\n\n    return cardinalityHelper;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA ;\n */\n/**\n * @author Jean-Sébastien Conan <jean-sebastien@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/helpers/outcomeValidator',[\n    'lodash'\n], function (_) {\n    'use strict';\n\n    /**\n     * The RegEx that validates outcome identifiers\n     * @type {RegExp}\n     */\n    var identifierValidator = /^[a-zA-Z_][a-zA-Z0-9_\\.-]*$/;\n\n    /**\n     * Checks the validity of an identifier\n     * @param {String} identifier\n     * @returns {Boolean}\n     */\n    function validateIdentifier(identifier) {\n        return !!(identifier && _.isString(identifier) && identifierValidator.test(identifier));\n    }\n\n    /**\n     * Checks if an object is a valid outcome\n     * @param {Object} outcome\n     * @param {Boolean} [checkIdentifier]\n     * @param {String||String[]} [allowedTypes]\n     * @returns {Boolean}\n     */\n    function validateOutcome(outcome, checkIdentifier, allowedTypes) {\n        var validOutcome = _.isPlainObject(outcome) && validateIdentifier(outcome['qti-type']);\n        var validIdentifier = !checkIdentifier || (outcome && validateIdentifier(outcome.identifier));\n\n        if (allowedTypes) {\n            allowedTypes = !_.isArray(allowedTypes) ? [allowedTypes] : allowedTypes;\n            validOutcome =  validOutcome && _.indexOf(allowedTypes, outcome['qti-type']) >= 0;\n        }\n\n        return !!(validOutcome && validIdentifier);\n    }\n\n    /**\n     * Checks if an array contains valid outcomes\n     * @param {Array} outcomes\n     * @param {Boolean} [checkIdentifier]\n     * @param {String||String[]} [allowedTypes]\n     * @returns {Boolean}\n     */\n    function validateOutcomes(outcomes, checkIdentifier, allowedTypes) {\n        var valid = _.isArray(outcomes);\n        _.forEach(outcomes, function(outcome) {\n            if (!validateOutcome(outcome, checkIdentifier, allowedTypes)) {\n                valid = false;\n                return false;\n            }\n        });\n        return valid;\n    }\n\n    return {\n        validateIdentifier: validateIdentifier,\n        validateOutcomes: validateOutcomes,\n        validateOutcome: validateOutcome\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA ;\n */\n/**\n * @author Jean-Sébastien Conan <jean-sebastien@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/helpers/qtiElement',[\n    'lodash',\n    'taoQtiTest/controller/creator/helpers/outcomeValidator'\n], function (_, outcomeValidator) {\n    'use strict';\n\n    var qtiElementHelper = {\n        /**\n         * Creates a QTI element\n         * @param {String} type - The QTI type of the element to create\n         * @param {String|Object} [identifier] - An optional identifier, or a list of properties\n         * @param {Object} [properties] - A list of additional properties\n         * @returns {Object}\n         * @throws {TypeError} if the type or the identifier is not valid\n         */\n        create: function create(type, identifier, properties) {\n            var element = {\n                'qti-type': type\n            };\n\n            if (!outcomeValidator.validateIdentifier(type)) {\n                throw new TypeError('You must provide a valid QTI type!');\n            }\n\n            if (_.isPlainObject(identifier)) {\n                properties = identifier;\n                identifier = null;\n            }\n\n            if (identifier) {\n                if (!outcomeValidator.validateIdentifier(identifier)) {\n                    throw new TypeError('You must provide a valid identifier!');\n                }\n                element.identifier = identifier;\n            }\n\n            return _.assign(element, properties || {});\n        },\n\n        /**\n         * Finds a QTI element in a collection, by its type.\n         * The collection may also be a single object.\n         * @param {Array|Object} collection\n         * @param {Array|String} type\n         * @returns {Object}\n         */\n        find: function find(collection, type) {\n            var found = null;\n            var types = forceArray(type);\n\n            function checkType(qtiElement) {\n                if (types.indexOf(qtiElement['qti-type']) >= 0) {\n                    found = qtiElement;\n                    return false;\n                }\n            }\n\n            if (_.isArray(collection)) {\n                _.forEach(collection, checkType);\n            } else if (collection) {\n                checkType(collection);\n            }\n\n            return found;\n        },\n\n        /**\n         * Finds an element from a tree.\n         * The path to the element is based on QTI types.\n         * @param {Object} tree - The root of the tree from which get the property\n         * @param {String|String[]} path - The path to the element, with QTI types separated by dot, like: \"setOutcomeValue.gte.baseValue\"\n         * @param {String|String[]} nodeName - The name of the nodes that may contain subtrees\n         * @returns {*}\n         */\n        lookupElement: function lookupElement(tree, path, nodeName) {\n            var steps = _.isArray(path) ? path : path.split('.');\n            var nodeNames = forceArray(nodeName);\n            var len = steps.length;\n            var i = 0;\n            var key;\n\n            while (tree && i < len) {\n                tree = qtiElementHelper.find(tree, steps[i++]);\n                if (tree && i < len) {\n                    key = _.find(nodeNames, _.partial(_.has, tree));\n                    tree = key && tree[key];\n                }\n            }\n\n            return tree || null;\n        },\n\n        /**\n         * Finds a property from a tree.\n         * The path to the property is based on QTI types.\n         * @param {Object} tree - The root of the tree from which get the property\n         * @param {String|String[]} path - The path to the property, with QTI types separated by dot, like: \"setOutcomeValue.gte.baseValue.value\"\n         * @param {String|String[]} nodeName - The name of the nodes that may contain subtrees\n         * @returns {*}\n         */\n        lookupProperty: function lookupProperty(tree, path, nodeName) {\n            var result = null;\n            var steps = _.isArray(path) ? path : path.split('.');\n            var propertyName = steps.pop();\n            var element = qtiElementHelper.lookupElement(tree, steps, nodeName);\n\n            if (element && element[propertyName]) {\n                result = element[propertyName];\n            }\n\n            return result;\n        }\n    };\n\n    /**\n     * Ensures a value is an array\n     * @param {*} value\n     * @returns {Array}\n     */\n    function forceArray(value) {\n        if (!value) {\n            value = [];\n        }\n        if (!_.isArray(value)) {\n            value = [value];\n        }\n        return value;\n    }\n\n    return qtiElementHelper;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA ;\n */\n/**\n * Basic helper that is intended to manage outcomes inside a test model.\n *\n * @author Jean-Sébastien Conan <jean-sebastien@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/helpers/outcome',[\n    'lodash',\n    'taoQtiTest/controller/creator/helpers/outcomeValidator',\n    'taoQtiTest/controller/creator/helpers/qtiElement',\n    'taoQtiTest/controller/creator/helpers/baseType',\n    'taoQtiTest/controller/creator/helpers/cardinality'\n], function (_, outcomeValidator, qtiElementHelper, baseTypeHelper, cardinalityHelper) {\n    'use strict';\n\n    var outcomeHelper = {\n        /**\n         * Gets a property from an outcome rule expression.\n         * The path to the property is based on QTI types.\n         * @param {Object} outcomeRule - The outcome rule from which get the property\n         * @param {String|String[]} path - The path to the property, with QTI types separated by dot, like: \"setOutcomeValue.gte.baseValue\"\n         * @returns {*}\n         */\n        getProcessingRuleExpression: function getProcessingRuleExpression(outcomeRule, path) {\n            return qtiElementHelper.lookupElement(outcomeRule, path, ['expression', 'expressions']);\n        },\n\n        /**\n         * Gets a property from an outcome rule expression.\n         * The path to the property is based on QTI types.\n         * @param {Object} outcomeRule - The outcome rule from which get the property\n         * @param {String|String[]} path - The path to the property, with QTI types separated by dot, like: \"setOutcomeValue.gte.baseValue.value\"\n         * @returns {*}\n         */\n        getProcessingRuleProperty: function getProcessingRuleProperty(outcomeRule, path) {\n            return qtiElementHelper.lookupProperty(outcomeRule, path, ['expression', 'expressions']);\n        },\n\n        /**\n         * Gets the identifier of an outcome\n         * @param {Object|String} outcome\n         * @returns {String}\n         */\n        getOutcomeIdentifier: function getOutcomeIdentifier(outcome) {\n            return String(_.isObject(outcome) ? outcome.identifier : outcome);\n        },\n\n        /**\n         * Gets the list of outcome declarations\n         * @param {Object} testModel\n         * @returns {Array}\n         */\n        getOutcomeDeclarations: function getOutcomeDeclarations(testModel) {\n            var outcomes = testModel && testModel.outcomeDeclarations;\n            return outcomes || [];\n        },\n\n        /**\n         * Gets the list of outcome processing rules\n         * @param {Object} testModel\n         * @returns {Array}\n         */\n        getOutcomeProcessingRules: function getOutcomeProcessingRules(testModel) {\n            var rules = testModel && testModel.outcomeProcessing && testModel.outcomeProcessing.outcomeRules;\n            return rules || [];\n        },\n\n        /**\n         * Applies a function on each outcome declarations\n         * @param {Object} testModel\n         * @param {Function} cb\n         */\n        eachOutcomeDeclarations: function eachOutcomeDeclarations(testModel, cb) {\n            _.forEach(outcomeHelper.getOutcomeDeclarations(testModel), cb);\n        },\n\n        /**\n         * Applies a function on each outcome processing rules. Does not take care of sub-expressions.\n         * @param {Object} testModel\n         * @param {Function} cb\n         */\n        eachOutcomeProcessingRules: function eachOutcomeProcessingRules(testModel, cb) {\n            _.forEach(outcomeHelper.getOutcomeProcessingRules(testModel), cb);\n        },\n\n        /**\n         * Applies a function on each outcome processing rules, take care of each sub expression.\n         * @param {Object} testModel\n         * @param {Function} cb\n         */\n        eachOutcomeProcessingRuleExpressions: function eachOutcomeProcessingRuleExpressions(testModel, cb) {\n            function browseExpressions(processingRule) {\n                if (_.isArray(processingRule)) {\n                    _.forEach(processingRule, browseExpressions);\n                } else if (processingRule) {\n                    cb(processingRule);\n\n                    if (processingRule.expression) {\n                        browseExpressions(processingRule.expression);\n                    } else if (processingRule.expressions) {\n                        browseExpressions(processingRule.expressions);\n                    }\n                }\n            }\n\n            browseExpressions(outcomeHelper.getOutcomeProcessingRules(testModel));\n        },\n\n        /**\n         * Lists all outcomes identifiers. An optional callback allows to filter the list\n         * @param {Object} testModel\n         * @param {Function} [cb]\n         * @returns {Array}\n         */\n        listOutcomes: function listOutcomes(testModel, cb) {\n            var outcomes = [];\n            if (!_.isFunction(cb)) {\n                cb = null;\n            }\n            outcomeHelper.eachOutcomeDeclarations(testModel, function (outcome) {\n                if (!cb || cb(outcome)) {\n                    outcomes.push(outcomeHelper.getOutcomeIdentifier(outcome));\n                }\n            });\n            return outcomes;\n        },\n\n        /**\n         * Removes the specified outcomes from the provided test model\n         * @param {Object} testModel - The test model to clean up\n         * @param {Function|String[]} outcomes - The list of outcomes identifiers to remove,\n         *                                       or a callback that will match each outcome to remove\n         */\n        removeOutcomes: function removeOutcomes(testModel, outcomes) {\n            var declarations = outcomeHelper.getOutcomeDeclarations(testModel);\n            var rules = outcomeHelper.getOutcomeProcessingRules(testModel);\n            var check;\n\n            if (_.isFunction(outcomes)) {\n                check = outcomes;\n            } else {\n                outcomes = _.indexBy(_.isArray(outcomes) ? outcomes : [outcomes], function (outcome) {\n                    return outcome;\n                });\n\n                check = function checkIdentifier(outcome) {\n                    return !!outcomes[outcomeHelper.getOutcomeIdentifier(outcome)];\n                };\n            }\n\n            if (declarations) {\n                _.remove(declarations, check);\n            }\n\n            if (rules) {\n                _.remove(rules, check);\n            }\n        },\n\n        /**\n         * Creates an outcome declaration\n         * @param {String} identifier\n         * @param {String|Number|Boolean} [type] - The data type of the outcome, FLOAT by default\n         * @param {Number} [cardinality] - The variable cardinality, default 0\n         * @returns {Object}\n         * @throws {TypeError} if the identifier is empty or is not a string\n         */\n        createOutcome: function createOutcome(identifier, type, cardinality) {\n\n            if (!outcomeValidator.validateIdentifier(identifier)) {\n                throw new TypeError('You must provide a valid identifier!');\n            }\n\n            return qtiElementHelper.create('outcomeDeclaration', identifier, {\n                views: [],\n                interpretation: '',\n                longInterpretation: '',\n                normalMaximum: false,\n                normalMinimum: false,\n                masteryValue: false,\n                cardinality: cardinalityHelper.getValid(cardinality, cardinalityHelper.SINGLE),\n                baseType: baseTypeHelper.getValid(type, baseTypeHelper.FLOAT)\n            });\n        },\n\n        /**\n         * Adds a processing rule into the test model\n         *\n         * @param {Object} testModel\n         * @param {Object} processingRule\n         * @returns {Object}\n         * @throws {TypeError} if the processing rule is not valid\n         */\n        addOutcomeProcessing: function createOutcomeProcessing(testModel, processingRule) {\n            var outcomeProcessing = testModel.outcomeProcessing;\n\n            if (!outcomeValidator.validateOutcome(processingRule)) {\n                throw new TypeError('You must provide a valid outcome processing rule!');\n            }\n\n            if (!outcomeProcessing) {\n                outcomeProcessing = qtiElementHelper.create('outcomeProcessing', {\n                    outcomeRules: []\n                });\n                testModel.outcomeProcessing = outcomeProcessing;\n            } else if (!outcomeProcessing.outcomeRules) {\n                outcomeProcessing.outcomeRules = [];\n            }\n\n            outcomeProcessing.outcomeRules.push(processingRule);\n            return processingRule;\n        },\n\n        /**\n         * Creates an outcome and adds it to the declarations\n         * @param {Object} testModel\n         * @param {Object} outcome - The outcome to add\n         * @param {Object} [processingRule] - The processing rule attached to the outcome\n         * @returns {Object}\n         * @throws {TypeError} if one of the outcome or the processing rule is not valid\n         */\n        addOutcome: function addOutcome(testModel, outcome, processingRule) {\n            var declarations = testModel.outcomeDeclarations;\n\n            if (!outcomeValidator.validateOutcome(outcome, true, 'outcomeDeclaration')) {\n                throw new TypeError('You must provide a valid outcome!');\n            }\n\n            if (processingRule) {\n                if (!outcomeValidator.validateOutcome(processingRule) || processingRule.identifier !== outcome.identifier) {\n                    throw new TypeError('You must provide a valid outcome processing rule!');\n                }\n\n                outcomeHelper.addOutcomeProcessing(testModel, processingRule);\n            }\n\n            if (!declarations) {\n                declarations = [];\n                testModel.outcomeDeclarations = declarations;\n            }\n\n            declarations.push(outcome);\n            return outcome;\n        },\n\n        /**\n         * Replaces the outcomes in a test model\n         * @param {Object} testModel\n         * @param {Object} outcomes\n         * @throws {TypeError} if one of the outcomes or the processing rules are not valid\n         */\n        replaceOutcomes: function replaceOutcomes(testModel, outcomes) {\n            if (_.isPlainObject(outcomes)) {\n                if (_.isArray(outcomes.outcomeDeclarations)) {\n                    if (!outcomeValidator.validateOutcomes(outcomes.outcomeDeclarations, true, 'outcomeDeclaration')) {\n                        throw new TypeError('You must provide valid outcomes!');\n                    }\n\n                    testModel.outcomeDeclarations = [].concat(outcomes.outcomeDeclarations);\n                }\n                if (outcomes.outcomeProcessing && _.isArray(outcomes.outcomeProcessing.outcomeRules)) {\n                    if (!outcomeValidator.validateOutcomes(outcomes.outcomeProcessing.outcomeRules)) {\n                        throw new TypeError('You must provide valid processing rules!');\n                    }\n\n                    if (!testModel.outcomeProcessing) {\n                        testModel.outcomeProcessing = qtiElementHelper.create('outcomeProcessing');\n                    }\n                    testModel.outcomeProcessing.outcomeRules = [].concat(outcomes.outcomeProcessing.outcomeRules);\n                }\n            }\n        }\n    };\n\n    return outcomeHelper;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA ;\n */\n/**\n * Helper that provides a way to browse all categories attached to a test model at the item level.\n *\n * @author Jean-Sébastien Conan <jean-sebastien@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/helpers/category',[\n    'lodash'\n], function (_) {\n    'use strict';\n\n    /**\n     * Checks if a category is an option\n     *\n     * @param {String} category\n     * @returns {Boolean}\n     */\n    function isCategoryOption(category) {\n        return category && category.indexOf('x-tao-') === 0;\n    }\n\n    /**\n     * Calls a function for each category in the test model\n     * @param {Object} testModel\n     * @param {Function} cb\n     */\n    function eachCategories(testModel, cb) {\n        _.forEach(testModel.testParts, function (testPart) {\n            _.forEach(testPart.assessmentSections, function (assessmentSection) {\n                _.forEach(assessmentSection.sectionParts, function (itemRef) {\n                    _.forEach(itemRef.categories, function(category) {\n                        cb(category, itemRef);\n                    });\n                });\n            });\n        });\n    }\n\n    return {\n        /**\n         * Calls a function for each category in the test model\n         * @function eachCategories\n         * @param {Object} testModel\n         * @param {Function} cb\n         */\n        eachCategories: eachCategories,\n\n        /**\n         * Gets the list of categories assigned to the items.\n         * Discards special purpose categories like 'x-tao-...'\n         *\n         * @param {Object} testModel\n         * @returns {Array}\n         */\n        listCategories: function listCategories(testModel) {\n            var categories = {};\n            eachCategories(testModel, function(category) {\n                if (!isCategoryOption(category)) {\n                    categories[category] = true;\n                }\n            });\n            return _.keys(categories);\n        },\n\n        /**\n         * Gets the list of options assigned to the items (special purpose categories like 'x-tao-...').\n         *\n         * @param {Object} testModel\n         * @returns {Array}\n         */\n        listOptions: function listOptions(testModel) {\n            var options = {};\n            eachCategories(testModel, function(category) {\n                if (isCategoryOption(category)) {\n                    options[category] = true;\n                }\n            });\n            return _.keys(options);\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA ;\n */\n/**\n * @author Jean-Sébastien Conan <jean-sebastien@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/modelOverseer',[\n    'lodash',\n    'core/eventifier',\n    'core/statifier',\n    'taoQtiTest/controller/creator/helpers/baseType',\n    'taoQtiTest/controller/creator/helpers/cardinality',\n    'taoQtiTest/controller/creator/helpers/outcome',\n    'taoQtiTest/controller/creator/helpers/category'\n], function (_, eventifier, statifier, baseTypeHelper, cardinalityHelper, outcomeHelper, categoryHelper) {\n    'use strict';\n\n    /**\n     * Wraps the test model in a manager, provides API to handle events and states\n     * @param {Object} model\n     * @param {Object} [config]\n     * @returns {Object}\n     */\n    function modelOverseerFactory(model, config) {\n        var modelOverseer = {\n            /**\n             * Gets the nested model\n             * @returns {Object}\n             */\n            getModel: function getModel() {\n                return model;\n            },\n\n            /**\n             * Sets the nested model\n             *\n             * @param {Object} newModel\n             * @returns {modelOverseer}\n             * @fires setmodel\n             */\n            setModel: function setModel(newModel) {\n                model = newModel;\n\n                /**\n                 * @event modelOverseer#setmodel\n                 * @param {String} model\n                 */\n                modelOverseer.trigger('setmodel', model);\n                return this;\n            },\n\n            /**\n             * Gets the config set\n             * @returns {Object}\n             */\n            getConfig: function getConfig() {\n                return config;\n            },\n\n\n\n            /**\n             * Gets the list of defined outcomes for the nested model. A descriptor is built for each outcomes:\n             * {\n             *      name: {String},\n             *      type: {String},\n             *      cardinality: {String}\n             * }\n             * @returns {Object[]}\n             */\n            getOutcomesList: function getOutcomesList() {\n                return _.map(outcomeHelper.getOutcomeDeclarations(model), function(declaration) {\n                    return {\n                        name: declaration.identifier,\n                        type: baseTypeHelper.getNameByConstant(declaration.baseType),\n                        cardinality: cardinalityHelper.getNameByConstant(declaration.cardinality)\n                    };\n                });\n            },\n\n            /**\n             * Gets the names of the defined outcomes for the nested model\n             * @returns {Array}\n             */\n            getOutcomesNames: function getOutcomesNames() {\n                return _.map(outcomeHelper.getOutcomeDeclarations(model), function(declaration) {\n                    return declaration.identifier;\n                });\n            },\n\n            /**\n             * Gets the list of defined categories for the nested model\n             * @returns {Array}\n             */\n            getCategories: function getCategories() {\n                return categoryHelper.listCategories(model);\n            },\n\n            /**\n             * Gets the list of defined options for the nested model\n             * @returns {Array}\n             */\n            getOptions: function getOptions() {\n                return categoryHelper.listOptions(model);\n            }\n        };\n\n        config = _.isPlainObject(config) ? config : _.assign({}, config);\n\n        return statifier(eventifier(modelOverseer));\n    }\n\n    return modelOverseerFactory;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA;\n */\n/**\n * This object holds a shared context for all of the test creator modules and allow them to communicate via events.\n * Its lifecycle is bound to the creator controller.\n *\n * @author Christophe Noël <christophe@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/qtiTestCreator',[\n    'jquery',\n    'core/eventifier',\n    'taoQtiTest/controller/creator/areaBroker',\n    'taoQtiTest/controller/creator/modelOverseer'\n], function($, eventifier, areaBrokerFactory, modelOverseerFactory) {\n    'use strict';\n\n    /**\n     * @param {jQuery} $creatorContainer - root DOM element containing the creator\n     * @param {Object} config - options that will be forwareded to the modelOverseer Factory\n     * @returns {Object}\n     */\n    function testCreatorFactory($creatorContainer, config) {\n        var testCreator;\n\n        var $container,\n            model,\n            areaBroker,\n            modelOverseer;\n\n        /**\n         * Create the model overseer with the given model\n         * @returns {modelOverseer}\n         */\n        function loadModelOverseer() {\n            if (! modelOverseer && model) {\n                modelOverseer = modelOverseerFactory(model, config);\n            }\n            return modelOverseer;\n        }\n\n        /**\n         * Set up the areaBroker mapping from the actual DOM\n         * @returns {areaBroker} already mapped\n         */\n        function loadAreaBroker(){\n            if (! areaBroker) {\n                areaBroker = areaBrokerFactory($container, {\n                    'creator': $container,\n                    'itemSelectorPanel': $container.find('.test-creator-items'),\n                    'contentCreatorPanel': $container.find('.test-creator-content'),\n                    'propertyPanel': $container.find('.test-creator-props'),\n                    'elementPropertyPanel': $container.find('.qti-widget-properties')\n                });\n            }\n            return areaBroker;\n        }\n\n        if (! ($creatorContainer instanceof $)) {\n            throw new TypeError('a valid $container must be given');\n        }\n\n        $container = $creatorContainer;\n\n        testCreator = {\n            setTestModel: function setTestModel(m) {\n                model = m;\n            },\n\n            getAreaBroker: function getAreaBroker() {\n                return loadAreaBroker();\n            },\n\n            getModelOverseer: function getModelOverseer() {\n                return loadModelOverseer();\n            },\n\n            isTestHasErrors: function isTestHasErrors() {\n                return $container.find('.test-creator-props').find('span.validate-error').length > 0;\n            }\n        };\n\n        return eventifier(testCreator);\n    }\n\n    return testCreatorFactory;\n});\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA;\n */\n\n/**\n * The testItem data provider\n *\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoQtiTest/provider/testItems',[\n    'lodash',\n    'i18n',\n    'util/url',\n    'core/dataProvider/request'\n], function (_, __, urlUtil, request) {\n    'use strict';\n\n    /**\n     * Per function requests configuration.\n     */\n    var defaultConfig = {\n        getItemClasses : {\n            url : urlUtil.route('getItemClasses', 'Items', 'taoQtiTest')\n        },\n        getItems : {\n            url : urlUtil.route('getItems', 'Items', 'taoQtiTest')\n        },\n        getItemClassProperties : {\n            url : urlUtil.route('create', 'RestFormItem', 'taoItems')\n        }\n    };\n\n    /**\n     * Creates a configured testItem provider\n     *\n     * @param {Object} [config] - to override the default config\n     * @returns {testItemProvider} the new provider\n     */\n    return function testItemProviderFactory(config){\n\n        config = _.defaults(config || {}, defaultConfig);\n\n        /**\n         * @typedef {testItemProvider}\n         */\n        return {\n\n            /**\n             * Get the list of Items classes and sub classes\n             * @returns {Promise} that resolves with the classes\n             */\n            getItemClasses: function getItemClasses(){\n                return request(config.getItemClasses.url);\n            },\n\n            /**\n             * Get QTI Items in different formats\n             * @param {Object} [params] - the parameters to pass through the request\n             * @returns {Promise} that resolves with the classes\n             */\n            getItems : function getItems(params){\n                return request(config.getItems.url, params);\n            },\n\n            /**\n             * Get the properties of a the given item class\n             * @param {String} classUri - the item class URI\n             * @returns {Promise} that resolves with the classes\n             */\n            getItemClassProperties: function getItemClassProperties(classUri) {\n                return request(config.getItemClassProperties.url, { classUri : classUri });\n            }\n        };\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n */\n\n/**\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/views/item',[\n    'module',\n    'jquery',\n    'i18n',\n    'core/logger',\n    'taoQtiTest/provider/testItems',\n    'ui/resource/selector',\n    'ui/feedback'\n], function (module, $, __, loggerFactory, testItemProviderFactory, resourceSelectorFactory, feedback) {\n    'use strict';\n\n    /**\n     * Create a dedicated logger\n     */\n    const logger = loggerFactory('taoQtiTest/creator/views/item');\n\n    /**\n     * Let's you access the data\n     */\n    const testItemProvider = testItemProviderFactory();\n\n    /**\n     * Handles errors\n     * @param {Error} err\n     */\n    const onError = function onError(err) {\n        logger.error(err);\n        feedback().error(err.message || __('An error occured while retrieving items'));\n    };\n\n    const ITEM_URI = 'http://www.tao.lu/Ontologies/TAOItem.rdf#Item';\n\n    /**\n     * The ItemView setup items related components\n     * @exports taoQtiTest/controller/creator/views/item\n     * @param {jQueryElement} $container - where to append the view\n     */\n    return function itemView($container) {\n        const filters = module.config().BRS || false; // feature flag BRS (search by metadata) in Test Authoring\n        const selectorConfig = {\n            type: __('items'),\n            selectionMode: resourceSelectorFactory.selectionModes.multiple,\n            selectAllPolicy: resourceSelectorFactory.selectAllPolicies.visible,\n            classUri: ITEM_URI,\n            classes: [\n                {\n                    label: 'Item',\n                    uri: ITEM_URI,\n                    type: 'class'\n                }\n            ],\n            filters\n        };\n\n        //set up the resource selector with one root class Item in classSelector\n        const resourceSelector = resourceSelectorFactory($container, selectorConfig)\n            .on('render', function () {\n                $container.on('itemselected.creator', () => {\n                    this.clearSelection();\n                });\n            })\n            .on('query', function (params) {\n                //ask the server the item from the component query\n                testItemProvider\n                    .getItems(params)\n                    .then(items => {\n                        //and update the item list\n                        this.update(items, params);\n                    })\n                    .catch(onError);\n            })\n            .on('classchange', function (classUri) {\n                //by changing the class we need to change the\n                //properties filters\n                testItemProvider\n                    .getItemClassProperties(classUri)\n                    .then(filters => {\n                        this.updateFilters(filters);\n                    })\n                    .catch(onError);\n            })\n            .on('change', function (values) {\n                /**\n                 * We've got a selection, triggered on the view container\n                 *\n                 * TODO replace jquery events by the eventifier\n                 *\n                 * @event jQuery#itemselect.creator\n                 * @param {Object[]} values - the selection\n                 */\n                $container.trigger('itemselect.creator', [values]);\n            });\n\n        //load the classes hierarchy\n        testItemProvider\n            .getItemClasses()\n            .then(function (classes) {\n                selectorConfig.classes = classes;\n                selectorConfig.classUri = classes[0].uri;\n            })\n            .then(function () {\n                //load the class properties\n                return testItemProvider.getItemClassProperties(selectorConfig.classUri);\n            })\n            .then(function (filters) {\n                //set the filters from the properties\n                selectorConfig.filters = filters;\n            })\n            .then(function () {\n                // add classes in classSelector\n                selectorConfig.classes[0].children.forEach(node => {\n                    resourceSelector.addClassNode(node, selectorConfig.classUri);\n                });\n                resourceSelector.updateFilters(selectorConfig.filters);\n            })\n            .catch(onError);\n    };\n});\n\n","\ndefine('tpl!taoQtiTest/controller/creator/templates/testpart', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, functionType=\"function\", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing;\n\n\n  buffer += \"<div id=\\\"\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" class=\\\"testpart clearfix\\\">\\n   <h1>\\n   <a href=\\\"#\\\" class=\\\"toggler opened\\\" data-toggle=\\\"#testpart-content-\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\"></a>\\n   <span data-bind=\\\"identifier\\\">\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</span>\\n       <span class=\\\"icon-warning\\\"></span>\\n        <div class=\\\"actions\\\">\\n            <div class=\\\"tlb\\\">\\n                <div class=\\\"tlb-top\\\">\\n                    <span class=\\\"tlb-box\\\">\\n                        <span class=\\\"tlb-bar\\\">\\n                            <span class=\\\"tlb-start\\\"></span>\\n                            <span class=\\\"tlb-group\\\">\\n                                <a href=\\\"#\\\" class=\\\"tlb-button-off property-toggler\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Test Part Properties\", options) : helperMissing.call(depth0, \"__\", \"Test Part Properties\", options)))\n    + \"\\\" data-testid=\\\"test-part-properties\\\"><span class=\\\"icon-settings\\\"></span></a>\\n                                <span class=\\\"tlb-separator\\\"></span>\\n                                <a href=\\\"#\\\" class=\\\"tlb-button-off move-up\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Move Up\", options) : helperMissing.call(depth0, \"__\", \"Move Up\", options)))\n    + \"\\\" data-testid=\\\"move-up-test-part\\\"><span class=\\\"icon-up\\\"></span></a>\\n                                <a href=\\\"#\\\" class=\\\"tlb-button-off move-down\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Move Down\", options) : helperMissing.call(depth0, \"__\", \"Move Down\", options)))\n    + \"\\\" data-testid=\\\"move-down-test-part\\\"><span class=\\\"icon-down\\\"></span></a>\\n                                <span class=\\\"tlb-separator\\\"></span>\\n                                <a href=\\\"#\\\" class=\\\"tlb-button-off\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Remove Test Part\", options) : helperMissing.call(depth0, \"__\", \"Remove Test Part\", options)))\n    + \"\\\" data-delete=\\\"#\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" data-testid=\\\"remove-test-part\\\"><span class=\\\"icon-bin\\\"></span></a>\\n                            </span>\\n                            <span class=\\\"tlb-end\\\"></span>\\n                        </span>\\n                    </span>\\n                </div>\\n            </div>\\n        </div>\\n    </h1>\\n    <div id=\\\"testpart-content-\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" class=\\\"testpart-content\\\">\\n\\n       <!-- assessmentTest/testPart/assessmentSections -->\\n       <div class=\\\"sections\\\" data-bind-each=\\\"assessmentSections\\\" data-bind-tmpl=\\\"section\\\" data-bind-filter=\\\"isSection\\\"></div>\\n\\n        <button class=\\\"btn-info small section-adder button-add\\\" data-testid=\\\"add-section\\\">\\n            <span class=\\\"icon-add\\\"></span>\\n            \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"New section\", options) : helperMissing.call(depth0, \"__\", \"New section\", options)))\n    + \"\\n        </button>\\n    </div>\\n</div>\";\n  return buffer;\n  });\n});\n\n","\ndefine('tpl!taoQtiTest/controller/creator/templates/section', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, functionType=\"function\", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing;\n\n\n  buffer += \"<div id=\\\"\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" class=\\\"section\\\">\\n\\n<!-- assessmentTest/testPart/assessmentSection/title -->\\n    <h2><span class=\\\"title-index\\\"></span> <span data-bind=\\\"title\\\">\";\n  if (helper = helpers.title) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</span>\\n        <span class=\\\"icon-warning\\\"></span>\\n        <div class=\\\"actions\\\">\\n            <div class=\\\"tlb\\\">\\n                <div class=\\\"tlb-top\\\">\\n                    <span class=\\\"tlb-box\\\">\\n                        <span class=\\\"tlb-bar\\\">\\n                            <span class=\\\"tlb-start\\\"></span>\\n                            <span class=\\\"tlb-group\\\">\\n                                <a href=\\\"#\\\" class=\\\"tlb-button-off add-subsection\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Add Subsection\", options) : helperMissing.call(depth0, \"__\", \"Add Subsection\", options)))\n    + \"\\\" data-testid=\\\"add-subsection\\\"><span class=\\\"icon-add-subsection\\\"></span></a>\\n                                <span class=\\\"tlb-separator\\\"></span>\\n                                <a href=\\\"#\\\" class=\\\"tlb-button-off rub-toggler\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Manage Rubric Blocks\", options) : helperMissing.call(depth0, \"__\", \"Manage Rubric Blocks\", options)))\n    + \"\\\" data-toggle=\\\"#rublocks-\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" data-testid=\\\"manage-rubric-blocks\\\"><span class=\\\"icon-rubric\\\"></span></a>\\n                                <span class=\\\"tlb-separator\\\"></span>\\n                                <a href=\\\"#\\\" class=\\\"tlb-button-off property-toggler\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Section Properties\", options) : helperMissing.call(depth0, \"__\", \"Section Properties\", options)))\n    + \"\\\" data-testid=\\\"section-properties\\\"><span class=\\\"icon-settings\\\"></span></a>\\n                                <span class=\\\"tlb-separator\\\"></span>\\n                                <a href=\\\"#\\\" class=\\\"tlb-button-off move-up disabled\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Move Up\", options) : helperMissing.call(depth0, \"__\", \"Move Up\", options)))\n    + \"\\\" data-testid=\\\"move-up-section\\\"><span class=\\\"icon-up\\\"></span></a>\\n                                <a href=\\\"#\\\" class=\\\"tlb-button-off move-down disabled\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Move Down\", options) : helperMissing.call(depth0, \"__\", \"Move Down\", options)))\n    + \"\\\" data-testid=\\\"move-down-section\\\"><span class=\\\"icon-down\\\"></span></a>\\n                                <span class=\\\"tlb-separator\\\"></span>\\n                                <a href=\\\"#\\\" class=\\\"tlb-button-off disabled\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Remove Section\", options) : helperMissing.call(depth0, \"__\", \"Remove Section\", options)))\n    + \"\\\" data-delete=\\\":parent .section\\\" data-testid=\\\"remove-section\\\"><span class=\\\"icon-bin\\\"></span></a>\\n                            </span>\\n                            <span class=\\\"tlb-end\\\"></span>\\n                        </span>\\n                    </span>\\n                </div>\\n            </div>\\n        </div>\\n    </h2>\\n\\n    <div id=\\\"rublocks-\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" class=\\\"rublocks clearfix toggled\\\">\\n        <h3>\\n            <span class=\\\"title\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Rubric Blocks\", options) : helperMissing.call(depth0, \"__\", \"Rubric Blocks\", options)))\n    + \"</span>\\n        </h3>\\n        <ol class=\\\"rubricblocks decimal\\\" data-bind-each=\\\"rubricBlocks\\\" data-bind-tmpl=\\\"rubricblock\\\"></ol>\\n        <button class=\\\"btn-info small rublock-adder\\\" data-testid=\\\"add-rubric-block\\\">\\n            <span class=\\\"icon-add\\\"></span>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"New Rubric Block\", options) : helperMissing.call(depth0, \"__\", \"New Rubric Block\", options)))\n    + \"\\n        </button>\\n    </div>\\n    <div class=\\\"itemrefs-wrapper\\\">\\n        <h3>\\n            <span class=\\\"title\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Items\", options) : helperMissing.call(depth0, \"__\", \"Items\", options)))\n    + \"</span>\\n        </h3>\\n        <ol class=\\\"itemrefs decimal clearfix\\\" data-bind-each=\\\"sectionParts\\\" data-bind-tmpl=\\\"itemref\\\" data-bind-filter=\\\"isItemRef\\\" data-msg=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Add selected item(s) here.\", options) : helperMissing.call(depth0, \"__\", \"Add selected item(s) here.\", options)))\n    + \"\\\"></ol>\\n        <div class=\\\"itemref-placeholder\\\" data-testid=\\\"add-items\\\">\\n            \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Add selected item(s) here.\", options) : helperMissing.call(depth0, \"__\", \"Add selected item(s) here.\", options)))\n    + \"\\n        </div>\\n    </div>\\n     <div class=\\\"subsections\\\" data-bind-each=\\\"sectionParts\\\" data-bind-tmpl=\\\"subsection\\\" data-bind-filter=\\\"isSection\\\"></div>\\n\\n</div>\";\n  return buffer;\n  });\n});\n\n","\ndefine('tpl!taoQtiTest/controller/creator/templates/rubricblock', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression;\n\n\n  buffer += \"<li class=\\\"rubricblock\\\">\\n    <div class=\\\"actions\\\">\\n       <div class=\\\"tlb\\\">\\n            <div class=\\\"tlb-top\\\">\\n                <span class=\\\"tlb-box\\\">\\n                    <span class=\\\"tlb-bar\\\">\\n                        <span class=\\\"tlb-start\\\"></span>\\n                        <span class=\\\"tlb-group\\\">\\n                            <a href=\\\"#\\\" class=\\\"tlb-button-off property-toggler\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Rubric Block Properties\", options) : helperMissing.call(depth0, \"__\", \"Rubric Block Properties\", options)))\n    + \"\\\" data-testid=\\\"rubric-block-properties\\\"><span class=\\\"icon-settings\\\"></span></a>\\n                            <span class=\\\"tlb-separator\\\"></span>\\n                            <a href=\\\"#\\\" class=\\\"tlb-button-off\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Remove Rubric Block\", options) : helperMissing.call(depth0, \"__\", \"Remove Rubric Block\", options)))\n    + \"\\\" data-delete=\\\":parent .rubricblock\\\" data-testid=\\\"remove-rubric-block\\\"><span class=\\\"icon-bin\\\"></span></a>\\n                        </span>\\n                        <span class=\\\"tlb-end\\\"></span>\\n                    </span>\\n                </span>\\n            </div>\\n        </div>\\n    </div>\\n    <div class=\\\"rubricblock-content\\\"></div>\\n</li>\";\n  return buffer;\n  });\n});\n\n","\ndefine('tpl!taoQtiTest/controller/creator/templates/itemref', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, functionType=\"function\", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing;\n\n\n  buffer += \"<li id='\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"' data-uri='\";\n  if (helper = helpers.href) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.href); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"' class='itemref'>\\n    <span class='title truncate'>\";\n  stack1 = (helper = helpers.dompurify || (depth0 && depth0.dompurify),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.label), options) : helperMissing.call(depth0, \"dompurify\", (depth0 && depth0.label), options));\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"</span>\\n    <span class=\\\"icon-warning\\\"></span>\\n    <div class=\\\"actions\\\">\\n        <div class=\\\"tlb\\\">\\n            <div class=\\\"tlb-top\\\">\\n                <span class=\\\"tlb-box\\\">\\n                    <span class=\\\"tlb-bar\\\">\\n                        <span class=\\\"tlb-start\\\"></span>\\n                        <span class=\\\"tlb-group\\\">\\n                            <a href=\\\"#\\\" class=\\\"tlb-button-off property-toggler\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Item Reference Properties\", options) : helperMissing.call(depth0, \"__\", \"Item Reference Properties\", options)))\n    + \"\\\" data-testid=\\\"item-properties\\\"><span class=\\\"icon-settings\\\"></span></a>\\n                            <span class=\\\"tlb-separator\\\"></span>\\n                            <a href=\\\"#\\\" class=\\\"tlb-button-off move-up\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Move Up\", options) : helperMissing.call(depth0, \"__\", \"Move Up\", options)))\n    + \"\\\" data-testid=\\\"move-up-item\\\"><span class=\\\"icon-up\\\"></span></a>\\n                            <a href=\\\"#\\\" class=\\\"tlb-button-off move-down\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Move Down\", options) : helperMissing.call(depth0, \"__\", \"Move Down\", options)))\n    + \"\\\" data-testid=\\\"move-down-item\\\"><span class=\\\"icon-down\\\"></span></a>\\n                            <span class=\\\"tlb-separator\\\"></span>\\n                            <a href=\\\"#\\\" class=\\\"tlb-button-off\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Remove Item Reference\", options) : helperMissing.call(depth0, \"__\", \"Remove Item Reference\", options)))\n    + \"\\\" data-delete=\\\":parent .itemref\\\" data-testid=\\\"remove-item\\\"><span class=\\\"icon-bin\\\"></span></a>\\n                        </span>\\n                        <span class=\\\"tlb-end\\\"></span>\\n                    </span>\\n                </span>\\n            </div>\\n        </div>\\n    </div>\\n</li>\";\n  return buffer;\n  });\n});\n\n","\ndefine('tpl!taoQtiTest/controller/creator/templates/outcomes', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, functionType=\"function\", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing, self=this;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\n    <div class=\\\"grid-row\\\">\\n        <div class=\\\"col-6 line\\\">\";\n  if (helper = helpers.name) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.name); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</div>\\n        <div class=\\\"col-3 line\\\">\";\n  if (helper = helpers.type) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.type); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</div>\\n        <div class=\\\"col-3 line\\\">\";\n  if (helper = helpers.cardinality) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.cardinality); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</div>\\n    </div>\\n\";\n  return buffer;\n  }\n\nfunction program3(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\n    <div class=\\\"grid-row\\\">\\n        <div class=\\\"col-12 line\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"no outcome declaration found\", options) : helperMissing.call(depth0, \"__\", \"no outcome declaration found\", options)))\n    + \"</div>\\n    </div>\\n\";\n  return buffer;\n  }\n\n  buffer += \"<div class=\\\"grid-row\\\">\\n    <div class=\\\"col-6 header\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Identifier\", options) : helperMissing.call(depth0, \"__\", \"Identifier\", options)))\n    + \"</div>\\n    <div class=\\\"col-3 header\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Type\", options) : helperMissing.call(depth0, \"__\", \"Type\", options)))\n    + \"</div>\\n    <div class=\\\"col-3 header\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Cardinality\", options) : helperMissing.call(depth0, \"__\", \"Cardinality\", options)))\n    + \"</div>\\n</div>\\n\";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.outcomes), {hash:{},inverse:self.program(3, program3, data),fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  return buffer;\n  });\n});\n\n","\ndefine('tpl!taoQtiTest/controller/creator/templates/test-props', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, functionType=\"function\", self=this;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\n        <h4 class=\\\"toggler closed\\\" data-toggle=\\\"~ .test-time-limits\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Time Limits\", options) : helperMissing.call(depth0, \"__\", \"Time Limits\", options)))\n    + \"</h4>\\n\\n    <!-- assessmentTest/timeLimits -->\\n        <div class=\\\"test-time-limits toggled\\\">\\n\\n    \\n\\n    <!-- assessmentTest/timeLimits/maxTime -->\\n            <div class=\\\"grid-row\\\">\\n                <div class=\\\"col-5\\\">\\n                    <label for=\\\"test-max-time\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Maximum Duration\", options) : helperMissing.call(depth0, \"__\", \"Maximum Duration\", options)))\n    + \"</label>\\n                </div>\\n                <div class=\\\"col-6 duration-group\\\">\\n                    <input type=\\\"text\\\" name=\\\"max-time\\\" value=\\\"00:00:00\\\" data-duration=\\\"HH:mm:ss\\\" data-bind=\\\"timeLimits.maxTime\\\" data-bind-encoder=\\\"time\\\" />\\n                </div>\\n                <div class=\\\"col-1 help\\\">\\n                    <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                    <div class=\\\"tooltip-content\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Maximum duration for the all test.\", options) : helperMissing.call(depth0, \"__\", \"Maximum duration for the all test.\", options)))\n    + \"\\n                    </div>\\n                </div>\\n            </div>\\n\\n    <!-- assessmentTest/timeLimits/allowLateSubmission -->\\n            <div class=\\\"grid-row pseudo-label-box\\\">\\n                <div class=\\\"col-5\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Late submission allowed\", options) : helperMissing.call(depth0, \"__\", \"Late submission allowed\", options)))\n    + \"\\n                </div>\\n                <div class=\\\"col-6\\\">\\n                    <label>\\n                        <input type=\\\"checkbox\\\" name=\\\"test-allow-late-submission\\\" value=\\\"true\\\" data-bind=\\\"timeLimits.allowLateSubmission\\\" data-bind-encoder=\\\"boolean\\\" />\\n                        <span class=\\\"icon-checkbox\\\"></span>\\n                    </label>\\n                </div>\\n                <div class=\\\"col-1 help\\\">\\n                    <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                    <div class=\\\"tooltip-content\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Whether a candidate's response that is beyond the maximum duration should still be accepted.\", options) : helperMissing.call(depth0, \"__\", \"Whether a candidate's response that is beyond the maximum duration should still be accepted.\", options)))\n    + \"\\n                    </div>\\n                </div>\\n            </div>\\n        </div>\\n    \";\n  return buffer;\n  }\n\nfunction program3(depth0,data) {\n  \n  var buffer = \"\", stack1, helper, options;\n  buffer += \"\\n    <div class=\\\"test-scoring toggled\\\">\\n\\n<!-- assessmentTest/scoring/outcomeProcessing -->\\n        <div class=\\\"grid-row\\\">\\n            <div class=\\\"col-5\\\">\\n                <label for=\\\"test-outcome-processing\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Outcome processing\", options) : helperMissing.call(depth0, \"__\", \"Outcome processing\", options)))\n    + \"</label>\\n            </div>\\n            <div class=\\\"col-6\\\">\\n                <select name=\\\"test-outcome-processing\\\" class=\\\"select2\\\" data-bind=\\\"scoring.outcomeProcessing\\\" data-bind-encoder=\\\"string\\\" data-has-search=\\\"false\\\">\\n                \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.modes), {hash:{},inverse:self.noop,fn:self.program(4, program4, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n                </select>\\n            </div>\\n            <div class=\\\"col-1 help\\\">\\n                <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                <div class=\\\"tooltip-content\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Select the way the responses of your test should be processed\", options) : helperMissing.call(depth0, \"__\", \"Select the way the responses of your test should be processed\", options)))\n    + \"\\n                </div>\\n            </div>\\n        </div>\\n\\n<!-- assessmentTest/scoring/categoryScore -->\\n        <div class=\\\"grid-row test-category-score\\\">\\n            <div class=\\\"col-5\\\">\\n                <label for=\\\"test-category-score\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Category score\", options) : helperMissing.call(depth0, \"__\", \"Category score\", options)))\n    + \"</label>\\n            </div>\\n            <div class=\\\"col-6\\\">\\n                <label>\\n                    <input type=\\\"checkbox\\\" name=\\\"test-category-score\\\" value=\\\"true\\\" data-bind=\\\"scoring.categoryScore\\\" data-bind-encoder=\\\"boolean\\\" />\\n                    <span class=\\\"icon-checkbox\\\"></span>\\n                </label>\\n            </div>\\n            <div class=\\\"col-1 help\\\">\\n                <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                <div class=\\\"tooltip-content\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Also compute the score per categories\", options) : helperMissing.call(depth0, \"__\", \"Also compute the score per categories\", options)))\n    + \"\\n                </div>\\n            </div>\\n        </div>\\n\\n<!-- assessmentTest/scoring/cutScore -->\\n        <div class=\\\"grid-row test-cut-score\\\">\\n            <div class=\\\"col-5\\\">\\n                <label for=\\\"test-cut-score\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Cut score (pass ratio)\", options) : helperMissing.call(depth0, \"__\", \"Cut score (pass ratio)\", options)))\n    + \"</label>\\n            </div>\\n            <div class=\\\"col-6\\\">\\n                <input type=\\\"text\\\" name=\\\"test-cut-score\\\" value=\\\"0\\\" data-bind=\\\"scoring.cutScore\\\" data-bind-encoder=\\\"float\\\" data-validate=\\\"$numeric;\\\" />\\n            </div>\\n            <div class=\\\"col-1 help\\\">\\n                <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                <div class=\\\"tooltip-content\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Set the cut score (or pass score ratio) associated to the test. It must be a float between 0 and 1.\", options) : helperMissing.call(depth0, \"__\", \"Set the cut score (or pass score ratio) associated to the test. It must be a float between 0 and 1.\", options)))\n    + \"\\n                </div>\\n            </div>\\n        </div>\\n\\n<!-- assessmentTest/scoring/weightIdentifier -->\\n        <div class=\\\"grid-row test-weight-identifier\\\">\\n            <div class=\\\"col-5\\\">\\n                <label for=\\\"test-weight-identifier\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Weight\", options) : helperMissing.call(depth0, \"__\", \"Weight\", options)))\n    + \"</label>\\n            </div>\\n            <div class=\\\"col-6\\\">\\n                <input type=\\\"text\\\" name=\\\"test-weight-identifier\\\" data-bind=\\\"scoring.weightIdentifier\\\" data-validate=\\\"$pattern(pattern=^([a-zA-Z_][a-zA-Z0-9_\\\\.-]*)?$);\\\" />\\n            </div>\\n            <div class=\\\"col-1 help\\\">\\n                <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                <div class=\\\"tooltip-content\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Set the weight identifier used to process the score\", options) : helperMissing.call(depth0, \"__\", \"Set the weight identifier used to process the score\", options)))\n    + \"\\n                </div>\\n            </div>\\n        </div>\\n\\n<!-- assessmentTest/scoring/description -->\\n        <div class=\\\"grid-row\\\">\\n            <div class=\\\"col-12\\\">\\n                \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.modes), {hash:{},inverse:self.noop,fn:self.program(7, program7, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n            </div>\\n        </div>\\n    </div>\\n\";\n  return buffer;\n  }\nfunction program4(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\n                    <option value=\\\"\";\n  if (helper = helpers.key) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.key); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.selected), {hash:{},inverse:self.noop,fn:self.program(5, program5, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \">\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</option>\\n                \";\n  return buffer;\n  }\nfunction program5(depth0,data) {\n  \n  \n  return \"selected=\\\"selected\\\"\";\n  }\n\nfunction program7(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\n                <div class=\\\"feedback-info test-outcome-processing-description\\\" data-key=\\\"\";\n  if (helper = helpers.key) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.key); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\n                    <span class=\\\"icon-info\\\"></span>\\n                    \";\n  if (helper = helpers.description) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.description); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\n                </div>\\n                \";\n  return buffer;\n  }\n\n  buffer += \"<div class=\\\"test-props props clearfix\\\">\\n\\n    <!-- test properties -->\\n    <h3 data-bind=\\\"title\\\"></h3>\\n\\n<!-- assessmentTest/identifier -->\\n    <div class=\\\"grid-row\\\">\\n        <div class=\\\"col-5\\\">\\n            <label for=\\\"test-identifier\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Identifier\", options) : helperMissing.call(depth0, \"__\", \"Identifier\", options)))\n    + \" <abbr title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Required field\", options) : helperMissing.call(depth0, \"__\", \"Required field\", options)))\n    + \"\\\">*</abbr></label>\\n            <span id=\\\"props-\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" data-bind=\\\"identifier\\\" style=\\\"display: none;\\\">\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</span>\\n        </div>\\n        <div class=\\\"col-6\\\">\\n            <input type=\\\"text\\\" name=\\\"test-identifier\\\" data-bind=\\\"identifier\\\" data-validate=\\\"$notEmpty; $idFormat; $testIdAvailable(identifier=\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \");\\\" />\\n        </div>\\n        <div class=\\\"col-1 help\\\">\\n            <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n            <div class=\\\"tooltip-content\\\">\\n            \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"The principle identifier of the test.\", options) : helperMissing.call(depth0, \"__\", \"The principle identifier of the test.\", options)))\n    + \"\\n            </div>\\n        </div>\\n    </div>\\n\\n<!-- assessmentTest/title -->\\n    <div class=\\\"grid-row\\\">\\n        <div class=\\\"col-5\\\">\\n            <label for=\\\"test-title\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Title\", options) : helperMissing.call(depth0, \"__\", \"Title\", options)))\n    + \" <abbr title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Required field\", options) : helperMissing.call(depth0, \"__\", \"Required field\", options)))\n    + \"\\\">*</abbr></label>\\n        </div>\\n        <div class=\\\"col-6\\\">\\n            <input type=\\\"text\\\" name=\\\"test-title\\\" data-bind=\\\"title\\\" data-validate=\\\"$notEmpty\\\" />\\n        </div>\\n        <div class=\\\"col-1 help\\\">\\n            <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n            <div class=\\\"tooltip-content\\\">\\n            \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"The test title.\", options) : helperMissing.call(depth0, \"__\", \"The test title.\", options)))\n    + \"\\n            </div>\\n        </div>\\n    </div>\\n\\n    \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.showTimeLimits), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n\\n    <h4 class=\\\"toggler closed\\\" data-toggle=\\\"~ .test-scoring\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Scoring\", options) : helperMissing.call(depth0, \"__\", \"Scoring\", options)))\n    + \"</h4>\\n\\n<!-- assessmentTest/scoring -->\\n\";\n  stack1 = helpers['with'].call(depth0, (depth0 && depth0.scoring), {hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n\\n    <h4 class=\\\"toggler closed\\\" data-toggle=\\\"~ .test-outcome-declarations\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Outcome declarations\", options) : helperMissing.call(depth0, \"__\", \"Outcome declarations\", options)))\n    + \"</h4>\\n\\n    <!-- assessmentTest/outcomeDeclarations -->\\n    <div class=\\\"test-outcome-declarations panel toggled\\\">\\n        <div class=\\\"grid-row test-outcomes-generate\\\">\\n            <div class=\\\"col-12 align-right\\\">\\n                <button class=\\\"btn-info small\\\" data-action=\\\"generate-outcomes\\\"><span class=\\\"icon icon-reset\\\"></span>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Regenerate\", options) : helperMissing.call(depth0, \"__\", \"Regenerate\", options)))\n    + \"</button>\\n            </div>\\n        </div>\\n        <div class=\\\"outcome-declarations\\\"></div>\\n    </div>\\n\\n</div>\";\n  return buffer;\n  });\n});\n\n","\ndefine('tpl!taoQtiTest/controller/creator/templates/testpart-props', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, functionType=\"function\", self=this;\n\nfunction program1(depth0,data) {\n  \n  \n  return \"checked\";\n  }\n\nfunction program3(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\n                <div class=\\\"grid-row pseudo-label-box\\\">\\n                    <div class=\\\"col-5\\\">\\n                        <label for=\\\"testpart-show-feedback\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Show Feedback\", options) : helperMissing.call(depth0, \"__\", \"Show Feedback\", options)))\n    + \"</label>\\n                    </div>\\n                    <div class=\\\"col-6\\\">\\n                        <label>\\n                            <input type=\\\"checkbox\\\" name=\\\"testpart-show-feedback\\\" value=\\\"true\\\" data-bind=\\\"itemSessionControl.showFeedback\\\" data-bind-encoder=\\\"boolean\\\" />\\n                            <span class=\\\"icon-checkbox\\\"></span>\\n                        </label>\\n                    </div>\\n                    <div class=\\\"col-1 help\\\">\\n                        <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                        <div class=\\\"tooltip-content\\\">\\n                        \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"This constraint affects the visibility of feedback after the end of the last attempt.\", options) : helperMissing.call(depth0, \"__\", \"This constraint affects the visibility of feedback after the end of the last attempt.\", options)))\n    + \"\\n                        </div>\\n                    </div>\\n                </div>\\n            \";\n  return buffer;\n  }\n\nfunction program5(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\n                <div class=\\\"grid-row pseudo-label-box\\\">\\n                    <div class=\\\"col-5\\\">\\n                        <label for=\\\"testpart-allow-comment\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Allow Comment\", options) : helperMissing.call(depth0, \"__\", \"Allow Comment\", options)))\n    + \"</label>\\n                    </div>\\n                    <div class=\\\"col-6\\\">\\n                        <label>\\n                            <input type=\\\"checkbox\\\" name=\\\"testpart-allow-comment\\\" value=\\\"true\\\" data-bind=\\\"itemSessionControl.allowComment\\\" data-bind-encoder=\\\"boolean\\\" />\\n                            <span class=\\\"icon-checkbox\\\"></span>\\n                        </label>\\n                    </div>\\n                    <div class=\\\"col-1 help\\\">\\n                        <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                        <div class=\\\"tooltip-content\\\">\\n                        \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"This constraint controls whether or not the candidate is allowed to provide a comment on the item during the session. Comments are not part of the assessed responses.\", options) : helperMissing.call(depth0, \"__\", \"This constraint controls whether or not the candidate is allowed to provide a comment on the item during the session. Comments are not part of the assessed responses.\", options)))\n    + \"\\n                        </div>\\n                    </div>\\n                </div>\\n            \";\n  return buffer;\n  }\n\nfunction program7(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\n                <div class=\\\"grid-row pseudo-label-box\\\">\\n                    <div class=\\\"col-5\\\">\\n                        <label for=\\\"testpart-allow-skipping\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Allow Skipping\", options) : helperMissing.call(depth0, \"__\", \"Allow Skipping\", options)))\n    + \"</label>\\n                    </div>\\n                    <div class=\\\"col-6\\\">\\n                        <label>\\n                            <input type=\\\"checkbox\\\" name=\\\"testpart-allow-skipping\\\" value=\\\"true\\\" checked=\\\"checked\\\"  data-bind=\\\"itemSessionControl.allowSkipping\\\" data-bind-encoder=\\\"boolean\\\"   />\\n                            <span class=\\\"icon-checkbox\\\"></span>\\n                        </label>\\n                    </div>\\n                    <div class=\\\"col-1 help\\\">\\n                        <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                        <div class=\\\"tooltip-content\\\">\\n                        \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"If the candidate can skip the item, without submitting a response (default is true).\", options) : helperMissing.call(depth0, \"__\", \"If the candidate can skip the item, without submitting a response (default is true).\", options)))\n    + \"\\n                        </div>\\n                    </div>\\n                </div>\\n            \";\n  return buffer;\n  }\n\nfunction program9(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\n            <h4 class=\\\"toggler closed\\\" data-toggle=\\\"~ .testpart-time-limits\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Time Limits\", options) : helperMissing.call(depth0, \"__\", \"Time Limits\", options)))\n    + \"</h4>\\n\\n    <!-- assessmentTest/testPart/timeLimits/minTime -->\\n            <div class=\\\"testpart-time-limits toggled\\\">\\n\\n    \\n\\n    <!-- assessmentTest/testPart/timeLimits/maxTime -->\\n                <div class=\\\"grid-row\\\">\\n                    <div class=\\\"col-5\\\">\\n                        <label for=\\\"testpart-max-time\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Maximum Duration\", options) : helperMissing.call(depth0, \"__\", \"Maximum Duration\", options)))\n    + \"</label>\\n                    </div>\\n                    <div class=\\\"col-6 duration-group\\\">\\n                        <input type=\\\"text\\\" id=\\\"testpart-max-time\\\" name=\\\"max-time\\\" value=\\\"00:00:00\\\" data-duration=\\\"HH:mm:ss\\\" data-bind=\\\"timeLimits.maxTime\\\" data-bind-encoder=\\\"time\\\" />\\n                    </div>\\n                    <div class=\\\"col-1 help\\\">\\n                        <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                        <div class=\\\"tooltip-content\\\">\\n                        \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Maximum duration for this test part.\", options) : helperMissing.call(depth0, \"__\", \"Maximum duration for this test part.\", options)))\n    + \"\\n                        </div>\\n                    </div>\\n                </div>\\n\\n    <!-- assessmentTest/testPart/timeLimits/allowLateSubmission -->\\n                <div class=\\\"grid-row pseudo-label-box\\\">\\n                    <div class=\\\"col-5\\\">\\n                        <label for=\\\"testpart-allow-late-submission\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Late submission allowed\", options) : helperMissing.call(depth0, \"__\", \"Late submission allowed\", options)))\n    + \"</label>\\n                    </div>\\n                    <div class=\\\"col-6\\\">\\n                        <label>\\n                            <input type=\\\"checkbox\\\" name=\\\"section-allow-late-submission\\\" value=\\\"true\\\" data-bind=\\\"timeLimits.allowLateSubmission\\\" data-bind-encoder=\\\"boolean\\\" />\\n                            <span class=\\\"icon-checkbox\\\"></span>\\n                        </label>\\n                    </div>\\n                    <div class=\\\"col-1 help\\\">\\n                        <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                        <div class=\\\"tooltip-content\\\">\\n                        \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Whether a candidate's response that is beyond the maximum duration of the test part should still be accepted.\", options) : helperMissing.call(depth0, \"__\", \"Whether a candidate's response that is beyond the maximum duration of the test part should still be accepted.\", options)))\n    + \"\\n                        </div>\\n                    </div>\\n                </div>\\n            </div>\\n        \";\n  return buffer;\n  }\n\n  buffer += \"<div id=\\\"testpart-props-\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" class=\\\"testpart-props props clearfix\\\">\\n    <h3>\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</h3>\\n\\n    <form autocomplete=\\\"off\\\">\\n\\n<!-- assessmentTest/testPart/identifier -->\\n        <div class=\\\"grid-row\\\">\\n            <div class=\\\"col-5\\\">\\n                <label for=\\\"testpart-identifier\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Identifier\", options) : helperMissing.call(depth0, \"__\", \"Identifier\", options)))\n    + \" <abbr title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Required field\", options) : helperMissing.call(depth0, \"__\", \"Required field\", options)))\n    + \"\\\">*</abbr></label>\\n                <span id=\\\"props-\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" data-bind=\\\"identifier\\\" style=\\\"display: none;\\\">\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</span>\\n            </div>\\n            <div class=\\\"col-6\\\">\\n                <input type=\\\"text\\\" id=\\\"testpart-identifier\\\" data-bind=\\\"identifier\\\" data-validate=\\\"$notEmpty; $idFormat; $testIdAvailable(identifier=\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \");\\\" />\\n            </div>\\n            <div class=\\\"col-1 help\\\">\\n                <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                <div class=\\\"tooltip-content\\\">\\n                \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"The test part identifier.\", options) : helperMissing.call(depth0, \"__\", \"The test part identifier.\", options)))\n    + \"\\n                </div>\\n            </div>\\n        </div>\\n\\n<!-- assessmentTest/testPart/navigationMode -->\\n        <div class=\\\"grid-row pseudo-label-box\\\">\\n            <div class=\\\"col-5\\\">\\n               \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Navigation\", options) : helperMissing.call(depth0, \"__\", \"Navigation\", options)))\n    + \" <abbr title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Required field\", options) : helperMissing.call(depth0, \"__\", \"Required field\", options)))\n    + \"\\\">*</abbr>\\n            </div>\\n            <div class=\\\"col-6\\\">\\n                <label>\\n                    <input\\n                            type=\\\"radio\\\"\\n                            name=\\\"testpart-navigation-mode\\\"\\n                            \";\n  stack1 = (helper = helpers.equal || (depth0 && depth0.equal),options={hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data},helper ? helper.call(depth0, (depth0 && depth0.navigationMode), 0, options) : helperMissing.call(depth0, \"equal\", (depth0 && depth0.navigationMode), 0, options));\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n                            value=\\\"0\\\"\\n                            data-bind=\\\"navigationMode\\\"\\n                            data-bind-encoder=\\\"number\\\"\\n                    />\\n                    <span class=\\\"icon-radio\\\"></span>\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Linear\", options) : helperMissing.call(depth0, \"__\", \"Linear\", options)))\n    + \"\\n                </label>\\n                <label>\\n                    <input\\n                            type=\\\"radio\\\"\\n                            name=\\\"testpart-navigation-mode\\\"\\n                            \";\n  stack1 = (helper = helpers.equal || (depth0 && depth0.equal),options={hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data},helper ? helper.call(depth0, (depth0 && depth0.navigationMode), 1, options) : helperMissing.call(depth0, \"equal\", (depth0 && depth0.navigationMode), 1, options));\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n                            value=\\\"1\\\"\\n                    />\\n                    <span class=\\\"icon-radio\\\"></span>\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Non Linear\", options) : helperMissing.call(depth0, \"__\", \"Non Linear\", options)))\n    + \"\\n                </label>\\n            </div>\\n            <div class=\\\"col-1 help\\\">\\n                <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                <div class=\\\"tooltip-content\\\">\\n                \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"The navigation mode determines the general paths that the candidate may take. A linear mode restricts the candidate to attempt each item in turn. Non Linear removes this restriction.\", options) : helperMissing.call(depth0, \"__\", \"The navigation mode determines the general paths that the candidate may take. A linear mode restricts the candidate to attempt each item in turn. Non Linear removes this restriction.\", options)))\n    + \"\\n                </div>\\n            </div>\\n        </div>\\n\\n<!-- assessmentTest/testPart/submissionMode -->\\n        <div class=\\\"grid-row pseudo-label-box\\\">\\n            <div class=\\\"col-5\\\">\\n                \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Submission\", options) : helperMissing.call(depth0, \"__\", \"Submission\", options)))\n    + \" <abbr title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Required field\", options) : helperMissing.call(depth0, \"__\", \"Required field\", options)))\n    + \"\\\">*</abbr>\\n            </div>\\n            <div class=\\\"col-6\\\">\\n                <label>\\n                    <input\\n                            type=\\\"radio\\\"\\n                            name=\\\"testpart-submission-mode\\\"\\n                            \";\n  stack1 = (helper = helpers.equal || (depth0 && depth0.equal),options={hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data},helper ? helper.call(depth0, (depth0 && depth0.submissionMode), 0, options) : helperMissing.call(depth0, \"equal\", (depth0 && depth0.submissionMode), 0, options));\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n                            value=\\\"0\\\"\\n                            data-bind=\\\"submissionMode\\\"\\n                            data-bind-encoder=\\\"number\\\"\\n                    />\\n                    <span class=\\\"icon-radio\\\"></span>\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Individual\", options) : helperMissing.call(depth0, \"__\", \"Individual\", options)))\n    + \"\\n                </label>\\n                <label>\\n                    <input\\n                            type=\\\"radio\\\"\\n                            name=\\\"testpart-submission-mode\\\"\\n                            \";\n  stack1 = (helper = helpers.equal || (depth0 && depth0.equal),options={hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data},helper ? helper.call(depth0, (depth0 && depth0.submissionMode), 1, options) : helperMissing.call(depth0, \"equal\", (depth0 && depth0.submissionMode), 1, options));\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n                            value=\\\"1\\\"\\n                    />\\n                    <span class=\\\"icon-radio\\\"></span>\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Simultaneous\", options) : helperMissing.call(depth0, \"__\", \"Simultaneous\", options)))\n    + \"\\n                </label>\\n            </div>\\n            <div class=\\\"col-1 help\\\">\\n                <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                <div class=\\\"tooltip-content\\\">\\n                \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"The submission mode determines when the candidate's responses are submitted for response processing. A testPart in individual mode requires the candidate to submit their responses on an item-by-item basis. In simultaneous mode the candidate's responses are all submitted together at the end of the testPart.\", options) : helperMissing.call(depth0, \"__\", \"The submission mode determines when the candidate's responses are submitted for response processing. A testPart in individual mode requires the candidate to submit their responses on an item-by-item basis. In simultaneous mode the candidate's responses are all submitted together at the end of the testPart.\", options)))\n    + \"\\n                </div>\\n            </div>\\n        </div>\\n\\n        <div class=\\\"categories\\\">\\n            <div class=\\\"grid-row\\\">\\n                <div class=\\\"col-5\\\">\\n                    <label for=\\\"category-custom\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Categories\", options) : helperMissing.call(depth0, \"__\", \"Categories\", options)))\n    + \"</label>\\n                </div>\\n                <div class=\\\"col-6\\\">\\n                    <input type=\\\"text\\\" id=\\\"category-custom\\\" name=\\\"category-custom\\\"/>\\n                </div>\\n                <div class=\\\"col-1 help\\\">\\n                    <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                    <div class=\\\"tooltip-content\\\">\\n                        \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Test part level category enables configuring the categories of its composing items all at once. A category in gray means that all items have that category. A category in white means that only a few items have that category.\", options) : helperMissing.call(depth0, \"__\", \"Test part level category enables configuring the categories of its composing items all at once. A category in gray means that all items have that category. A category in white means that only a few items have that category.\", options)))\n    + \"\\n                    </div>\\n                </div>\\n            </div>\\n\\n            <!-- some user features (Test Navigation, Test Taker Tools, etc.) are in fact implemented as categories. They will appear here: -->\\n            <div class=\\\"category-presets\\\"></div>\\n        </div>\\n\\n        <h4 class=\\\"toggler closed\\\" data-toggle=\\\"~ .testpart-item-session-control\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Item Session Control\", options) : helperMissing.call(depth0, \"__\", \"Item Session Control\", options)))\n    + \"</h4>\\n\\n\\n<!-- assessmentTest/testPart/itemSessionControl -->\\n        <div class=\\\"testpart-item-session-control toggled\\\">\\n\\n<!-- assessmentTest/testPart/itemSessionControl/maxAttempts -->\\n            <div class=\\\"grid-row\\\">\\n                <div class=\\\"col-5\\\">\\n                    <label for=\\\"testpart-max-attempts\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Max Attempts\", options) : helperMissing.call(depth0, \"__\", \"Max Attempts\", options)))\n    + \"</label>\\n                </div>\\n                <div class=\\\"col-6\\\">\\n                    <input\\n                            id=\\\"testpart-max-attempts\\\"\\n                            type=\\\"text\\\"\\n                            data-increment=\\\"1\\\"\\n                            data-min=\\\"0\\\"\\n                            data-max=\\\"151\\\"\\n                            value=\\\"\";\n  if (helper = helpers.maxAttempts) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.maxAttempts); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\"\\n                            data-bind=\\\"itemSessionControl.maxAttempts\\\"\\n                            data-bind-encoder=\\\"number\\\"\\n                    />\\n                </div>\\n                <div class=\\\"col-1 help\\\">\\n                    <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                    <div class=\\\"tooltip-content\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Controls the maximum number of attempts allowed. 0 means unlimited.\", options) : helperMissing.call(depth0, \"__\", \"Controls the maximum number of attempts allowed. 0 means unlimited.\", options)))\n    + \"\\n                    </div>\\n                </div>\\n            </div>\\n\\n<!-- assessmentTest/testPart/itemSessionControl/showFeedback -->\\n            \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.itemSessionShowFeedback), {hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n\\n\\n\\n\\n\\n<!-- assessmentTest/testPart/itemSessionControl/allowComment -->\\n            \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.itemSessionAllowComment), {hash:{},inverse:self.noop,fn:self.program(5, program5, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n\\n<!-- assessmentTest/testPart/itemSessionControl/allowSkipping -->\\n            \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.itemSessionAllowSkipping), {hash:{},inverse:self.noop,fn:self.program(7, program7, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n\\n<!-- assessmentTest/testPart/itemSessionControl/validateResponses -->\\n            <div class=\\\"grid-row pseudo-label-box\\\">\\n                <div class=\\\"col-5\\\">\\n                    <label for=\\\"testpart-validate-responses\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Validate Responses\", options) : helperMissing.call(depth0, \"__\", \"Validate Responses\", options)))\n    + \"</label>\\n                </div>\\n                <div class=\\\"col-6\\\">\\n                    <label>\\n                        <input type=\\\"checkbox\\\" name=\\\"testpart-validate-responses\\\" value=\\\"true\\\"  data-bind=\\\"itemSessionControl.validateResponses\\\" data-bind-encoder=\\\"boolean\\\"  />\\n                        <span class=\\\"icon-checkbox\\\"></span>\\n                    </label>\\n                </div>\\n                <div class=\\\"col-1 help\\\">\\n                    <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                    <div class=\\\"tooltip-content\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"The candidate is not allowed to submit invalid responses.\", options) : helperMissing.call(depth0, \"__\", \"The candidate is not allowed to submit invalid responses.\", options)))\n    + \"\\n                    </div>\\n                </div>\\n            </div>\\n\\n        </div>\\n\\n        \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.showTimeLimits), {hash:{},inverse:self.noop,fn:self.program(9, program9, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n    </form>\\n</div>\";\n  return buffer;\n  });\n});\n\n","\ndefine('tpl!taoQtiTest/controller/creator/templates/section-props', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, functionType=\"function\", self=this;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\n    <div class=\\\"grid-row pseudo-label-box\\\">\\n        <div class=\\\"col-5\\\">\\n            <label for=\\\"section-blueprint\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Associate Blueprint\", options) : helperMissing.call(depth0, \"__\", \"Associate Blueprint\", options)))\n    + \"</label>\\n        </div>\\n\\n        <div class=\\\"col-6\\\">\\n            <input type=\\\"text\\\" id=\\\"section-blueprint\\\" />\\n        </div>\\n        <div class=\\\"col-1 help\\\">\\n            <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n            <div class=\\\"tooltip-content\\\">\\n                \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Associate a blueprint to a section allow you to validate this section against the specified blueprint.\", options) : helperMissing.call(depth0, \"__\", \"Associate a blueprint to a section allow you to validate this section against the specified blueprint.\", options)))\n    + \"\\n            </div>\\n        </div>\\n    </div>\\n    \";\n  return buffer;\n  }\n\nfunction program3(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\n            <div class=\\\"grid-row pseudo-label-box\\\">\\n                <div class=\\\"col-5\\\">\\n                    <label for=\\\"section-show-feedback\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Show Feedback\", options) : helperMissing.call(depth0, \"__\", \"Show Feedback\", options)))\n    + \"</label>\\n                </div>\\n                <div class=\\\"col-6\\\">\\n                    <label>\\n                        <input type=\\\"checkbox\\\" name=\\\"section-show-feedback\\\" value=\\\"true\\\" data-bind=\\\"itemSessionControl.showFeedback\\\" data-bind-encoder=\\\"boolean\\\" />\\n                        <span class=\\\"icon-checkbox\\\"></span>\\n                    </label>\\n                </div>\\n                <div class=\\\"col-1 help\\\">\\n                    <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                    <div class=\\\"tooltip-content\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"This constraint affects the visibility of feedback after the end of the last attempt.\", options) : helperMissing.call(depth0, \"__\", \"This constraint affects the visibility of feedback after the end of the last attempt.\", options)))\n    + \"\\n                    </div>\\n                </div>\\n            </div>\\n        \";\n  return buffer;\n  }\n\nfunction program5(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\n            <div class=\\\"grid-row pseudo-label-box\\\">\\n                <div class=\\\"col-5\\\">\\n                    <label for=\\\"section-allow-comment\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Allow Comment\", options) : helperMissing.call(depth0, \"__\", \"Allow Comment\", options)))\n    + \"</label>\\n                </div>\\n                <div class=\\\"col-6\\\">\\n                    <label>\\n                        <input type=\\\"checkbox\\\" name=\\\"section-allow-comment\\\" value=\\\"true\\\"  data-bind=\\\"itemSessionControl.allowComment\\\" data-bind-encoder=\\\"boolean\\\" />\\n                        <span class=\\\"icon-checkbox\\\"></span>\\n                    </label>\\n                </div>\\n                <div class=\\\"col-1 help\\\">\\n                    <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                    <div class=\\\"tooltip-content\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"This constraint controls whether or not the candidate is allowed to provide a comment on the item during the session. Comments are not part of the assessed responses.\", options) : helperMissing.call(depth0, \"__\", \"This constraint controls whether or not the candidate is allowed to provide a comment on the item during the session. Comments are not part of the assessed responses.\", options)))\n    + \"\\n                    </div>\\n                </div>\\n            </div>\\n        \";\n  return buffer;\n  }\n\nfunction program7(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\n            <div class=\\\"grid-row pseudo-label-box\\\">\\n                <div class=\\\"col-5\\\">\\n                    <label for=\\\"section-allow-skipping\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Allow Skipping\", options) : helperMissing.call(depth0, \"__\", \"Allow Skipping\", options)))\n    + \"</label>\\n                </div>\\n                <div class=\\\"col-6\\\">\\n                    <label>\\n                        <input type=\\\"checkbox\\\" name=\\\"section-allow-skipping\\\" value=\\\"true\\\" checked=\\\"checked\\\" data-bind=\\\"itemSessionControl.allowSkipping\\\" data-bind-encoder=\\\"boolean\\\" />\\n                        <span class=\\\"icon-checkbox\\\"></span>\\n                    </label>\\n                </div>\\n                <div class=\\\"col-1 help\\\">\\n                    <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                    <div class=\\\"tooltip-content\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"If the candidate can skip the item, without submitting a response (default is true).\", options) : helperMissing.call(depth0, \"__\", \"If the candidate can skip the item, without submitting a response (default is true).\", options)))\n    + \"\\n                    </div>\\n                </div>\\n            </div>\\n        \";\n  return buffer;\n  }\n\nfunction program9(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\n        <h4 class=\\\"toggler closed\\\" data-toggle=\\\"~ .section-time-limits\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Time Limits\", options) : helperMissing.call(depth0, \"__\", \"Time Limits\", options)))\n    + \"</h4>\\n\\n    <!-- assessmentTest/timeLimits -->\\n        <div class=\\\"section-time-limits toggled\\\">\\n\\n\\n    \\n\\n    <!-- assessmentTest/testPart/assessmentSection/timeLimits/maxTime -->\\n            <div class=\\\"grid-row\\\">\\n                <div class=\\\"col-5\\\">\\n                    <label for=\\\"section-max-time\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Maximum Duration\", options) : helperMissing.call(depth0, \"__\", \"Maximum Duration\", options)))\n    + \"</label>\\n                </div>\\n                <div class=\\\"col-6 duration-group\\\">\\n                    <input type=\\\"text\\\" id=\\\"section-max-time\\\" name=\\\"max-time\\\" value=\\\"00:00:00\\\" data-duration=\\\"HH:mm:ss\\\" data-bind=\\\"timeLimits.maxTime\\\" data-bind-encoder=\\\"time\\\" />\\n                </div>\\n                <div class=\\\"col-1 help\\\">\\n                    <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                    <div class=\\\"tooltip-content\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Maximum duration for this section.\", options) : helperMissing.call(depth0, \"__\", \"Maximum duration for this section.\", options)))\n    + \"\\n                    </div>\\n                </div>\\n            </div>\\n\\n    <!-- assessmentTest/testPart/assessmentSection/timeLimits/allowLateSubmission -->\\n            <div class=\\\"grid-row pseudo-label-box\\\">\\n                <div class=\\\"col-5\\\">\\n                    <label for=\\\"section-allow-late-submission\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Late submission allowed\", options) : helperMissing.call(depth0, \"__\", \"Late submission allowed\", options)))\n    + \"</label>\\n                </div>\\n                <div class=\\\"col-6\\\">\\n                    <label>\\n                        <input type=\\\"checkbox\\\" name=\\\"section-allow-late-submission\\\" value=\\\"true\\\" data-bind=\\\"timeLimits.allowLateSubmission\\\" data-bind-encoder=\\\"boolean\\\" />\\n                        <span class=\\\"icon-checkbox\\\"></span>\\n                    </label>\\n                </div>\\n                <div class=\\\"col-1 help\\\">\\n                    <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                    <div class=\\\"tooltip-content\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Whether a candidate's response that is beyond the maximum duration of the section should still be accepted.\", options) : helperMissing.call(depth0, \"__\", \"Whether a candidate's response that is beyond the maximum duration of the section should still be accepted.\", options)))\n    + \"\\n                    </div>\\n                </div>\\n            </div>\\n        </div>\\n    \";\n  return buffer;\n  }\n\n  buffer += \"<div id=\\\"section-props-\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" class=\\\"section-props props clearfix\\\">\\n    <h3>\";\n  if (helper = helpers.title) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</h3>\\n\\n<!-- assessmentTest/testPart/assessmentSection/identifier -->\\n    <div class=\\\"grid-row\\\">\\n        <div class=\\\"col-5\\\">\\n            <label for=\\\"section-identifier\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Identifier\", options) : helperMissing.call(depth0, \"__\", \"Identifier\", options)))\n    + \" <abbr title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Required field\", options) : helperMissing.call(depth0, \"__\", \"Required field\", options)))\n    + \"\\\">*</abbr></label>\\n            <span id=\\\"props-\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" data-bind=\\\"identifier\\\" style=\\\"display: none;\\\">\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</span>\\n        </div>\\n        <div class=\\\"col-6\\\">\\n            <input type=\\\"text\\\" id=\\\"section-identifier\\\" data-bind=\\\"identifier\\\" data-validate=\\\"$notEmpty; $idFormat; $testIdAvailable(identifier=\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \");\\\" />\\n        </div>\\n        <div class=\\\"col-1 help\\\">\\n            <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n            <div class=\\\"tooltip-content\\\">\\n            \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"The identifier of the section.\", options) : helperMissing.call(depth0, \"__\", \"The identifier of the section.\", options)))\n    + \"\\n            </div>\\n        </div>\\n    </div>\\n\\n<!-- assessmentTest/testPart/assessmentSection/title -->\\n    <div class=\\\"grid-row\\\">\\n        <div class=\\\"col-5\\\">\\n            <label for=\\\"section-title\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Title\", options) : helperMissing.call(depth0, \"__\", \"Title\", options)))\n    + \" <abbr title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Required field\", options) : helperMissing.call(depth0, \"__\", \"Required field\", options)))\n    + \"\\\">*</abbr></label>\\n        </div>\\n        <div class=\\\"col-6\\\">\\n            <input type=\\\"text\\\" id=\\\"section-title\\\" data-bind=\\\"title\\\" data-validate=\\\"$notEmpty\\\" />\\n        </div>\\n        <div class=\\\"col-1 help\\\">\\n            <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n            <div class=\\\"tooltip-content\\\">\\n            \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"The section title.\", options) : helperMissing.call(depth0, \"__\", \"The section title.\", options)))\n    + \"\\n            </div>\\n        </div>\\n    </div>\\n\\n\\n\\n\\n\\n<!-- assessmentTest/testPart/assessmentSection/visible -->\\n    <div class=\\\"grid-row pseudo-label-box\\\">\\n        <div class=\\\"col-5\\\">\\n            <label for=\\\"section-visible\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Visible\", options) : helperMissing.call(depth0, \"__\", \"Visible\", options)))\n    + \" <abbr title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Required field\", options) : helperMissing.call(depth0, \"__\", \"Required field\", options)))\n    + \"\\\">*</abbr></label>\\n        </div>\\n        <div class=\\\"col-6\\\">\\n            <label>\\n                <input type=\\\"checkbox\\\" name=\\\"section-visible\\\" value=\\\"true\\\" checked=\\\"checked\\\"  data-bind=\\\"visible\\\" data-bind-encoder=\\\"boolean\\\" />\\n                <span class=\\\"icon-checkbox\\\"></span>\\n            </label>\\n        </div>\\n        <div class=\\\"col-1 help\\\">\\n            <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n            <div class=\\\"tooltip-content\\\">\\n            \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"A visible section is one that is identifiable by the candidate.\", options) : helperMissing.call(depth0, \"__\", \"A visible section is one that is identifiable by the candidate.\", options)))\n    + \"\\n            </div>\\n        </div>\\n    </div>\\n\\n<!-- assessmentTest/testPart/assessmentSection/keepTogether -->\\n    <div class=\\\"grid-row pseudo-label-box\\\">\\n        <div class=\\\"col-5\\\">\\n            <label for=\\\"section-keep-together\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Keep Together\", options) : helperMissing.call(depth0, \"__\", \"Keep Together\", options)))\n    + \"</label>\\n        </div>\\n\\n        <div class=\\\"col-6\\\">\\n            <label>\\n                <input type=\\\"checkbox\\\" name=\\\"section-keep-together\\\" value=\\\"true\\\" checked=\\\"checked\\\"  data-bind=\\\"keepTogether\\\" data-bind-encoder=\\\"boolean\\\" />\\n                <span class=\\\"icon-checkbox\\\"></span>\\n            </label>\\n        </div>\\n        <div class=\\\"col-1 help\\\">\\n            <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n            <div class=\\\"tooltip-content\\\">\\n            \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"An invisible section with a parent that is subject to shuffling can specify whether or not its children, which will appear to the candidate as if they were part of the parent, are shuffled as a block or mixed up with the other children of the parent section.\", options) : helperMissing.call(depth0, \"__\", \"An invisible section with a parent that is subject to shuffling can specify whether or not its children, which will appear to the candidate as if they were part of the parent, are shuffled as a block or mixed up with the other children of the parent section.\", options)))\n    + \"\\n            </div>\\n        </div>\\n    </div>\\n\\n    \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.hasBlueprint), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n\\n    <div class=\\\"categories\\\">\\n        <div class=\\\"grid-row\\\">\\n            <div class=\\\"col-5\\\">\\n                <label for=\\\"category-custom\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Categories\", options) : helperMissing.call(depth0, \"__\", \"Categories\", options)))\n    + \"</label>\\n            </div>\\n            <div class=\\\"col-6\\\">\\n                <input type=\\\"text\\\" id=\\\"category-custom\\\" name=\\\"category-custom\\\"/>\\n            </div>\\n            <div class=\\\"col-1 help\\\">\\n                <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                <div class=\\\"tooltip-content\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Section level category enables configuring the categories of its composing items all at once. A category in gray means that all items have that category. A category in white means that only a few items have that category.\", options) : helperMissing.call(depth0, \"__\", \"Section level category enables configuring the categories of its composing items all at once. A category in gray means that all items have that category. A category in white means that only a few items have that category.\", options)))\n    + \"\\n                </div>\\n            </div>\\n        </div>\\n\\n        <!-- some user features (Test Navigation, Test Taker Tools, etc.) are in fact implemented as categories. They will appear here: -->\\n        <div class=\\\"category-presets\\\"></div>\\n    </div>\\n\\n    <h4 class=\\\"toggler closed\\\" data-toggle=\\\"~ .section-selection\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Selection\", options) : helperMissing.call(depth0, \"__\", \"Selection\", options)))\n    + \"</h4>\\n\\n<!-- assessmentTest/testPart/assessmentSection/selection -->\\n    <div class=\\\"section-selection toggled\\\">\\n\\n        <div class=\\\"grid-row pseudo-label-box\\\">\\n            <div class=\\\"col-5\\\">\\n                <label for=\\\"section-enable-selection\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Enable selection\", options) : helperMissing.call(depth0, \"__\", \"Enable selection\", options)))\n    + \"</label>\\n            </div>\\n\\n            <div class=\\\"col-6\\\">\\n                <label>\\n                    <input type=\\\"checkbox\\\" name=\\\"section-enable-selection\\\"  />\\n                    <span class=\\\"icon-checkbox\\\"></span>\\n                </label>\\n            </div>\\n        </div>\\n\\n<!-- assessmentTest/testPart/assessmentSection/selection/select -->\\n        <div class=\\\"grid-row\\\">\\n            <div class=\\\"col-5\\\">\\n                <label for=\\\"section-select\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Select\", options) : helperMissing.call(depth0, \"__\", \"Select\", options)))\n    + \" <abbr title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Required field\", options) : helperMissing.call(depth0, \"__\", \"Required field\", options)))\n    + \"\\\">*</abbr></label>\\n            </div>\\n            <div class=\\\"col-6\\\">\\n                <input id=\\\"section-select\\\" name=\\\"section-select\\\" type=\\\"text\\\" data-increment=\\\"1\\\" data-min=\\\"0\\\" value=\\\"0\\\" data-bind=\\\"selection.select\\\"  data-bind-encoder=\\\"number\\\" />\\n            </div>\\n            <div class=\\\"col-1 help\\\">\\n                <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                <div class=\\\"tooltip-content\\\">\\n                \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"The number of child elements to be selected.\", options) : helperMissing.call(depth0, \"__\", \"The number of child elements to be selected.\", options)))\n    + \"\\n                </div>\\n            </div>\\n        </div>\\n\\n<!-- assessmentTest/testPart/assessmentSection/selection/withReplacement -->\\n        <div class=\\\"grid-row pseudo-label-box\\\">\\n            <div class=\\\"col-5\\\">\\n                <label for=\\\"section-with-replacement\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"With Replacement\", options) : helperMissing.call(depth0, \"__\", \"With Replacement\", options)))\n    + \"</label>\\n            </div>\\n\\n            <div class=\\\"col-6\\\">\\n                <label>\\n                    <input type=\\\"checkbox\\\" name=\\\"section-with-replacement\\\" value=\\\"true\\\" data-bind=\\\"selection.withReplacement\\\"  data-bind-encoder=\\\"boolean\\\" />\\n                    <span class=\\\"icon-checkbox\\\"></span>\\n                </label>\\n            </div>\\n            <div class=\\\"col-1 help\\\">\\n                <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                <div class=\\\"tooltip-content\\\">\\n                \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"When selecting child elements each element is normally eligible for selection once only.\", options) : helperMissing.call(depth0, \"__\", \"When selecting child elements each element is normally eligible for selection once only.\", options)))\n    + \"\\n                </div>\\n            </div>\\n        </div>\\n    </div>\\n\\n    <h4 class=\\\"toggler closed\\\" data-toggle=\\\"~ .section-ordering\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Ordering\", options) : helperMissing.call(depth0, \"__\", \"Ordering\", options)))\n    + \"</h4>\\n\\n<!-- assessmentTest/testPart/assessmentSection/ordering -->\\n    <div class=\\\"section-ordering toggled\\\">\\n<!-- assessmentTest/testPart/assessmentSection/ordering/shuffle -->\\n        <div class=\\\"grid-row pseudo-label-box\\\">\\n            <div class=\\\"col-5\\\">\\n                <label for=\\\"section-shuffle\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Shuffle\", options) : helperMissing.call(depth0, \"__\", \"Shuffle\", options)))\n    + \"</label>\\n            </div>\\n\\n            <div class=\\\"col-6\\\">\\n                <label>\\n                    <input type=\\\"checkbox\\\" name=\\\"section-shuffle\\\" value=\\\"true\\\" data-bind=\\\"ordering.shuffle\\\"  data-bind-encoder=\\\"boolean\\\"  />\\n                    <span class=\\\"icon-checkbox\\\"></span>\\n                </label>\\n            </div>\\n            <div class=\\\"col-1 help\\\">\\n                <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                <div class=\\\"tooltip-content\\\">\\n                \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"If set, it causes the order of the child elements to be randomized, otherwise it uses the order in which the child elements are defined.\", options) : helperMissing.call(depth0, \"__\", \"If set, it causes the order of the child elements to be randomized, otherwise it uses the order in which the child elements are defined.\", options)))\n    + \"\\n                </div>\\n            </div>\\n        </div>\\n    </div>\\n\\n    <h4 class=\\\"toggler closed\\\" data-toggle=\\\"~ .section-item-session-control\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Item Session Control\", options) : helperMissing.call(depth0, \"__\", \"Item Session Control\", options)))\n    + \"</h4>\\n\\n<!-- assessmentTest/testPart/assessmentSection/itemSessionControl -->\\n    <div class=\\\"section-item-session-control toggled\\\">\\n<!-- assessmentTest/testPart/assessmentSection/itemSessionControl/maxAttempts -->\\n        <div class=\\\"grid-row\\\">\\n            <div class=\\\"col-5\\\">\\n                <label for=\\\"section-max-attempts\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Max Attempts\", options) : helperMissing.call(depth0, \"__\", \"Max Attempts\", options)))\n    + \"</label>\\n            </div>\\n            <div class=\\\"col-6\\\">\\n                <input\\n                        id=\\\"section-max-attempts\\\"\\n                        type=\\\"text\\\"\\n                        data-increment=\\\"1\\\"\\n                        data-min=\\\"0\\\"\\n                        data-max=\\\"151\\\"\\n                        value=\\\"\";\n  if (helper = helpers.maxAttempts) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.maxAttempts); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\"\\n                        data-bind=\\\"itemSessionControl.maxAttempts\\\"\\n                        data-bind-encoder=\\\"number\\\"\\n                />\\n            </div>\\n            <div class=\\\"col-1 help\\\">\\n                <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                <div class=\\\"tooltip-content\\\">\\n                \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Controls the maximum number of attempts allowed. 0 means unlimited.\", options) : helperMissing.call(depth0, \"__\", \"Controls the maximum number of attempts allowed. 0 means unlimited.\", options)))\n    + \"\\n                </div>\\n            </div>\\n        </div>\\n\\n<!-- assessmentTest/testPart/assessmentSection/itemSessionControl/showFeedback -->\\n        \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.itemSessionShowFeedback), {hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n\\n\\n\\n\\n\\n<!-- assessmentTest/testPart/assessmentSection/itemSessionControl/allowComment -->\\n        \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.itemSessionAllowComment), {hash:{},inverse:self.noop,fn:self.program(5, program5, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n\\n<!-- assessmentTest/testPart/assessmentSection/itemSessionControl/allowSkipping -->\\n        \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.itemSessionAllowSkipping), {hash:{},inverse:self.noop,fn:self.program(7, program7, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n\\n<!-- assessmentTest/testPart/assessmentSection/itemSessionControl/validateResponses -->\\n        <div class=\\\"grid-row pseudo-label-box\\\">\\n            <div class=\\\"col-5\\\">\\n                <label for=\\\"section-validate-responses\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Validate Responses\", options) : helperMissing.call(depth0, \"__\", \"Validate Responses\", options)))\n    + \"</label>\\n            </div>\\n            <div class=\\\"col-6\\\">\\n                <label>\\n                    <input type=\\\"checkbox\\\" name=\\\"section-validate-responses\\\" value=\\\"true\\\" data-bind=\\\"itemSessionControl.validateResponses\\\" data-bind-encoder=\\\"boolean\\\" />\\n                    <span class=\\\"icon-checkbox\\\"></span>\\n                </label>\\n            </div>\\n            <div class=\\\"col-1 help\\\">\\n                <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                <div class=\\\"tooltip-content\\\">\\n                \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"The candidate is not allowed to submit invalid responses.\", options) : helperMissing.call(depth0, \"__\", \"The candidate is not allowed to submit invalid responses.\", options)))\n    + \"\\n                </div>\\n            </div>\\n        </div>\\n\\n    </div>\\n\\n    \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.showTimeLimits), {hash:{},inverse:self.noop,fn:self.program(9, program9, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n</div>\";\n  return buffer;\n  });\n});\n\n","\ndefine('tpl!taoQtiTest/controller/creator/templates/itemref-props', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, self=this, functionType=\"function\";\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\n            <div class=\\\"grid-row pseudo-label-box\\\">\\n                <div class=\\\"col-5\\\">\\n                    <label for=\\\"itemref-show-feedback\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Show Feedback\", options) : helperMissing.call(depth0, \"__\", \"Show Feedback\", options)))\n    + \"</label>\\n                </div>\\n                <div class=\\\"col-6\\\">\\n                    <label>\\n                        <input type=\\\"checkbox\\\" name=\\\"itemref-show-feedback\\\" value=\\\"true\\\" data-bind=\\\"itemSessionControl.showFeedback\\\" data-bind-encoder=\\\"boolean\\\" />\\n                        <span class=\\\"icon-checkbox\\\"></span>\\n                    </label>\\n                </div>\\n                <div class=\\\"col-1 help\\\">\\n                    <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                    <div class=\\\"tooltip-content\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"This constraint affects the visibility of feedback after the end of the last attempt.\", options) : helperMissing.call(depth0, \"__\", \"This constraint affects the visibility of feedback after the end of the last attempt.\", options)))\n    + \"\\n                    </div>\\n                </div>\\n            </div>\\n        \";\n  return buffer;\n  }\n\nfunction program3(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\n            <div class=\\\"grid-row pseudo-label-box\\\">\\n                <div class=\\\"col-5\\\">\\n                    <label for=\\\"itemref-allow-comment\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Allow Comment\", options) : helperMissing.call(depth0, \"__\", \"Allow Comment\", options)))\n    + \"</label>\\n                </div>\\n                <div class=\\\"col-6\\\">\\n                    <label>\\n                        <input type=\\\"checkbox\\\" name=\\\"itemref-allow-comment\\\" value=\\\"true\\\"  data-bind=\\\"itemSessionControl.allowComment\\\" data-bind-encoder=\\\"boolean\\\" />\\n                        <span class=\\\"icon-checkbox\\\"></span>\\n                    </label>\\n                </div>\\n                <div class=\\\"col-1 help\\\">\\n                    <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                    <div class=\\\"tooltip-content\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"This constraint controls whether or not the candidate is allowed to provide a comment on the item during the session. Comments are not part of the assessed responses.\", options) : helperMissing.call(depth0, \"__\", \"This constraint controls whether or not the candidate is allowed to provide a comment on the item during the session. Comments are not part of the assessed responses.\", options)))\n    + \"\\n                    </div>\\n                </div>\\n            </div>\\n        \";\n  return buffer;\n  }\n\nfunction program5(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\n            <div class=\\\"grid-row pseudo-label-box\\\">\\n                <div class=\\\"col-5\\\">\\n                    <label for=\\\"itemref-allow-skipping\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Allow Skipping\", options) : helperMissing.call(depth0, \"__\", \"Allow Skipping\", options)))\n    + \"</label>\\n                </div>\\n                <div class=\\\"col-6\\\">\\n                    <label>\\n                        <input type=\\\"checkbox\\\" name=\\\"itemref-allow-skipping\\\" value=\\\"true\\\" checked=\\\"checked\\\" data-bind=\\\"itemSessionControl.allowSkipping\\\" data-bind-encoder=\\\"boolean\\\" />\\n                        <span class=\\\"icon-checkbox\\\"></span>\\n                    </label>\\n                </div>\\n                <div class=\\\"col-1 help\\\">\\n                    <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                    <div class=\\\"tooltip-content\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"If the candidate can skip the item, without submitting a response (default is true).\", options) : helperMissing.call(depth0, \"__\", \"If the candidate can skip the item, without submitting a response (default is true).\", options)))\n    + \"\\n                    </div>\\n                </div>\\n            </div>\\n        \";\n  return buffer;\n  }\n\nfunction program7(depth0,data) {\n  \n  var buffer = \"\", stack1, helper, options;\n  buffer += \"\\n    <h4 class=\\\"toggler closed\\\" data-toggle=\\\"~ .itemref-time-limits\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Time Limits\", options) : helperMissing.call(depth0, \"__\", \"Time Limits\", options)))\n    + \"</h4>\\n\\n<!-- assessmentTest/timeLimits -->\\n    <div class=\\\"itemref-time-limits toggled\\\">\\n\\n        <div class=\\\"lockedtime-container hidden\\\">\\n\\n            <div class=\\\"grid-row\\\">\\n                <div class=\\\"col-5\\\">\\n                    <label for=\\\"itemref-max-time\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Maximum Duration\", options) : helperMissing.call(depth0, \"__\", \"Maximum Duration\", options)))\n    + \"</label>\\n                </div>\\n                <div class=\\\"col-6 duration-group\\\">\\n                    <input type=\\\"text\\\" name=\\\"max-time\\\" value=\\\"00:00:00\\\" data-duration=\\\"HH:mm:ss\\\" data-bind=\\\"timeLimits.maxTime\\\" data-bind-encoder=\\\"time\\\" />\\n                </div>\\n                <div class=\\\"col-1 help\\\">\\n                    <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                    <div class=\\\"tooltip-content\\\">\\n                        \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Minimum duration : enforces the test taker to stay on the item for the given duration.\", options) : helperMissing.call(depth0, \"__\", \"Minimum duration : enforces the test taker to stay on the item for the given duration.\", options)))\n    + \"<br>\\n                        \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Maximum duration : the items times out when the duration reaches 0.\", options) : helperMissing.call(depth0, \"__\", \"Maximum duration : the items times out when the duration reaches 0.\", options)))\n    + \"<br>\\n                        \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Locked duration  : guided navigation. The test transition to the next item once the duration reaches 0.\", options) : helperMissing.call(depth0, \"__\", \"Locked duration  : guided navigation. The test transition to the next item once the duration reaches 0.\", options)))\n    + \"<br>\\n                    </div>\\n                </div>\\n            </div>\\n            <div class=\\\"locker\\\">\\n                <button class=\\\"unlocked\\\" title='\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Link durations to activate the guided navigation\", options) : helperMissing.call(depth0, \"__\", \"Link durations to activate the guided navigation\", options)))\n    + \"' ><span class=\\\"icon-unlink\\\"></span></button>\\n            </div>\\n            <div class=\\\"grid-row\\\">\\n                <div class=\\\"col-5\\\">\\n                    <label for=\\\"itemref-min-time\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Minimum Duration\", options) : helperMissing.call(depth0, \"__\", \"Minimum Duration\", options)))\n    + \"</label>\\n                </div>\\n                <div class=\\\"col-6\\\">\\n                    <input type=\\\"text\\\" name=\\\"min-time\\\" value=\\\"00:00:00\\\" data-duration=\\\"HH:mm:ss\\\"  data-bind=\\\"timeLimits.minTime\\\" data-bind-encoder=\\\"time\\\" />\\n                </div>\\n            </div>\\n        </div>\\n    \\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/timeLimits/maxTime -->\\n        <div class=\\\"grid-row maxtime-container \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.isLinear), {hash:{},inverse:self.noop,fn:self.program(8, program8, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\\">\\n            <div class=\\\"col-5\\\">\\n                <label for=\\\"itemref-max-time\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Maximum Duration\", options) : helperMissing.call(depth0, \"__\", \"Maximum Duration\", options)))\n    + \"</label>\\n            </div>\\n            <div class=\\\"col-6 duration-group\\\">\\n                <input type=\\\"text\\\" name=\\\"max-time\\\" value=\\\"00:00:00\\\" data-duration=\\\"HH:mm:ss\\\" data-bind=\\\"timeLimits.maxTime\\\" data-bind-encoder=\\\"time\\\" />\\n            </div>\\n            <div class=\\\"col-1 help\\\">\\n                <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                <div class=\\\"tooltip-content\\\">\\n                \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Maximum duration for this item.\", options) : helperMissing.call(depth0, \"__\", \"Maximum duration for this item.\", options)))\n    + \"\\n                </div>\\n            </div>\\n        </div>\\n\\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/timeLimits/minTime -->\\n        <div class=\\\"grid-row mintime-container \";\n  stack1 = helpers.unless.call(depth0, (depth0 && depth0.isLinear), {hash:{},inverse:self.noop,fn:self.program(8, program8, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\\">\\n            <div class=\\\"col-5\\\">\\n                <label for=\\\"min-time\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Minimum Duration\", options) : helperMissing.call(depth0, \"__\", \"Minimum Duration\", options)))\n    + \"</label>\\n            </div>\\n            <div class=\\\"col-6 duration-group\\\">\\n                <input type=\\\"text\\\" name=\\\"min-time\\\" value=\\\"00:00:00\\\" data-duration=\\\"HH:mm:ss\\\" data-bind=\\\"timeLimits.minTime\\\" data-bind-encoder=\\\"time\\\" />\\n            </div>\\n            <div class=\\\"col-1 help\\\">\\n                <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                <div class=\\\"tooltip-content\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Minimum duration for this item.\", options) : helperMissing.call(depth0, \"__\", \"Minimum duration for this item.\", options)))\n    + \"\\n                </div>\\n            </div>\\n        </div>\\n\\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/timeLimits/allowLateSubmission -->\\n        <div class=\\\"grid-row pseudo-label-box\\\">\\n            <div class=\\\"col-5\\\">\\n                <label for=\\\"itemref-allow-late-submission\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Late submission allowed\", options) : helperMissing.call(depth0, \"__\", \"Late submission allowed\", options)))\n    + \"</label>\\n            </div>\\n            <div class=\\\"col-6\\\">\\n                <label>\\n                    <input type=\\\"checkbox\\\" name=\\\"itemref-allow-late-submission\\\" value=\\\"true\\\" data-bind=\\\"timeLimits.allowLateSubmission\\\" data-bind-encoder=\\\"boolean\\\" />\\n                    <span class=\\\"icon-checkbox\\\"></span>\\n                </label>\\n            </div>\\n            <div class=\\\"col-1 help\\\">\\n                <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                <div class=\\\"tooltip-content\\\">\\n                \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Whether a candidate's response that is beyond the maximum duration of the item should still be accepted.\", options) : helperMissing.call(depth0, \"__\", \"Whether a candidate's response that is beyond the maximum duration of the item should still be accepted.\", options)))\n    + \"\\n                </div>\\n            </div>\\n        </div>\\n    </div>\\n    \";\n  return buffer;\n  }\nfunction program8(depth0,data) {\n  \n  \n  return \"hidden\";\n  }\n\n  buffer += \"<div id=\\\"itemref-props-\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" class=\\\"itemref-props props clearfix\\\">\\n\\n    <h3>\";\n  stack1 = (helper = helpers.dompurify || (depth0 && depth0.dompurify),options={hash:{},data:data},helper ? helper.call(depth0, (depth0 && depth0.label), options) : helperMissing.call(depth0, \"dompurify\", (depth0 && depth0.label), options));\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"</h3>\\n\\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/identifier -->\\n    <div class=\\\"grid-row\\\">\\n        <div class=\\\"col-5\\\">\\n            <label for=\\\"itemref-identifier\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Identifier\", options) : helperMissing.call(depth0, \"__\", \"Identifier\", options)))\n    + \" <abbr title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Required field\", options) : helperMissing.call(depth0, \"__\", \"Required field\", options)))\n    + \"\\\">*</abbr></label>\\n            <span id=\\\"props-\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" data-bind=\\\"identifier\\\" style=\\\"display: none;\\\">\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</span>\\n        </div>\\n        <div class=\\\"col-6\\\">\\n            <input type=\\\"text\\\" name=\\\"itemref-identifier\\\" data-bind=\\\"identifier\\\" data-validate=\\\"$notEmpty; $idFormat; $testIdAvailable(identifier=\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \");\\\" />\\n        </div>\\n        <div class=\\\"col-1 help\\\">\\n            <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n            <div class=\\\"tooltip-content\\\">\\n            \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"The identifier of the item reference.\", options) : helperMissing.call(depth0, \"__\", \"The identifier of the item reference.\", options)))\n    + \"\\n            </div>\\n        </div>\\n    </div>\\n\\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/href -->\\n    <div class=\\\"grid-row\\\">\\n        <div class=\\\"col-5\\\">\\n            <label for=\\\"itemref-href\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Reference\", options) : helperMissing.call(depth0, \"__\", \"Reference\", options)))\n    + \" <abbr title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Required field\", options) : helperMissing.call(depth0, \"__\", \"Required field\", options)))\n    + \"\\\">*</abbr></label>\\n        </div>\\n        <div class=\\\"col-6\\\">\\n            <input type=\\\"text\\\" name=\\\"itemref-href\\\" data-bind=\\\"href\\\" readonly=\\\"readonly\\\" />\\n        </div>\\n        <div class=\\\"col-1 help\\\">\\n            <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n            <div class=\\\"tooltip-content\\\">\\n            \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"The reference.\", options) : helperMissing.call(depth0, \"__\", \"The reference.\", options)))\n    + \"\\n            </div>\\n        </div>\\n    </div>\\n\\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/required -->\\n    <div class=\\\"grid-row pseudo-label-box\\\">\\n        <div class=\\\"col-5\\\">\\n            <label for=\\\"itemref-required\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Required\", options) : helperMissing.call(depth0, \"__\", \"Required\", options)))\n    + \"</label>\\n        </div>\\n        <div class=\\\"col-6\\\">\\n            <label>\\n                <input type=\\\"checkbox\\\" name=\\\"itemref-required\\\" value=\\\"true\\\" data-bind=\\\"required\\\" data-bind-encoder=\\\"boolean\\\" />\\n                <span class=\\\"icon-checkbox\\\"></span>\\n            </label>\\n        </div>\\n        <div class=\\\"col-1 help\\\">\\n            <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n            <div class=\\\"tooltip-content\\\">\\n            \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"If required it must appear (at least once) in the selection.\", options) : helperMissing.call(depth0, \"__\", \"If required it must appear (at least once) in the selection.\", options)))\n    + \"\\n            </div>\\n        </div>\\n    </div>\\n\\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/fixed -->\\n    <div class=\\\"grid-row pseudo-label-box\\\">\\n        <div class=\\\"col-5\\\">\\n            <label for=\\\"itemref-fixed\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Fixed\", options) : helperMissing.call(depth0, \"__\", \"Fixed\", options)))\n    + \"</label>\\n        </div>\\n        <div class=\\\"col-6\\\">\\n            <label>\\n                <input type=\\\"checkbox\\\" name=\\\"itemref-fixed\\\" value=\\\"true\\\" data-bind=\\\"fixed\\\" data-bind-encoder=\\\"boolean\\\" />\\n                <span class=\\\"icon-checkbox\\\"></span>\\n            </label>\\n        </div>\\n        <div class=\\\"col-1 help\\\">\\n            <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n            <div class=\\\"tooltip-content\\\">\\n            \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Not shuffled, the position remains fixed.\", options) : helperMissing.call(depth0, \"__\", \"Not shuffled, the position remains fixed.\", options)))\n    + \"\\n            </div>\\n        </div>\\n    </div>\\n\\n    <div class=\\\"categories\\\">\\n        <div class=\\\"grid-row\\\">\\n            <div class=\\\"col-5\\\">\\n                <label for=\\\"category-custom\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Categories\", options) : helperMissing.call(depth0, \"__\", \"Categories\", options)))\n    + \"</label>\\n            </div>\\n            <div class=\\\"col-6\\\">\\n                <input type=\\\"text\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"custom categories\", options) : helperMissing.call(depth0, \"__\", \"custom categories\", options)))\n    + \"\\\" name=\\\"category-custom\\\"/>\\n            </div>\\n            <div class=\\\"col-1 help\\\">\\n                <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                <div class=\\\"tooltip-content\\\">\\n                \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Items can optionally be assigned to one or more categories.\", options) : helperMissing.call(depth0, \"__\", \"Items can optionally be assigned to one or more categories.\", options)))\n    + \"\\n                </div>\\n            </div>\\n        </div>\\n\\n        <!-- assessmentTest/testPart/assessmentSection/sectionPart/category -->\\n        <textarea title=\\\"categories\\\" class=\\\"hidden\\\" type=\\\"text\\\" name=\\\"itemref-category\\\" data-bind=\\\"categories\\\" data-bind-encoder=\\\"str2array\\\"></textarea>\\n\\n        <!-- some user features (Test Navigation, Test Taker Tools, etc.) are in fact implemented as categories. They will appear here: -->\\n        <div class=\\\"category-presets\\\"></div>\\n    </div>\\n\\n    <h4 class=\\\"toggler closed\\\" data-toggle=\\\"~ .itemref-weights\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Weights\", options) : helperMissing.call(depth0, \"__\", \"Weights\", options)))\n    + \"</h4>\\n\\n    <div class=\\\"itemref-weights toggled\\\">\\n        <div class=\\\"grid-row \\\">\\n            <div class=\\\"col-9\\\">\\n                <strong>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Identifier\", options) : helperMissing.call(depth0, \"__\", \"Identifier\", options)))\n    + \"</strong>\\n            </div>\\n            <div class=\\\"col-2\\\">\\n                <strong>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Value\", options) : helperMissing.call(depth0, \"__\", \"Value\", options)))\n    + \"</strong>\\n            </div>\\n            <div class=\\\"col-1 help\\\">\\n                <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                <div class=\\\"tooltip-content\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Controls the contribution of an individual item score to the overall test score.\", options) : helperMissing.call(depth0, \"__\", \"Controls the contribution of an individual item score to the overall test score.\", options)))\n    + \"\\n                </div>\\n            </div>\\n        </div>\\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/weights -->\\n        <div data-bind-each=\\\"weights\\\" data-bind-tmpl=\\\"itemrefweight\\\"></div>\\n        <div class=\\\"grid-row\\\">\\n            <div class=\\\"col-12\\\">\\n                <a class=\\\"itemref-weight-add\\\"><span class=\\\"icon-add\\\"></span> \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"add a new weight\", options) : helperMissing.call(depth0, \"__\", \"add a new weight\", options)))\n    + \"</a>\\n            </div>\\n        </div>\\n    </div>\\n\\n\\n    <h4 class=\\\"toggler closed\\\" data-toggle=\\\"~ .itemref-item-session-control\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Item Session Control\", options) : helperMissing.call(depth0, \"__\", \"Item Session Control\", options)))\n    + \"</h4>\\n\\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/itemSessionControl -->\\n    <div class=\\\"itemref-item-session-control toggled\\\">\\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/itemSessionControl/maxAttempts -->\\n        <div class=\\\"grid-row\\\">\\n            <div class=\\\"col-5\\\">\\n                <label for=\\\"itemref-max-attempts\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Max Attempts\", options) : helperMissing.call(depth0, \"__\", \"Max Attempts\", options)))\n    + \"</label>\\n            </div>\\n            <div class=\\\"col-6\\\">\\n                <input\\n                        name=\\\"itemref-max-attempts\\\"\\n                        type=\\\"text\\\"\\n                        data-increment=\\\"1\\\"\\n                        data-min=\\\"0\\\"\\n                        data-max=\\\"151\\\"\\n                        value=\\\"\";\n  if (helper = helpers.maxAttempts) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.maxAttempts); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\"\\n                        data-bind=\\\"itemSessionControl.maxAttempts\\\"\\n                        data-bind-encoder=\\\"number\\\"\\n                />\\n            </div>\\n            <div class=\\\"col-1 help\\\">\\n                <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                <div class=\\\"tooltip-content\\\">\\n                \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Controls the maximum number of attempts allowed. 0 means unlimited.\", options) : helperMissing.call(depth0, \"__\", \"Controls the maximum number of attempts allowed. 0 means unlimited.\", options)))\n    + \"\\n                </div>\\n            </div>\\n        </div>\\n\\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/itemSessionControl/showFeedback -->\\n        \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.itemSessionShowFeedback), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n\\n\\n\\n\\n\\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/itemSessionControl/allowComment -->\\n        \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.itemSessionAllowComment), {hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n\\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/itemSessionControl/allowSkipping -->\\n        \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.itemSessionAllowSkipping), {hash:{},inverse:self.noop,fn:self.program(5, program5, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n\\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/itemSessionControl/validateResponses -->\\n        <div class=\\\"grid-row pseudo-label-box\\\">\\n            <div class=\\\"col-5\\\">\\n                <label for=\\\"itemref-validate-responses\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Validate Responses\", options) : helperMissing.call(depth0, \"__\", \"Validate Responses\", options)))\n    + \"</label>\\n            </div>\\n            <div class=\\\"col-6\\\">\\n                <label>\\n                    <input type=\\\"checkbox\\\" name=\\\"itemref-validate-responses\\\" value=\\\"true\\\" data-bind=\\\"itemSessionControl.validateResponses\\\" data-bind-encoder=\\\"boolean\\\" />\\n                    <span class=\\\"icon-checkbox\\\"></span>\\n                </label>\\n            </div>\\n            <div class=\\\"col-1 help\\\">\\n                <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                <div class=\\\"tooltip-content\\\">\\n                \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"The candidate is not allowed to submit invalid responses.\", options) : helperMissing.call(depth0, \"__\", \"The candidate is not allowed to submit invalid responses.\", options)))\n    + \"\\n                </div>\\n            </div>\\n        </div>\\n\\n    </div>\\n\\n    \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.showTimeLimits), {hash:{},inverse:self.noop,fn:self.program(7, program7, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n</div>\";\n  return buffer;\n  });\n});\n\n","\ndefine('tpl!taoQtiTest/controller/creator/templates/itemref-props-weight', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, functionType=\"function\", escapeExpression=this.escapeExpression;\n\n\n  buffer += \"<div class=\\\"grid-row itemref-weight\\\">\\n    <div class=\\\"col-9\\\">\\n        <input data-bind=\\\"identifier\\\" data-validate=\\\"$notEmpty; $testIdFormat; $testIdAvailable(original=\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \");\\\" type=\\\"text\\\" value=\\\"\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" />\\n    </div>\\n    <div class=\\\"col-2\\\">\\n        <input data-bind=\\\"value\\\" data-validate=\\\"$notEmpty; $numeric;\\\" type=\\\"text\\\" value=\\\"\";\n  if (helper = helpers.value) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.value); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" data-bind-encoder=\\\"float\\\" />\\n    </div>\\n    <div class=\\\"col-1\\\">\\n        <a class=\\\"itemref-weight-remove\\\" data-delete=\\\":parent .itemref-weight\\\">\\n            <span class=\\\"icon-bin\\\"></span>\\n        </a>\\n    </div>\\n</div>\";\n  return buffer;\n  });\n});\n\n","\ndefine('tpl!taoQtiTest/controller/creator/templates/rubricblock-props', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, functionType=\"function\", self=this;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\n    <div class=\\\"rubric-feedback toggled\\\">\\n\\n        <!--assessmentTest/testPart/assessmentSection/sectionPart/rubricBlock/feedback/activated -->\\n        <div class=\\\"grid-row rubric-feedback-activated\\\">\\n            <div class=\\\"col-5\\\">\\n                <label for=\\\"activated\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Activated\", options) : helperMissing.call(depth0, \"__\", \"Activated\", options)))\n    + \"</label>\\n            </div>\\n            <div class=\\\"col-6\\\">\\n                <label>\\n                    <input type=\\\"checkbox\\\" name=\\\"activated\\\" value=\\\"true\\\" data-bind=\\\"feedback.activated\\\" data-bind-encoder=\\\"boolean\\\" />\\n                    <span class=\\\"icon-checkbox\\\"></span>\\n                </label>\\n            </div>\\n            <div class=\\\"col-1 help\\\">\\n                <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                <div class=\\\"tooltip-content\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Set the rubric block as a feedback block\", options) : helperMissing.call(depth0, \"__\", \"Set the rubric block as a feedback block\", options)))\n    + \"\\n                </div>\\n            </div>\\n        </div>\\n\\n        <!--assessmentTest/testPart/assessmentSection/sectionPart/rubricBlock/feedback/outcome -->\\n        <div class=\\\"grid-row rubric-feedback-outcome\\\">\\n            <div class=\\\"col-5\\\">\\n                <label for=\\\"feedback-outcome\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Outcome\", options) : helperMissing.call(depth0, \"__\", \"Outcome\", options)))\n    + \"</label>\\n            </div>\\n            <div class=\\\"col-6\\\">\\n                <input type=\\\"text\\\" name=\\\"feedback-outcome\\\" data-bind=\\\"feedback.outcome\\\" data-bind-encoder=\\\"string\\\" data-validate=\\\"$pattern(pattern=^([a-zA-Z_][a-zA-Z0-9_\\\\.-]*)?$);\\\" />\\n            </div>\\n            <div class=\\\"col-1 help\\\">\\n                <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                <div class=\\\"tooltip-content\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Set outcome identifier the feedback block is related to\", options) : helperMissing.call(depth0, \"__\", \"Set outcome identifier the feedback block is related to\", options)))\n    + \"\\n                </div>\\n            </div>\\n        </div>\\n\\n        <!--assessmentTest/testPart/assessmentSection/sectionPart/rubricBlock/feedback/matchValue -->\\n        <div class=\\\"grid-row rubric-feedback-match-value\\\">\\n            <div class=\\\"col-5\\\">\\n                <label for=\\\"feedback-match-value\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Match value\", options) : helperMissing.call(depth0, \"__\", \"Match value\", options)))\n    + \"</label>\\n            </div>\\n            <div class=\\\"col-6\\\">\\n                <input type=\\\"text\\\" name=\\\"feedback-match-value\\\" data-bind=\\\"feedback.matchValue\\\" data-bind-encoder=\\\"string\\\" data-validate=\\\"$pattern(pattern=^([a-zA-Z_][a-zA-Z0-9_\\\\.-]*)?$);\\\" />\\n            </div>\\n            <div class=\\\"col-1 help\\\">\\n                <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n                <div class=\\\"tooltip-content\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Set the value of the outcome that will activate the feedback block\", options) : helperMissing.call(depth0, \"__\", \"Set the value of the outcome that will activate the feedback block\", options)))\n    + \"\\n                </div>\\n            </div>\\n        </div>\\n    </div>\\n    \";\n  return buffer;\n  }\n\n  buffer += \"<div class=\\\"rubricblock-props props clearfix\\\">\\n\\n    <h3>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Rubric Block\", options) : helperMissing.call(depth0, \"__\", \"Rubric Block\", options)))\n    + \": \";\n  if (helper = helpers.orderIndex) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.orderIndex); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</h3>\\n\\n    <!--assessmentTest/testPart/assessmentSection/sectionPart/rubricBlock/views -->\\n    <!--\\n    <div class=\\\"grid-row\\\">\\n        <div class=\\\"col-5\\\">\\n            <label for=\\\"itemref-identifier\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Views\", options) : helperMissing.call(depth0, \"__\", \"Views\", options)))\n    + \" <abbr title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Required field\", options) : helperMissing.call(depth0, \"__\", \"Required field\", options)))\n    + \"\\\">*</abbr></label>\\n        </div>\\n        <div class=\\\"col-6\\\">\\n            <select name=\\\"view\\\" multiple=\\\"multiple\\\" data-bind=\\\"views\\\">\\n                <option value=\\\"author\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Author\", options) : helperMissing.call(depth0, \"__\", \"Author\", options)))\n    + \"</option>\\n                <option value=\\\"candidate\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Candidate\", options) : helperMissing.call(depth0, \"__\", \"Candidate\", options)))\n    + \"</option>\\n                <option value=\\\"proctor\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Proctor\", options) : helperMissing.call(depth0, \"__\", \"Proctor\", options)))\n    + \"</option>\\n                <option value=\\\"scorer\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Scorer\", options) : helperMissing.call(depth0, \"__\", \"Scorer\", options)))\n    + \"</option>\\n                <option value=\\\"testConstructor\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Test constructor\", options) : helperMissing.call(depth0, \"__\", \"Test constructor\", options)))\n    + \"</option>\\n                <option value=\\\"tutor\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Tutor\", options) : helperMissing.call(depth0, \"__\", \"Tutor\", options)))\n    + \"</option>\\n            </select>\\n        </div>\\n        <div class=\\\"col-1 help\\\">\\n            <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n            <div class=\\\"tooltip-content\\\">\\n                \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Who can view the rubric block during the delivery.\", options) : helperMissing.call(depth0, \"__\", \"Who can view the rubric block during the delivery.\", options)))\n    + \"\\n            </div>\\n        </div>\\n    </div>\\n    -->\\n    <!--assessmentTest/testPart/assessmentSection/sectionPart/rubricBlock/class -->\\n    <div class=\\\"grid-row\\\">\\n        <div class=\\\"col-5\\\">\\n            <label for=\\\"class\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Class\", options) : helperMissing.call(depth0, \"__\", \"Class\", options)))\n    + \"</label>\\n        </div>\\n        <div class=\\\"col-6\\\">\\n            <input type=\\\"text\\\" name=\\\"class\\\" data-bind=\\\"class\\\" data-bind-encoder=\\\"string\\\" data-validate=\\\"$pattern(pattern=^([a-zA-Z_\\\\s][a-zA-Z0-9_\\\\s-]*)?$);\\\" />\\n        </div>\\n        <div class=\\\"col-1 help\\\">\\n            <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n            <div class=\\\"tooltip-content\\\">\\n                \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Set the XHTML-QTI class of the rubric block.\", options) : helperMissing.call(depth0, \"__\", \"Set the XHTML-QTI class of the rubric block.\", options)))\n    + \"\\n            </div>\\n        </div>\\n    </div>\\n\\n    <!--assessmentTest/testPart/assessmentSection/sectionPart/rubricBlock/id -->\\n    <!--\\n    <div class=\\\"grid-row\\\">\\n        <div class=\\\"col-5\\\">\\n            <label for=\\\"id\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Identifier\", options) : helperMissing.call(depth0, \"__\", \"Identifier\", options)))\n    + \"</label>\\n        </div>\\n        <div class=\\\"col-6\\\">\\n            <input type=\\\"text\\\" name=\\\"id\\\" data-bind=\\\"id\\\" data-bind-encoder=\\\"string\\\" data-validate=\\\"$pattern(pattern=^([a-zA-Z_\\\\s][a-zA-Z0-9_\\\\s-]*)?$);\\\" />\\n        </div>\\n        <div class=\\\"col-1 help\\\">\\n            <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n            <div class=\\\"tooltip-content\\\">\\n                \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Set the XHTML-QTI identifier of the rubric block.\", options) : helperMissing.call(depth0, \"__\", \"Set the XHTML-QTI identifier of the rubric block.\", options)))\n    + \"\\n            </div>\\n        </div>\\n    </div>\\n    -->\\n\\n    <h4 class=\\\"toggler closed\\\" data-toggle=\\\"~ .rubric-feedback\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Feedback block\", options) : helperMissing.call(depth0, \"__\", \"Feedback block\", options)))\n    + \"</h4>\\n\\n    <!--assessmentTest/testPart/assessmentSection/sectionPart/rubricBlock/feedback -->\\n    \";\n  stack1 = helpers['with'].call(depth0, (depth0 && depth0.feedback), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n</div>\";\n  return buffer;\n  });\n});\n\n","\ndefine('tpl!taoQtiTest/controller/creator/templates/category-presets', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var stack1, functionType=\"function\", escapeExpression=this.escapeExpression, self=this, helperMissing=helpers.helperMissing;\n\nfunction program1(depth0,data,depth1) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\n<h4 class=\\\"toggler closed\\\" data-toggle=\\\"~ .category-preset-group-\";\n  if (helper = helpers.groupId) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.groupId); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\";\n  if (helper = helpers.groupLabel) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.groupLabel); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</h4>\\n\\n<div class=\\\"category-preset-group-\";\n  if (helper = helpers.groupId) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.groupId); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \" toggled\\\">\\n    \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.presets), {hash:{},inverse:self.noop,fn:self.programWithDepth(2, program2, data, depth1),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n</div>\\n\\n\";\n  return buffer;\n  }\nfunction program2(depth0,data,depth2) {\n  \n  var buffer = \"\", stack1, helper, options;\n  buffer += \"\\n    <div class=\\\"grid-row pseudo-label-box category-preset\\\" data-qti-category=\\\"\";\n  if (helper = helpers.qtiCategory) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.qtiCategory); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\n        <div class=\\\"col-1\\\">\\n            <label>\\n                <input\\n                        type=\\\"checkbox\\\"\\n                        name=\\\"category-preset-\";\n  if (helper = helpers.id) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.id); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\"\\n                        value=\\\"\";\n  if (helper = helpers.qtiCategory) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.qtiCategory); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\"\\n                        \";\n  stack1 = (helper = helpers.includes || (depth2 && depth2.includes),options={hash:{},inverse:self.noop,fn:self.program(3, program3, data),data:data},helper ? helper.call(depth0, (depth2 && depth2.categories), (depth0 && depth0.qtiCategory), options) : helperMissing.call(depth0, \"includes\", (depth2 && depth2.categories), (depth0 && depth0.qtiCategory), options));\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n                />\\n                <span class=\\\"icon-checkbox\\\"></span>\\n            </label>\\n        </div>\\n        <div class=\\\"col-10\\\">\\n            <label for=\\\"category-preset-\";\n  if (helper = helpers.id) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.id); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</label>\\n        </div>\\n        <div class=\\\"col-1 help\\\">\\n            <span class=\\\"icon-help\\\" data-tooltip=\\\"~ .tooltip-content\\\" data-tooltip-theme=\\\"info\\\"></span>\\n            <div class=\\\"tooltip-content\\\">\\n                \";\n  if (helper = helpers.description) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.description); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\n            </div>\\n        </div>\\n    </div>\\n    \";\n  return buffer;\n  }\nfunction program3(depth0,data) {\n  \n  \n  return \"checked\";\n  }\n\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.presetGroups), {hash:{},inverse:self.noop,fn:self.programWithDepth(1, program1, data, depth0),data:data});\n  if(stack1 || stack1 === 0) { return stack1; }\n  else { return ''; }\n  });\n});\n\n","\ndefine('tpl!taoQtiTest/controller/creator/templates/subsection', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, functionType=\"function\", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing;\n\n\n  buffer += \"<div id=\\\"\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" class=\\\"subsection\\\">\\n\\n    <h2><span class=\\\"title-index\\\"></span> <span data-bind=\\\"title\\\">\";\n  if (helper = helpers.title) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.title); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</span>\\n        <span class=\\\"icon-warning\\\"></span>\\n        <div class=\\\"actions\\\">\\n            <div class=\\\"tlb\\\">\\n                <div class=\\\"tlb-top\\\">\\n                    <span class=\\\"tlb-box\\\">\\n                        <span class=\\\"tlb-bar\\\">\\n                            <span class=\\\"tlb-start\\\"></span>\\n                            <span class=\\\"tlb-group\\\">\\n                                <a href=\\\"#\\\" class=\\\"tlb-button-off add-subsection\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Add Subsection\", options) : helperMissing.call(depth0, \"__\", \"Add Subsection\", options)))\n    + \"\\\" data-testid=\\\"add-subsection\\\"><span class=\\\"icon-add-subsection\\\"></span></a>\\n                                <span class=\\\"tlb-separator\\\"></span>\\n                                <a href=\\\"#\\\" class=\\\"tlb-button-off rub-toggler\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Manage Rubric Blocks\", options) : helperMissing.call(depth0, \"__\", \"Manage Rubric Blocks\", options)))\n    + \"\\\" data-toggle=\\\"#rublocks-\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" data-testid=\\\"manage-rubric-blocks\\\"><span class=\\\"icon-rubric\\\"></span></a>\\n                                <span class=\\\"tlb-separator\\\"></span>\\n                                <a href=\\\"#\\\" class=\\\"tlb-button-off property-toggler\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Section Properties\", options) : helperMissing.call(depth0, \"__\", \"Section Properties\", options)))\n    + \"\\\" data-testid=\\\"section-properties\\\"><span class=\\\"icon-settings\\\"></span></a>\\n                                <span class=\\\"tlb-separator\\\"></span>\\n                                <a href=\\\"#\\\" class=\\\"tlb-button-off move-up disabled\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Move Up\", options) : helperMissing.call(depth0, \"__\", \"Move Up\", options)))\n    + \"\\\" data-testid=\\\"move-up-subsection\\\"><span class=\\\"icon-up\\\"></span></a>\\n                                <a href=\\\"#\\\" class=\\\"tlb-button-off move-down disabled\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Move Down\", options) : helperMissing.call(depth0, \"__\", \"Move Down\", options)))\n    + \"\\\" data-testid=\\\"move-down-subsection\\\"><span class=\\\"icon-down\\\"></span></a>\\n                                <span class=\\\"tlb-separator\\\"></span>\\n                                <a href=\\\"#\\\" class=\\\"tlb-button-off disabled delete-subsection\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Remove Subsection\", options) : helperMissing.call(depth0, \"__\", \"Remove Subsection\", options)))\n    + \"\\\" data-delete=\\\":parent .subsection\\\" data-testid=\\\"remove-subsection\\\"><span class=\\\"icon-bin\\\"></span></a>\\n                            </span>\\n                            <span class=\\\"tlb-end\\\"></span>\\n                        </span>\\n                    </span>\\n                </div>\\n            </div>\\n        </div>\\n    </h2>\\n\\n    <div id=\\\"rublocks-\";\n  if (helper = helpers.identifier) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.identifier); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" class=\\\"rublocks clearfix toggled\\\">\\n        <h3>\\n            <span class=\\\"title\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Rubric Blocks\", options) : helperMissing.call(depth0, \"__\", \"Rubric Blocks\", options)))\n    + \"</span>\\n        </h3>\\n        <ol class=\\\"rubricblocks decimal\\\" data-bind-each=\\\"rubricBlocks\\\" data-bind-tmpl=\\\"rubricblock\\\"></ol>\\n        <button class=\\\"btn-info small rublock-adder\\\" data-testid=\\\"add-rubric-block\\\">\\n            <span class=\\\"icon-add\\\"></span>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"New Rubric Block\", options) : helperMissing.call(depth0, \"__\", \"New Rubric Block\", options)))\n    + \"\\n        </button>\\n    </div>\\n    <div class=\\\"itemrefs-wrapper\\\">\\n        <h3>\\n            <span class=\\\"title\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Items\", options) : helperMissing.call(depth0, \"__\", \"Items\", options)))\n    + \"</span>\\n        </h3>\\n        <ol class=\\\"itemrefs decimal clearfix\\\" data-bind-each=\\\"sectionParts\\\" data-bind-tmpl=\\\"itemref\\\" data-bind-filter=\\\"isItemRef\\\" data-msg=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Add selected item(s) here.\", options) : helperMissing.call(depth0, \"__\", \"Add selected item(s) here.\", options)))\n    + \"\\\"></ol>\\n        <div class=\\\"itemref-placeholder\\\" data-testid=\\\"add-items\\\">\\n            \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Add selected item(s) here.\", options) : helperMissing.call(depth0, \"__\", \"Add selected item(s) here.\", options)))\n    + \"\\n        </div>\\n    </div>\\n     <div class=\\\"subsections\\\" data-bind-each=\\\"sectionParts\\\" data-bind-tmpl=\\\"subsection\\\" data-bind-filter=\\\"isSection\\\"></div>\\n</div>\";\n  return buffer;\n  });\n});\n\n","\n/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014-2021 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n */\n/**\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/templates/index',[\n    'taoQtiTest/controller/creator/config/defaults',\n    'tpl!taoQtiTest/controller/creator/templates/testpart',\n    'tpl!taoQtiTest/controller/creator/templates/section',\n    'tpl!taoQtiTest/controller/creator/templates/rubricblock',\n    'tpl!taoQtiTest/controller/creator/templates/itemref',\n    'tpl!taoQtiTest/controller/creator/templates/outcomes',\n    'tpl!taoQtiTest/controller/creator/templates/test-props',\n    'tpl!taoQtiTest/controller/creator/templates/testpart-props',\n    'tpl!taoQtiTest/controller/creator/templates/section-props',\n    'tpl!taoQtiTest/controller/creator/templates/itemref-props',\n    'tpl!taoQtiTest/controller/creator/templates/itemref-props-weight',\n    'tpl!taoQtiTest/controller/creator/templates/rubricblock-props',\n    'tpl!taoQtiTest/controller/creator/templates/category-presets',\n    'tpl!taoQtiTest/controller/creator/templates/subsection'\n],\nfunction(\n    defaults,\n    testPart,\n    section,\n    rubricBlock,\n    itemRef,\n    outcomes,\n    testProps,\n    testPartProps,\n    sectionProps,\n    itemRefProps,\n    itemRefPropsWeight,\n    rubricBlockProps,\n    categoryPresets,\n    subsection\n){\n    'use strict';\n\n    const applyTemplateConfiguration = (template) => (config) => template(defaults(config));\n\n    /**\n     * Expose all the templates used by the test creator\n     * @exports taoQtiTest/controller/creator/templates/index\n     */\n    return {\n        testpart    : applyTemplateConfiguration(testPart),\n        section     : applyTemplateConfiguration(section),\n        itemref     : applyTemplateConfiguration(itemRef),\n        rubricblock : applyTemplateConfiguration(rubricBlock),\n        outcomes    : applyTemplateConfiguration(outcomes),\n        subsection  : applyTemplateConfiguration(subsection),\n        properties  : {\n            test            : applyTemplateConfiguration(testProps),\n            testpart        : applyTemplateConfiguration(testPartProps),\n            section         : applyTemplateConfiguration(sectionProps),\n            itemref         : applyTemplateConfiguration(itemRefProps),\n            itemrefweight   : applyTemplateConfiguration(itemRefPropsWeight),\n            rubricblock     : applyTemplateConfiguration(rubricBlockProps),\n            categorypresets : applyTemplateConfiguration(categoryPresets),\n            subsection  : applyTemplateConfiguration(sectionProps)\n\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014-2022 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n */\n\n/**\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/views/property',['jquery', 'uikitLoader', 'core/databinder', 'taoQtiTest/controller/creator/templates/index'], function (\n    $,\n    ui,\n    DataBinder,\n    templates\n) {\n    'use strict';\n\n    /**\n     * @callback PropertyViewCallback\n     * @param {propertyView} propertyView - the view object\n     */\n\n    /**\n     * The PropertyView setup the property panel component\n     * @param {String} tmplName\n     * @param {Object} model\n     * @exports taoQtiTest/controller/creator/views/property\n     * @returns {Object}\n     */\n    const propView = function propView(tmplName, model) {\n        const $container = $('.test-creator-props');\n        const template = templates.properties[tmplName];\n        let $view;\n\n        /**\n         * Opens the view for the 1st time\n         */\n        const open = function propOpen() {\n            const binderOptions = {\n                templates: templates.properties\n            };\n            $container.children('.props').hide().trigger('propclose.propview');\n            $view = $(template(model)).appendTo($container).filter('.props');\n\n            //start listening for DOM compoenents inside the view\n            ui.startDomComponent($view);\n\n            //start the data binding\n            const databinder = new DataBinder($view, model, binderOptions);\n            databinder.bind();\n\n            propValidation();\n\n            $view.trigger('propopen.propview');\n\n            // contains identifier from model, needed for validation on keyup for identifiers\n            // jQuesy selector for Id with dots don't work\n            // dots are allowed for id by default see taoQtiItem/qtiCreator/widgets/helpers/qtiIdentifier\n            // need to use attr\n            const $identifier = $view.find(`[id=\"props-${model.identifier}\"]`);\n            $view.on('change.binder', function (e) {\n                if (e.namespace === 'binder' && $identifier.length) {\n                    $identifier.text(model.identifier);\n                }\n            });\n        };\n\n        /**\n         * Get the view container element\n         * @returns {jQueryElement}\n         */\n        const getView = function propGetView() {\n            return $view;\n        };\n\n        /**\n         * Check wheter the view is displayed\n         * @returns {boolean} true id opened\n         */\n        const isOpen = function propIsOpen() {\n            return $view.css('display') !== 'none';\n        };\n\n        /**\n         * Bind a callback on view open\n         * @param {PropertyViewCallback} cb\n         */\n        const onOpen = function propOnOpen(cb) {\n            $view.on('propopen.propview', function (e) {\n                e.stopPropagation();\n                cb();\n            });\n        };\n\n        /**\n         * Bind a callback on view close\n         * @param {PropertyViewCallback} cb\n         */\n        const onClose = function propOnClose(cb) {\n            $view.on('propclose.propview', function (e) {\n                e.stopPropagation();\n                cb();\n            });\n        };\n\n        /**\n         * Removes the property view\n         */\n        const destroy = function propDestroy() {\n            $view.remove();\n        };\n\n        /**\n         * Toggles the property view display\n         */\n        const toggle = function propToggle() {\n            $container.children('.props').not($view).hide().trigger('propclose.propview');\n            if (isOpen()) {\n                $view.hide().trigger('propclose.propview');\n            } else {\n                $view.show().trigger('propopen.propview');\n            }\n        };\n\n        /**\n         * Set up the validation on the property view\n         * @private\n         */\n        function propValidation() {\n            $view.on('validated.group', function(e, isValid){\n                const $warningIconSelector = $('span.icon-warning');\n                const $test = $('.tlb-button-on').parents('.test-creator-test');\n\n                // finds error current element if any\n                let errors = $(e.currentTarget).find('span.validate-error');\n                let currentTargetId = `[id=\"${$(e.currentTarget).find('span[data-bind=\"identifier\"]').attr('id').slice(6)}\"]`;\n                \n                if(e.namespace === 'group'){\n                    if (isValid && errors.length === 0) {\n                        //remove warning icon if validation fails\n                        if($(e.currentTarget).hasClass('test-props')){\n                         $($test).find($warningIconSelector).first().css('display', 'none');\n                        }\n                        $(currentTargetId).find($warningIconSelector).first().css('display', 'none');\n                    } else {\n                       //add warning icon if validation fails\n                        if($(e.currentTarget).hasClass('test-props')){\n                            $($test).find($warningIconSelector).first().css('display', 'inline');\n                        }\n                        $(currentTargetId).find($warningIconSelector).first().css('display', 'inline');\n                    }\n                }\n            });\n\n            $view.groupValidator({ events: ['keyup', 'change', 'blur'] });\n        }\n\n        return {\n            open: open,\n            getView: getView,\n            isOpen: isOpen,\n            onOpen: onOpen,\n            onClose: onClose,\n            destroy: destroy,\n            toggle: toggle\n        };\n    };\n\n    return propView;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2021-2022 (original work) Open Assessment Technologies SA;\n */\ndefine('taoQtiTest/controller/creator/helpers/subsection',['jquery', 'lodash'], function ($, _) {\n    'use strict';\n\n    /**\n     * Check if this is first level of subsections\n     *\n     * @param {JQueryElement} $subsection\n     * @returns {boolean}\n     */\n    function isFistLevelSubsection($subsection) {\n        return $subsection.parents('.subsection').length === 0;\n    }\n    /**\n     * Check if this is nested subsections (2nd level)\n     *\n     * @param {JQueryElement} $subsection\n     * @returns {boolean}\n     */\n    function isNestedSubsection($subsection) {\n        return $subsection.parents('.subsection').length > 0;\n    }\n    /**\n     * Get subsections of this section/subsection (without nesting subsection)\n     *\n     * @param {JQueryElement} $section\n     * @returns {boolean}\n     */\n    function getSubsections($section) {\n        return $section.children('.subsections').children('.subsection');\n    }\n    /**\n     * Get siblings subsections of this subsection\n     *\n     * @param {JQueryElement} $subsection\n     * @returns {boolean}\n     */\n    function getSiblingSubsections($subsection) {\n        return getSubsectionContainer($subsection).children('.subsection');\n    }\n    /**\n     * Get parent subsection of this nested subsection\n     *\n     * @param {JQueryElement} $subsection\n     * @returns {boolean}\n     */\n    function getParentSubsection($subsection) {\n        return $subsection.parents('.subsection').first();\n    }\n    /**\n     * Get parent section of this subsection\n     *\n     * @param {JQueryElement} $subsection\n     * @returns {boolean}\n     */\n    function getParentSection($subsection) {\n        return $subsection.parents('.section');\n    }\n    /**\n     * Get parent section/subsection\n     *\n     * @param {JQueryElement} $subsection\n     * @returns {boolean}\n     */\n    function getParent($subsection) {\n        if (isFistLevelSubsection($subsection)) {\n            return getParentSection($subsection);\n        }\n        return getParentSubsection($subsection);\n    }\n    /**\n     * Get parent container('.subsections') for this subsection\n     *\n     * @param {JQueryElement} $subsection\n     * @returns {boolean}\n     */\n    function getSubsectionContainer($subsection) {\n        return $subsection.hasClass('subsections') ? $subsection : $subsection.parents('.subsections').first();\n    }\n\n    /**\n     * Get index for this subsection\n     *\n     * @param {JQueryElement} $subsection\n     * @returns {boolean}\n     */\n    function getSubsectionTitleIndex($subsection) {\n        const $parentSection = getParentSection($subsection);\n        const index = getSiblingSubsections($subsection).index($subsection);\n        const sectionIndex = $parentSection.parents('.sections').children('.section').index($parentSection);\n        if (isFistLevelSubsection($subsection)) {\n            return `${sectionIndex + 1}.${index + 1}.`;\n        } else {\n            const $parentSubsection = getParentSubsection($subsection);\n            const subsectionIndex = getSiblingSubsections($parentSubsection).index($parentSubsection);\n            return `${sectionIndex + 1}.${subsectionIndex + 1}.${index + 1}.`;\n        }\n    }\n\n    return {\n        isFistLevelSubsection,\n        isNestedSubsection,\n        getSubsections,\n        getSubsectionContainer,\n        getSiblingSubsections,\n        getParentSubsection,\n        getParentSection,\n        getParent,\n        getSubsectionTitleIndex\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014-2022 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n */\n\n/**\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/views/actions',[\n    'jquery',\n    'taoQtiTest/controller/creator/views/property',\n    'taoQtiTest/controller/creator/helpers/subsection'\n], function ($, propertyView, subsectionsHelper) {\n    'use strict';\n\n    const disabledClass = 'disabled';\n    const activeClass = 'active';\n    const btnOnClass = 'tlb-button-on';\n\n    /**\n     * Set up the property view for an element\n     * @param {jQueryElement} $container - that contains the property opener\n     * @param {String} template - the name of the template to give to the propertyView\n     * @param {Object} model - the model to bind\n     * @param {PropertyViewCallback} cb - execute at view setup phase\n     */\n    function properties($container, template, model, cb) {\n        let propView = null;\n        $container.find('.property-toggler').on('click', function (e) {\n            e.preventDefault();\n            const $elt = $(this);\n            if (!$(this).hasClass(disabledClass)) {\n                $elt.blur(); //to remove the focus\n\n                if (propView === null) {\n                    $container.addClass(activeClass);\n                    $elt.addClass(btnOnClass);\n\n                    propView = propertyView(template, model);\n                    propView.open();\n\n                    propView.onOpen(function () {\n                        $container.addClass(activeClass);\n                        $elt.addClass(btnOnClass);\n                    });\n                    propView.onClose(function () {\n                        $container.removeClass(activeClass);\n                        $elt.removeClass(btnOnClass);\n                    });\n\n                    if (typeof cb === 'function') {\n                        cb(propView);\n                    }\n                } else {\n                    propView.toggle();\n                }\n            }\n        });\n    }\n\n    /**\n     * Enable to move an element\n     * @param {jQueryElement} $actionContainer - where the mover is\n     * @param {String} containerClass - the cssClass of the element container\n     * @param {String} elementClass - the cssClass to identify elements\n     */\n    function move($actionContainer, containerClass, elementClass) {\n        const $element = $actionContainer.closest(`.${elementClass}`);\n        const $container = $element.closest(`.${containerClass}`);\n\n        //move up an element\n        $('.move-up', $actionContainer).click(function (e) {\n            let $elements, index;\n\n            //prevent default and click during animation and on disabled icon\n            e.preventDefault();\n            if ($element.is(':animated') && $element.hasClass('disabled')) {\n                return false;\n            }\n\n            //get the position\n            $elements = $container.children(`.${elementClass}`);\n            index = $elements.index($element);\n            if (index > 0) {\n                $element.fadeOut(200, () => {\n                    $element\n                        .insertBefore($container.children(`.${elementClass}:eq(${index - 1})`))\n                        .fadeIn(400, () => $container.trigger('change'));\n                });\n            }\n        });\n\n        //move down an element\n        $('.move-down', $actionContainer).click(function (e) {\n            let $elements, index;\n\n            //prevent default and click during animation and on disabled icon\n            e.preventDefault();\n            if ($element.is(':animated') && $element.hasClass('disabled')) {\n                return false;\n            }\n\n            //get the position\n            $elements = $container.children(`.${elementClass}`);\n            index = $elements.index($element);\n            if (index < $elements.length - 1 && $elements.length > 1) {\n                $element.fadeOut(200, () => {\n                    $element\n                        .insertAfter($container.children(`.${elementClass}:eq(${index + 1})`))\n                        .fadeIn(400, () => $container.trigger('change'));\n                });\n            }\n        });\n    }\n\n    /**\n     * Update the movable state of an element\n     * @param {jQueryElement} $container - the movable elements (scopped)\n     * @param {String} elementClass - the cssClass to identify elements\n     * @param {String} actionContainerElt - the element name that contains the actions\n     */\n    function movable($container, elementClass, actionContainerElt) {\n        $container.each(function () {\n            const $elt = $(this);\n            const $actionContainer = $elt.children(actionContainerElt);\n\n            const index = $container.index($elt);\n            const $moveUp = $('.move-up', $actionContainer);\n            const $moveDown = $('.move-down', $actionContainer);\n\n            //only one test part, no moving\n            if ($container.length === 1) {\n                $moveUp.addClass(disabledClass);\n                $moveDown.addClass(disabledClass);\n\n                //testpart is the first, only moving down\n            } else if (index === 0) {\n                $moveUp.addClass(disabledClass);\n                $moveDown.removeClass(disabledClass);\n\n                //testpart is the lasst, only moving up\n            } else if (index >= $container.length - 1) {\n                $moveDown.addClass(disabledClass);\n                $moveUp.removeClass(disabledClass);\n\n                //or enable moving top/bottom\n            } else {\n                $moveUp.removeClass(disabledClass);\n                $moveDown.removeClass(disabledClass);\n            }\n        });\n    }\n\n    /**\n     * Update the removable state of an element\n     * @param {jQueryElement} $container - that contains the removable action\n     * @param {String} actionContainerElt - the element name that contains the actions\n     */\n    function removable($container, actionContainerElt) {\n        $container.each(function () {\n            const $elt = $(this);\n            const $actionContainer = $elt.children(actionContainerElt);\n            const $delete = $('[data-delete]', $actionContainer);\n\n            if ($container.length <= 1 && !$elt.hasClass('subsection')) {\n                $delete.addClass(disabledClass);\n            } else {\n                $delete.removeClass(disabledClass);\n            }\n        });\n    }\n\n    /**\n     * Disable all the actions of the target\n     * @param {jQueryElement} $container - that contains the the actions\n     * @param {String} actionContainerElt - the element name that contains the actions\n     */\n    function disable($container, actionContainerElt) {\n\n        if ($container.length <= 2){\n        $container.children(actionContainerElt).find('[data-delete]').addClass(disabledClass);\n        }\n    }\n\n    /**\n     * Enable all the actions of the target\n     * @param {jQueryElement} $container - that contains the the actions\n     * @param {String} actionContainerElt - the element name that contains the actions\n     */\n    function enable($container, actionContainerElt) {\n        $container.children(actionContainerElt).find('[data-delete],.move-up,.move-down').removeClass(disabledClass);\n    }\n\n    /**\n     * Hides/shows container for adding items inside a section checking if there is at least\n     * one subsection inside of it. As delete subsection event is triggered before subsection\n     * container is actually removed from section container, we need to have conditional flow\n     * @param {jQueryElement} $section - section jquery container\n     */\n    function displayItemWrapper($section) {\n        const $elt = $('.itemrefs-wrapper:first', $section);\n        const subsectionsCount = subsectionsHelper.getSubsections($section).length;\n        if (subsectionsCount) {\n            $elt.hide();\n        } else {\n            $elt.show();\n        }\n    }\n\n    /**\n     * Update delete selector for 2nd level subsections\n     *@param {jQueryElement} $actionContainer - action's container\n     */\n    function updateDeleteSelector($actionContainer) {\n        const $deleteButton = $actionContainer.find('.delete-subsection');\n        if ($deleteButton.parents('.subsection').length > 1) {\n            const deleteSelector = $deleteButton.data('delete');\n            $deleteButton.attr('data-delete', `${deleteSelector} .subsection`);\n        }\n    }\n\n    /**\n     * Hides/shows category-presets (Test Navigation, Navigation Warnings, Test-Taker Tools)\n     * Hide category-presets for section that contains subsections\n     * @param {jQueryElement} $authoringContainer\n     * @param {string} [scope='section'] // can also be 'testpart'\n     * @fires propertiesView#set-default-categories\n     */\n    function displayCategoryPresets($authoringContainer, scope = 'section') {\n        const id = $authoringContainer.attr('id');\n        const $propertiesView = $(`.test-creator-props #${scope}-props-${id}`);\n        if (!$propertiesView.length) {\n            // property view is not setup\n            return;\n        }\n        const $elt = $propertiesView.find('.category-presets');\n        switch (scope) {\n            case 'testpart':\n                $elt.show();\n                break;\n\n            case 'section':\n                const subsectionsCount = subsectionsHelper.getSubsections($authoringContainer).length;\n                if (subsectionsCount) {\n                    $elt.hide();\n                    $propertiesView.trigger('set-default-categories');\n                } else {\n                    $elt.show();\n                }\n                break;\n        }\n    }\n\n    /**\n     * Update the index of an section/subsection\n     * @param {jQueryElement} $list - list of elements\n     */\n    function updateTitleIndex($list) {\n        $list.each(function () {\n            const $elt = $(this);\n            const $indexSpan = $('.title-index', $elt.children('h2'));\n\n            if ($elt.hasClass('section')) {\n                const $parent = $elt.parents('.sections');\n                const index = $('.section', $parent).index($elt);\n                $indexSpan.text(`${index + 1}.`);\n            } else {\n                $indexSpan.text(subsectionsHelper.getSubsectionTitleIndex($elt));\n            }\n        });\n    }\n\n    /**\n     * The actions gives you shared behavior for some actions.\n     *\n     * @exports taoQtiTest/controller/creator/views/actions\n     */\n    return {\n        properties,\n        move,\n        removable,\n        movable,\n        disable,\n        enable,\n        displayItemWrapper,\n        updateDeleteSelector,\n        displayCategoryPresets,\n        updateTitleIndex\n    };\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2022 (original work) Open Assessment Technologies SA\n *\n */\n\ndefine('taoQtiTest/controller/creator/helpers/featureVisibility',['services/features'], function (features) {\n    'use strict';\n\n    /**\n     * Adds visibility properties for test model which allow to toggle test properties presence in interface\n     * @param {Object} model\n     */\n    function addTestVisibilityProps(model) {\n        if (features.isVisible('taoQtiTest/creator/test/property/timeLimits')) {\n            model.showTimeLimits = true;\n        }\n    }\n\n    /**\n     * Adds visibility properties for testPart model which allow to toggle testPart properties presence in interface\n     * @param {Object} model\n     */\n    function addTestPartVisibilityProps(model) {\n        const propertyNamespace = 'taoQtiTest/creator/testPart/property/';\n        if (features.isVisible(`${propertyNamespace}timeLimits`)) {\n            model.showTimeLimits = true;\n        }\n        if (features.isVisible(`${propertyNamespace}itemSessionControl/showFeedback`)) {\n            model.itemSessionShowFeedback = true;\n        }\n        if (features.isVisible(`${propertyNamespace}itemSessionControl/allowComment`)) {\n            model.itemSessionAllowComment = true;\n        }\n        if (features.isVisible(`${propertyNamespace}itemSessionControl/allowSkipping`)) {\n            model.itemSessionAllowSkipping = true;\n        }\n    }\n\n    /**\n     * Adds visibility properties for section model which allow to toggle section properties presence in interface\n     * @param {Object} model\n     */\n    function addSectionVisibilityProps(model) {\n        const propertyNamespace = 'taoQtiTest/creator/section/property/';\n        if (features.isVisible(`${propertyNamespace}timeLimits`)) {\n            model.showTimeLimits = true;\n        }\n        if (features.isVisible(`${propertyNamespace}itemSessionControl/showFeedback`)) {\n            model.itemSessionShowFeedback = true;\n        }\n        if (features.isVisible(`${propertyNamespace}itemSessionControl/allowComment`)) {\n            model.itemSessionAllowComment = true;\n        }\n        if (features.isVisible(`${propertyNamespace}itemSessionControl/allowSkipping`)) {\n            model.itemSessionAllowSkipping = true;\n        }\n    }\n\n    /**\n     * Adds visibility properties for item model which allow to toggle item properties presence in interface\n     * @param {Object} model\n     */\n    function addItemRefVisibilityProps(model) {\n        const propertyNamespace = 'taoQtiTest/creator/itemRef/property/';\n        if (features.isVisible(`${propertyNamespace}timeLimits`)) {\n            model.showTimeLimits = true;\n        }\n        if (features.isVisible(`${propertyNamespace}itemSessionControl/showFeedback`)) {\n            model.itemSessionShowFeedback = true;\n        }\n        if (features.isVisible(`${propertyNamespace}itemSessionControl/allowComment`)) {\n            model.itemSessionAllowComment = true;\n        }\n        if (features.isVisible(`${propertyNamespace}itemSessionControl/allowSkipping`)) {\n            model.itemSessionAllowSkipping = true;\n        }\n    }\n\n    /**\n     * Filters the presets and preset groups based on visibility config\n     * @param {Array} presetGroups array of presetGroups\n     * @param {string} [level='all'] testPart, section of itemRef\n     * @returns {Array} filtered presetGroups array\n     */\n    function filterVisiblePresets(presetGroups, level = 'all') {\n        const categoryGroupNamespace = `taoQtiTest/creator/${level}/category/presetGroup/`;\n        const categoryPresetNamespace = `taoQtiTest/creator/${level}/category/preset/`;\n        let filteredGroups;\n        if (presetGroups && presetGroups.length) {\n            filteredGroups = presetGroups.filter(presetGroup => {\n                return features.isVisible(`${categoryGroupNamespace}${presetGroup.groupId}`);\n            });\n            if (filteredGroups.length) {\n                filteredGroups.forEach(filteredGroup => {\n                    if (filteredGroup.presets && filteredGroup.presets.length) {\n                        const filteredPresets = filteredGroup.presets.filter(preset => {\n                            return features.isVisible(`${categoryPresetNamespace}${preset.id}`);\n                        });\n                        filteredGroup.presets = filteredPresets;\n                    }\n                });\n            }\n        }\n        return filteredGroups;\n    }\n\n    return {\n        addTestVisibilityProps,\n        addTestPartVisibilityProps,\n        addSectionVisibilityProps,\n        addItemRefVisibilityProps,\n        filterVisiblePresets\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA;\n */\n/**\n * This helper manages the category selection UI:\n * - either via a text entry field that allow to enter any custom categories\n * - either via displaying grouped checkboxes that allow to select any categories presets\n * All categories are then grouped and given to this object's listeners, as they will later end up in the same model field.\n *\n * @author Christophe Noël <christophe@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/helpers/categorySelector',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'core/eventifier',\n    'ui/tooltip',\n    'taoQtiTest/controller/creator/templates/index',\n    'taoQtiTest/controller/creator/helpers/featureVisibility',\n    'select2'\n], function($, _, __, eventifier, tooltip, templates, featureVisibility) {\n    'use strict';\n\n    var allPresets = [],\n        allQtiCategoriesPresets = [];\n\n\n    function categorySelectorFactory($container) {\n        var categorySelector,\n\n            $presetsContainer = $container.find('.category-presets'),\n            $presetsCheckboxes,\n            $customCategoriesSelect = $container.find('[name=category-custom]');\n\n        /**\n         * Read the form state from the DOM and trigger an event with the result, so the listeners can update the item/section model\n         * @fires categorySelector#category-change\n         */\n        function updateCategories() {\n            var selectedCategories,\n                indeterminatedCategories,\n\n                presetSelected = $container\n                    .find('.category-preset input:checked')\n                    .toArray()\n                    .map(function(categoryEl) {\n                        return categoryEl.value;\n                    }),\n                presetIndeterminate = $container\n                    .find('.category-preset input:indeterminate')\n                    .toArray()\n                    .map(function(categoryEl) {\n                        return categoryEl.value;\n                    }),\n                customSelected = $customCategoriesSelect.siblings('.select2-container').find('.select2-search-choice').not('.partial')\n                    .toArray()\n                    .map(function(categoryEl) {\n                        return categoryEl.textContent && categoryEl.textContent.trim();\n                    }),\n                customIndeterminate = $customCategoriesSelect.siblings('.select2-container').find('.select2-search-choice.partial')\n                    .toArray()\n                    .map(function(categoryEl) {\n                        return categoryEl.textContent && categoryEl.textContent.trim();\n                    });\n\n            selectedCategories = presetSelected.concat(customSelected);\n            indeterminatedCategories = presetIndeterminate.concat(customIndeterminate);\n\n            /**\n             * @event categorySelector#category-change\n             * @param {String[]} allCategories\n             * @param {String[]} indeterminate\n             */\n            this.trigger('category-change', selectedCategories, indeterminatedCategories);\n        }\n\n        categorySelector = {\n            /**\n             * Create the category selection form\n             *\n             * @param {Array} [currentCategories] - all categories currently associated to the item. If applied to a section,\n             * contains all the categories applied to at least one item of the section.\n             * @param {string} [level] one of the values `testPart`, `section` or `itemRef`\n             */\n            createForm: function createForm(currentCategories, level) {\n                var self = this,\n                    presetsTpl = templates.properties.categorypresets,\n                    customCategories = _.difference(currentCategories, allQtiCategoriesPresets);\n\n                const filteredPresets = featureVisibility.filterVisiblePresets(allPresets, level);\n                // add preset checkboxes\n                $presetsContainer.append(\n                    presetsTpl({presetGroups: filteredPresets})\n                );\n\n                $presetsContainer.on('click', function(e) {\n                    var $preset = $(e.target).closest('.category-preset'),\n                        $checkbox;\n\n                    if ($preset.length) {\n                        $checkbox = $preset.find('input');\n                        $checkbox.prop('indeterminate', false);\n\n                        _.defer(function() {\n                            updateCategories.call(self);\n                        });\n                    }\n                });\n\n                // init custom categories field\n                $customCategoriesSelect.select2({\n                    width: '100%',\n                    tags : customCategories,\n                    multiple : true,\n                    tokenSeparators: [\",\", \" \", \";\"],\n                    formatNoMatches : function(){\n                        return __('Enter a custom category');\n                    },\n                    maximumInputLength : 32\n                }).on('change', function(){\n                    updateCategories.call(self);\n                });\n\n                // enable help tooltips\n                tooltip.lookup($container);\n            },\n\n            /**\n             * Check/Uncheck boxes and fill the custom category field to match the new model\n             * @param {String[]} selected - categories associated with an item, or with all the items of the same section\n             * @param {String[]} [indeterminate] - categories in an indeterminate state at a section level\n             */\n            updateFormState: function updateFormState(selected, indeterminate) {\n                var customCategories;\n\n                indeterminate = indeterminate || [];\n\n                customCategories = _.difference(selected.concat(indeterminate), allQtiCategoriesPresets);\n\n                // Preset categories\n\n                $presetsCheckboxes = $container.find('.category-preset input');\n                $presetsCheckboxes.each(function() {\n                    var category = this.value;\n\n                    this.indeterminate = false;\n                    this.checked = false;\n\n                    if (indeterminate.indexOf(category) !== -1) {\n                        this.indeterminate = true;\n                    } else if (selected.indexOf(category) !== -1) {\n                        this.checked = true;\n                    }\n                });\n\n                // Custom categories\n\n                $customCategoriesSelect.select2('val', customCategories);\n\n                $customCategoriesSelect.siblings('.select2-container').find('.select2-search-choice').each(function(){\n                    var $li = $(this);\n                    var content = $li.find('div').text();\n                    if(indeterminate.indexOf(content) !== -1){\n                        $li.addClass('partial');\n                    }\n                });\n            }\n        };\n\n        eventifier(categorySelector);\n\n        return categorySelector;\n    }\n\n    /**\n     * @param {Object[]} presets - expected format:\n     * [\n     *  {\n     *      groupId: 'navigation',\n     *      groupLabel: 'Test Navigation',\n     *      presets: [\n     *          {\n     *              id: 'nextPartWarning',\n     *              label: 'Next Part Warning',\n     *              qtiCategory : 'x-tao-option-nextPartWarning',\n     *              description : 'Displays a warning before the user finishes a part'\n *              },\n     *          ...\n     *      ]\n     *  },\n     *  ...\n     * ]\n     */\n    categorySelectorFactory.setPresets = function setPresets(presets) {\n        if (_.isArray(presets)) {\n            allPresets = presets;\n            allQtiCategoriesPresets = extractCategoriesFromPresets();\n        }\n    };\n\n    /**\n     * Extract the qtiCategory property of all presets of all groups\n     * @returns {String[]}\n     */\n    function extractCategoriesFromPresets() {\n        return allPresets.reduce(function (prev, current) {\n            var groupIds = _.pluck(current.presets, 'qtiCategory');\n            return prev.concat(groupIds);\n        }, []);\n    }\n\n    return categorySelectorFactory;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA;\n */\ndefine('taoQtiTest/controller/creator/helpers/sectionCategory',[\n    'lodash',\n    'i18n',\n    'core/errorHandler'\n], function (_, __, errorHandler){\n\n    'use strict';\n\n    var _ns = '.sectionCategory';\n\n    /**\n     * Check if the given object is a valid assessmentSection model object\n     *\n     * @param {object} model\n     * @returns {boolean}\n     */\n    function isValidSectionModel(model){\n        return (_.isObject(model) && model['qti-type'] === 'assessmentSection' && _.isArray(model.sectionParts));\n    }\n\n    /**\n     * Set an array of categories to the section model (affect the childen itemRef)\n     *\n     * @param {object} model\n     * @param {array} selected - all categories active for the whole section\n     * @param {array} partial - only categories in an indeterminate state\n     * @returns {undefined}\n     */\n    function setCategories(model, selected, partial){\n\n        var toRemove,\n            toAdd,\n            currentCategories = getCategories(model);\n\n        partial = partial || [];\n\n        //the categories that are no longer in the new list of categories should be removed\n        toRemove = _.difference(currentCategories.all, selected.concat(partial));\n\n        //the categories that are not in the current categories collection should be added to the children\n        toAdd = _.difference(selected, currentCategories.propagated);\n\n        model.categories = _.difference(model.categories, toRemove);\n        model.categories = model.categories.concat(toAdd);\n\n        //process the modification\n        addCategories(model, toAdd);\n        removeCategories(model, toRemove);\n    }\n\n    /**\n     * Get the categories assign to the section model, infered by its interal itemRefs\n     *\n     * @param {object} model\n     * @returns {object}\n     */\n    function getCategories(model) {\n        var categories,\n            arrays,\n            union,\n            propagated,\n            partial,\n            itemCount = 0;\n\n        if (!isValidSectionModel(model)) {\n            return errorHandler.throw(_ns, 'invalid tool config format');\n        }\n\n        categories = _.map(model.sectionParts, function (itemRef){\n            if(itemRef['qti-type'] === 'assessmentItemRef' && ++itemCount && _.isArray(itemRef.categories)){\n                return _.compact(itemRef.categories);\n            }\n        });\n\n        if (!itemCount) {\n            return createCategories(model.categories, model.categories);\n        }\n\n        //array of categories\n        arrays = _.values(categories);\n        union = _.union.apply(null, arrays);\n\n        //categories that are common to all itemRef\n        propagated = _.intersection.apply(null, arrays);\n\n        //the categories that are only partially covered on the section level : complementary of \"propagated\"\n        partial = _.difference(union, propagated);\n\n        return createCategories(union, propagated, partial);\n    }\n\n    /**\n     * Add an array of categories to a section model (affect the childen itemRef)\n     *\n     * @param {object} model\n     * @param {array} categories\n     * @returns {undefined}\n     */\n    function addCategories(model, categories){\n        if(isValidSectionModel(model)){\n            _.each(model.sectionParts, function (itemRef){\n                if(itemRef['qti-type'] === 'assessmentItemRef'){\n                    if(!_.isArray(itemRef.categories)){\n                        itemRef.categories = [];\n                    }\n                    itemRef.categories = _.union(itemRef.categories, categories);\n                }\n            });\n        }else{\n            errorHandler.throw(_ns, 'invalid tool config format');\n        }\n    }\n\n    /**\n     * Remove an array of categories from a section model (affect the childen itemRef)\n     *\n     * @param {object} model\n     * @param {array} categories\n     * @returns {undefined}\n     */\n    function removeCategories(model, categories){\n        if(isValidSectionModel(model)){\n            _.each(model.sectionParts, function (itemRef){\n                if(itemRef['qti-type'] === 'assessmentItemRef' && _.isArray(itemRef.categories)){\n                    itemRef.categories = _.difference(itemRef.categories, categories);\n                }\n            });\n        }else{\n            errorHandler.throw(_ns, 'invalid tool config format');\n        }\n    }\n\n    function createCategories(all = [], propagated = [], partial = []) {\n        return _.mapValues({\n            all: all,\n            propagated: propagated,\n            partial: partial\n        }, function (categories) {\n            return categories.sort();\n        });\n    }\n\n    return {\n        isValidSectionModel : isValidSectionModel,\n        setCategories : setCategories,\n        getCategories : getCategories,\n        addCategories : addCategories,\n        removeCategories : removeCategories\n    };\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2022 (original work) Open Assessment Technologies SA\n *\n */\ndefine('taoQtiTest/controller/creator/helpers/validators',[\n    'ui/validator/validators',\n    'jquery',\n    'lodash',\n    'i18n',\n    'taoQtiTest/controller/creator/helpers/outcome',\n    'taoQtiTest/controller/creator/helpers/qtiElement',\n    'taoQtiItem/qtiCreator/widgets/helpers/qtiIdentifier'\n], function (validators, $, _, __, outcomeHelper, qtiElementHelper, qtiIdentifier) {\n    'use strict';\n\n    const qtiIdPattern = qtiIdentifier.pattern;\n    //Identifiers must be unique across\n    //those QTI types\n    const qtiTypesForUniqueIds = ['assessmentTest', 'testPart', 'assessmentSection', 'assessmentItemRef'];\n\n    /**\n     * Gives you a validator that check QTI id format\n     * @returns {Object} the validator\n     */\n    function idFormatValidator() {\n        return {\n            name: 'idFormat',\n            message: qtiIdentifier.invalidQtiIdMessage,\n            validate: function (value, callback) {\n                if (typeof callback === 'function') {\n                    callback(qtiIdPattern.test(value));\n                }\n            }\n        };\n    }\n\n    /**\n     * Gives you a validator that check QTI id format of the test (it is different from the others...)\n     * @returns {Object} the validator\n     */\n    function testidFormatValidator() {\n        const qtiTestIdPattern = /^\\S+$/;\n        return {\n            name: 'testIdFormat',\n            message: __('is not a valid identifier (everything except spaces)'),\n            validate: function (value, callback) {\n                if (typeof callback === 'function') {\n                    callback(qtiTestIdPattern.test(value));\n                }\n            }\n        };\n    }\n\n    /**\n     * Gives you a validator that check if a QTI id is available\n     * @param {Object} modelOverseer - let's you get the data model\n     * @returns {Object} the validator\n     */\n    function idAvailableValidator(modelOverseer) {\n        return {\n            name: 'testIdAvailable',\n            message: __('is already used in the test.'),\n            validate: function (value, callback, options) {\n                if (options.identifier) {\n                    const key = value.toUpperCase();\n                    const identifiers = extractIdentifiers(modelOverseer.getModel(), qtiTypesForUniqueIds);\n                    // jQuesy selector for Id with dots don't work\n                    // dots are allowed for id by default see taoQtiItem/qtiCreator/widgets/helpers/qtiIdentifier\n                    // need to use attr\n                    const $idInUI = $(`[id=\"props-${options.identifier}\"]:contains(\"${value}\")`);\n                    if (typeof callback === 'function') {\n                        const counts = _.countBy(identifiers, 'identifier');\n                        //the identifier list contains itself after change on input\n                        //on keyup $idInUI.length === 0\n                        //on change and blur $idInUI.length === 1 and text equal value\n                        callback(\n                            typeof counts[key] === 'undefined' ||\n                            $idInUI.length === 1 && $idInUI.text() === value && counts[key] === 1\n                        );\n                    }\n                } else {\n                    throw new Error('missing required option \"identifier\"');\n                }\n            }\n        };\n    }\n\n    /**\n     * Gives you a validator that check if a QTI id is available\n     * @param {Object} modelOverseer - let's you get the data model\n     */\n    function registerValidators(modelOverseer) {\n        //register validators\n        validators.register('idFormat', idFormatValidator());\n        validators.register('testIdFormat', testidFormatValidator());\n        validators.register('testIdAvailable', idAvailableValidator(modelOverseer), true);\n    }\n\n    /**\n     * Validates the provided model\n     * @param {Object} model\n     * @throws {Error} if the model is not valid\n     */\n    function validateModel(model) {\n        const identifiers = extractIdentifiers(model, qtiTypesForUniqueIds);\n        let nonUniqueIdentifiers = 0;\n        const outcomes = _.indexBy(outcomeHelper.listOutcomes(model));\n        let messageDetails = '';\n\n        _(identifiers)\n            .countBy('identifier')\n            .forEach(function (count, id) {\n                if (count > 1) {\n                    nonUniqueIdentifiers++;\n                    messageDetails += `\\n${id}`;\n                }\n            });\n        if (nonUniqueIdentifiers >= 1) {\n            throw new Error(__('The following identifiers are not unique accross the test : %s', messageDetails));\n        }\n\n        _.forEach(model.testParts, function (testPart) {\n            _.forEach(testPart.assessmentSections, function (assessmentSection) {\n                _.forEach(assessmentSection.rubricBlocks, function (rubricBlock) {\n                    const feedbackBlock = qtiElementHelper.lookupElement(\n                        rubricBlock,\n                        'rubricBlock.div.feedbackBlock',\n                        'content'\n                    );\n                    if (feedbackBlock && !outcomes[feedbackBlock.outcomeIdentifier]) {\n                        throw new Error(\n                            __(\n                                'The outcome \"%s\" does not exist, but it is referenced by a feedback block!',\n                                feedbackBlock.outcomeIdentifier\n                            )\n                        );\n                    }\n                });\n            });\n        });\n    }\n    /**\n     * Extracts the identifiers from a QTI model\n     * @param {Object|Object[]} model - the JSON QTI model\n     * @param {String[]} [includesOnlyTypes] - list of qti-type to include, exclusively\n     * @param {String[]} [excludeTypes] - list of qti-type to exclude, it excludes the children too\n     * @returns {Object[]} a collection of identifiers (with some meta), if the id is not unique it will appear multiple times, as extracted.\n     */\n    function extractIdentifiers(model, includesOnlyTypes, excludeTypes) {\n        const identifiers = [];\n\n        const extract = function extract(element) {\n            if (element && _.has(element, 'identifier') && _.isString(element.identifier)) {\n                if (!includesOnlyTypes.length || _.contains(includesOnlyTypes, element['qti-type'])) {\n                    identifiers.push({\n                        identifier: element.identifier.toUpperCase(),\n                        originalIdentifier: element.identifier,\n                        type: element['qti-type'],\n                        label: element.title || element.identifier\n                    });\n                }\n            }\n            _.forEach(element, function (subElement) {\n                if (_.isPlainObject(subElement) || _.isArray(subElement)) {\n                    if (!excludeTypes.length || !_.contains(excludeTypes, subElement['qti-type'])) {\n                        extract(subElement);\n                    }\n                }\n            });\n        };\n\n        if (_.isPlainObject(model) || _.isArray(model)) {\n            excludeTypes = excludeTypes || [];\n            includesOnlyTypes = includesOnlyTypes || [];\n\n            extract(model);\n        }\n        return identifiers;\n    }\n\n    /**\n     * Gives you a validator that check QTI id format\n     * @param {String} value of identifier\n     * @param {Object} modelOverseer - let's you get the data model\n     * @returns {Boolean} isValid\n     */\n    function checkIfItemIdValid(value, modelOverseer) {\n        const identifiers = extractIdentifiers(modelOverseer.getModel(), qtiTypesForUniqueIds);\n        const key = value.toUpperCase();\n        const counts = _.countBy(identifiers, 'identifier');\n        return qtiIdPattern.test(value) && counts[key] === 1;\n    }\n    return {\n        qtiTypesForUniqueIds,\n        extractIdentifiers,\n        registerValidators,\n        validateModel,\n        checkIfItemIdValid\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015-2022 (original work) Open Assessment Technologies SA ;\n */\n\n/**\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/helpers/qtiTest',['jquery', 'lodash', 'taoQtiTest/controller/creator/helpers/validators'], function ($, _, validators) {\n    'use strict';\n\n    /**\n     * Utility to manage the QTI Test model\n     * @exports taoQtiTest/controller/creator/qtiTestHelper\n     */\n    const qtiTestHelper = {\n        /**\n         * Get the list of unique identifiers for the given model.\n         * @param {Object|Object[]} model - the JSON QTI model\n         * @param {String[]} [includesOnlyTypes] - list of qti-type to include, exclusively\n         * @param {String[]} [excludeTypes] - list of qti-type to exclude, it excludes the children too\n         * @returns {String[]} the list of unique identifiers\n         */\n        getIdentifiers: function getIdentifiers(model, includesOnlyTypes, excludeTypes) {\n            return _.uniq(_.pluck(validators.extractIdentifiers(model, includesOnlyTypes, excludeTypes), 'identifier'));\n        },\n\n        /**\n         * Get the list of identifiers for a given QTI type, only.\n         * @param {Object|Object[]} model - the JSON QTI model\n         * @param {String} qtiType - the type of QTI element to get the identifiers.\n         * @returns {String[]} the list of unique identifiers\n         */\n        getIdentifiersOf: function getIdentifiersOf(model, qtiType) {\n            return this.getIdentifiers(model, [qtiType]);\n        },\n\n        /**\n         * Does the value contains the type type\n         * @param {Object} value\n         * @param {string} type\n         * @returns {boolean}\n         */\n        filterQtiType: function filterQtiType(value, type) {\n            return value['qti-type'] && value['qti-type'] === type;\n        },\n\n        /**\n         * Add the 'qti-type' properties to object that miss it, using the parent key name\n         * @param {Object|Array} collection\n         * @param {string} parentType\n         */\n        addMissingQtiType: function addMissingQtiType(collection, parentType) {\n            _.forEach(collection, (value, key) => {\n                if (_.isObject(value) && !_.isArray(value) && !_.has(value, 'qti-type')) {\n                    if (_.isNumber(key)) {\n                        if (parentType) {\n                            value['qti-type'] = parentType;\n                        }\n                    } else {\n                        value['qti-type'] = key;\n                    }\n                }\n                if (_.isArray(value)) {\n                    this.addMissingQtiType(value, key.replace(/s$/, ''));\n                } else if (_.isObject(value)) {\n                    this.addMissingQtiType(value);\n                }\n            });\n        },\n\n        /**\n         * Applies consolidation rules to the model\n         * @param {Object} model\n         * @returns {Object}\n         */\n        consolidateModel: function consolidateModel(model) {\n            if (model && model.testParts && _.isArray(model.testParts)) {\n                _.forEach(model.testParts, function (testPart) {\n                    if (testPart.assessmentSections && _.isArray(testPart.assessmentSections)) {\n                        _.forEach(testPart.assessmentSections, function (assessmentSection) {\n                            //remove ordering is shuffle is false\n                            if (\n                                assessmentSection.ordering &&\n                                typeof assessmentSection.ordering.shuffle !== 'undefined' &&\n                                assessmentSection.ordering.shuffle === false\n                            ) {\n                                delete assessmentSection.ordering;\n                            }\n\n                            // clean categories (QTI identifier can't be empty string)\n                            if (assessmentSection.sectionParts && _.isArray(assessmentSection.sectionParts)) {\n                                _.forEach(assessmentSection.sectionParts, function (part) {\n                                    if (\n                                        part.categories &&\n                                        _.isArray(part.categories) &&\n                                        (part.categories.length === 0 || part.categories[0].length === 0)\n                                    ) {\n                                        part.categories = [];\n                                    }\n                                });\n                            }\n\n                            if (assessmentSection.rubricBlocks && _.isArray(assessmentSection.rubricBlocks)) {\n                                //remove rubric blocks if empty\n                                if (\n                                    assessmentSection.rubricBlocks.length === 0 ||\n                                    (assessmentSection.rubricBlocks.length === 1 &&\n                                        assessmentSection.rubricBlocks[0].content.length === 0)\n                                ) {\n                                    delete assessmentSection.rubricBlocks;\n                                } else if (assessmentSection.rubricBlocks.length > 0) {\n                                    //ensure the view attribute is present\n                                    _.forEach(assessmentSection.rubricBlocks, function (rubricBlock) {\n                                        rubricBlock.views = ['candidate'];\n                                        //change once views are supported\n                                        //if(rubricBlock && rubricBlock.content && (!rubricBlock.views || (_.isArray(rubricBlock.views) && rubricBlock.views.length === 0))){\n                                        //rubricBlock.views = ['candidate'];\n                                        //}\n                                    });\n                                }\n                            }\n                        });\n                    }\n                });\n            }\n            return model;\n        },\n        /**\n         * Get a valid and available QTI identifier for the given type\n         * @param {Object|Object[]} model - the JSON QTI model to check the existing IDs\n         * @param {String} qtiType - the type of element you want an id for\n         * @param {String} [suggestion] - the default pattern body, we use the type otherwise\n         * @returns {String} the generated identifier\n         */\n        getAvailableIdentifier: function getAvailableIdentifier(model, qtiType, suggestion) {\n            let index = 1;\n            const glue = '-';\n            let identifier;\n            let current;\n            if (_.contains(validators.qtiTypesForUniqueIds, qtiType)) {\n                current = this.getIdentifiers(model, validators.qtiTypesForUniqueIds);\n            } else {\n                current = this.getIdentifiersOf(model, qtiType);\n            }\n\n            suggestion = suggestion || qtiType;\n\n            do {\n                identifier = suggestion + glue + index++;\n            } while (\n                _.contains(current, identifier.toUpperCase()) || // identifier exist in model\n                $(`#${identifier}`).length // identifier was in model but still exist in DOM\n            );\n\n            return identifier;\n        }\n    };\n\n    return qtiTestHelper;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n */\n\n/**\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/views/itemref',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'taoQtiTest/controller/creator/views/actions',\n    'taoQtiTest/controller/creator/helpers/categorySelector',\n    'taoQtiTest/controller/creator/helpers/sectionCategory',\n    'taoQtiTest/controller/creator/helpers/qtiTest',\n    'taoQtiTest/controller/creator/helpers/featureVisibility',\n    'taoQtiTest/controller/creator/templates/index'\n], function (\n    $,\n    _,\n    __,\n    actions,\n    categorySelectorFactory,\n    sectionCategory,\n    qtiTestHelper,\n    featureVisibility,\n    templates\n) {\n    ('use strict');\n\n    /**\n     * We need to resize the itemref in case of long labels\n     */\n    var resize = _.throttle(function resize() {\n        var $refs = $('.itemrefs').first();\n        var $actions = $('.itemref .actions').first();\n        var width = $refs.innerWidth() - $actions.outerWidth();\n        $('.itemref > .title').width(width);\n    }, 100);\n\n    /**\n     * Set up an item ref: init action behaviors. Called for each one.\n     *\n     * @param {Object} creatorContext\n     * @param {Object} refModel - the data model to bind to the item ref\n     * @param {Object} sectionModel - the parent data model to inherit\n     * @param {Object} partModel - the model of the parent's test part\n     * @param {jQueryElement} $itemRef - the itemRef element to set up\n     */\n    function setUp(creatorContext, refModel, sectionModel, partModel, $itemRef) {\n        var modelOverseer = creatorContext.getModelOverseer();\n        var config = modelOverseer.getConfig() || {};\n        var $actionContainer = $('.actions', $itemRef);\n\n        // set item session control to use test part options if section level isn't set\n        if (!refModel.itemSessionControl) {\n            refModel.itemSessionControl = {};\n        }\n        _.defaults(refModel.itemSessionControl, sectionModel.itemSessionControl);\n\n        refModel.isLinear = partModel.navigationMode === 0;\n\n        //add feature visibility properties to itemRef model\n        featureVisibility.addItemRefVisibilityProps(refModel);\n\n        actions.properties($actionContainer, 'itemref', refModel, propHandler);\n        actions.move($actionContainer, 'itemrefs', 'itemref');\n\n        /**\n         * We need to resize the itemref in case of long labels\n         */\n        _.throttle(function resize() {\n            var $actions = $itemRef.find('.actions').first();\n            var width = $itemRef.innerWidth() - $actions.outerWidth();\n            $('.itemref > .title').width(width);\n        }, 100);\n\n        /**\n         * Set up the time limits behaviors :\n         *  - linear test part: display the minTime field\n         *  - linear + guided nav option : display the minTime field + the lock\n         *  - otherwise only the maxTime field\n         * @param {propView} propView - the view object\n         */\n        function timeLimitsProperty(propView) {\n            var $view = propView.getView();\n\n            //target elements\n            var $minTimeContainer = $('.mintime-container', $view);\n            var $maxTimeContainer = $('.maxtime-container', $view);\n            var $lockedTimeContainer = $('.lockedtime-container', $view);\n            var $locker = $('.locker button', $lockedTimeContainer);\n            var $durationFields = $(':text[data-duration]', $lockedTimeContainer);\n            var $minTimeField = $(':text[name=\"min-time\"]', $lockedTimeContainer);\n            var $maxTimeField = $(':text[name=\"max-time\"]', $lockedTimeContainer);\n\n            /**\n             * Sync min value to max value, trigger change to sync the component.\n             * Need to temporally remove the other handler to prevent infinite loop\n             */\n            var minToMaxHandler = _.throttle(function minToMax() {\n                $maxTimeField.off('change.sync');\n                $maxTimeField.val($minTimeField.val()).trigger('change');\n                _.defer(function () {\n                    $maxTimeField.on('change.sync', minToMaxHandler);\n                });\n            }, 200);\n\n            /**\n             * Sync max value to min value, trigger change to sync the component.\n             * Need to temporally remove the other handler to prevent infinite loop\n             */\n            var maxToMinHandler = _.throttle(function maxToMin() {\n                $minTimeField.off('change.sync');\n                $minTimeField.val($maxTimeField.val()).trigger('change');\n                _.defer(function () {\n                    $minTimeField.on('change.sync', minToMaxHandler);\n                });\n            }, 200);\n\n            /**\n             * Lock the timers\n             */\n            var lockTimers = function lockTimers() {\n                $locker\n                    .removeClass('unlocked')\n                    .addClass('locked')\n                    .attr('title', __('Unlink to use separated durations'));\n\n                //sync min to max\n                $minTimeField.val($maxTimeField.val()).trigger('change');\n\n                //keep both in sync\n                $minTimeField.on('change.sync', minToMaxHandler);\n                $maxTimeField.on('change.sync', maxToMinHandler);\n            };\n\n            /**\n             * Unlock the timers\n             */\n            var unlockTimers = function unlockTimers() {\n                $locker\n                    .removeClass('locked')\n                    .addClass('unlocked')\n                    .attr('title', __('Link durations to activate the guided navigation'));\n\n                $durationFields.off('change.sync');\n                $minTimeField.val('00:00:00').trigger('change');\n            };\n\n            /**\n             * Toggle the timelimits modes max, min + max, min + max + locked\n             */\n            var toggleTimeContainers = function toggleTimeContainers() {\n                refModel.isLinear = partModel.navigationMode === 0;\n                if (refModel.isLinear && config.guidedNavigation) {\n                    $minTimeContainer.addClass('hidden');\n                    $maxTimeContainer.addClass('hidden');\n                    $lockedTimeContainer.removeClass('hidden');\n                    if ($minTimeField.val() === $maxTimeField.val() && $maxTimeField.val() !== '00:00:00') {\n                        lockTimers();\n                    }\n                    $locker.on('click', function (e) {\n                        e.preventDefault();\n\n                        if ($locker.hasClass('locked')) {\n                            unlockTimers();\n                        } else {\n                            lockTimers();\n                        }\n                    });\n                } else if (refModel.isLinear) {\n                    $lockedTimeContainer.addClass('hidden');\n                    $minTimeContainer.removeClass('hidden');\n                    $maxTimeContainer.removeClass('hidden');\n                } else {\n                    $lockedTimeContainer.addClass('hidden');\n                    $minTimeContainer.addClass('hidden');\n                    $maxTimeContainer.removeClass('hidden');\n                }\n            };\n\n            //if the testpart changes it's navigation mode\n            modelOverseer.on('testpart-change', function () {\n                toggleTimeContainers();\n            });\n\n            toggleTimeContainers();\n\n            //check if min <= maw\n            $durationFields.on('change.check', function () {\n                if (\n                    refModel.timeLimits.minTime > 0 &&\n                    refModel.timeLimits.maxTime > 0 &&\n                    refModel.timeLimits.minTime > refModel.timeLimits.maxTime\n                ) {\n                    $minTimeField.parent('div').find('.duration-ctrl-wrapper').addClass('brd-danger');\n                } else {\n                    $minTimeField.parent('div').find('.duration-ctrl-wrapper').removeClass('brd-danger');\n                }\n            });\n        }\n\n        /**\n         * Set up the category property\n         * @private\n         * @param {jQueryElement} $view - the $view object containing the $select\n         */\n        function categoriesProperty($view) {\n            var categorySelector = categorySelectorFactory($view),\n                $categoryField = $view.find('[name=\"itemref-category\"]');\n\n            categorySelector.createForm([], 'itemRef');\n            categorySelector.updateFormState(refModel.categories);\n\n            $view.on('propopen.propview', function () {\n                categorySelector.updateFormState(refModel.categories);\n            });\n\n            categorySelector.on('category-change', function (selected) {\n                // Let the binder update the model by going through the category hidden field\n                $categoryField.val(selected.join(','));\n                $categoryField.trigger('change');\n\n                modelOverseer.trigger('category-change', selected);\n            });\n        }\n\n        /**\n         * Setup the weights properties\n         */\n        function weightsProperty(propView) {\n            var $view = propView.getView(),\n                $weightList = $view.find('[data-bind-each=\"weights\"]'),\n                weightTpl = templates.properties.itemrefweight;\n\n            $view.find('.itemref-weight-add').on('click', function (e) {\n                var defaultData = {\n                    value: 1,\n                    'qti-type': 'weight',\n                    identifier:\n                        refModel.weights.length === 0\n                            ? 'WEIGHT'\n                            : qtiTestHelper.getAvailableIdentifier(refModel, 'weight', 'WEIGHT')\n                };\n                e.preventDefault();\n\n                $weightList.append(weightTpl(defaultData));\n                refModel.weights.push(defaultData);\n                $weightList.trigger('add.internalbinder'); // trigger model update\n\n                $view.groupValidator();\n            });\n        }\n\n        /**\n         * Perform some binding once the property view is create\n         * @private\n         * @param {propView} propView - the view object\n         */\n        function propHandler(propView) {\n            const removePropHandler = function removePropHandler(e, $deletedNode) {\n                const validIds = [\n                    $itemRef.attr('id'),\n                    $itemRef.parents('.section').attr('id'),\n                    $itemRef.parents('.testpart').attr('id')\n                ];\n                const deletedNodeId = $deletedNode.attr('id');\n\n                if (propView !== null && validIds.includes(deletedNodeId)) {\n                    propView.destroy();\n                }\n            };\n\n            categoriesProperty(propView.getView());\n            weightsProperty(propView);\n            timeLimitsProperty(propView);\n\n            $itemRef.parents('.testparts').on('deleted.deleter', removePropHandler);\n        }\n    }\n\n    /**\n     * Listen for state changes to enable/disable . Called globally.\n     */\n    function listenActionState() {\n        $('.itemrefs').each(function () {\n            actions.movable($('.itemref', $(this)), 'itemref', '.actions');\n        });\n\n        $(document)\n            .on('delete', function (e) {\n                var $parent;\n                var $target = $(e.target);\n                if ($target.hasClass('itemref')) {\n                    $parent = $target.parents('.itemrefs');\n                }\n            })\n            .on('add change undo.deleter deleted.deleter', '.itemrefs', function (e) {\n                var $parent;\n                var $target = $(e.target);\n                if ($target.hasClass('itemref') || $target.hasClass('itemrefs')) {\n                    $parent = $('.itemref', $target.hasClass('itemrefs') ? $target : $target.parents('.itemrefs'));\n                    actions.enable($parent, '.actions');\n                    actions.movable($parent, 'itemref', '.actions');\n                }\n            });\n    }\n\n    /**\n     * The itemrefView setup itemref related components and behavior\n     *\n     * @exports taoQtiTest/controller/creator/views/itemref\n     */\n    return {\n        setUp: setUp,\n        listenActionState: listenActionState\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n */\n\n/**\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/encoders/dom2qti',[\n    'jquery',\n    'lodash',\n    'taoQtiTest/controller/creator/helpers/qtiElement',\n    'taoQtiTest/controller/creator/helpers/baseType',\n    'lib/dompurify/purify'\n], function ($, _, qtiElementHelper, baseType, DOMPurify) {\n    'use strict';\n\n    /**\n     * A mapping of QTI-XML node and attributes names in order to keep the camel case form\n     * @type {Object}\n     */\n    const normalizedNodes = {\n        feedbackblock: 'feedbackBlock',\n        outcomeidentifier: 'outcomeIdentifier',\n        showhide: 'showHide',\n        printedvariable: 'printedVariable',\n        powerform: 'powerForm',\n        mappingindicator: 'mappingIndicator'\n    };\n\n    /**\n     * Some Nodes have attributes that needs typing during decoding.\n     * @type {Object}\n     */\n    const typedAttributes = {\n        printedVariable: {\n            identifier:       baseType.getConstantByName('identifier'),\n            powerForm:        baseType.getConstantByName('boolean'),\n            base:             baseType.getConstantByName('intOrIdentifier'),\n            index:            baseType.getConstantByName('intOrIdentifier'),\n            delimiter:        baseType.getConstantByName('string'),\n            field:            baseType.getConstantByName('string'),\n            mappingIndicator: baseType.getConstantByName('string')\n        }\n    };\n\n    /**\n     * Get the list of objects attributes to encode\n     * @param {Object} object\n     * @returns {Array}\n     */\n    function getAttributes(object) {\n        return _.omit(object, [\n            'qti-type',\n            'content',\n            'xmlBase',\n            'lang',\n            'label'\n        ]);\n    }\n\n    /**\n     * Encode object's properties to xml/html string attributes\n     * @param {Object} attributes\n     * @returns {String}\n     */\n    function attrToStr(attributes) {\n        return _.reduce(attributes, function (acc, value, key) {\n            if (_.isNumber(value) || _.isBoolean(value) || (_.isString(value) && !_.isEmpty(value))) {\n                return acc + ' ' + key + '=\"' + value + '\" ';\n            }\n            return acc;\n        }, '');\n    }\n\n    /**\n     * Ensures the nodeName has a normalized form:\n     * - standard HTML tags are in lower case\n     * - QTI-XML tags are in the right form\n     * @param {String} nodeName\n     * @returns {String}\n     */\n    function normalizeNodeName(nodeName) {\n        const normalized = (nodeName) ? nodeName.toLocaleLowerCase() : '';\n        return normalizedNodes[normalized] || normalized;\n    }\n\n    /**\n     * This encoder is used to transform DOM to JSON QTI and JSON QTI to DOM.\n     * It works now for the rubricBlocks components.\n     * @exports creator/encoders/dom2qti\n     */\n    return {\n\n        /**\n         * Encode an object to a dom string\n         * @param {Object} modelValue\n         * @returns {String}\n         */\n        encode: function (modelValue) {\n            let self = this,\n                startTag;\n\n            if (_.isArray(modelValue)) {\n                return _.reduce(modelValue, function (result, value) {\n                    return result + self.encode(value);\n                }, '');\n            } else if (_.isObject(modelValue) && modelValue['qti-type']) {\n                if (modelValue['qti-type'] === 'textRun') {\n                    return modelValue.content;\n                }\n                startTag = '<' + modelValue['qti-type'] + attrToStr(getAttributes(modelValue));\n                if (modelValue.content) {\n                    return startTag + '>' + self.encode(modelValue.content) + '</' + modelValue['qti-type'] + '>';\n                } else {\n                    return startTag + '/>';\n                }\n            }\n            return '' + modelValue;\n        },\n\n        /**\n         * Decode a string that represents a DOM to a QTI formatted object\n         * @param {String} nodeValue\n         * @returns {Array}\n         */\n        decode: function (nodeValue) {\n            const self = this;\n            const $nodeValue = (nodeValue instanceof $) ? nodeValue : $(nodeValue);\n            const result = [];\n            let nodeName;\n\n            _.forEach($nodeValue, function (elt) {\n                let object;\n                if (elt.nodeType === 3) {\n                    if (!_.isEmpty($.trim(elt.nodeValue))) {\n                        result.push(qtiElementHelper.create('textRun', {\n                            'content': DOMPurify.sanitize(elt.nodeValue),\n                            'xmlBase': ''\n                        }));\n                    }\n                } else if (elt.nodeType === 1) {\n                    nodeName = normalizeNodeName(elt.nodeName);\n\n                    object = _.merge(qtiElementHelper.create(nodeName, {\n                            'id': '',\n                            'class': '',\n                            'xmlBase': '',\n                            'lang': '',\n                            'label': ''\n                        }),\n                        _.transform(elt.attributes, function (acc, value) {\n                            const attrName = normalizeNodeName(value.nodeName);\n                            if (attrName) {\n                                if (typedAttributes[nodeName] && typedAttributes[nodeName][attrName]) {\n                                    acc[attrName] = baseType.getValue(typedAttributes[nodeName][attrName], value.nodeValue);\n                                } else {\n                                    acc[attrName] = value.nodeValue;\n                                }\n                            }\n                        }));\n                    if (elt.childNodes.length > 0) {\n                        object.content = self.decode(elt.childNodes);\n                    }\n                    result.push(object);\n                }\n            });\n            return result;\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA;\n */\n/**\n * Instanciate a Wysiwyg editor to create QTI content.\n *\n * @author Christophe Noël <christophe@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/qtiContentCreator',[\n    'lodash',\n    'jquery',\n    'lib/uuid',\n    'taoQtiItem/qtiCreator/helper/commonRenderer',\n    'taoQtiItem/qtiCreator/editor/containerEditor'\n], function(_, $, uuid, qtiCommonRenderer, containerEditor) {\n    'use strict';\n\n    return {\n        create: function create(creatorContext, $container, options) {\n            var self = this,\n                editorId = uuid(),\n                areaBroker = creatorContext.getAreaBroker(),\n                modelOverseer = creatorContext.getModelOverseer();\n\n            var removePlugins = [\n                    'magicline',\n                    'taoqtiimage',\n                    'taoqtimedia',\n                    'taoqtimaths',\n                    'taoqtiinclude',\n                    'taoqtitable',\n                    'sharedspace' // That Ck instance still use floatingspace to position the toolbar, whereas the sharedspace plugin is used by the Item creator\n                ].join(','),\n\n                toolbar = [\n                    {\n                        name : 'basicstyles',\n                        items : ['Bold', 'Italic', 'Subscript', 'Superscript']\n                    }, {\n                        name : 'insert',\n                        items : ['SpecialChar', 'TaoQtiPrintedVariable']\n                    }, {\n                        name : 'links',\n                        items : ['Link']\n                    },\n                    '/',\n                    {\n                        name : 'styles',\n                        items : ['Format']\n                    }, {\n                        name : 'paragraph',\n                        items : ['NumberedList', 'BulletedList', '-', 'Blockquote', 'JustifyLeft', 'JustifyCenter', 'JustifyRight', 'JustifyBlock']\n                    }\n                ];\n\n            qtiCommonRenderer.setContext(areaBroker.getContentCreatorPanelArea());\n\n            containerEditor.create($container, {\n                areaBroker: areaBroker,\n                removePlugins: removePlugins,\n                toolbar: toolbar,\n                metadata: {\n                    getOutcomes: function getOutcomes() {\n                        return modelOverseer.getOutcomesNames();\n                    }\n                },\n                change: options.change || _.noop,\n                resetRenderer: true,\n                autofocus: false\n            });\n\n            // destroying ckInstance on editor close\n            creatorContext.on('creatorclose.' + editorId, function() {\n                self.destroy(creatorContext, $container);\n            });\n\n            $container.data('editorId', editorId);\n        },\n\n        /**\n         * @returns {Promise} - when editor is destroyed\n         */\n        destroy: function destroy(creatorContext, $container) {\n            var editorId = $container.data('editorId');\n            if (editorId) {\n                creatorContext.off('.' + editorId);\n            }\n            return containerEditor.destroy($container);\n        }\n    };\n});\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n */\n\n/**\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/views/rubricblock',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'ui/hider',\n    'ui/dialog/alert',\n    'util/namespace',\n    'taoQtiTest/controller/creator/views/actions',\n    'helpers',\n    'taoQtiTest/controller/creator/encoders/dom2qti',\n    'taoQtiTest/controller/creator/helpers/qtiElement',\n    'taoQtiTest/controller/creator/qtiContentCreator',\n    'ckeditor',\n], function ($, _, __, hider, dialogAlert, namespaceHelper, actions, helpers, Dom2QtiEncoder, qtiElementHelper, qtiContentCreator) {\n    'use strict';\n\n    /**\n     * The rubriclockView setup RB related components and behavior\n     *\n     * @exports taoQtiTest/controller/creator/views/rubricblock\n     */\n    return {\n        /**\n         * Set up a rubric block: init action behaviors. Called for each one.\n         *\n         * @param {Object} creatorContext\n         * @param {Object} rubricModel - the rubric block data\n         * @param {jQueryElement} $rubricBlock - the rubric block to set up\n         */\n        setUp: function setUp(creatorContext, rubricModel, $rubricBlock) {\n            var modelOverseer = creatorContext.getModelOverseer();\n            var areaBroker = creatorContext.getAreaBroker();\n            var $rubricBlockContent = $('.rubricblock-content', $rubricBlock);\n\n            /**\n             * Bind a listener only related to this rubric.\n             * @param {jQuery} $el\n             * @param {String} eventName\n             * @param {Function} cb\n             * @returns {jQuery}\n             */\n            function bindEvent($el, eventName, cb) {\n                eventName = namespaceHelper.namespaceAll(eventName, rubricModel.uid);\n                return $el.off(eventName).on(eventName, cb);\n            }\n\n            /**\n             * Ensures an html content is wrapped by a container tag.\n             * @param {String} html\n             * @returns {String}\n             */\n            function ensureWrap(html) {\n                html = (html || '').trim();\n                if (html.charAt(0) !== '<' || html.charAt(html.length - 1) !== '>') {\n                    html = '<div>' + html + '</div>';\n                }\n                if ($(html).length > 1) {\n                    html = '<div>' + html + '</div>';\n                }\n                return html;\n            }\n\n            /**\n             * Forwards the editor content into the model\n             */\n            function editorToModel(html) {\n                var rubric = qtiElementHelper.lookupElement(rubricModel, 'rubricBlock', 'content');\n                var wrapper = qtiElementHelper.lookupElement(rubricModel, 'rubricBlock.div.feedbackBlock', 'content');\n                var content = Dom2QtiEncoder.decode(ensureWrap(html));\n\n                if (wrapper) {\n                    wrapper.content = content;\n                } else {\n                    rubric.content = content;\n                }\n            }\n\n            /**\n             * Forwards the model content into the editor\n             */\n            function modelToEditor() {\n                var rubric = qtiElementHelper.lookupElement(rubricModel, 'rubricBlock', 'content') || {};\n                var wrapper = qtiElementHelper.lookupElement(rubricModel, 'rubricBlock.div.feedbackBlock', 'content');\n                var content = wrapper ? wrapper.content : rubric.content;\n                var html = ensureWrap(Dom2QtiEncoder.encode(content));\n\n                // Destroy any existing CKEditor instance\n                qtiContentCreator.destroy(creatorContext, $rubricBlockContent).then(function() {\n                    // update the editor content\n                    $rubricBlockContent.html(html);\n\n                    // Re-create the Qti-ckEditor instance\n                    qtiContentCreator.create(creatorContext, $rubricBlockContent, {\n                        change: function change(editorContent) {\n                            editorToModel(editorContent);\n                        }\n                    });\n                });\n            }\n\n            /**\n             * Wrap/unwrap the rubric block in a feedback according to the user selection\n             * @param {Object} feedback\n             * @returns {Boolean}\n             */\n            function updateFeedback(feedback) {\n                var activated = feedback && feedback.activated;\n                var wrapper = qtiElementHelper.lookupElement(rubricModel, 'rubricBlock.div.feedbackBlock', 'content');\n\n                if (activated) {\n                    // wrap the actual content into a feedbackBlock if needed\n                    if (!wrapper) {\n                        rubricModel.content = [qtiElementHelper.create('div', {\n                            content: [qtiElementHelper.create('feedbackBlock', {\n                                outcomeIdentifier: feedback.outcome,\n                                identifier: feedback.matchValue,\n                                content: rubricModel.content\n                            })]\n                        })];\n                    } else {\n                        wrapper.outcomeIdentifier = feedback.outcome;\n                        wrapper.identifier = feedback.matchValue;\n                    }\n                    modelToEditor();\n                } else {\n                    // remove the feedbackBlock wrapper, just keep the actual content\n                    if (wrapper) {\n                        rubricModel.content = wrapper.content;\n                        modelToEditor();\n                    }\n                }\n\n                return activated;\n            }\n\n            /**\n             * Perform some binding once the property view is created\n             * @private\n             * @param {propView} propView - the view object\n             */\n            function propHandler(propView) {\n                var $view = propView.getView();\n                var $feedbackOutcomeLine = $('.rubric-feedback-outcome', $view);\n                var $feedbackMatchLine = $('.rubric-feedback-match-value', $view);\n                var $feedbackOutcome = $('[name=feedback-outcome]', $view);\n                var $feedbackActivated = $('[name=activated]', $view);\n\n                // toggle the feedback panel\n                function changeFeedback(activated) {\n                    hider.toggle($feedbackOutcomeLine, activated);\n                    hider.toggle($feedbackMatchLine, activated);\n                }\n\n                // should be called when the properties panel is removed\n                function removePropHandler() {\n                    rubricModel.feedback = {};\n                    if (propView !== null) {\n                        propView.destroy();\n                    }\n                }\n\n                // take care of changes in the properties view\n                function changeHandler(e, changedModel) {\n                    if (e.namespace === 'binder' && changedModel['qti-type'] === 'rubricBlock') {\n                        changeFeedback(updateFeedback(changedModel.feedback));\n                    }\n                }\n\n                // update the list of outcomes the feedback can target\n                function updateOutcomes() {\n                    var activated = rubricModel.feedback && rubricModel.feedback.activated;\n                    // build the list of outcomes in a way select2 can understand\n                    var outcomes = _.map(modelOverseer.getOutcomesNames(), function(name) {\n                        return {\n                            id: name,\n                            text: name\n                        };\n                    });\n\n                    // create/update the select field\n                    $feedbackOutcome.select2({\n                        minimumResultsForSearch: -1,\n                        width: '100%',\n                        data: outcomes\n                    });\n\n                    // update the UI to reflect the data\n                    if (!activated) {\n                        $feedbackActivated.prop('checked', false);\n                    }\n                    changeFeedback(activated);\n                }\n\n                $('[name=type]', $view).select2({\n                    minimumResultsForSearch: -1,\n                    width: '100%'\n                });\n\n                $view.on('change.binder', changeHandler);\n                bindEvent($rubricBlock.parents('.testpart'), 'delete', removePropHandler);\n                bindEvent($rubricBlock.parents('.section'), 'delete', removePropHandler);\n                bindEvent($rubricBlock, 'delete', removePropHandler);\n                bindEvent($rubricBlock, 'outcome-removed', function() {\n                    $feedbackOutcome.val('');\n                    updateOutcomes();\n                });\n                bindEvent($rubricBlock, 'outcome-updated', function() {\n                    updateFeedback(rubricModel.feedback);\n                    updateOutcomes();\n                });\n\n                changeFeedback(rubricModel.feedback);\n                updateOutcomes();\n                rbViews($view);\n            }\n\n            /**\n             * Set up the views select box\n             * @private\n             * @param {jQueryElement} $propContainer - the element container\n             */\n            function rbViews($propContainer) {\n                var $select = $('[name=view]', $propContainer);\n\n                bindEvent($select.select2({'width': '100%'}), \"select2-removed\", function () {\n                    if ($select.select2('val').length === 0) {\n                        $select.select2('val', [1]);\n                    }\n                });\n\n                if ($select.select2('val').length === 0) {\n                    $select.select2('val', [1]);\n                }\n            }\n\n            rubricModel.orderIndex = (rubricModel.index || 0) + 1;\n            rubricModel.uid = _.uniqueId('rb');\n            rubricModel.feedback = {\n                activated: !!qtiElementHelper.lookupElement(rubricModel, 'rubricBlock.div.feedbackBlock', 'content'),\n                outcome: qtiElementHelper.lookupProperty(rubricModel, 'rubricBlock.div.feedbackBlock.outcomeIdentifier', 'content'),\n                matchValue: qtiElementHelper.lookupProperty(rubricModel, 'rubricBlock.div.feedbackBlock.identifier', 'content')\n            };\n\n            modelOverseer\n                .before('scoring-write.' + rubricModel.uid, function() {\n                    var feedbackOutcome = rubricModel.feedback && rubricModel.feedback.outcome;\n                    if (feedbackOutcome && _.indexOf(modelOverseer.getOutcomesNames(), feedbackOutcome) < 0) {\n                        // the targeted outcome has been removed, so remove the feedback\n                        modelOverseer.changedRubricBlock = (modelOverseer.changedRubricBlock || 0) + 1;\n                        rubricModel.feedback.activated = false;\n                        rubricModel.feedback.outcome = '';\n                        updateFeedback(rubricModel.feedback);\n                        $rubricBlock.trigger('outcome-removed');\n                    } else {\n                        // the tageted outcome is still here, just notify the properties panel to update the list\n                        $rubricBlock.trigger('outcome-updated');\n                    }\n                })\n                .on('scoring-write.' + rubricModel.uid, function() {\n                    // will notify the user of any removed feedbacks\n                    if (modelOverseer.changedRubricBlock) {\n                        /** @todo: provide a way to cancel changes */\n                        dialogAlert(__('Some rubric blocks have been updated to reflect the changes in the list of outcomes.'));\n                        modelOverseer.changedRubricBlock = 0;\n                    }\n                });\n\n            actions.properties($rubricBlock, 'rubricblock', rubricModel, propHandler);\n\n            modelToEditor();\n\n            // destroy CK instance on rubric bloc deletion.\n            // todo: find a way to destroy CK upon destroying rubric bloc parent section/part\n            bindEvent($rubricBlock, 'delete', function() {\n                qtiContentCreator.destroy(creatorContext, $rubricBlockContent);\n            });\n\n            $rubricBlockContent.on('editorfocus', function() {\n                // close all properties forms and turn off their related button\n                areaBroker.getPropertyPanelArea().children('.props').hide().trigger('propclose.propview');\n            });\n\n            //change position of CKeditor toolbar on scroll\n            areaBroker.getContentCreatorPanelArea().find('.test-content').on('scroll', function () {\n                CKEDITOR.document.getWindow().fire('scroll');\n            });\n        }\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2022 (original work) Open Assessment Technologies SA ;\n */\n\n/**\n * Helper for iterating on nested collections within a test model.\n * It's recommended to use a validator on the model before calling these functions.\n *\n * @example\nconst testModel = {\n    'qti-type': 'test',\n    testParts: [{\n        'qti-type': 'testPart',\n        identifier: 'testPart-1',\n        assessmentSections: [{\n            'qti-type': 'assessmentSection',\n            identifier: 'assessmentSection-1',\n            sectionParts: [{\n                'qti-type': 'assessmentSection',\n                identifier: 'subsection-1',\n                sectionParts: [{\n                    'qti-type': 'assessmentItemRef',\n                    identifier: 'item-1',\n                    categories: ['math', 'history']\n                }]\n            }]\n        }]\n    }]\n};\neachItemInTest(testModel, itemRef => {\n    console.log(itemRef.categories);\n});\n */\ndefine('taoQtiTest/controller/creator/helpers/testModel',[\n    'lodash',\n    'core/errorHandler'\n], function (_, errorHandler) {\n    'use strict';\n\n    const _ns = '.testModel';\n\n    /**\n     * Calls a function for each itemRef in the test model. Handles nested subsections.\n     * @param {Object} testModel\n     * @param {Function} cb - takes itemRef as only param\n     */\n    function eachItemInTest(testModel, cb) {\n        _.forEach(testModel.testParts, testPartModel => {\n            eachItemInTestPart(testPartModel, cb);\n        });\n    }\n\n    /**\n     * Calls a function for each itemRef in the testPart model. Handles nested subsections.\n     * @param {Object} testPartModel\n     * @param {Function} cb - takes itemRef as only param\n     */\n    function eachItemInTestPart(testPartModel, cb) {\n        _.forEach(testPartModel.assessmentSections, sectionModel => {\n            eachItemInSection(sectionModel, cb);\n        });\n    }\n\n    /**\n     * Calls a function for each itemRef in the section model. Handles nested subsections.\n     * @param {Object} sectionModel\n     * @param {Function} cb - takes itemRef as only param\n     */\n    function eachItemInSection(sectionModel, cb) {\n        _.forEach(sectionModel.sectionParts, sectionPartModel => {\n            // could be item, could be subsection\n            if (sectionPartModel['qti-type'] === 'assessmentSection') {\n                // recursion to handle any amount of subsection levels\n                eachItemInSection(sectionPartModel, cb);\n            } else if (sectionPartModel['qti-type'] === 'assessmentItemRef') {\n                const itemRef = sectionPartModel;\n                if (typeof cb === 'function') {\n                    cb(itemRef);\n                } else {\n                    errorHandler.throw(_ns, 'cb must be a function');\n                }\n            }\n        });\n    }\n\n    return {\n        eachItemInTest,\n        eachItemInTestPart,\n        eachItemInSection\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2022 (original work) Open Assessment Technologies SA;\n */\ndefine('taoQtiTest/controller/creator/helpers/testPartCategory',[\n    'lodash',\n    'i18n',\n    'taoQtiTest/controller/creator/helpers/sectionCategory',\n    'taoQtiTest/controller/creator/helpers/testModel',\n    'core/errorHandler'\n], function(_, __, sectionCategory, testModelHelper, errorHandler) {\n    'use strict';\n\n    const _ns = '.testPartCategory';\n\n    /**\n     * Check if the given object is a valid testPart model object\n     *\n     * @param {object} model\n     * @returns {boolean}\n     */\n    function isValidTestPartModel(model) {\n        return _.isObject(model)\n            && model['qti-type'] === 'testPart'\n            && _.isArray(model.assessmentSections)\n            && model.assessmentSections.every(section => sectionCategory.isValidSectionModel(section));\n    }\n\n    /**\n     * Set an array of categories to the testPart model (affects the children itemRef, and after propagation, the section models)\n     *\n     * @param {object} model\n     * @param {array} selected - all categories active for the whole testPart\n     * @param {array} partial - only categories in an indeterminate state\n     * @returns {undefined}\n     */\n    function setCategories(model, selected, partial = []) {\n\n        const currentCategories = getCategories(model);\n\n        // partial = partial || [];\n\n        //the categories that are no longer in the new list of categories should be removed\n        const toRemove = _.difference(currentCategories.all, selected.concat(partial));\n\n        //the categories that are not in the current categories collection should be added to the children\n        const toAdd = _.difference(selected, currentCategories.propagated);\n\n        model.categories = _.difference(model.categories, toRemove);\n        model.categories = model.categories.concat(toAdd);\n\n        //process the modification\n        addCategories(model, toAdd);\n        removeCategories(model, toRemove);\n    }\n\n    /**\n     * @typedef {object} CategoriesSummary\n     * @property {string[]} all - array of all categories of itemRef descendents\n     * @property {string[]} propagated - array of categories propagated to every itemRef descendent\n     * @property {string[]} partial - array of categories propagated to a partial set of itemRef descendents\n     */\n\n    /**\n     * Get the categories assigned to the testPart model, inferred by its internal itemRefs\n     *\n     * @param {object} model\n     * @returns {CategoriesSummary}\n     */\n    function getCategories(model) {\n        if (!isValidTestPartModel(model)) {\n            return errorHandler.throw(_ns, 'invalid tool config format');\n        }\n\n        let itemCount = 0;\n\n        /**\n         * List of lists of categories of each itemRef in the testPart\n         * @type {string[][]}\n         */\n        const itemRefCategories = [];\n        testModelHelper.eachItemInTestPart(model, itemRef => {\n            if (++itemCount && _.isArray(itemRef.categories)) {\n                itemRefCategories.push(_.compact(itemRef.categories));\n            }\n        });\n\n        if (!itemCount) {\n            return createCategories(model.categories, model.categories);\n        }\n\n        //all item categories\n        const union = _.union.apply(null, itemRefCategories);\n        //categories that are common to all itemRefs\n        const propagated = _.intersection.apply(null, itemRefCategories);\n        //the categories that are only partially covered on the section level : complementary of \"propagated\"\n        const partial = _.difference(union, propagated);\n\n        return createCategories(union, propagated, partial);\n    }\n\n    /**\n     * Add an array of categories to a testPart model (affects the children itemRef, and after propagation, the section models)\n     *\n     * @param {object} model\n     * @param {array} categories\n     * @returns {undefined}\n     */\n    function addCategories(model, categories) {\n        if (isValidTestPartModel(model)) {\n            testModelHelper.eachItemInTestPart(model, itemRef => {\n                if (!_.isArray(itemRef.categories)) {\n                    itemRef.categories = [];\n                }\n                itemRef.categories = _.union(itemRef.categories, categories);\n            });\n        } else {\n            errorHandler.throw(_ns, 'invalid tool config format');\n        }\n    }\n\n    /**\n     * Remove an array of categories from a testPart model (affects the children itemRef, and after propagation, the section models)\n     *\n     * @param {object} model\n     * @param {array} categories\n     * @returns {undefined}\n     */\n    function removeCategories(model, categories) {\n        if (isValidTestPartModel(model)) {\n            testModelHelper.eachItemInTestPart(model, itemRef => {\n                if (_.isArray(itemRef.categories)) {\n                    itemRef.categories = _.difference(itemRef.categories, categories);\n                }\n            });\n        } else {\n            errorHandler.throw(_ns, 'invalid tool config format');\n        }\n    }\n\n    /**\n     * Assigns input category arrays to output object, while sorting each one\n     * @param {string[]} all\n     * @param {string[]} propagated\n     * @param {string[]} partial\n     * @returns {CategoriesSummary}\n     */\n    function createCategories(all = [], propagated = [], partial = []) {\n        return _.mapValues({\n            all: all,\n            propagated: propagated,\n            partial: partial\n        }, function(categories) {\n            return categories.sort();\n        });\n    }\n\n    return {\n        isValidTestPartModel : isValidTestPartModel,\n        setCategories : setCategories,\n        getCategories : getCategories,\n        addCategories : addCategories,\n        removeCategories : removeCategories\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2016 (original work) Open Assessment Technologies SA;\n */\ndefine('taoQtiTest/controller/creator/helpers/sectionBlueprints',[\n    'lodash',\n    'i18n',\n    'core/errorHandler'\n], function (_, __, errorHandler){\n\n    'use strict';\n\n    var _ns = '.sectionBlueprint';\n\n\n    /**\n     * Set an array of categories to the section model (affect the childen itemRef)\n     *\n     * @param {object} model\n     * @param {string} blueprint\n     * @returns {undefined}\n     */\n    function setBlueprint(model, blueprint){\n        model.blueprint = blueprint;\n    }\n\n    /**\n     * Get the categories assign to the section model, infered by its interal itemRefs\n     *\n     * @param {string} getUrl\n     * @param {object} model\n     * @returns {object}\n     */\n    function getBlueprint(getUrl, model){\n\n        return $.ajax({\n            url: getUrl,\n            type: 'GET',\n            data: {\n                section: model.identifier\n            },\n            dataType: 'json'\n\n        })\n        .fail(function () {\n            errorHandler.throw(_ns, 'invalid tool config format');\n        });\n\n    }\n\n    return {\n        setBlueprint : setBlueprint,\n        getBlueprint : getBlueprint\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2021-2022 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n */\n\ndefine('taoQtiTest/controller/creator/views/subsection',[\n    'jquery',\n    'lodash',\n    'uri',\n    'i18n',\n    'taoQtiTest/controller/creator/config/defaults',\n    'taoQtiTest/controller/creator/views/actions',\n    'taoQtiTest/controller/creator/views/itemref',\n    'taoQtiTest/controller/creator/views/rubricblock',\n    'taoQtiTest/controller/creator/templates/index',\n    'taoQtiTest/controller/creator/helpers/qtiTest',\n    'taoQtiTest/controller/creator/helpers/categorySelector',\n    'taoQtiTest/controller/creator/helpers/sectionCategory',\n    'taoQtiTest/controller/creator/helpers/sectionBlueprints',\n    'ui/dialog/confirm',\n    'taoQtiTest/controller/creator/helpers/subsection',\n    'taoQtiTest/controller/creator/helpers/validators'\n], function (\n    $,\n    _,\n    uri,\n    __,\n    defaults,\n    actions,\n    itemRefView,\n    rubricBlockView,\n    templates,\n    qtiTestHelper,\n    categorySelectorFactory,\n    sectionCategory,\n    sectionBlueprint,\n    confirmDialog,\n    subsectionsHelper,\n    validators\n) {\n    'use strict';\n    /**\n     * Set up a section: init action behaviors. Called for each section.\n     *\n     * @param {Object} creatorContext\n     * @param {Object} subsectionModel - the data model to bind to the test section\n     * @param {Object} sectionModel - the parent data model to inherit\n     * @param {jQuery} $subsection - the subsection to set up\n     */\n    function setUp(creatorContext, subsectionModel, sectionModel, $subsection) {\n        // select elements for subsection, to avoid selecting the same elements in nested subsections\n        const $itemRefsWrapper = $subsection.children('.itemrefs-wrapper');\n        const $rubBlocks = $subsection.children('.rublocks');\n        const $titleWithActions = $subsection.children('h2');\n\n        const modelOverseer = creatorContext.getModelOverseer();\n        const config = modelOverseer.getConfig();\n\n        // set item session control to use test part options if section level isn't set\n        if (!subsectionModel.itemSessionControl) {\n            subsectionModel.itemSessionControl = {};\n        }\n        if (!subsectionModel.categories) {\n            subsectionModel.categories = defaults().categories;\n        }\n        _.defaults(subsectionModel.itemSessionControl, sectionModel.itemSessionControl);\n\n        if (!_.isEmpty(config.routes.blueprintsById)) {\n            subsectionModel.hasBlueprint = true;\n        }\n        actions.properties($titleWithActions, 'section', subsectionModel, propHandler);\n        actions.move($titleWithActions, 'subsections', 'subsection');\n        actions.displayItemWrapper($subsection);\n        actions.updateDeleteSelector($titleWithActions);\n\n        subsections();\n        itemRefs();\n        acceptItemRefs();\n        rubricBlocks();\n        addRubricBlock();\n\n        if (subsectionsHelper.isNestedSubsection($subsection)) {\n            // prevent adding a third subsection level\n            $('.add-subsection', $subsection).hide();\n            $('.add-subsection + .tlb-separator', $subsection).hide();\n        } else {\n            addSubsection();\n        }\n\n        /**\n         * Perform some binding once the property view is create\n         * @param {propView} propView - the view object\n         */\n        function propHandler(propView) {\n            const $view = propView.getView();\n\n            //enable/disable selection\n            const $selectionSwitcher = $('[name=section-enable-selection]', $view);\n            const $selectionSelect = $('[name=section-select]', $view);\n            const $selectionWithRep = $('[name=section-with-replacement]', $view);\n\n            // subsectionModel.selection will be filled by binded values from template section-props.tpl\n            // if subsectionModel.selection from server response it has 'qti-type'\n            const isSelectionFromServer = !!(subsectionModel.selection && subsectionModel.selection['qti-type']);\n\n            const switchSelection = function switchSelection() {\n                if ($selectionSwitcher.prop('checked') === true) {\n                    $selectionSelect.incrementer('enable');\n                    $selectionWithRep.removeClass('disabled');\n                } else {\n                    $selectionSelect.incrementer('disable');\n                    $selectionWithRep.addClass('disabled');\n                }\n            };\n            $selectionSwitcher.on('change', switchSelection);\n            $selectionSwitcher.on('change', function updateModel() {\n                if (!$selectionSwitcher.prop('checked')) {\n                    $selectionSelect.val(0);\n                    $selectionWithRep.prop('checked', false);\n                    delete subsectionModel.selection;\n                }\n            });\n\n            $selectionSwitcher.prop('checked', isSelectionFromServer).trigger('change');\n\n            //listen for databinder change to update the test part title\n            const $title = $('[data-bind=title]', $titleWithActions);\n            $view.on('change.binder', function (e) {\n                if (e.namespace === 'binder' && subsectionModel['qti-type'] === 'assessmentSection') {\n                    $title.text(subsectionModel.title);\n                }\n            });\n\n            // deleted.deleter event fires only on the parent nodes (testparts, sections, etc)\n            // Since it \"bubles\" we can subsctibe only to the highest parent node\n            $subsection.parents('.testparts').on('deleted.deleter', removePropHandler);\n\n            //section level category configuration\n            categoriesProperty($view);\n\n            if (typeof subsectionModel.hasBlueprint !== 'undefined') {\n                blueprintProperty($view);\n            }\n\n            actions.displayCategoryPresets($subsection);\n\n            function removePropHandler(e, $deletedNode) {\n                const validIds = [$subsection.parents('.testpart').attr('id'), $subsection.attr('id')];\n\n                const deletedNodeId = $deletedNode.attr('id');\n                // We have to check id of a deleted node, because\n                // 1. Event fires after child node was deleted, but e.stopPropagation doesn't help\n                // because currentTarget is always document\n                // 2. We have to subscribe to the parent node and it's posiible that another section was removed even from another testpart\n                // Subscription to the .sections selector event won't help because sections element might contain several children.\n\n                if (propView !== null && validIds.includes(deletedNodeId)) {\n                    propView.destroy();\n                }\n            }\n        }\n        /**\n         * Set up subsections that already belongs to the section\n         * @private\n         */\n        function subsections() {\n            if (!subsectionModel.sectionParts) {\n                subsectionModel.sectionParts = [];\n            }\n\n            subsectionsHelper.getSubsections($subsection).each(function () {\n                const $sub2section = $(this);\n                const index = $sub2section.data('bind-index');\n                if (!subsectionModel.sectionParts[index]) {\n                    subsectionModel.sectionParts[index] = {};\n                }\n\n                setUp(creatorContext, subsectionModel.sectionParts[index], subsectionModel, $sub2section);\n            });\n        }\n        /**\n         * Set up the item refs that already belongs to the section\n         * @private\n         */\n        function itemRefs() {\n            if (!subsectionModel.sectionParts) {\n                subsectionModel.sectionParts = [];\n            }\n            $('.itemref', $itemRefsWrapper).each(function () {\n                const $itemRef = $(this);\n                const index = $itemRef.data('bind-index');\n                if (!subsectionModel.sectionParts[index]) {\n                    subsectionModel.sectionParts[index] = {};\n                }\n\n                itemRefView.setUp(\n                    creatorContext,\n                    subsectionModel.sectionParts[index],\n                    subsectionModel,\n                    sectionModel,\n                    $itemRef\n                );\n                $itemRef.find('.title').text(config.labels[uri.encode($itemRef.data('uri'))]);\n            });\n        }\n\n        /**\n         * Make the section to accept the selected items\n         * @private\n         * @fires modelOverseer#item-add\n         */\n        function acceptItemRefs() {\n            const $itemsPanel = $('.test-creator-items .item-selection');\n\n            //the item selector trigger a select event\n            $itemsPanel.on('itemselect.creator', function (e, selection) {\n                const $placeholder = $('.itemref-placeholder', $itemRefsWrapper);\n                const $placeholders = $('.itemref-placeholder');\n\n                if (_.size(selection) > 0) {\n                    $placeholder\n                        .show()\n                        .off('click')\n                        .on('click', function () {\n                            //prepare the item data\n                            const defaultItemData = {};\n\n                            if (\n                                subsectionModel.itemSessionControl &&\n                                !_.isUndefined(subsectionModel.itemSessionControl.maxAttempts)\n                            ) {\n                                //for a matter of consistency, the itemRef will \"inherit\" the itemSessionControl configuration from its parent section\n                                defaultItemData.itemSessionControl = _.clone(subsectionModel.itemSessionControl);\n                            }\n\n                            //the itemRef should also \"inherit\"  default categories set at the item level\n                            defaultItemData.categories = _.clone(defaults().categories) || [];\n\n                            _.forEach(selection, function (item) {\n                                const itemData = _.defaults(\n                                    {\n                                        href: item.uri,\n                                        label: item.label,\n                                        'qti-type': 'assessmentItemRef'\n                                    },\n                                    defaultItemData\n                                );\n\n                                if (_.isArray(item.categories)) {\n                                    itemData.categories = item.categories.concat(itemData.categories);\n                                }\n\n                                addItemRef($('.itemrefs', $itemRefsWrapper), null, itemData);\n                            });\n\n                            $itemsPanel.trigger('itemselected.creator');\n\n                            $placeholders.hide().off('click');\n                        });\n                } else {\n                    $placeholders.hide().off('click');\n                }\n            });\n\n            //we listen the event not from the adder but  from the data binder to be sure the model is up to date\n            // jquesry issue to select id with dot by '#ab.cd', should be used [id=\"ab.cd\"]\n            $(document)\n                .off('add.binder', `[id=\"${$subsection.attr('id')}\"] > .itemrefs-wrapper .itemrefs`)\n                .on(\n                    'add.binder',\n                    `[id=\"${$subsection.attr('id')}\"] > .itemrefs-wrapper .itemrefs`,\n                    function (e, $itemRef) {\n                        if (\n                            e.namespace === 'binder' &&\n                            $itemRef.hasClass('itemref') &&\n                            $itemRef.closest('.subsection').attr('id') === $subsection.attr('id')\n                        ) {\n                            const index = $itemRef.data('bind-index');\n                            const itemRefModel = subsectionModel.sectionParts[index];\n\n                            //initialize the new item ref\n                            itemRefView.setUp(creatorContext, itemRefModel, subsectionModel, sectionModel, $itemRef);\n\n                            /**\n                             * @event modelOverseer#item-add\n                             * @param {Object} itemRefModel\n                             */\n                            modelOverseer.trigger('item-add', itemRefModel);\n                        }\n                    }\n                );\n        }\n\n        /**\n         * Add a new item ref to the section\n         * @param {jQuery} $refList - the element to add the item to\n         * @param {Number} [index] - the position of the item to add\n         * @param {Object} [itemData] - the data to bind to the new item ref\n         */\n        function addItemRef($refList, index, itemData) {\n            const $items = $refList.children('li');\n            index = index || $items.length;\n            itemData.identifier = qtiTestHelper.getAvailableIdentifier(\n                modelOverseer.getModel(),\n                'assessmentItemRef',\n                'item'\n            );\n            itemData.index = index + 1;\n            const $itemRef = $(templates.itemref(itemData));\n            if (index > 0) {\n                $itemRef.insertAfter($items.eq(index - 1));\n            } else {\n                $itemRef.appendTo($refList);\n            }\n            $refList.trigger('add', [$itemRef, itemData]);\n        }\n\n        /**\n         * Set up the rubric blocks that already belongs to the section\n         * @private\n         */\n        function rubricBlocks() {\n            if (!subsectionModel.rubricBlocks) {\n                subsectionModel.rubricBlocks = [];\n            }\n            $('.rubricblock', $rubBlocks).each(function () {\n                const $rubricBlock = $(this);\n                const index = $rubricBlock.data('bind-index');\n                if (!subsectionModel.rubricBlocks[index]) {\n                    subsectionModel.rubricBlocks[index] = {};\n                }\n\n                rubricBlockView.setUp(creatorContext, subsectionModel.rubricBlocks[index], $rubricBlock);\n            });\n\n            //opens the rubric blocks section if they are there.\n            if (subsectionModel.rubricBlocks.length > 0) {\n                $('.rub-toggler', $titleWithActions).trigger('click');\n            }\n        }\n\n        /**\n         * Enable to add new rubric block\n         * @private\n         * @fires modelOverseer#rubric-add\n         */\n        function addRubricBlock() {\n            $('.rublock-adder', $rubBlocks).adder({\n                target: $('.rubricblocks', $rubBlocks),\n                content: templates.rubricblock,\n                templateData: function (cb) {\n                    cb({\n                        'qti-type': 'rubricBlock',\n                        index: $('.rubricblock', $rubBlocks).length,\n                        content: [],\n                        views: [1]\n                    });\n                }\n            });\n\n            //we listen the event not from the adder but  from the data binder to be sure the model is up to date\n            // jquesry issue to select id with dot by '#ab.cd', should be used [id=\"ab.cd\"]\n            $(document)\n                .off('add.binder', `[id=\"${$subsection.attr('id')}\"] > .rublocks .rubricblocks`)\n                .on(\n                    'add.binder',\n                    `[id=\"${$subsection.attr('id')}\"] > .rublocks .rubricblocks`,\n                    function (e, $rubricBlock) {\n                        if (\n                            e.namespace === 'binder' &&\n                            $rubricBlock.hasClass('rubricblock') &&\n                            $rubricBlock.closest('.subsection').attr('id') === $subsection.attr('id')\n                        ) {\n                            const index = $rubricBlock.data('bind-index');\n                            const rubricModel = subsectionModel.rubricBlocks[index] || {};\n\n                            $('.rubricblock-binding', $rubricBlock).html('<p>&nbsp;</p>');\n                            rubricBlockView.setUp(creatorContext, rubricModel, $rubricBlock);\n\n                            /**\n                             * @event modelOverseer#rubric-add\n                             * @param {Object} rubricModel\n                             */\n                            modelOverseer.trigger('rubric-add', rubricModel);\n                        }\n                    }\n                );\n        }\n\n        /**\n         * Set up the category property\n         * @private\n         * @param {jQuery} $view - the $view object containing the $select\n         * @fires modelOverseer#category-change\n         */\n        function categoriesProperty($view) {\n            const categories = sectionCategory.getCategories(subsectionModel),\n                categorySelector = categorySelectorFactory($view);\n\n            categorySelector.createForm(categories.all);\n            updateFormState(categorySelector);\n\n            $view.on('propopen.propview', function () {\n                updateFormState(categorySelector);\n            });\n\n            $view.on('set-default-categories', function () {\n                subsectionModel.categories = defaults().categories;\n                updateFormState(categorySelector);\n            });\n\n            categorySelector.on('category-change', function (selected, indeterminate) {\n                sectionCategory.setCategories(subsectionModel, selected, indeterminate);\n\n                modelOverseer.trigger('category-change');\n            });\n        }\n\n        function updateFormState(categorySelector) {\n            const categories = sectionCategory.getCategories(subsectionModel);\n            categorySelector.updateFormState(categories.propagated, categories.partial);\n        }\n\n        /**\n         * Set up the Blueprint property\n         * @private\n         * @param {jQuery} $view - the $view object containing the $select\n         */\n        function blueprintProperty($view) {\n            const $select = $('[name=section-blueprint]', $view);\n            $select\n                .select2({\n                    ajax: {\n                        url: config.routes.blueprintsById,\n                        dataType: 'json',\n                        delay: 350,\n                        method: 'POST',\n                        data: function (params) {\n                            return {\n                                identifier: params // search term\n                            };\n                        },\n                        results: function (data) {\n                            return data;\n                        }\n                    },\n                    minimumInputLength: 3,\n                    width: '100%',\n                    multiple: false,\n                    allowClear: true,\n                    placeholder: __('Select a blueprint'),\n                    formatNoMatches: function () {\n                        return __('Enter a blueprint');\n                    },\n                    maximumInputLength: 32\n                })\n                .on('change', function (e) {\n                    setBlueprint(e.val);\n                });\n\n            initBlueprint();\n            $view.on('propopen.propview', function () {\n                initBlueprint();\n            });\n\n            /**\n             * Start the blueprint editing\n             * @private\n             */\n            function initBlueprint() {\n                if (typeof subsectionModel.blueprint === 'undefined') {\n                    sectionBlueprint\n                        .getBlueprint(config.routes.blueprintByTestSection, subsectionModel)\n                        .success(function (data) {\n                            if (!_.isEmpty(data)) {\n                                if (subsectionModel.blueprint !== '') {\n                                    subsectionModel.blueprint = data.uri;\n                                    $select.select2('data', { id: data.uri, text: data.text });\n                                    $select.trigger('change');\n                                }\n                            }\n                        });\n                }\n            }\n\n            /**\n             * save the categories into the model\n             * @param {Object} blueprint\n             * @private\n             */\n            function setBlueprint(blueprint) {\n                sectionBlueprint.setBlueprint(subsectionModel, blueprint);\n            }\n        }\n\n        function addSubsection() {\n            const optionsConfirmDialog = {\n                buttons: {\n                    labels: {\n                        ok: __('Yes'),\n                        cancel: __('No')\n                    }\n                }\n            };\n\n            $('.add-subsection', $titleWithActions).adder({\n                target: $subsection.children('.subsections'),\n                content: templates.subsection,\n                templateData: function (cb) {\n                    //create a new subsection model object to be bound to the template\n                    let sectionParts = [];\n                    if ($subsection.data('movedItems')) {\n                        sectionParts = $subsection.data('movedItems');\n                        $subsection.removeData('movedItems');\n                    }\n                    cb({\n                        'qti-type': 'assessmentSection',\n                        identifier: qtiTestHelper.getAvailableIdentifier(\n                            modelOverseer.getModel(),\n                            'assessmentSection',\n                            'subsection'\n                        ),\n                        title: defaults().sectionTitlePrefix,\n                        index: 0,\n                        sectionParts,\n                        visible: true\n                    });\n                },\n                checkAndCallAdd: function (executeAdd) {\n                    if (\n                        subsectionModel.sectionParts[0] &&\n                        qtiTestHelper.filterQtiType(subsectionModel.sectionParts[0], 'assessmentItemRef')\n                    ) {\n                        // subsection has item(s)\n                        const subsectionIndex = subsectionsHelper.getSubsectionTitleIndex($subsection);\n                        const confirmMessage = __(\n                            'The items contained in <b>%s %s</b> will be moved into the new <b>%s %s</b>. Do you wish to proceed?',\n                            subsectionIndex,\n                            subsectionModel.title,\n                            `${subsectionIndex}1.`,\n                            defaults().sectionTitlePrefix\n                        );\n                        const acceptFunction = () => {\n                            // trigger deleted event for each itemfer to run removePropHandler and remove propView\n                            $('.itemrefs .itemref', $itemRefsWrapper).each(function () {\n                                $subsection.parents('.testparts').trigger('deleted.deleter', [$(this)]);\n                            });\n                            setTimeout(() => {\n                                // remove all itemrefs\n                                $('.itemrefs', $itemRefsWrapper).empty();\n                                // check itemrefs identifiers\n                                // because validation is build on <span id=\"props-{identifier}\">\n                                // and each item should have valid and unique id\n                                subsectionModel.sectionParts.forEach(itemRef => {\n                                    if (!validators.checkIfItemIdValid(itemRef.identifier, modelOverseer)) {\n                                        itemRef.identifier = qtiTestHelper.getAvailableIdentifier(\n                                            modelOverseer.getModel(),\n                                            'assessmentItemRef',\n                                            'item'\n                                        );\n                                    }\n                                });\n                                $subsection.data('movedItems', _.clone(subsectionModel.sectionParts));\n                                subsectionModel.sectionParts = [];\n                                executeAdd();\n                            }, 0);\n                        };\n                        confirmDialog(confirmMessage, acceptFunction, () => {}, optionsConfirmDialog)\n                            .getDom()\n                            .find('.buttons')\n                            .css('display', 'flex')\n                            .css('flex-direction', 'row-reverse');\n                    } else {\n                        if (!subsectionModel.sectionParts.length && subsectionModel.categories.length) {\n                            $subsection.data('movedCategories', _.clone(subsectionModel.categories));\n                        }\n                        executeAdd();\n                    }\n                }\n            });\n\n            //we listen the event not from the adder but  from the data binder to be sure the model is up to date\n            // jquesry issue to select id with dot by '#ab.cd', should be used [id=\"ab.cd\"]\n            $(document)\n                .off('add.binder', `[id=\"${$subsection.attr('id')}\"] > .subsections`)\n                .on('add.binder', `[id=\"${$subsection.attr('id')}\"] > .subsections`, function (e, $sub2section) {\n                    if (\n                        e.namespace === 'binder' &&\n                        $sub2section.hasClass('subsection') &&\n                        $sub2section.parents('.subsection').length\n                    ) {\n                        // second level of subsection){\n                        const sub2sectionIndex = $sub2section.data('bind-index');\n                        const sub2sectionModel = subsectionModel.sectionParts[sub2sectionIndex];\n\n                        if ($subsection.data('movedCategories')) {\n                            sub2sectionModel.categories = $subsection.data('movedCategories');\n                            $subsection.removeData('movedCategories');\n                        }\n\n                        // initialize the new subsection\n                        setUp(creatorContext, sub2sectionModel, subsectionModel, $sub2section);\n                        // hide 'Items' block and category-presets for current subsection\n                        actions.displayItemWrapper($subsection);\n                        actions.displayCategoryPresets($subsection);\n                        // set index for new subsection\n                        actions.updateTitleIndex($sub2section);\n\n                        /**\n                         * @event modelOverseer#section-add\n                         * @param {Object} sub2sectionModel\n                         */\n                        modelOverseer.trigger('section-add', sub2sectionModel);\n                    }\n                });\n        }\n    }\n\n    /**\n     * Listen for state changes to enable/disable . Called globally.\n     */\n    function listenActionState() {\n        $('.subsections').each(function () {\n            const $subsections = $('.subsection', $(this));\n\n            actions.removable($subsections, 'h2');\n            actions.movable($subsections, 'subsection', 'h2');\n            actions.updateTitleIndex($subsections);\n        });\n\n        $(document)\n            .on('delete', function (e) {\n                const $target = $(e.target);\n                if ($target.hasClass('subsection')) {\n                    const $parent = subsectionsHelper.getParent($target);\n                    setTimeout(() => {\n                        actions.displayItemWrapper($parent);\n                        actions.displayCategoryPresets($parent);\n                        // element detached after event\n                        const $subsections = $('.subsection', $parent);\n                        actions.updateTitleIndex($subsections);\n                    }, 100);\n                }\n            })\n            .on('add change undo.deleter deleted.deleter', function (e) {\n                const $target = $(e.target);\n                if ($target.hasClass('subsection') || $target.hasClass('subsections')) {\n                    const $subsections = subsectionsHelper.getSiblingSubsections($target);\n                    actions.removable($subsections, 'h2');\n                    actions.movable($subsections, 'subsection', 'h2');\n\n                    if (e.type === 'undo' || e.type === 'change') {\n                        const $parent = subsectionsHelper.getParent($target);\n                        const $AllNestedSubsections = $('.subsection', $parent);\n                        actions.updateTitleIndex($AllNestedSubsections);\n                        actions.displayItemWrapper($parent);\n                        actions.displayCategoryPresets($parent);\n                    }\n                }\n            });\n    }\n    /**\n     * The sectionView setup section related components and beahvior\n     *\n     * @exports taoQtiTest/controller/creator/views/section\n     */\n    return {\n        setUp: setUp,\n        listenActionState: listenActionState\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014-2022 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n */\n\n/**\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/views/section',[\n    'jquery',\n    'lodash',\n    'uri',\n    'i18n',\n    'taoQtiTest/controller/creator/config/defaults',\n    'taoQtiTest/controller/creator/views/actions',\n    'taoQtiTest/controller/creator/views/itemref',\n    'taoQtiTest/controller/creator/views/rubricblock',\n    'taoQtiTest/controller/creator/templates/index',\n    'taoQtiTest/controller/creator/helpers/qtiTest',\n    'taoQtiTest/controller/creator/helpers/categorySelector',\n    'taoQtiTest/controller/creator/helpers/testPartCategory',\n    'taoQtiTest/controller/creator/helpers/sectionCategory',\n    'taoQtiTest/controller/creator/helpers/sectionBlueprints',\n    'taoQtiTest/controller/creator/views/subsection',\n    'ui/dialog/confirm',\n    'taoQtiTest/controller/creator/helpers/subsection',\n    'taoQtiTest/controller/creator/helpers/validators',\n    'taoQtiTest/controller/creator/helpers/featureVisibility'\n], function (\n    $,\n    _,\n    uri,\n    __,\n    defaults,\n    actions,\n    itemRefView,\n    rubricBlockView,\n    templates,\n    qtiTestHelper,\n    categorySelectorFactory,\n    testPartCategory,\n    sectionCategory,\n    sectionBlueprint,\n    subsectionView,\n    confirmDialog,\n    subsectionsHelper,\n    validators,\n    featureVisibility\n) {\n    ('use strict');\n\n    /**\n     * Set up a section: init action behaviors. Called for each section.\n     *\n     * @param {Object} creatorContext\n     * @param {Object} sectionModel - the data model to bind to the test section\n     * @param {Object} partModel - the parent data model to inherit\n     * @param {jQuery} $section - the section to set up\n     */\n    function setUp(creatorContext, sectionModel, partModel, $section) {\n        // select elements for section, to avoid selecting the same elements in subsections\n        const $itemRefsWrapper = $section.children('.itemrefs-wrapper');\n        const $rubBlocks = $section.children('.rublocks');\n        const $titleWithActions = $section.children('h2');\n\n        const modelOverseer = creatorContext.getModelOverseer();\n        const config = modelOverseer.getConfig();\n\n        // set item session control to use test part options if section level isn't set\n        if (!sectionModel.itemSessionControl) {\n            sectionModel.itemSessionControl = {};\n        }\n        if (!sectionModel.categories) {\n            // inherit the parent testPart's propagated categories\n            const partCategories = testPartCategory.getCategories(partModel);\n            sectionModel.categories = _.clone(partCategories.propagated || defaults().categories);\n        }\n        _.defaults(sectionModel.itemSessionControl, partModel.itemSessionControl);\n\n        if (!_.isEmpty(config.routes.blueprintsById)) {\n            sectionModel.hasBlueprint = true;\n        }\n\n        //add feature visibility properties to sectionModel\n        featureVisibility.addSectionVisibilityProps(sectionModel);\n\n        actions.properties($titleWithActions, 'section', sectionModel, propHandler);\n        actions.move($titleWithActions, 'sections', 'section');\n        actions.displayItemWrapper($section);\n\n        subsections();\n        itemRefs();\n        acceptItemRefs();\n        rubricBlocks();\n        addRubricBlock();\n        addSubsection();\n\n        /**\n         * Perform some binding once the property view is create\n         * @param {propView} propView - the view object\n         */\n        function propHandler(propView) {\n            const $view = propView.getView();\n\n            //enable/disable selection\n            const $selectionSwitcher = $('[name=section-enable-selection]', $view);\n            const $selectionSelect = $('[name=section-select]', $view);\n            const $selectionWithRep = $('[name=section-with-replacement]', $view);\n\n            // sectionModel.selection will be filled by bound values from template section-props.tpl\n            // if sectionModel.selection from server response it has 'qti-type'\n            const isSelectionFromServer = !!(sectionModel.selection && sectionModel.selection['qti-type']);\n\n            const switchSelection = function switchSelection() {\n                if ($selectionSwitcher.prop('checked') === true) {\n                    $selectionSelect.incrementer('enable');\n                    $selectionWithRep.removeClass('disabled');\n                } else {\n                    $selectionSelect.incrementer('disable');\n                    $selectionWithRep.addClass('disabled');\n                }\n            };\n            $selectionSwitcher.on('change', switchSelection);\n            $selectionSwitcher.on('change', function updateModel() {\n                if (!$selectionSwitcher.prop('checked')) {\n                    $selectionSelect.val(0);\n                    $selectionWithRep.prop('checked', false);\n                    delete sectionModel.selection;\n                }\n            });\n\n            $selectionSwitcher.prop('checked', isSelectionFromServer).trigger('change');\n\n            //listen for databinder change to update the test part title\n            const $title = $('[data-bind=title]', $titleWithActions);\n            $view.on('change.binder', function (e) {\n                if (e.namespace === 'binder' && sectionModel['qti-type'] === 'assessmentSection') {\n                    $title.text(sectionModel.title);\n                }\n            });\n\n            // deleted.deleter event fires only on the parent nodes (testparts, sections, etc)\n            // Since it \"bubles\" we can subscribe only to the highest parent node\n            $section.parents('.testparts').on('deleted.deleter', removePropHandler);\n\n            //section level category configuration\n            categoriesProperty($view);\n\n            if (typeof sectionModel.hasBlueprint !== 'undefined') {\n                blueprintProperty($view);\n            }\n\n            actions.displayCategoryPresets($section);\n\n            function removePropHandler(e, $deletedNode) {\n                const validIds = [$section.parents('.testpart').attr('id'), $section.attr('id')];\n\n                const deletedNodeId = $deletedNode.attr('id');\n                // We have to check id of a deleted node, because\n                // 1. Event fires after child node was deleted, but e.stopPropagation doesn't help\n                // because currentTarget is always document\n                // 2. We have to subscribe to the parent node and it's possible that another section was removed even from another testpart\n                // Subscription to the .sections selector event won't help because sections element might contain several children.\n\n                if (propView !== null && validIds.includes(deletedNodeId)) {\n                    propView.destroy();\n                }\n            }\n        }\n\n        /**\n         * Set up subsections that already belongs to the section\n         * @private\n         */\n        function subsections() {\n            if (!sectionModel.sectionParts) {\n                sectionModel.sectionParts = [];\n            }\n\n            subsectionsHelper.getSubsections($section).each(function () {\n                const $subsection = $(this);\n                const index = $subsection.data('bind-index');\n                if (!sectionModel.sectionParts[index]) {\n                    sectionModel.sectionParts[index] = {};\n                }\n\n                subsectionView.setUp(creatorContext, sectionModel.sectionParts[index], sectionModel, $subsection);\n            });\n        }\n        /**\n         * Set up the item refs that already belongs to the section\n         * @private\n         */\n        function itemRefs() {\n            if (!sectionModel.sectionParts) {\n                sectionModel.sectionParts = [];\n            }\n            $('.itemref', $itemRefsWrapper).each(function () {\n                const $itemRef = $(this);\n                const index = $itemRef.data('bind-index');\n                if (!sectionModel.sectionParts[index]) {\n                    sectionModel.sectionParts[index] = {};\n                }\n\n                itemRefView.setUp(creatorContext, sectionModel.sectionParts[index], sectionModel, partModel, $itemRef);\n                $itemRef.find('.title').text(config.labels[uri.encode($itemRef.data('uri'))]);\n            });\n        }\n\n        /**\n         * Make the section to accept the selected items\n         * @private\n         * @fires modelOverseer#item-add\n         */\n        function acceptItemRefs() {\n            const $itemsPanel = $('.test-creator-items .item-selection');\n\n            //the item selector trigger a select event\n            $itemsPanel.on('itemselect.creator', function (e, selection) {\n                const $placeholder = $('.itemref-placeholder', $itemRefsWrapper);\n                const $placeholders = $('.itemref-placeholder');\n\n                if (_.size(selection) > 0) {\n                    $placeholder\n                        .show()\n                        .off('click')\n                        .on('click', function () {\n                            //prepare the item data\n                            const defaultItemData = {};\n\n                            if (\n                                sectionModel.itemSessionControl &&\n                                !_.isUndefined(sectionModel.itemSessionControl.maxAttempts)\n                            ) {\n                                //for a matter of consistency, the itemRef will \"inherit\" the itemSessionControl configuration from its parent section\n                                defaultItemData.itemSessionControl = _.clone(sectionModel.itemSessionControl);\n                            }\n\n                            //the itemRef should also \"inherit\" default categories set at the item level\n                            defaultItemData.categories = _.clone(defaults().categories) || [];\n\n                            _.forEach(selection, function (item) {\n                                const itemData = _.defaults(\n                                    {\n                                        href: item.uri,\n                                        label: item.label,\n                                        'qti-type': 'assessmentItemRef'\n                                    },\n                                    defaultItemData\n                                );\n\n                                if (_.isArray(item.categories)) {\n                                    itemData.categories = item.categories.concat(itemData.categories);\n                                }\n\n                                addItemRef($('.itemrefs', $itemRefsWrapper), null, itemData);\n                            });\n\n                            $itemsPanel.trigger('itemselected.creator');\n\n                            $placeholders.hide().off('click');\n                        });\n                } else {\n                    $placeholders.hide().off('click');\n                }\n            });\n\n            //we listen the event not from the adder but  from the data binder to be sure the model is up to date\n            // jquery issue to select id with dot by '#ab.cd', should be used [id=\"ab.cd\"]\n            $(document)\n                .off('add.binder', `[id=\"${$section.attr('id')}\"] > .itemrefs-wrapper .itemrefs`)\n                .on(\n                    'add.binder',\n                    `[id=\"${$section.attr('id')}\"] > .itemrefs-wrapper .itemrefs`,\n                    function (e, $itemRef) {\n                        if (\n                            e.namespace === 'binder' &&\n                            $itemRef.hasClass('itemref') &&\n                            !$itemRef.parents('.subsection').length\n                        ) {\n                            const index = $itemRef.data('bind-index');\n                            const itemRefModel = sectionModel.sectionParts[index];\n\n                            //initialize the new item ref\n                            itemRefView.setUp(creatorContext, itemRefModel, sectionModel, partModel, $itemRef);\n\n                            /**\n                             * @event modelOverseer#item-add\n                             * @param {Object} itemRefModel\n                             */\n                            modelOverseer.trigger('item-add', itemRefModel);\n                        }\n                    }\n                );\n        }\n\n        /**\n         * Add a new item ref to the section\n         * @param {jQuery} $refList - the element to add the item to\n         * @param {Number} [index] - the position of the item to add\n         * @param {Object} [itemData] - the data to bind to the new item ref\n         */\n        function addItemRef($refList, index, itemData) {\n            const $items = $refList.children('li');\n            index = index || $items.length;\n            itemData.identifier = qtiTestHelper.getAvailableIdentifier(\n                modelOverseer.getModel(),\n                'assessmentItemRef',\n                'item'\n            );\n            itemData.index = index + 1;\n            const $itemRef = $(templates.itemref(itemData));\n            if (index > 0) {\n                $itemRef.insertAfter($items.eq(index - 1));\n            } else {\n                $itemRef.appendTo($refList);\n            }\n            $refList.trigger('add', [$itemRef, itemData]);\n        }\n\n        /**\n         * Set up the rubric blocks that already belongs to the section\n         * @private\n         */\n        function rubricBlocks() {\n            if (!sectionModel.rubricBlocks) {\n                sectionModel.rubricBlocks = [];\n            }\n            $('.rubricblock', $rubBlocks).each(function () {\n                const $rubricBlock = $(this);\n                const index = $rubricBlock.data('bind-index');\n                if (!sectionModel.rubricBlocks[index]) {\n                    sectionModel.rubricBlocks[index] = {};\n                }\n\n                rubricBlockView.setUp(creatorContext, sectionModel.rubricBlocks[index], $rubricBlock);\n            });\n\n            //opens the rubric blocks section if they are there.\n            if (sectionModel.rubricBlocks.length > 0) {\n                $('.rub-toggler', $titleWithActions).trigger('click');\n            }\n        }\n\n        /**\n         * Enable to add new rubric block\n         * @private\n         * @fires modelOverseer#rubric-add\n         */\n        function addRubricBlock() {\n            $('.rublock-adder', $rubBlocks).adder({\n                target: $('.rubricblocks', $rubBlocks),\n                content: templates.rubricblock,\n                templateData: function (cb) {\n                    cb({\n                        'qti-type': 'rubricBlock',\n                        index: $('.rubricblock', $rubBlocks).length,\n                        content: [],\n                        views: [1]\n                    });\n                }\n            });\n\n            //we listen the event not from the adder but  from the data binder to be sure the model is up to date\n            // jquery issue to select id with dot by '#ab.cd', should be used [id=\"ab.cd\"]\n            $(document)\n                .off('add.binder', `[id=\"${$section.attr('id')}\"] > .rublocks .rubricblocks`)\n                .on(\n                    'add.binder',\n                    `[id=\"${$section.attr('id')}\"] > .rublocks .rubricblocks`,\n                    function (e, $rubricBlock) {\n                        if (\n                            e.namespace === 'binder' &&\n                            $rubricBlock.hasClass('rubricblock') &&\n                            !$rubricBlock.parents('.subsection').length\n                        ) {\n                            const index = $rubricBlock.data('bind-index');\n                            const rubricModel = sectionModel.rubricBlocks[index] || {};\n\n                            $('.rubricblock-binding', $rubricBlock).html('<p>&nbsp;</p>');\n                            rubricBlockView.setUp(creatorContext, rubricModel, $rubricBlock);\n\n                            /**\n                             * @event modelOverseer#rubric-add\n                             * @param {Object} rubricModel\n                             */\n                            modelOverseer.trigger('rubric-add', rubricModel);\n                        }\n                    }\n                );\n        }\n\n        /**\n         * Set up the category property\n         * @private\n         * @param {jQuery} $view - the $view object containing the $select\n         * @fires modelOverseer#category-change\n         */\n        function categoriesProperty($view) {\n            const categories = sectionCategory.getCategories(sectionModel),\n                categorySelector = categorySelectorFactory($view);\n\n            categorySelector.createForm(categories.all, 'section');\n            updateFormState(categorySelector);\n\n            $view.on('propopen.propview', function () {\n                updateFormState(categorySelector);\n            });\n\n            $view.on('set-default-categories', function () {\n                sectionModel.categories = defaults().categories;\n                updateFormState(categorySelector);\n            });\n\n            categorySelector.on('category-change', function (selected, indeterminate) {\n                sectionCategory.setCategories(sectionModel, selected, indeterminate);\n\n                modelOverseer.trigger('category-change');\n            });\n        }\n\n        function updateFormState(categorySelector) {\n            const categories = sectionCategory.getCategories(sectionModel);\n            categorySelector.updateFormState(categories.propagated, categories.partial);\n        }\n\n        /**\n         * Set up the Blueprint property\n         * @private\n         * @param {jQuery} $view - the $view object containing the $select\n         */\n        function blueprintProperty($view) {\n            const $select = $('[name=section-blueprint]', $view);\n            $select\n                .select2({\n                    ajax: {\n                        url: config.routes.blueprintsById,\n                        dataType: 'json',\n                        delay: 350,\n                        method: 'POST',\n                        data: function (params) {\n                            return {\n                                identifier: params // search term\n                            };\n                        },\n                        results: function (data) {\n                            return data;\n                        }\n                    },\n                    minimumInputLength: 3,\n                    width: '100%',\n                    multiple: false,\n                    allowClear: true,\n                    placeholder: __('Select a blueprint'),\n                    formatNoMatches: function () {\n                        return __('Enter a blueprint');\n                    },\n                    maximumInputLength: 32\n                })\n                .on('change', function (e) {\n                    setBlueprint(e.val);\n                });\n\n            initBlueprint();\n            $view.on('propopen.propview', function () {\n                initBlueprint();\n            });\n\n            /**\n             * Start the blueprint editing\n             * @private\n             */\n            function initBlueprint() {\n                if (typeof sectionModel.blueprint === 'undefined') {\n                    sectionBlueprint\n                        .getBlueprint(config.routes.blueprintByTestSection, sectionModel)\n                        .success(function (data) {\n                            if (!_.isEmpty(data)) {\n                                if (sectionModel.blueprint !== '') {\n                                    sectionModel.blueprint = data.uri;\n                                    $select.select2('data', { id: data.uri, text: data.text });\n                                    $select.trigger('change');\n                                }\n                            }\n                        });\n                }\n            }\n\n            /**\n             * save the categories into the model\n             * @param {Object} blueprint\n             * @private\n             */\n            function setBlueprint(blueprint) {\n                sectionBlueprint.setBlueprint(sectionModel, blueprint);\n            }\n        }\n\n        function addSubsection() {\n            const optionsConfirmDialog = {\n                buttons: {\n                    labels: {\n                        ok: __('Yes'),\n                        cancel: __('No')\n                    }\n                }\n            };\n\n            $('.add-subsection', $titleWithActions).adder({\n                target: $section.children('.subsections'),\n                content: templates.subsection,\n                templateData: function (cb) {\n                    //create a new subsection model object to be bound to the template\n                    let sectionParts = [];\n                    if ($section.data('movedItems')) {\n                        sectionParts = $section.data('movedItems');\n                        $section.removeData('movedItems');\n                    }\n                    cb({\n                        'qti-type': 'assessmentSection',\n                        identifier: qtiTestHelper.getAvailableIdentifier(\n                            modelOverseer.getModel(),\n                            'assessmentSection',\n                            'subsection'\n                        ),\n                        title: defaults().sectionTitlePrefix,\n                        index: 0,\n                        sectionParts,\n                        visible: true\n                    });\n                },\n                checkAndCallAdd: function (executeAdd) {\n                    if (\n                        sectionModel.sectionParts[0] &&\n                        qtiTestHelper.filterQtiType(sectionModel.sectionParts[0], 'assessmentItemRef')\n                    ) {\n                        // section has item(s)\n                        const $parent = $section.parents('.sections');\n                        const index = $('.section', $parent).index($section);\n                        const confirmMessage = __(\n                            'The items contained in <b>%s %s</b> will be moved into the new <b>%s %s</b>. Do you wish to proceed?',\n                            `${index + 1}.`,\n                            sectionModel.title,\n                            `${index + 1}.1.`,\n                            defaults().sectionTitlePrefix\n                        );\n                        const acceptFunction = () => {\n                            // trigger deleted event for each itemfer to run removePropHandler and remove propView\n                            $('.itemrefs .itemref', $itemRefsWrapper).each(function () {\n                                $section.parents('.testparts').trigger('deleted.deleter', [$(this)]);\n                            });\n                            setTimeout(() => {\n                                // remove all itemrefs\n                                $('.itemrefs', $itemRefsWrapper).empty();\n                                // check itemrefs identifiers\n                                // because validation is build on <span id=\"props-{identifier}\">\n                                // and each item should have valid and unique id\n                                sectionModel.sectionParts.forEach(itemRef => {\n                                    if (!validators.checkIfItemIdValid(itemRef.identifier, modelOverseer)) {\n                                        itemRef.identifier = qtiTestHelper.getAvailableIdentifier(\n                                            modelOverseer.getModel(),\n                                            'assessmentItemRef',\n                                            'item'\n                                        );\n                                    }\n                                });\n                                $section.data('movedItems', _.clone(sectionModel.sectionParts));\n                                sectionModel.sectionParts = [];\n                                executeAdd();\n                            }, 0);\n                        };\n                        confirmDialog(confirmMessage, acceptFunction, () => {}, optionsConfirmDialog)\n                            .getDom()\n                            .find('.buttons')\n                            .css('display', 'flex')\n                            .css('flex-direction', 'row-reverse');\n                    } else {\n                        if (!sectionModel.sectionParts.length && sectionModel.categories.length) {\n                            $section.data('movedCategories', _.clone(sectionModel.categories));\n                        }\n                        executeAdd();\n                    }\n                }\n            });\n\n            //we listen the event not from the adder but  from the data binder to be sure the model is up to date\n            // jquery issue to select id with dot by '#ab.cd', should be used [id=\"ab.cd\"]\n            $(document)\n                .off('add.binder', `[id=\"${$section.attr('id')}\"] > .subsections`)\n                .on('add.binder', `[id=\"${$section.attr('id')}\"] > .subsections`, function (e, $subsection) {\n                    if (\n                        e.namespace === 'binder' &&\n                        $subsection.hasClass('subsection') &&\n                        !$subsection.parents('.subsection').length\n                    ) {\n                        // first level of subsection\n                        const subsectionIndex = $subsection.data('bind-index');\n                        const subsectionModel = sectionModel.sectionParts[subsectionIndex];\n\n                        if ($section.data('movedCategories')) {\n                            subsectionModel.categories = $section.data('movedCategories');\n                            $section.removeData('movedCategories');\n                        }\n\n                        //initialize the new subsection\n                        subsectionView.setUp(creatorContext, subsectionModel, sectionModel, $subsection);\n                        // hide 'Items' block and category-presets for current section\n                        actions.displayItemWrapper($section);\n                        actions.displayCategoryPresets($section);\n                        // set index for new subsection\n                        actions.updateTitleIndex($subsection);\n\n                        /**\n                         * @event modelOverseer#section-add\n                         * @param {Object} subsectionModel\n                         */\n                        modelOverseer.trigger('section-add', subsectionModel);\n                    }\n                });\n        }\n    }\n\n    /**\n     * Listen for state changes to enable/disable . Called globally.\n     */\n    function listenActionState() {\n        $('.sections').each(function () {\n            const $sections = $('.section', $(this));\n\n            actions.removable($sections, 'h2');\n            actions.movable($sections, 'section', 'h2');\n            actions.updateTitleIndex($sections);\n        });\n\n        $(document)\n            .on('delete', function (e) {\n                let $parent;\n                const $target = $(e.target);\n                if ($target.hasClass('section')) {\n                    $parent = $target.parents('.sections');\n                    actions.disable($parent.find('.section'), 'h2');\n                    setTimeout(() => {\n                        // element detached after event\n                        const $sectionsAndsubsections = $('.section,.subsection', $parent);\n                        actions.updateTitleIndex($sectionsAndsubsections);\n                    }, 100);\n                }\n            })\n            .on('add change undo.deleter deleted.deleter', function (e) {\n                const $target = $(e.target);\n                if ($target.hasClass('section') || $target.hasClass('sections')) {\n                    const $sectionsContainer = $target.hasClass('sections') ? $target : $target.parents('.sections');\n                    const $sections = $('.section', $sectionsContainer);\n                    actions.removable($sections, 'h2');\n                    actions.movable($sections, 'section', 'h2');\n                    if (e.type === 'undo' || e.type === 'change') {\n                        const $sectionsAndsubsections = $('.section,.subsection', $sectionsContainer);\n                        actions.updateTitleIndex($sectionsAndsubsections);\n                    } else if (e.type === 'add') {\n                        const $newSection = $('.section:last', $sectionsContainer);\n                        actions.updateTitleIndex($newSection);\n                    }\n                }\n            })\n            .on('open.toggler', '.rub-toggler', function (e) {\n                if (e.namespace === 'toggler') {\n                    $(this).parents('h2').addClass('active');\n                }\n            })\n            .on('close.toggler', '.rub-toggler', function (e) {\n                if (e.namespace === 'toggler') {\n                    $(this).parents('h2').removeClass('active');\n                }\n            });\n    }\n\n    /**\n     * The sectionView setup section related components and behavior\n     *\n     * @exports taoQtiTest/controller/creator/views/section\n     */\n    return {\n        setUp: setUp,\n        listenActionState: listenActionState\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014-2022 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n */\n\n/**\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/views/testpart',[\n    'jquery',\n    'lodash',\n    'taoQtiTest/controller/creator/config/defaults',\n    'taoQtiTest/controller/creator/views/actions',\n    'taoQtiTest/controller/creator/views/section',\n    'taoQtiTest/controller/creator/templates/index',\n    'taoQtiTest/controller/creator/helpers/qtiTest',\n    'taoQtiTest/controller/creator/helpers/testPartCategory',\n    'taoQtiTest/controller/creator/helpers/categorySelector',\n    'taoQtiTest/controller/creator/helpers/featureVisibility'\n], function (\n    $,\n    _,\n    defaults,\n    actions,\n    sectionView,\n    templates,\n    qtiTestHelper,\n    testPartCategory,\n    categorySelectorFactory,\n    featureVisibility\n) {\n    ('use strict');\n\n    const addVisibilityProps = model => {};\n\n    /**\n     * Set up a test part: init action behaviors. Called for each test part.\n     *\n     * @param {Object} creatorContext\n     * @param {Object} partModel - the data model to bind to the test part\n     * @param {jQuery} $testPart - the testpart container to set up\n     */\n    function setUp(creatorContext, partModel, $testPart) {\n        const $actionContainer = $('h1', $testPart);\n        const $titleWithActions = $testPart.children('h1');\n        const modelOverseer = creatorContext.getModelOverseer();\n\n        //add feature visibility properties to testPartModel\n        featureVisibility.addTestPartVisibilityProps(partModel);\n\n        //run setup methods\n        actions.properties($actionContainer, 'testpart', partModel, propHandler);\n        actions.move($actionContainer, 'testparts', 'testpart');\n        sections();\n        addSection();\n\n        /**\n         * Perform some binding once the property view is created\n         * @private\n         * @param {propView} propView - the view object\n         */\n        function propHandler(propView) {\n            const $view = propView.getView();\n\n            //listen for databinder change to update the test part title\n            const $identifier = $('[data-bind=identifier]', $titleWithActions);\n            $view.on('change.binder', function (e, model) {\n                if (e.namespace === 'binder' && model['qti-type'] === 'testPart') {\n                    $identifier.text(model.identifier);\n\n                    /**\n                     * @event modelOverseer#section-add\n                     * @param {Object} sectionModel\n                     */\n                    modelOverseer.trigger('testpart-change', partModel);\n                }\n            });\n\n            //destroy it when it's testpart is removed\n            $testPart.parents('.testparts').on('deleted.deleter', function (e, $deletedNode) {\n                if (propView !== null && $deletedNode.attr('id') === $testPart.attr('id')) {\n                    propView.destroy();\n                }\n            });\n\n            //testPart level category configuration\n            categoriesProperty($view);\n\n            actions.displayCategoryPresets($testPart, 'testpart');\n        }\n\n        /**\n         * Set up sections that already belongs to the test part\n         * @private\n         */\n        function sections() {\n            if (!partModel.assessmentSections) {\n                partModel.assessmentSections = [];\n            }\n            $('.section', $testPart).each(function () {\n                const $section = $(this);\n                const index = $section.data('bind-index');\n                if (!partModel.assessmentSections[index]) {\n                    partModel.assessmentSections[index] = {};\n                }\n\n                sectionView.setUp(creatorContext, partModel.assessmentSections[index], partModel, $section);\n            });\n        }\n\n        /**\n         * Enable to add new sections\n         * @private\n         * @fires modelOverseer#section-add\n         */\n        function addSection() {\n            $('.section-adder', $testPart).adder({\n                target: $('.sections', $testPart),\n                content: templates.section,\n                templateData: function (cb) {\n                    //create a new section model object to be bound to the template\n                    cb({\n                        'qti-type': 'assessmentSection',\n                        identifier: qtiTestHelper.getAvailableIdentifier(\n                            modelOverseer.getModel(),\n                            'assessmentSection',\n                            defaults().sectionIdPrefix\n                        ),\n                        title: defaults().sectionTitlePrefix,\n                        index: 0,\n                        sectionParts: [],\n                        visible: true\n                    });\n                }\n            });\n\n            //we listen the event not from the adder but  from the data binder to be sure the model is up to date\n            // jquery issue to select id with dot by '#ab.cd', should be used [id=\"ab.cd\"]\n            $(document)\n                .off('add.binder', `[id=${$testPart.attr('id')}] .sections`)\n                .on('add.binder', `[id=${$testPart.attr('id')}] .sections`, function (e, $section) {\n                    if (e.namespace === 'binder' && $section.hasClass('section')) {\n                        const index = $section.data('bind-index');\n                        const sectionModel = partModel.assessmentSections[index];\n\n                        //initialize the new section\n                        sectionView.setUp(creatorContext, sectionModel, partModel, $section);\n\n                        /**\n                         * @event modelOverseer#section-add\n                         * @param {Object} sectionModel\n                         */\n                        modelOverseer.trigger('section-add', sectionModel);\n                    }\n                });\n        }\n\n        /**\n         * Set up the category property\n         * @private\n         * @param {jQuery} $view - the $view object containing the $select\n         * @fires modelOverseer#category-change\n         */\n        function categoriesProperty($view) {\n            const categoriesSummary = testPartCategory.getCategories(partModel);\n            const categorySelector = categorySelectorFactory($view);\n\n            categorySelector.createForm(categoriesSummary.all, 'testPart');\n            updateFormState(categorySelector);\n\n            $view.on('propopen.propview', function () {\n                updateFormState(categorySelector);\n            });\n\n            $view.on('set-default-categories', function () {\n                partModel.categories = defaults().categories;\n                updateFormState(categorySelector);\n            });\n\n            categorySelector.on('category-change', function (selected, indeterminate) {\n                testPartCategory.setCategories(partModel, selected, indeterminate);\n\n                modelOverseer.trigger('category-change');\n            });\n        }\n\n        function updateFormState(categorySelector) {\n            const categoriesSummary = testPartCategory.getCategories(partModel);\n            categorySelector.updateFormState(categoriesSummary.propagated, categoriesSummary.partial);\n        }\n    }\n\n    /**\n     * Listen for state changes to enable/disable . Called globally.\n     */\n    function listenActionState() {\n        let $testParts = $('.testpart');\n\n        actions.removable($testParts, 'h1');\n        actions.movable($testParts, 'testpart', 'h1');\n\n        $('.testparts')\n            .on('delete', function (e) {\n                const $target = $(e.target);\n                if ($target.hasClass('testpart')) {\n                    actions.disable($(e.target.id), 'h1');\n                }\n            })\n            .on('add change undo.deleter deleted.deleter', function (e) {\n                const $target = $(e.target);\n\n                if ($target.hasClass('testpart') || $target.hasClass('testparts')) {\n                    //refresh\n                    $testParts = $('.testpart');\n\n                    //check state\n                    actions.removable($testParts, 'h1');\n                    actions.movable($testParts, 'testpart', 'h1');\n                }\n            });\n    }\n\n    /**\n     * The testPartView setup testpart related components and behavior\n     *\n     * @exports taoQtiTest/controller/creator/views/testpart\n     */\n    return {\n        setUp: setUp,\n        listenActionState: listenActionState\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n */\n/**\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/views/test',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'ui/hider',\n    'ui/feedback',\n    'services/features',\n    'taoQtiTest/controller/creator/config/defaults',\n    'taoQtiTest/controller/creator/views/actions',\n    'taoQtiTest/controller/creator/views/testpart',\n    'taoQtiTest/controller/creator/templates/index',\n    'taoQtiTest/controller/creator/helpers/qtiTest',\n    'taoQtiTest/controller/creator/helpers/featureVisibility'\n], function (\n    $,\n    _,\n    __,\n    hider,\n    feedback,\n    features,\n    defaults,\n    actions,\n    testPartView,\n    templates,\n    qtiTestHelper,\n    featureVisibility\n) {\n    ('use strict');\n\n    /**\n     * The TestView setup test related components and behavior\n     *\n     * @exports taoQtiTest/controller/creator/views/test\n     * @param {Object} creatorContext\n     */\n    function testView(creatorContext) {\n        var modelOverseer = creatorContext.getModelOverseer();\n        var testModel = modelOverseer.getModel();\n\n        //add feature visibility properties to testModel\n        featureVisibility.addTestVisibilityProps(testModel);\n\n        actions.properties($('.test-creator-test > h1'), 'test', testModel, propHandler);\n        testParts();\n        addTestPart();\n\n        //add feature visibility props to model\n\n        /**\n         * set up the existing test part views\n         * @private\n         */\n        function testParts() {\n            if (!testModel.testParts) {\n                testModel.testParts = [];\n            }\n            $('.testpart').each(function () {\n                var $testPart = $(this);\n                var index = $testPart.data('bind-index');\n                if (!testModel.testParts[index]) {\n                    testModel.testParts[index] = {};\n                }\n\n                testPartView.setUp(creatorContext, testModel.testParts[index], $testPart);\n            });\n        }\n\n        /**\n         * Perform some binding once the property view is created\n         * @private\n         * @param {propView} propView - the view object\n         * @fires modelOverseer#scoring-change\n         */\n        function propHandler(propView) {\n            var $view = propView.getView();\n            var $categoryScoreLine = $('.test-category-score', $view);\n            var $cutScoreLine = $('.test-cut-score', $view);\n            var $weightIdentifierLine = $('.test-weight-identifier', $view);\n            var $descriptions = $('.test-outcome-processing-description', $view);\n            var $generate = $('[data-action=\"generate-outcomes\"]', $view);\n            var $title = $('.test-creator-test > h1 [data-bind=title]');\n            var scoringState = JSON.stringify(testModel.scoring);\n\n            function changeScoring(scoring) {\n                var noOptions = !!scoring && ['none', 'custom'].indexOf(scoring.outcomeProcessing) === -1;\n                var newScoringState = JSON.stringify(scoring);\n\n                hider.toggle($cutScoreLine, !!scoring && scoring.outcomeProcessing === 'cut');\n                hider.toggle($categoryScoreLine, noOptions);\n                hider.toggle($weightIdentifierLine, noOptions);\n                hider.hide($descriptions);\n                hider.show($descriptions.filter('[data-key=\"' + scoring.outcomeProcessing + '\"]'));\n\n                if (scoringState !== newScoringState) {\n                    /**\n                     * @event modelOverseer#scoring-change\n                     * @param {Object} testModel\n                     */\n                    modelOverseer.trigger('scoring-change', testModel);\n                }\n                scoringState = newScoringState;\n            }\n\n            function updateOutcomes() {\n                var $panel = $('.outcome-declarations', $view);\n\n                $panel.html(templates.outcomes({ outcomes: modelOverseer.getOutcomesList() }));\n            }\n\n            $('[name=test-outcome-processing]', $view).select2({\n                minimumResultsForSearch: -1,\n                width: '100%'\n            });\n\n            $generate.on('click', function () {\n                $generate.addClass('disabled').attr('disabled', true);\n                modelOverseer\n                    .on('scoring-write.regenerate', function () {\n                        modelOverseer.off('scoring-write.regenerate');\n                        feedback()\n                            .success(__('The outcomes have been regenerated!'))\n                            .on('destroy', function () {\n                                $generate.removeClass('disabled').removeAttr('disabled');\n                            });\n                    })\n                    .trigger('scoring-change');\n            });\n\n            $view.on('change.binder', function (e, model) {\n                if (e.namespace === 'binder' && model['qti-type'] === 'assessmentTest') {\n                    changeScoring(model.scoring);\n\n                    //update the test part title when the databinder has changed it\n                    $title.text(model.title);\n                }\n            });\n\n            modelOverseer.on('scoring-write', updateOutcomes);\n\n            changeScoring(testModel.scoring);\n            updateOutcomes();\n        }\n\n        /**\n         * Enable to add new test parts\n         * @private\n         * @fires modelOverseer#part-add\n         */\n        function addTestPart() {\n            $('.testpart-adder').adder({\n                target: $('.testparts'),\n                content: templates.testpart,\n                templateData: function (cb) {\n                    //create an new testPart model object to be bound to the template\n                    var testPartIndex = $('.testpart').length;\n                    cb({\n                        'qti-type': 'testPart',\n                        identifier: qtiTestHelper.getAvailableIdentifier(\n                            modelOverseer.getModel(),\n                            'testPart',\n                            defaults().partIdPrefix\n                        ),\n                        index: testPartIndex,\n                        navigationMode: defaults().navigationMode,\n                        submissionMode: defaults().submissionMode,\n                        assessmentSections: [\n                            {\n                                'qti-type': 'assessmentSection',\n                                identifier: qtiTestHelper.getAvailableIdentifier(\n                                    modelOverseer.getModel(),\n                                    'assessmentSection',\n                                    defaults().sectionIdPrefix\n                                ),\n                                title: defaults().sectionTitlePrefix,\n                                index: 0,\n                                sectionParts: [],\n                                visible: true\n                            }\n                        ]\n                    });\n                }\n            });\n\n            //we listen the event not from the adder but  from the data binder to be sure the model is up to date\n            $(document)\n                .off('add.binder', '.testparts')\n                .on('add.binder', '.testparts', function (e, $testPart, added) {\n                    var partModel;\n                    if (e.namespace === 'binder' && $testPart.hasClass('testpart')) {\n                        partModel = testModel.testParts[added.index];\n\n                        //initialize the new test part\n                        testPartView.setUp(creatorContext, partModel, $testPart);\n                        // set index for new section\n                        actions.updateTitleIndex($('.section', $testPart));\n\n                        /**\n                         * @event modelOverseer#part-add\n                         * @param {Object} partModel\n                         */\n                        modelOverseer.trigger('part-add', partModel);\n                    }\n                });\n        }\n    }\n\n    return testView;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA ;\n */\n/**\n * Basic helper that is intended to generate outcomes processing rules for a test model.\n *\n * @author Jean-Sébastien Conan <jean-sebastien@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/helpers/processingRule',[\n    'lodash',\n    'taoQtiTest/controller/creator/helpers/outcomeValidator',\n    'taoQtiTest/controller/creator/helpers/qtiElement',\n    'taoQtiTest/controller/creator/helpers/baseType',\n    'taoQtiTest/controller/creator/helpers/cardinality'\n], function (_, outcomeValidator, qtiElementHelper, baseTypeHelper, cardinalityHelper) {\n    'use strict';\n\n    var processingRuleHelper = {\n        /**\n         * Creates a basic processing rule\n         * @param {String} type\n         * @param {String} [identifier]\n         * @param {Array|Object} [expression]\n         * @returns {Object}\n         * @throws {TypeError} if the type is empty or is not a string\n         * @throws {TypeError} if the identifier is not valid\n         * @throws {TypeError} if the expression does not contain valid QTI elements\n         */\n        create: function create(type, identifier, expression) {\n            var processingRule = qtiElementHelper.create(type, identifier && validateIdentifier(identifier));\n\n            if (expression) {\n                processingRuleHelper.setExpression(processingRule, expression);\n            }\n\n            return processingRule;\n        },\n\n        /**\n         * Sets an expression to a processing rule\n         * @param {Object} processingRule\n         * @param {Object|Array} expression\n         * @throws {TypeError} if the expression does not contain valid QTI elements\n         */\n        setExpression: function setExpression(processingRule, expression) {\n            if (processingRule) {\n                if (_.isArray(expression)) {\n                    if (processingRule.expression) {\n                        processingRule.expression = null;\n                    }\n                    processingRule.expressions = validateOutcomeList(expression);\n                } else {\n                    if (processingRule.expressions) {\n                        processingRule.expressions = null;\n                    }\n                    if (expression) {\n                        processingRule.expression = validateOutcome(expression);\n                    }\n                }\n            }\n        },\n\n        /**\n         * Adds an expression to a processing rule\n         * @param {Object} processingRule\n         * @param {Object|Array} expression\n         * @throws {TypeError} if the expression does not contain valid QTI elements\n         */\n        addExpression: function addExpression(processingRule, expression) {\n            if (processingRule && expression) {\n                if (processingRule.expression) {\n                    processingRule.expressions = forceArray(processingRule.expression);\n                    processingRule.expression = null;\n                }\n\n                if (_.isArray(expression)) {\n                    processingRule.expressions = forceArray(processingRule.expressions).concat(validateOutcomeList(expression));\n                } else {\n                    if (processingRule.expressions) {\n                        processingRule.expressions.push(expression);\n                    } else {\n                        processingRule.expression = validateOutcome(expression);\n                    }\n                }\n            }\n        },\n\n        /**\n         * Creates a `setOutcomeValue` rule\n         * @param {String} identifier\n         * @param {Object|Array} [expression]\n         * @returns {Object}\n         * @throws {TypeError} if the identifier is empty or is not a string\n         * @throws {TypeError} if the expression does not contain valid QTI elements\n         */\n        setOutcomeValue: function setOutcomeValue(identifier, expression) {\n            return processingRuleHelper.create('setOutcomeValue',  validateIdentifier(identifier), expression);\n        },\n\n        /**\n         * Creates a `gte` rule\n         * @param {Object|Array} left - the left operand\n         * @param {Object|Array} right - the right operand\n         * @returns {Object}\n         * @throws {TypeError} if the left and right operands are not valid QTI elements\n         */\n        gte: function gte(left, right) {\n            return binaryOperator('gte', left, right);\n        },\n\n        /**\n         * Creates a `lte` rule\n         * @param {Object|Array} left - the left operand\n         * @param {Object|Array} right - the right operand\n         * @returns {Object}\n         * @throws {TypeError} if the left and right operands are not valid QTI elements\n         */\n        lte: function lte(left, right) {\n            return binaryOperator('lte', left, right);\n        },\n\n        /**\n         * Creates a `divide` rule\n         * @param {Object|Array} left - the left operand\n         * @param {Object|Array} right - the right operand\n         * @returns {Object}\n         * @throws {TypeError} if the left and right operands are not valid QTI elements\n         */\n        divide: function divide(left, right) {\n            return binaryOperator('divide', left, right);\n        },\n\n        /**\n         * Creates a `sum` rule\n         * @param {Object|Array} terms\n         * @returns {Object}\n         * @throws {TypeError} if the terms are not valid QTI elements\n         */\n        sum: function sum(terms) {\n            var processingRule = processingRuleHelper.create('sum', null, forceArray(terms));\n\n            processingRule.minOperands = 1;\n            processingRule.maxOperands = -1;\n            processingRule.acceptedCardinalities = [cardinalityHelper.SINGLE, cardinalityHelper.MULTIPLE, cardinalityHelper.ORDERED];\n            processingRule.acceptedBaseTypes = [baseTypeHelper.INTEGER, baseTypeHelper.FLOAT];\n\n            return processingRule;\n        },\n\n        /**\n         * Creates a `testVariables` rule\n         * @param {String} identifier\n         * @param {String|Number} [type]\n         * @param {String} weightIdentifier\n         * @param {String|String[]} [includeCategories]\n         * @param {String|String[]} [excludeCategories]\n         * @returns {Object}\n         * @throws {TypeError} if the identifier is empty or is not a string\n         */\n        testVariables: function testVariables(identifier, type, weightIdentifier, includeCategories, excludeCategories) {\n            var processingRule = processingRuleHelper.create('testVariables');\n\n            processingRule.variableIdentifier = validateIdentifier(identifier);\n            processingRule.baseType = baseTypeHelper.getValid(type);\n            addWeightIdentifier(processingRule, weightIdentifier);\n            addSectionIdentifier(processingRule, '');\n            addCategories(processingRule, includeCategories, excludeCategories);\n\n            return processingRule;\n        },\n\n        /**\n         * Creates a `outcomeMaximum` rule\n         * @param {String} identifier\n         * @param {String} weightIdentifier\n         * @param {String|String[]} [includeCategories]\n         * @param {String|String[]} [excludeCategories]\n         * @returns {Object}\n         * @throws {TypeError} if the identifier is empty or is not a string\n         */\n        outcomeMaximum: function outcomeMaximum(identifier, weightIdentifier, includeCategories, excludeCategories) {\n            var processingRule = processingRuleHelper.create('outcomeMaximum');\n\n            processingRule.outcomeIdentifier = validateIdentifier(identifier);\n\n            addWeightIdentifier(processingRule, weightIdentifier);\n            addSectionIdentifier(processingRule, '');\n            addCategories(processingRule, includeCategories, excludeCategories);\n\n            return processingRule;\n        },\n\n        /**\n         * Creates a `numberPresented` rule\n         * @param {String|String[]} [includeCategories]\n         * @param {String|String[]} [excludeCategories]\n         * @returns {Object}\n         */\n        numberPresented: function numberPresented(includeCategories, excludeCategories) {\n            var processingRule = processingRuleHelper.create('numberPresented');\n\n            addSectionIdentifier(processingRule, '');\n            addCategories(processingRule, includeCategories, excludeCategories);\n\n            return processingRule;\n        },\n\n        /**\n         * Creates a `baseValue` rule\n         * @param {*} [value]\n         * @param {String|Number} [type]\n         * @returns {Object}\n         */\n        baseValue: function baseValue(value, type) {\n            var processingRule = processingRuleHelper.create('baseValue');\n\n            processingRule.baseType = baseTypeHelper.getValid(type, baseTypeHelper.FLOAT);\n            processingRule.value = baseTypeHelper.getValue(processingRule.baseType, value);\n\n            return processingRule;\n        },\n\n        /**\n         ** Creates a `variable` rule\n         * @param {String} identifier\n         * @param {String} [weightIdentifier]\n         * @returns {Object}\n         * @throws {TypeError} if the identifier is not valid\n         * @throws {TypeError} if the weight identifier is not valid\n         */\n        variable: function variable(identifier, weightIdentifier) {\n            var processingRule = processingRuleHelper.create('variable', validateIdentifier(identifier));\n\n            addWeightIdentifier(processingRule, weightIdentifier);\n\n            return processingRule;\n        },\n\n        /**\n         * Creates a `match` rule\n         * @param {Object|Array} left - the left operand\n         * @param {Object|Array} right - the right operand\n         * @returns {Object}\n         * @throws {TypeError} if the left and right operands are not valid QTI elements\n         */\n        match: function match(left, right) {\n            return binaryOperator('match', left, right, cardinalityHelper.SAME, cardinalityHelper.SAME);\n        },\n\n        /**\n         * Creates a `isNull` rule\n         * @param {Object|Array} expression - the operand\n         * @returns {Object}\n         * @throws {TypeError} if the operand is not valid QTI element\n         */\n        isNull: function isNull(expression) {\n            return unaryOperator('isNull', expression, baseTypeHelper.ANY, cardinalityHelper.ANY);\n        },\n\n        /**\n         * Creates a `outcomeCondition` rule\n         * @param {Object} outcomeIf\n         * @param {Object} outcomeElse\n         * @returns {Object}\n         * @throws {TypeError} if the outcomeIf and outcomeElse operands are not valid QTI elements\n         */\n        outcomeCondition: function outcomeCondition(outcomeIf, outcomeElse) {\n            var processingRule = processingRuleHelper.create('outcomeCondition');\n\n            if (!outcomeValidator.validateOutcome(outcomeIf, false, 'outcomeIf')) {\n                throw new TypeError('You must provide a valid outcomeIf element!');\n            }\n\n            if (outcomeElse && !outcomeValidator.validateOutcome(outcomeElse, false, 'outcomeElse')) {\n                throw new TypeError('You must provide a valid outcomeElse element!');\n            }\n\n            processingRule.outcomeIf = outcomeIf;\n            processingRule.outcomeElseIfs = [];\n\n            if (outcomeElse) {\n                processingRule.outcomeElse = outcomeElse;\n            }\n\n            return processingRule;\n        },\n\n        /**\n         * Creates a `outcomeIf` rule\n         * @param {Object} expression\n         * @param {Object|Object[]} instruction\n         * @returns {Object}\n         * @throws {TypeError} if the expression and instruction operands are not valid QTI elements\n         */\n        outcomeIf: function outcomeIf(expression, instruction) {\n            var processingRule = processingRuleHelper.create('outcomeIf');\n\n            if (!_.isArray(instruction)) {\n                instruction = [instruction];\n            }\n\n            processingRule.expression = validateOutcome(expression);\n            processingRule.outcomeRules = validateOutcomeList(instruction);\n\n            return processingRule;\n        },\n\n        /**\n         * Creates a `outcomeElse` rule\n         * @param {Object|Object[]} instruction\n         * @returns {Object}\n         * @throws {TypeError} if the instruction is not a valid QTI element\n         */\n        outcomeElse: function outcomeElse(instruction) {\n            var processingRule = processingRuleHelper.create('outcomeElse');\n\n            if (!_.isArray(instruction)) {\n                instruction = [instruction];\n            }\n\n            processingRule.outcomeRules = validateOutcomeList(instruction);\n\n            return processingRule;\n        }\n\n    };\n\n    /**\n     * Creates a unary operator rule\n     * @param {String} type - The rule type\n     * @param {Object|Array} expression - The operand\n     * @param {Number|Array} [baseType] - The accepted base type\n     * @param {Number|Array} [cardinality] - The accepted cardinality\n     * @returns {Object}\n     * @throws {TypeError} if the type is empty or is not a string\n     * @throws {TypeError} if the operand is not valid QTI element\n     */\n    function unaryOperator(type, expression, baseType, cardinality) {\n        var processingRule = processingRuleHelper.create(type, null, [expression]);\n\n        processingRule.minOperands = 1;\n        processingRule.maxOperands = 1;\n\n        addTypeAndCardinality(processingRule, baseType, cardinality);\n\n        return processingRule;\n    }\n\n    /**\n     * Creates a binary operator rule\n     * @param {String} type - The rule type\n     * @param {Object|Array} left - The left operand\n     * @param {Object|Array} right - The right operand\n     * @param {Number|Array} [baseType] - The accepted base type\n     * @param {Number|Array} [cardinality] - The accepted cardinality\n     * @returns {Object}\n     * @throws {TypeError} if the type is empty or is not a string\n     * @throws {TypeError} if the left and right operands are not valid QTI elements\n     */\n    function binaryOperator(type, left, right, baseType, cardinality) {\n        var processingRule = processingRuleHelper.create(type, null, [left, right]);\n\n        processingRule.minOperands = 2;\n        processingRule.maxOperands = 2;\n\n        addTypeAndCardinality(processingRule, baseType, cardinality);\n\n        return processingRule;\n    }\n\n    /**\n     * Appends the base type and the cardinality on a processing rule\n     * @param {Object} processingRule\n     * @param {Number|Array} [baseType] - The accepted base type\n     * @param {Number|Array} [cardinality] - The accepted cardinality\n     * @returns {Object}\n     */\n    function addTypeAndCardinality(processingRule, baseType, cardinality) {\n        if (_.isUndefined(baseType)) {\n            baseType = [baseTypeHelper.INTEGER, baseTypeHelper.FLOAT];\n        }\n\n        if (_.isUndefined(cardinality)) {\n            cardinality = [cardinalityHelper.SINGLE];\n        }\n\n        processingRule.acceptedCardinalities = forceArray(cardinality);\n        processingRule.acceptedBaseTypes = forceArray(baseType);\n\n        return processingRule;\n    }\n\n    /**\n     * Extends a processing rule with categories\n     * @param {Object} processingRule\n     * @param {Array|String} [includeCategories]\n     * @param {Array|String} [excludeCategories]\n     * @returns {Object}\n     */\n    function addCategories(processingRule, includeCategories, excludeCategories) {\n        processingRule.includeCategories = forceArray(includeCategories);\n        processingRule.excludeCategories = forceArray(excludeCategories);\n\n        return processingRule;\n    }\n\n    /**\n     * Appends the section identifier on a processing rule\n     * @param {Object} processingRule\n     * @param {String} [sectionIdentifier]\n     * @returns {Object}\n     * @throws {TypeError} if the weight identifier is not valid\n     */\n    function addSectionIdentifier(processingRule, sectionIdentifier) {\n        if (sectionIdentifier) {\n            if (!outcomeValidator.validateIdentifier(sectionIdentifier)) {\n                throw new TypeError('You must provide a valid weight identifier!');\n            }\n            processingRule.sectionIdentifier = sectionIdentifier;\n        } else {\n            processingRule.sectionIdentifier = '';\n        }\n\n        return processingRule;\n    }\n\n    /**\n     * Appends the weight identifier on a processing rule\n     * @param {Object} processingRule\n     * @param {String} [weightIdentifier]\n     * @returns {Object}\n     * @throws {TypeError} if the weight identifier is not valid\n     */\n    function addWeightIdentifier(processingRule, weightIdentifier) {\n        if (weightIdentifier) {\n            if (!outcomeValidator.validateIdentifier(weightIdentifier)) {\n                throw new TypeError('You must provide a valid weight identifier!');\n            }\n            processingRule.weightIdentifier = weightIdentifier;\n        } else {\n            processingRule.weightIdentifier = '';\n        }\n\n        return processingRule;\n    }\n\n    /**\n     * Validates an identifier\n     * @param {String} identifier\n     * @returns {String}\n     * @throws {TypeError} if the identifier is not valid\n     */\n    function validateIdentifier(identifier) {\n        if (!outcomeValidator.validateIdentifier(identifier)) {\n            throw new TypeError('You must provide a valid identifier!');\n        }\n        return identifier;\n    }\n\n    /**\n     * Validates an outcome\n     * @param {Object} outcome\n     * @returns {Object}\n     * @throws {TypeError} if the outcome is not valid\n     */\n    function validateOutcome(outcome) {\n        if (!outcomeValidator.validateOutcome(outcome)) {\n            throw new TypeError('You must provide a valid QTI element!');\n        }\n        return outcome;\n    }\n\n    /**\n     * Validates a list of outcomes\n     * @param {Array} outcomes\n     * @returns {Array}\n     * @throws {TypeError} if an outcome is not valid\n     */\n    function validateOutcomeList(outcomes) {\n        if (!outcomeValidator.validateOutcomes(outcomes)) {\n            throw new TypeError('You must provide a valid list of QTI elements!');\n        }\n        return outcomes;\n    }\n\n    /**\n     * Ensures a value is an array\n     * @param {*} value\n     * @returns {Array}\n     */\n    function forceArray(value) {\n        if (!value) {\n            value = [];\n        }\n        if (!_.isArray(value)) {\n            value = [value];\n        }\n        return value;\n    }\n\n    return processingRuleHelper;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2017 (original work) Open Assessment Technologies SA ;\n */\n/**\n * Basic helper that is intended to manage the score processing declaration in a test model.\n *\n * @author Jean-Sébastien Conan <jean-sebastien@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/helpers/scoring',[\n    'lodash',\n    'i18n',\n    'core/format',\n    'taoQtiTest/controller/creator/helpers/baseType',\n    'taoQtiTest/controller/creator/helpers/outcome',\n    'taoQtiTest/controller/creator/helpers/processingRule'\n], function (_, __, format, baseTypeHelper, outcomeHelper, processingRuleHelper) {\n    'use strict';\n\n    /**\n     * The default cut score\n     * @todo Move this to a config file\n     * @type {Number}\n     */\n    var defaultCutScore = 0.5;\n\n    /**\n     * The name of the variable containing the score\n     * @type {String}\n     */\n    var defaultScoreIdentifier = 'SCORE';\n\n    /**\n     * The list of supported processing modes, indexed by mode identifier\n     * @type {Object}\n     */\n    var processingModes = {\n        none: {\n            key: 'none',\n            label: __('None'),\n            description: __('No outcome processing. Erase the existing rules, if any.')\n        },\n        custom: {\n            key: 'custom',\n            label: __('Custom'),\n            description: __('Custom outcome processing. No changes will be made to the existing rules.')\n        },\n        total: {\n            key: 'total',\n            label: __('Total score'),\n            description: __('The score will be processed for the entire test. A sum of all SCORE outcomes will be computed, the result will take place in the SCORE_TOTAL outcome.')\n                         + ' ' +\n                         __('If the category option is set, the score will also be processed per categories, and each results will take place in the SCORE_xxx outcome, where xxx is the name of the category.')\n        },\n        cut: {\n            key: 'cut',\n            label: __('Cut score'),\n            description: __('The score will be processed for the entire test. A sum of all SCORE outcomes will be computed and divided by the sum of MAX SCORE, the result will be compared to the cut score (or pass ratio), then the PASS_TOTAL outcome will be set accordingly.')\n                         + ' ' +\n                         __('If the category option is set, the score will also be processed per categories, and each results will take place in the PASS_xxx outcome, where xxx is the name of the category.')\n        }\n    };\n\n    /**\n     * The list of recipes to generate the outcomes\n     * @type {Object}\n     */\n    var outcomesRecipes = {\n        none: {\n            key: 'none',\n            clean: true\n        },\n        custom: {\n            key: 'custom',\n            clean: false\n        },\n        total: {\n            key: 'total',\n            signature: /^SCORE_([a-zA-Z][a-zA-Z0-9_\\.-]*)$/,\n            outcomes: [{\n                writer: 'total',\n                identifier: 'SCORE_TOTAL',\n                weighted: 'SCORE_TOTAL_WEIGHTED',\n                categoryIdentifier: 'SCORE_CATEGORY_%s',\n                categoryWeighted: 'SCORE_CATEGORY_WEIGHTED_%s'\n            }, {\n                writer: 'max',\n                identifier: 'SCORE_TOTAL_MAX',\n                weighted: 'SCORE_TOTAL_MAX_WEIGHTED',\n                categoryIdentifier: 'SCORE_CATEGORY_MAX_%s',\n                categoryWeighted: 'SCORE_CATEGORY_WEIGHTED_MAX_%s'\n            }, {\n                writer: 'ratio',\n                identifier: 'SCORE_RATIO',\n                weighted: 'SCORE_RATIO_WEIGHTED',\n                scoreIdentifier: {\n                    total : 'SCORE_TOTAL',\n                    max : 'SCORE_TOTAL_MAX'\n                },\n                scoreWeighted : {\n                    total : 'SCORE_TOTAL_WEIGHTED',\n                    max : 'SCORE_TOTAL_MAX_WEIGHTED',\n                },\n            }],\n            clean: true\n        },\n        cut: {\n            key: 'cut',\n            include: 'total',\n            signature: /^PASS_([a-zA-Z][a-zA-Z0-9_\\.-]*)$/,\n            outcomes: [{\n                writer: 'cut',\n                identifier: 'PASS_ALL',\n                feedback: 'PASS_ALL_RENDERING',\n                feedbackOk: \"passed\",\n                feedbackFailed: \"not_passed\",\n                categoryIdentifier: 'PASS_CATEGORY_%s',\n                categoryFeedback: 'PASS_CATEGORY_%s_RENDERING'\n            }],\n            clean: true\n        }\n    };\n\n    /**\n     * List of writers that provide the outcomes for each score processing mode.\n     * @type {Object}\n     */\n    var outcomesWriters = {\n        /**\n         * Generates the outcomes that compute the \"Score ratio\"\n         * @param {Object} descriptor\n         * @param {Object} scoring\n         * @param {Object} outcomes\n         */\n        ratio : function writerRatio(descriptor, scoring, outcomes){\n            addRatioOutcomes(outcomes, descriptor.identifier, descriptor.scoreIdentifier.total, descriptor.scoreIdentifier.max);\n            if(scoring.weightIdentifier){\n                //add weighted ratio outcome only when the scoring outcome processing rule uses a weight\n                addRatioOutcomes(outcomes, descriptor.weighted, descriptor.scoreWeighted.total, descriptor.scoreWeighted.max);\n            }\n        },\n\n        /**\n         * Generates the outcomes that compute the \"Total score\"\n         * @param {Object} descriptor\n         * @param {Object} scoring\n         * @param {Object} outcomes\n         * @param {Array} [categories]\n         */\n        total: function writerTotal(descriptor, scoring, outcomes, categories) {\n            // create the outcome and the rule that process the overall score\n            addTotalScoreOutcomes(outcomes, scoring, descriptor.identifier, false);\n            if (descriptor.weighted && scoring.weightIdentifier) {\n                addTotalScoreOutcomes(outcomes, scoring, descriptor.weighted, true);\n            }\n\n            // create an outcome per categories\n            if (descriptor.categoryIdentifier && categories) {\n                _.forEach(categories, function (category) {\n                    addTotalScoreOutcomes(outcomes, scoring, formatCategoryOutcome(category, descriptor.categoryIdentifier), false, category);\n                    if (descriptor.categoryWeighted && scoring.weightIdentifier) {\n                        addTotalScoreOutcomes(outcomes, scoring, formatCategoryOutcome(category, descriptor.categoryWeighted), true, category);\n                    }\n                });\n            }\n        },\n\n        /**\n         * Generates the outcomes that compute the \"Max score\"\n         * @param {Object} descriptor\n         * @param {Object} scoring\n         * @param {Object} outcomes\n         * @param {Array} [categories]\n         */\n        max: function writerMax(descriptor, scoring, outcomes, categories) {\n            // create the outcome and the rule that process the maximum overall score\n            addMaxScoreOutcomes(outcomes, scoring, descriptor.identifier, false);\n            if (descriptor.weighted && scoring.weightIdentifier) {\n                addMaxScoreOutcomes(outcomes, scoring, descriptor.weighted, true);\n            }\n\n            // create an outcome per categories\n            if (descriptor.categoryIdentifier && categories) {\n                _.forEach(categories, function (category) {\n                    addMaxScoreOutcomes(outcomes, scoring, formatCategoryOutcome(category, descriptor.categoryIdentifier), false, category);\n                    if (descriptor.categoryWeighted && scoring.weightIdentifier) {\n                        addMaxScoreOutcomes(outcomes, scoring, formatCategoryOutcome(category, descriptor.categoryWeighted), true, category);\n                    }\n                });\n            }\n        },\n\n        /**\n         * Generates the outcomes that compute the \"Cut score\"\n         * @param {Object} descriptor\n         * @param {Object} scoring\n         * @param {Object} outcomes\n         * @param {Array} [categories]\n         */\n        cut: function writerCut(descriptor, scoring, outcomes, categories) {\n            var cutScore = scoring.cutScore;\n            var totalModeOutcomes = outcomesRecipes.total.outcomes;\n            var total = _.find(totalModeOutcomes, {writer: 'total'});\n            var max = _.find(totalModeOutcomes, {writer: 'max'});\n            var ratio = _.find(totalModeOutcomes, {writer: 'ratio'});\n            var whichOutcome = scoring.weightIdentifier ? 'weighted' : 'identifier';\n            var ratioIdentifier = ratio[whichOutcome];\n\n            // create the outcome and the rule that process the overall score\n            addGlobalCutScoreOutcomes(outcomes, descriptor.identifier, ratioIdentifier, cutScore);\n\n            // create the outcome and the rule that process the score feedback\n            if (descriptor.feedback) {\n                addFeedbackScoreOutcomes(\n                    outcomes,\n                    descriptor.feedback,\n                    descriptor.identifier,\n                    descriptor.feedbackOk,\n                    descriptor.feedbackFailed\n                );\n            }\n\n            // create an outcome per category\n            if (descriptor.categoryIdentifier && categories) {\n                _.forEach(categories, function (category) {\n                    var categoryOutcome = scoring.weightIdentifier ? 'categoryWeighted' : 'categoryIdentifier';\n                    var categoryOutcomeIdentifier = formatCategoryOutcome(category, descriptor.categoryIdentifier);\n                    var categoryScoreIdentifier = formatCategoryOutcome(category, total[categoryOutcome]);\n                    var categoryCountIdentifier = formatCategoryOutcome(category, max[categoryOutcome]);\n\n                    addCutScoreOutcomes(outcomes, categoryOutcomeIdentifier, categoryScoreIdentifier, categoryCountIdentifier, cutScore);\n\n                    if (descriptor.categoryFeedback) {\n                        addFeedbackScoreOutcomes(\n                            outcomes,\n                            formatCategoryOutcome(category, descriptor.categoryFeedback),\n                            categoryOutcomeIdentifier,\n                            descriptor.feedbackOk,\n                            descriptor.feedbackFailed\n                        );\n                    }\n                });\n            }\n\n            return outcomes;\n        }\n    };\n\n    var scoringHelper = {\n        /**\n         * Checks the test model against outcome processing mode.\n         * Initializes the scoring property accordingly.\n         *\n         * @param {modelOverseer} modelOverseer\n         * @throws {TypeError} if the modelOverseer is invalid\n         * @fires modelOverseer#scoring-init\n         * @fires modelOverseer#scoring-generate\n         * @fires modelOverseer#scoring-write\n         */\n        init: function init(modelOverseer) {\n            var model;\n\n            if (!modelOverseer || !_.isFunction(modelOverseer.getModel)) {\n                throw new TypeError(\"You must provide a valid modelOverseer\");\n            }\n\n            model = modelOverseer.getModel();\n\n            // detect the score processing mode and build the descriptor used to manage the UI\n            model.scoring = detectScoring(modelOverseer);\n\n            modelOverseer\n                .on('scoring-change category-change delete', function () {\n                    /**\n                     * Regenerates the outcomes on any significant changes.\n                     * After the outcomes have been generated a write is needed to actually apply the data.\n                     * Other component can listen to this event and eventually prevent the write to happen.\n                     * @event modelOverseer#scoring-generate\n                     * @param {Object} outcomes\n                     */\n                    modelOverseer.trigger('scoring-generate', scoringHelper.generate(modelOverseer));\n                })\n                .on('scoring-generate', function (outcomes) {\n                    outcomeHelper.replaceOutcomes(model, outcomes);\n\n                    /**\n                     * The generated outcome have just been applied on the model.\n                     * @event modelOverseer#scoring-write\n                     * @param {Object} testModel\n                     */\n                    modelOverseer.trigger('scoring-write', model);\n                })\n\n                /**\n                 * @event modelOverseer#scoring-init\n                 * @param {Object} testModel\n                 */\n                .trigger('scoring-init', model);\n        },\n\n        /**\n         * If the processing mode has been set, generates the outcomes that define the scoring.\n         *\n         * @param {modelOverseer} modelOverseer\n         * @returns {Object}\n         * @throws {TypeError} if the modelOverseer is invalid or the processing mode is unknown\n         */\n        generate: function generate(modelOverseer) {\n            var model, scoring, outcomes, outcomeRecipe, recipes, categories;\n\n            if (!modelOverseer || !_.isFunction(modelOverseer.getModel)) {\n                throw new TypeError(\"You must provide a valid modelOverseer\");\n            }\n\n            model = modelOverseer.getModel();\n            scoring = model.scoring;\n            outcomes = getOutcomes(model);\n\n            // write the score processing mode by generating the outcomes variables, but only if the mode has been set\n            if (scoring) {\n                outcomeRecipe = outcomesRecipes[scoring.outcomeProcessing];\n                if (outcomeRecipe) {\n\n                    if (outcomeRecipe.clean) {\n                        // erase the existing rules, they will be replaced by those that are defined here\n                        removeScoring(outcomes);\n                    }\n\n                    // get the recipes that define the outcomes, include sub-recipes if any\n                    recipes = getRecipes(outcomeRecipe);\n\n                    // only get the categories if requested\n                    if (handleCategories(modelOverseer)) {\n                        categories = modelOverseer.getCategories();\n                    }\n\n                    // will generate outcomes based of the defined recipe\n                    _.forEach(recipes, function(recipe) {\n                        var writer = outcomesWriters[recipe.writer];\n                        writer(recipe, scoring, outcomes, categories);\n                    });\n\n                } else {\n                    throw new Error('Unknown score processing mode: ' + scoring.outcomeProcessing);\n                }\n            }\n\n            return outcomes;\n        }\n    };\n\n    /**\n     * Creates an outcome and the rule that process the total score\n     *\n     * @param {Object} model\n     * @param {Object} scoring\n     * @param {String} identifier\n     * @param {Boolean} [weight]\n     * @param {String} [category]\n     */\n    function addTotalScoreOutcomes(model, scoring, identifier, weight, category) {\n        var outcome = outcomeHelper.createOutcome(identifier, baseTypeHelper.FLOAT);\n        var processingRule = processingRuleHelper.setOutcomeValue(identifier,\n            processingRuleHelper.sum(\n                processingRuleHelper.testVariables(scoring.scoreIdentifier, -1, weight && scoring.weightIdentifier, category)\n            )\n        );\n\n        outcomeHelper.addOutcome(model, outcome, processingRule);\n    }\n\n    /**\n     * Creates an outcome and the rule that process the maximum score\n     *\n     * @param {Object} model\n     * @param {Object} scoring\n     * @param {String} identifier\n     * @param {Boolean} [weight]\n     * @param {String} [category]\n     */\n    function addMaxScoreOutcomes(model, scoring, identifier, weight, category) {\n        var outcome = outcomeHelper.createOutcome(identifier, baseTypeHelper.FLOAT);\n        var processingRule = processingRuleHelper.setOutcomeValue(identifier,\n            processingRuleHelper.sum(\n                processingRuleHelper.testVariables('MAXSCORE', -1, weight && scoring.weightIdentifier, category)\n            )\n        );\n        outcomeHelper.addOutcome(model, outcome, processingRule);\n    }\n\n    /**\n     * Create an outcome and the rule that process the score ratio\n     *\n     * @param model\n     * @param identifier\n     * @param identifierTotal\n     * @param identifierMax\n     */\n    function addRatioOutcomes(model, identifier, identifierTotal, identifierMax) {\n        var outcome = outcomeHelper.createOutcome(identifier, baseTypeHelper.FLOAT);\n        var outcomeCondition = processingRuleHelper.outcomeCondition(\n            processingRuleHelper.outcomeIf(\n                processingRuleHelper.isNull(\n                    processingRuleHelper.variable(identifierMax)\n                ),\n                processingRuleHelper.setOutcomeValue(identifier,\n                    processingRuleHelper.baseValue(0, baseTypeHelper.FLOAT)\n                )\n            ),\n            processingRuleHelper.outcomeElse(\n                processingRuleHelper.setOutcomeValue(identifier,\n                    processingRuleHelper.divide(\n                        processingRuleHelper.variable(identifierTotal),\n                        processingRuleHelper.variable(identifierMax)\n                    )\n                )\n            )\n        );\n\n        outcomeHelper.addOutcome(model, outcome);\n        outcomeHelper.addOutcomeProcessing(model, outcomeCondition);\n    }\n\n    /**\n     * Creates an outcome and the rule that process the cut score by category\n     *\n     * @param {Object} model\n     * @param {String} identifier\n     * @param {String} scoreIdentifier\n     * @param {String} countIdentifier\n     * @param {String|Number} cutScore\n     */\n    function addCutScoreOutcomes(model, identifier, scoreIdentifier, countIdentifier, cutScore) {\n        var outcome = outcomeHelper.createOutcome(identifier, baseTypeHelper.BOOLEAN);\n        var processingRule = processingRuleHelper.setOutcomeValue(identifier,\n            processingRuleHelper.gte(\n                processingRuleHelper.divide(\n                    processingRuleHelper.variable(scoreIdentifier),\n                    processingRuleHelper.variable(countIdentifier)\n                ),\n                processingRuleHelper.baseValue(cutScore, baseTypeHelper.FLOAT)\n            )\n        );\n\n        outcomeHelper.addOutcome(model, outcome, processingRule);\n    }\n\n    /**\n     * Creates an outcome and the rule that process the global cut score\n     *\n     * @param {Object} model\n     * @param {String} identifier\n     * @param {String} scoreIdentifier\n     * @param {String} countIdentifier\n     * @param {String|Number} cutScore\n     */\n    function addGlobalCutScoreOutcomes(model, identifier, ratioIdentifier, cutScore) {\n        var outcome = outcomeHelper.createOutcome(identifier, baseTypeHelper.BOOLEAN);\n        var processingRule = processingRuleHelper.setOutcomeValue(identifier,\n            processingRuleHelper.gte(\n                processingRuleHelper.variable(ratioIdentifier),\n                processingRuleHelper.baseValue(cutScore, baseTypeHelper.FLOAT)\n            )\n        );\n\n        outcomeHelper.addOutcome(model, outcome, processingRule);\n    }\n\n    /**\n     * Creates an outcome and the rule that process the score feedback\n     *\n     * @param {Object} model\n     * @param {String} identifier\n     * @param {String} variable\n     * @param {String} passed\n     * @param {String} notPassed\n     */\n    function addFeedbackScoreOutcomes(model, identifier, variable, passed, notPassed) {\n        var type = baseTypeHelper.IDENTIFIER;\n        var outcome = outcomeHelper.createOutcome(identifier, type);\n        var processingRule = processingRuleHelper.outcomeCondition(\n            processingRuleHelper.outcomeIf(\n                processingRuleHelper.match(\n                    processingRuleHelper.variable(variable),\n                    processingRuleHelper.baseValue(true, baseTypeHelper.BOOLEAN)\n                ),\n                processingRuleHelper.setOutcomeValue(identifier,\n                    processingRuleHelper.baseValue(passed, type)\n                )\n            ),\n            processingRuleHelper.outcomeElse(\n                processingRuleHelper.setOutcomeValue(identifier,\n                    processingRuleHelper.baseValue(notPassed, type)\n                )\n            )\n        );\n\n        outcomeHelper.addOutcome(model, outcome);\n        outcomeHelper.addOutcomeProcessing(model, processingRule);\n    }\n\n    /**\n     * Formats the identifier of a category outcome\n     * @param {String} category\n     * @param {String} template\n     * @returns {String}\n     */\n    function formatCategoryOutcome(category, template) {\n        return format(template, category.toUpperCase());\n    }\n\n    /**\n     * Checks whether an identifier belongs to a particular recipe\n     * @param {String} identifier\n     * @param {Object} recipe\n     * @param {Boolean} [onlyCategories]\n     * @returns {Boolean}\n     */\n    function belongToRecipe(identifier, recipe, onlyCategories) {\n        var match = false;\n        if (recipe.signature && recipe.signature.test(identifier)) {\n            match = true;\n            if (onlyCategories) {\n                _.forEach(recipe.outcomes, function(outcome) {\n                    if (outcome.identifier === identifier ||\n                        (outcome.weighted && outcome.weighted === identifier) ||\n                        (outcome.feedback && outcome.feedback === identifier)) {\n                        match = false;\n                        return false;\n                    }\n                });\n            }\n        }\n        return match;\n    }\n\n    /**\n     * Checks if all the outcomes are related to the recipe\n     * @param {Object} outcomeRecipe\n     * @param {Array} outcomes\n     * @param {Array} categories\n     * @returns {Boolean}\n     */\n    function matchRecipe(outcomeRecipe, outcomes, categories) {\n        var signatures = getSignatures(outcomeRecipe);\n        var match = true;\n\n        // check the outcomes definitions against the provided identifier\n        function matchRecipeOutcome(recipe, identifier) {\n            var outcomeMatch = false;\n\n            // first level, the signature must match\n            if (recipe.signature && recipe.signature.test(identifier)) {\n                _.forEach(recipe.outcomes, function(outcome) {\n                    // second level, the main identifier must match\n                    if (outcome.identifier !== identifier &&\n                        (!outcome.weighted || (outcome.weighted && outcome.weighted !== identifier)) &&\n                        (!outcome.feedback || (outcome.feedback && outcome.feedback !== identifier))) {\n\n                        if (categories) {\n                            // third level, a category must match\n                            _.forEach(categories, function(category) {\n                                if (outcome.categoryIdentifier &&\n                                    identifier === formatCategoryOutcome(category, outcome.categoryIdentifier)) {\n                                    outcomeMatch = true;\n                                } else if (outcome.categoryWeighted &&\n                                    identifier === formatCategoryOutcome(category, outcome.categoryWeighted)) {\n                                    outcomeMatch = true;\n                                } else if (outcome.categoryFeedback &&\n                                    identifier === formatCategoryOutcome(category, outcome.categoryFeedback)) {\n                                    outcomeMatch = true;\n                                }\n                                // found something?\n                                if (outcomeMatch) {\n                                    return false;\n                                }\n                            });\n                        }\n                    } else {\n                        outcomeMatch = true;\n                    }\n\n                    // found something?\n                    if (outcomeMatch) {\n                        return false;\n                    }\n                });\n            }\n\n            if (!outcomeMatch && recipe.include) {\n                outcomeMatch = matchRecipeOutcome(outcomesRecipes[recipe.include], identifier);\n            }\n\n            return outcomeMatch;\n        }\n\n        // only check the outcomes that are related to the scoring mode\n        _.forEach(outcomes, function(identifier) {\n            var signatureMatch = false;\n            _.forEach(signatures, function(signature) {\n                if (signature.test(identifier)) {\n                    signatureMatch = true;\n                    return false;\n                }\n            });\n\n            if (signatureMatch) {\n                match = matchRecipeOutcome(outcomeRecipe, identifier);\n\n                if (!match) {\n                    return false;\n                }\n            }\n        });\n\n        return match;\n    }\n\n    /**\n     * Gets all the outcomes signatures related to a scoring mode\n     * @param {Object} recipe\n     * @returns {Array}\n     */\n    function getSignatures(recipe) {\n        var signatures = [];\n\n        // list the signatures for each processing mode, taking care of includes\n        while(recipe) {\n            if (recipe.signature) {\n                signatures.push(recipe.signature);\n            }\n            recipe = recipe.include && outcomesRecipes[recipe.include];\n        }\n\n        return signatures;\n    }\n\n    /**\n     * Gets all the outcomes recipes related to a scoring mode\n     * @param {Object} recipe\n     * @returns {Array}\n     */\n    function getRecipes(recipe) {\n        var descriptors = [];\n\n        // get the recipes that define the outcomes, include sub-recipes if any\n        while(recipe) {\n            if (recipe.outcomes) {\n                descriptors = [].concat(recipe.outcomes, descriptors);\n            }\n            recipe = recipe.include && outcomesRecipes[recipe.include];\n        }\n\n        return descriptors;\n    }\n\n    /**\n     * Checks if an outcome is related to the outcomes recipe,\n     * then returns the recipe descriptor.\n     * @param {Object|String} outcome\n     * @returns {Object}\n     */\n    function getOutcomesRecipe(outcome) {\n        var identifier = outcomeHelper.getOutcomeIdentifier(outcome);\n        var mode = null;\n        _.forEach(outcomesRecipes, function (processingRecipe) {\n            if (belongToRecipe(identifier, processingRecipe)) {\n                mode = processingRecipe;\n                return false;\n            }\n        });\n        return mode;\n    }\n\n    /**\n     * Gets the score processing modes from a list of outcomes\n     * @param {Array} outcomes\n     * @returns {Array}\n     */\n    function listScoringModes(outcomes) {\n        var modes = {};\n        _.forEach(outcomes, function (outcome) {\n            var recipe = getOutcomesRecipe(outcome);\n            if (recipe) {\n                modes[recipe.key] = true;\n            }\n        });\n        return _.keys(modes);\n    }\n\n    /**\n     * Checks whether the categories have to be taken into account\n     * @param {modelOverseer} modelOverseer\n     * @returns {Boolean}\n     */\n    function handleCategories(modelOverseer) {\n        var model = modelOverseer.getModel();\n        return !!(model.scoring && model.scoring.categoryScore);\n    }\n\n    /**\n     * Checks if the test model contains outcomes for categories\n     * @param {Object} model\n     * @returns {Boolean}\n     */\n    function hasCategoryOutcome(model) {\n        var categoryOutcomes = false;\n        _.forEach(outcomeHelper.getOutcomeDeclarations(model), function (outcomeDeclaration) {\n            var identifier = outcomeHelper.getOutcomeIdentifier(outcomeDeclaration);\n            _.forEach(outcomesRecipes, function (processingRecipe) {\n                if (belongToRecipe(identifier, processingRecipe, true)) {\n                    categoryOutcomes = true;\n                    return false;\n                }\n            });\n        });\n        return categoryOutcomes;\n    }\n\n    /**\n     * Gets the defined cut score from the outcome rules\n     * @param {Object} model\n     * @returns {Number}\n     */\n    function getCutScore(model) {\n        var values = _(outcomeHelper.getOutcomeProcessingRules(model)).map(function (outcome) {\n            return outcomeHelper.getProcessingRuleProperty(outcome, 'setOutcomeValue.gte.baseValue.value');\n        }).compact().uniq().value();\n        if (_.isEmpty(values)) {\n            values = [defaultCutScore];\n        }\n        return Math.max(0, _.max(values));\n    }\n\n    /**\n     * Gets the defined weight identifier from the outcome rules\n     * @param {Object} model\n     * @returns {String}\n     */\n    function getWeightIdentifier(model) {\n        var values = [];\n        outcomeHelper.eachOutcomeProcessingRuleExpressions(model, function (processingRule) {\n            if (processingRule['qti-type'] === 'testVariables' && processingRule.weightIdentifier) {\n                values.push(processingRule.weightIdentifier);\n            }\n        });\n        values = _(values).compact().uniq().value();\n\n        return values.length ? values[0] : '';\n    }\n\n    /**\n     * Detects the outcome processing mode for the scoring\n     * @param {modelOverseer} modelOverseer\n     * @returns {String}\n     */\n    function getOutcomeProcessing(modelOverseer) {\n        var model = modelOverseer.getModel();\n        var outcomeDeclarations = outcomeHelper.getOutcomeDeclarations(model);\n        var outcomeRules = outcomeHelper.getOutcomeProcessingRules(model);\n\n        // walk through each outcome declaration, and tries to identify the score processing mode\n        var declarations = listScoringModes(outcomeDeclarations);\n        var processing = listScoringModes(outcomeRules);\n        var diff = _.difference(declarations, processing);\n        var count = _.size(declarations);\n        var included;\n\n        // default fallback, applied when several modes are detected at the same time\n        var outcomeProcessing = 'custom';\n\n        // set the score processing mode with respect to the found outcomes\n        if (count === _.size(processing)) {\n            if (!count) {\n                // no mode detected, set the mode to none\n                outcomeProcessing = 'none';\n            } else if (_.isEmpty(diff)) {\n                if (count > 1) {\n                    // several modes detected, try to reduce the list by detecting includes\n                    included = [];\n                    _.forEach(declarations, function(mode) {\n                        if (outcomesRecipes[mode] && outcomesRecipes[mode].include) {\n                            included.push(outcomesRecipes[mode].include);\n                        }\n                    });\n                    processing = _.difference(processing, included);\n                    count = _.size(processing);\n                }\n\n                if (count === 1) {\n                    // single mode detected, keep the last got key\n                    outcomeProcessing = processing[0];\n\n                    // check if all outcomes are strictly related to the detected mode\n                    if (!matchRecipe(outcomesRecipes[outcomeProcessing], modelOverseer.getOutcomesNames(), modelOverseer.getCategories())) {\n                        outcomeProcessing = 'custom';\n                    }\n                }\n            }\n        }\n\n        return outcomeProcessing;\n    }\n\n    /**\n     * Detects the score processing mode and builds the descriptor used to manage the UI.\n     * @param {modelOverseer} modelOverseer\n     * @returns {Object}\n     */\n    function detectScoring(modelOverseer) {\n        var model = modelOverseer.getModel();\n        return {\n            modes: processingModes,\n            scoreIdentifier: defaultScoreIdentifier,\n            weightIdentifier: getWeightIdentifier(model),\n            cutScore: getCutScore(model),\n            categoryScore: hasCategoryOutcome(model),\n            outcomeProcessing: getOutcomeProcessing(modelOverseer)\n        };\n    }\n\n    /**\n     * Removes all scoring outcomes\n     * @param {Object} model\n     */\n    function removeScoring(model) {\n        var scoringOutcomes = _.indexBy(outcomeHelper.listOutcomes(model, getOutcomesRecipe), function (outcome) {\n            return outcome;\n        });\n\n        outcomeHelper.removeOutcomes(model, function(outcome) {\n            var match = false;\n\n            function browseExpressions(processingRule) {\n                if (_.isArray(processingRule)) {\n                    _.forEach(processingRule, browseExpressions);\n                } else if (processingRule) {\n                    if (scoringOutcomes[outcomeHelper.getOutcomeIdentifier(processingRule)]) {\n                        match = true;\n                    }\n\n                    if (!match && processingRule.expression) {\n                        browseExpressions(processingRule.expression);\n                    }\n                    if (!match && processingRule.expressions) {\n                        browseExpressions(processingRule.expressions);\n                    }\n                    if (!match && processingRule.outcomeRules) {\n                        browseExpressions(processingRule.outcomeRules);\n                    }\n                    if (!match && processingRule.outcomeIf) {\n                        browseExpressions(processingRule.outcomeIf);\n                    }\n                    if (!match && processingRule.outcomeElse) {\n                        browseExpressions(processingRule.outcomeElse);\n                    }\n                }\n            }\n\n            if (outcome['qti-type'] === 'outcomeCondition') {\n                browseExpressions(outcome);\n            } else {\n                match = !!scoringOutcomes[outcomeHelper.getOutcomeIdentifier(outcome)];\n            }\n            return match;\n        });\n    }\n\n    /**\n     * Gets a copy of the list of outcomes, provides the same structure as the model\n     * @param {Object} model\n     * @returns {Object}\n     */\n    function getOutcomes(model) {\n        return {\n            outcomeDeclarations: [].concat(outcomeHelper.getOutcomeDeclarations(model)),\n            outcomeProcessing: {\n                outcomeRules: [].concat(outcomeHelper.getOutcomeProcessingRules(model))\n            }\n        };\n    }\n\n    return scoringHelper;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2020 Open Assessment Technologies SA ;\n */\n/**\n * Track the change within the testCreator\n * @author Juan Luis Gutierrez Dos Santos <juanluis.gutierrezdossantos@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/helpers/changeTracker',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'lib/uuid',\n    'core/eventifier',\n    'ui/dialog',\n    'ui/feedback',\n], function (\n    $,\n    _,\n    __,\n    uuid,\n    eventifier,\n    dialog,\n    feedback\n) {\n    'use strict';\n\n    /**\n     * The messages asking to save\n     */\n    const messages = {\n        preview: __('The test needs to be saved before it can be previewed.'),\n        leave: __('The test has unsaved changes, are you sure you want to leave?'),\n        exit: __('The test has unsaved changes, would you like to save it?'),\n        leaveWhenInvalid: __('If you leave the test, your changes will not be saved due to invalid test settings. Are you sure you wish to leave?')\n    };\n    const buttonsYesNo = [{\n        id: 'dontsave',\n        type: 'regular',\n        label: __('YES'),\n        close: true\n    }, {\n        id: 'cancel',\n        type: 'regular',\n        label: __('NO'),\n        close: true\n    }];\n    const buttonsCancelSave = [{\n        id: 'dontsave',\n        type: 'regular',\n        label: __('Don\\'t save'),\n        close: true\n    }, {\n        id: 'cancel',\n        type: 'regular',\n        label: __('Cancel'),\n        close: true\n    }, {\n        id: 'save',\n        type: 'info',\n        label: __('Save'),\n        close: true\n    }];\n\n    /**\n     *\n     * @param {HTMLElement} container\n     * @param {testCreator} testCreator\n     * @param {String} [wrapperSelector]\n     * @returns {changeTracker}\n     */\n    function changeTrackerFactory(container, testCreator, wrapperSelector = 'body') {\n\n        // internal namespace for global registered events\n        const eventNS = `.ct-${uuid(8, 16)}`;\n\n        // keep the value of the test before changes\n        let originalTest;\n\n        // are we in the middle of the confirm process?\n        let asking = false;\n\n        /**\n         * @typedef {Object} changeTracker\n         */\n        const changeTracker = eventifier({\n            /**\n             * Initialized the changed state\n             * @returns {changeTracker}\n             */\n            init() {\n                originalTest = this.getSerializedTest();\n\n                return this;\n            },\n\n            /**\n             * Installs the change tracker, registers listeners\n             * @returns {changeTracker}\n             */\n            install() {\n                this.init();\n                asking = false;\n\n                // add a browser popup to prevent leaving the browser\n                $(window)\n                    .on(`beforeunload${eventNS}`, () => {\n                        if (!asking && this.hasChanged()) {\n                            return messages.leave;\n                        }\n                    })\n                    // since we don't know how to prevent history based events, we just stop the handling\n                    .on('popstate', this.uninstall);\n\n                // every click outside the authoring\n                $(wrapperSelector)\n                    .on(`click${eventNS}`, e => {\n                        if (!$.contains(container, e.target) && this.hasChanged() && e.target.classList[0] !== 'icon-close') {\n                            e.stopImmediatePropagation();\n                            e.preventDefault();\n\n                            if (testCreator.isTestHasErrors()) {\n                                this.confirmBefore('leaveWhenInvalid')\n                                    .then(whatToDo => {\n                                        this.ifWantSave(whatToDo);\n                                        this.uninstall();\n                                        e.target.click();\n                                    })\n                                    .catch(() => {});\n                            } else {\n                                this.confirmBefore('exit')\n                                    .then(whatToDo => {\n                                        this.ifWantSave(whatToDo);\n                                        this.uninstall();\n                                        e.target.click();\n                                    })\n                                    //do nothing but prevent uncaught error\n                                    .catch(() => {});\n                            }\n                        }\n                    });\n\n                testCreator\n                    .on(`ready${eventNS} saved${eventNS}`, () => this.init())\n                    .before(`creatorclose${eventNS}`, () => {\n                        let leavingStatus = 'leave';\n                        if(testCreator.isTestHasErrors()) {\n                            leavingStatus ='leaveWhenInvalid';\n                        }\n                        return this.confirmBefore(leavingStatus).then(whatToDo => {\n                            this.ifWantSave(whatToDo);\n                        })})\n                    .before(`preview${eventNS}`, () => this.confirmBefore('preview').then(whatToDo => {\n                        if(testCreator.isTestHasErrors()){\n                            feedback().warning(`${__('The test cannot be saved because it currently contains invalid settings.\\n' +\n                                'Please fix the invalid settings and try again.')}`);\n                        } else {\n                        this.ifWantSave(whatToDo);\n                        }\n                    }))\n                    .before(`exit${eventNS}`, () => this.uninstall());\n\n                return this;\n            },\n\n            /**\n             * Check if we need to trigger save\n             * @param {Object} whatToDo\n             * @fires {save}\n             */\n            ifWantSave(whatToDo) {\n                if (whatToDo && whatToDo.ifWantSave) {\n                    testCreator.trigger('save');\n                }\n            },\n\n\n            /**\n             * Uninstalls the change tracker, unregisters listeners\n             * @returns {changeTracker}\n             */\n            uninstall() {\n                // remove all global handlers\n                $(window.document)\n                    .off(eventNS);\n                $(window).off(eventNS);\n                $(wrapperSelector).off(eventNS);\n                testCreator.off(eventNS);\n\n                return this;\n            },\n\n            /**\n             * Displays a confirmation dialog,\n             * The \"ok\" button will save and resolve.\n             * The \"cancel\" button will reject.\n             *\n             * @param {String} message - the confirm message to display\n             * @returns {Promise} resolves once saved\n             */\n            confirmBefore(message) {\n                // if a key is given load the related message\n                message = messages[message] || message;\n\n                return new Promise((resolve, reject) => {\n                    if (asking) {\n                        return reject();\n                    }\n\n                    if (!this.hasChanged()) {\n                        return resolve();\n                    }\n\n                    asking = true;\n                    let confirmDlg;\n\n                    // chosses what buttons to display depending on the message\n                    if(message === messages.leaveWhenInvalid) {\n                        confirmDlg = dialog({\n                            message: message,\n                            buttons: buttonsYesNo,\n                            autoRender: true,\n                            autoDestroy: true,\n                            onDontsaveBtn: () => resolve({ ifWantSave: false }),\n                            onCancelBtn: () => {\n                                confirmDlg.hide();\n                                reject({ cancel: true });\n                            }\n                        });\n                    } else {\n                        confirmDlg = dialog({\n                           message: message,\n                           buttons: buttonsCancelSave,\n                           autoRender: true,\n                           autoDestroy: true,\n                           onSaveBtn: () => resolve({ ifWantSave: true }),\n                           onDontsaveBtn: () => resolve({ ifWantSave: false }),\n                           onCancelBtn: () => {\n                               confirmDlg.hide();\n                               reject({ cancel: true });\n                           }\n                      });\n                    }\n                    confirmDlg.on('closed.modal', () => asking = false);\n                });\n            },\n\n            /**\n             * Does the test have changed?\n             * @returns {Boolean}\n             */\n            hasChanged() {\n                const currentTest = this.getSerializedTest();\n                return originalTest !== currentTest || (null === currentTest && null === originalTest);\n            },\n\n            /**\n             * Get a string representation of the current test, used for comparison\n             * @returns {String} the test\n             */\n            getSerializedTest() {\n                let serialized = '';\n                try {\n                    // create a string from the test content\n                    serialized = JSON.stringify(testCreator.getModelOverseer().getModel());\n\n                    // sometimes the creator strip spaces between tags, so we do the same\n                    serialized = serialized.replace(/ {2,}/g, ' ');\n                } catch (err) {\n                    serialized = null;\n                }\n                return serialized;\n            }\n        });\n\n        return changeTracker.install();\n    }\n\n    return changeTrackerFactory;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014-2021 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n */\n/**\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoQtiTest/controller/creator/creator',[\n    'module',\n    'jquery',\n    'lodash',\n    'helpers',\n    'i18n',\n    'services/features',\n    'ui/feedback',\n    'core/databindcontroller',\n    'taoQtiTest/controller/creator/qtiTestCreator',\n    'taoQtiTest/controller/creator/views/item',\n    'taoQtiTest/controller/creator/views/test',\n    'taoQtiTest/controller/creator/views/testpart',\n    'taoQtiTest/controller/creator/views/section',\n    'taoQtiTest/controller/creator/views/itemref',\n    'taoQtiTest/controller/creator/encoders/dom2qti',\n    'taoQtiTest/controller/creator/templates/index',\n    'taoQtiTest/controller/creator/helpers/qtiTest',\n    'taoQtiTest/controller/creator/helpers/scoring',\n    'taoQtiTest/controller/creator/helpers/categorySelector',\n    'taoQtiTest/controller/creator/helpers/validators',\n    'taoQtiTest/controller/creator/helpers/changeTracker',\n    'taoQtiTest/controller/creator/helpers/featureVisibility',\n    'taoTests/previewer/factory',\n    'core/logger',\n    'taoQtiTest/controller/creator/views/subsection'\n], function (\n    module,\n    $,\n    _,\n    helpers,\n    __,\n    features,\n    feedback,\n    DataBindController,\n    qtiTestCreatorFactory,\n    itemView,\n    testView,\n    testPartView,\n    sectionView,\n    itemrefView,\n    Dom2QtiEncoder,\n    templates,\n    qtiTestHelper,\n    scoringHelper,\n    categorySelector,\n    validators,\n    changeTracker,\n    featureVisibility,\n    previewerFactory,\n    loggerFactory,\n    subsectionView\n) {\n    ('use strict');\n    const logger = loggerFactory('taoQtiTest/controller/creator');\n\n    /**\n     * The test creator controller is the main entry point\n     * and orchestrates data retrieval and view/components loading.\n     * @exports creator/controller\n     */\n    const Controller = {\n        routes: {},\n\n        /**\n         * Start the controller, main entry method.\n         * @public\n         * @param {Object} options\n         * @param {Object} options.labels - the list of item's labels to give to the ItemView\n         * @param {Object} options.routes - action's urls\n         * @param {Object} options.categoriesPresets - predefined category that can be set at the item or section level\n         * @param {Boolean} [options.guidedNavigation=false] - feature flag for the guided navigation\n         */\n        start(options) {\n            const $container = $('#test-creator');\n            const $saver = $('#saver');\n            const $previewer = $('#previewer');\n            const $back = $('#authoringBack');\n\n            let creatorContext;\n            let binder;\n            let binderOptions;\n            let modelOverseer;\n\n            this.identifiers = [];\n\n            options = _.merge(module.config(), options || {});\n            options.routes = options.routes || {};\n            options.labels = options.labels || {};\n            options.categoriesPresets = featureVisibility.filterVisiblePresets(options.categoriesPresets) || {};\n            options.guidedNavigation = options.guidedNavigation === true;\n\n            categorySelector.setPresets(options.categoriesPresets);\n\n            //back button\n            $back.on('click', e => {\n                e.preventDefault();\n                creatorContext.trigger('creatorclose');\n            });\n\n            //preview button\n            if (!Object.keys(options.labels).length) {\n                $previewer.attr('disabled', true).addClass('disabled');\n            }\n            $previewer.on('click', e => {\n                e.preventDefault();\n                if (!$previewer.hasClass('disabled')) {\n                    creatorContext.trigger('preview');\n                }\n            });\n            const isTestContainsItems = () => {\n                if ($container.find('.test-content').find('.itemref').length) {\n                    $previewer.attr('disabled', false).removeClass('disabled');\n                    return true;\n                } else {\n                    $previewer.attr('disabled', true).addClass('disabled');\n                    return false;\n                }\n            };\n\n            //set up the ItemView, give it a configured loadItems ref\n            itemView($('.test-creator-items .item-selection', $container));\n\n            // forwards some binder events to the model overseer\n            $container.on('change.binder delete.binder', (e, model) => {\n                if (e.namespace === 'binder' && model && modelOverseer) {\n                    modelOverseer.trigger(e.type, model);\n                }\n            });\n\n            //Data Binding options\n            binderOptions = _.merge(options.routes, {\n                filters: {\n                    isItemRef: value => qtiTestHelper.filterQtiType(value, 'assessmentItemRef'),\n                    isSection: value => qtiTestHelper.filterQtiType(value, 'assessmentSection')\n                },\n                encoders: {\n                    dom2qti: Dom2QtiEncoder\n                },\n                templates: templates,\n                beforeSave(model) {\n                    //ensure the qti-type is present\n                    qtiTestHelper.addMissingQtiType(model);\n\n                    //apply consolidation rules\n                    qtiTestHelper.consolidateModel(model);\n\n                    //validate the model\n                    try {\n                        validators.validateModel(model);\n                    } catch (err) {\n                        $saver.attr('disabled', false).removeClass('disabled');\n                        feedback().error(`${__('The test has not been saved.')} + ${err}`);\n                        return false;\n                    }\n                    return true;\n                }\n            });\n\n            //set up the databinder\n            binder = DataBindController.takeControl($container, binderOptions).get(model => {\n                creatorContext = qtiTestCreatorFactory($container, {\n                    uri: options.uri,\n                    labels: options.labels,\n                    routes: options.routes,\n                    guidedNavigation: options.guidedNavigation\n                });\n                creatorContext.setTestModel(model);\n                modelOverseer = creatorContext.getModelOverseer();\n\n                //detect the scoring mode\n                scoringHelper.init(modelOverseer);\n\n                //register validators\n                validators.registerValidators(modelOverseer);\n\n                //once model is loaded, we set up the test view\n                testView(creatorContext);\n\n                //listen for changes to update available actions\n                testPartView.listenActionState();\n                sectionView.listenActionState();\n                subsectionView.listenActionState();\n                itemrefView.listenActionState();\n\n                changeTracker($container.get()[0], creatorContext, '.content-wrap');\n\n                creatorContext.on('save', function () {\n                    if (!$saver.hasClass('disabled')) {\n                        $saver.prop('disabled', true).addClass('disabled');\n                        binder.save(\n                            function () {\n                                $saver.prop('disabled', false).removeClass('disabled');\n                                feedback().success(__('Test Saved'));\n                                isTestContainsItems();\n                                creatorContext.trigger('saved');\n                            },\n                            function () {\n                                $saver.prop('disabled', false).removeClass('disabled');\n                            }\n                        );\n                    }\n                });\n\n                creatorContext.on('preview', function () {\n                    if (isTestContainsItems() && !creatorContext.isTestHasErrors()) {\n                        const saveUrl = options.routes.save;\n                        const testUri = saveUrl.slice(saveUrl.indexOf('uri=') + 4);\n                        const config = module.config();\n                        return previewerFactory(config.provider, decodeURIComponent(testUri), {\n                            readOnly: false,\n                            fullPage: true,\n                            pluginsOptions: config.pluginsOptions\n                        }).catch(err => {\n                            logger.error(err);\n                            feedback().error(\n                                __('Test Preview is not installed, please contact to your administrator.')\n                            );\n                        });\n                    }\n                });\n\n                creatorContext.on('creatorclose', () => {\n                    creatorContext.trigger('exit');\n                    window.history.back();\n                });\n            });\n\n            //the save button triggers binder's save action.\n            $saver.on('click', function (event) {\n                if (creatorContext.isTestHasErrors()) {\n                    event.preventDefault();\n                    feedback().warning(\n                        __('The test cannot be saved because it currently contains invalid settings.\\nPlease fix the invalid settings and try again.')\n                    );\n                } else {\n                    creatorContext.trigger('save');\n                }\n            });\n        }\n    };\n\n    return Controller;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA ;\n */\n/**\n * @author Jean-Sébastien Conan <jean-sebastien.conan@vesperiagroup.com>\n */\ndefine('taoQtiTest/controller/creator/helpers/ckConfigurator',['ui/ckeditor/ckConfigurator', 'mathJax'], function(ckConfigurator) {\n    'use strict';\n\n    /**\n     * Generate a configuration object for CKEDITOR\n     *\n     * @param editor instance of ckeditor\n     * @param toolbarType block | inline | flow | qtiBlock | qtiInline | qtiFlow | reset to get back to normal\n     * @param {Object} [options] - is based on the CKEDITOR config object with some additional sugar\n     *        Note that it's here you need to add parameters for the resource manager.\n     *        Some options are not covered in http://docs.ckeditor.com/#!/api/CKEDITOR.config\n     * @param [options.dtdOverrides] - @see dtdOverrides which pre-defines them\n     * @param {Object} [options.positionedPlugins] - @see ckConfig.positionedPlugins\n     * @param {Boolean} [options.qtiImage] - enables the qtiImage plugin\n     * @param {Boolean} [options.qtiInclude] - enables the qtiInclude plugin\n     * @param {Boolean} [options.underline] - enables the underline plugin\n     * @param {Boolean} [options.mathJax] - enables the mathJax plugin\n     *\n     * @see http://docs.ckeditor.com/#!/api/CKEDITOR.config\n     */\n    var getConfig = function(editor, toolbarType, options){\n        options = options || {};\n\n        options.underline = true;\n\n        return ckConfigurator.getConfig(editor, toolbarType, options);\n    };\n\n    return {\n        getConfig : getConfig\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\n\n//@see http://forge.taotesting.com/projects/tao/wiki/Front_js\ndefine('taoQtiTest/controller/routes',[],function () {\n    'use strict';\n\n    return {\n        Creator: {\n            css: 'creator',\n            actions: {\n                index: 'controller/creator/creator'\n            }\n        },\n        XmlEditor: {\n            actions: {\n                edit: 'controller/content/edit'\n            }\n        }\n    };\n});\n\n","\ndefine('css!taoQtiTestCss/new-test-runner',[],function(){});\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2016-2019 (original work) Open Assessment Technologies SA ;\n */\n\n/**\n * Test runner controller entry\n *\n * @author Bertrand Chevrier <bertrand@taotesting.com>\n */\ndefine('taoQtiTest/controller/runner/runner',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'context',\n    'module',\n    'core/router',\n    'core/logger',\n    'layout/loading-bar',\n    'ui/feedback',\n    'util/url',\n    'util/locale',\n    'taoTests/runner/providerLoader',\n    'taoTests/runner/runner',\n    'css!taoQtiTestCss/new-test-runner'\n], function (\n    $,\n    _,\n    __,\n    context,\n    module,\n    router,\n    loggerFactory,\n    loadingBar,\n    feedback,\n    urlUtil,\n    locale,\n    providerLoader,\n    runner\n) {\n    'use strict';\n\n    /**\n     * List of options required by the controller\n     * @type {String[]}\n     */\n    const requiredOptions = [\n        'testDefinition',\n        'testCompilation',\n        'serviceCallId',\n        'bootstrap',\n        'options',\n        'providers'\n    ];\n\n    /**\n     * The runner controller\n     */\n    return {\n\n        /**\n         * Controller entry point\n         *\n         * @param {Object} config - the testRunner config\n         * @param {String} config.testDefinition - the test definition id\n         * @param {String} config.testCompilation - the test compilation id\n         * @param {String} config.serviceCallId - the service call id\n         * @param {Object} config.bootstrap - contains the extension and the controller to call\n         * @param {Object} config.options - the full URL where to return at the final end of the test\n         * @param {Object[]} config.providers - the collection of providers to load\n         */\n        start(config) {\n            let exitReason;\n            const $container = $('.runner');\n\n            const logger = loggerFactory('controller/runner', {\n                serviceCallId : config.serviceCallId,\n                plugins : config && config.providers && Object.keys(config.providers.plugins)\n            });\n\n            let preventFeedback = false;\n            let errorFeedback = null;\n\n            /**\n             * Exit the test runner using the configured exitUrl\n             * @param {String} [reason] - to add a warning once left\n             * @param {String} [level] - error level\n             */\n            const exit = function exit(reason, level){\n                let url = config.options.exitUrl;\n                const params = {};\n                if (reason) {\n                    if (!level) {\n                        level = 'warning';\n                    }\n                    params[level] = reason;\n                    url = urlUtil.build(url, params);\n                }\n                window.location = url;\n            };\n\n            /**\n             * Handles errors\n             * @param {Error} err - the thrown error\n             * @param {String} [displayMessage] - an alternate message to display\n             */\n            const onError = function onError(err, displayMessage) {\n                onFeedback(err, displayMessage, \"error\");\n            };\n\n            /**\n             * Handles warnings\n             * @param {Error} err - the thrown error\n             * @param {String} [displayMessage] - an alternate message to display\n             */\n            const onWarning = function onWarning(err, displayMessage) {\n                onFeedback(err, displayMessage, \"warning\");\n            };\n\n            /**\n             * Handles errors & warnings\n             * @param {Error} err - the thrown error\n             * @param {String} [displayMessage] - an alternate message to display\n             * @param {String} [type] - \"error\" or \"warning\"\n             */\n            const onFeedback = function onFeedback(err, displayMessage, type) {\n                const typeMap = {\n                    warning: {\n                        logger: \"warn\",\n                        feedback: \"warning\"\n                    },\n                    error: {\n                        logger: \"error\",\n                        feedback: \"error\"\n                    }\n                };\n                const loggerByType = logger[typeMap[type].logger];\n                const feedbackByType = feedback()[typeMap[type].feedback];\n\n                displayMessage = displayMessage || err.message;\n\n                if(!_.isString(displayMessage)){\n                    displayMessage = JSON.stringify(displayMessage);\n                }\n                loadingBar.stop();\n\n                loggerByType({ displayMessage : displayMessage }, err);\n\n                if(type === \"error\" && (err.code === 403 || err.code === 500)) {\n                    displayMessage = `${__('An error occurred during the test, please content your administrator.')} ${displayMessage}`;\n                    return exit(displayMessage, 'error');\n                }\n                if (!preventFeedback) {\n                    errorFeedback = feedbackByType(displayMessage, {timeout: -1});\n                }\n            };\n\n            const moduleConfig = module.config();\n\n            loadingBar.start();\n\n            // adding attr for RTL languages\n            $('.delivery-scope').attr({dir: locale.getLanguageDirection(context.locale)});\n\n            // verify required config\n            if ( ! requiredOptions.every( option => typeof config[option] !== 'undefined') ) {\n                return onError(new TypeError(__('Missing required configuration option %s', name)));\n            }\n\n            // dispatch any extra registered routes\n            if (moduleConfig && _.isArray(moduleConfig.extraRoutes) && moduleConfig.extraRoutes.length) {\n                router.dispatch(moduleConfig.extraRoutes);\n            }\n\n            //for the qti provider to be selected here\n            config.provider = Object.assign( config.provider || {}, { runner: 'qti' });\n\n            //load the plugins and the proxy provider\n            providerLoader(config.providers, context.bundle)\n                .then(function (results) {\n\n                    const testRunnerConfig = _.omit(config, ['providers']);\n                    testRunnerConfig.renderTo = $container;\n\n                    if (results.proxy && typeof results.proxy.getAvailableProviders === 'function') {\n                        const loadedProxies = results.proxy.getAvailableProviders();\n                        testRunnerConfig.provider.proxy = loadedProxies[0];\n                    }\n\n                    logger.debug({\n                        config: testRunnerConfig,\n                        providers : config.providers\n                    }, 'Start test runner');\n\n                    //instantiate the QtiTestRunner\n                    runner(config.provider.runner, results.plugins, testRunnerConfig)\n                        .on('error', onError)\n                        .on('warning', onWarning)\n                        .on('ready', function () {\n                            _.defer(function () {\n                                $container.removeClass('hidden');\n                            });\n                        })\n                        .on('pause', function(data) {\n                            if (data && data.reason) {\n                                exitReason = data.reason;\n                            }\n                        })\n                        .after('destroy', function () {\n                            this.removeAllListeners();\n\n                            // at the end, we are redirected to the exit URL\n                            exit(exitReason);\n                        })\n\n                        //FIXME this event should not be triggered on the test runner\n                        .on('disablefeedbackalerts', function() {\n                            if (errorFeedback) {\n                                errorFeedback.close();\n                            }\n                            preventFeedback = true;\n                        })\n\n                        //FIXME this event should not be triggered on the test runner\n                        .on('enablefeedbackalerts', function() {\n                            preventFeedback = false;\n                        })\n                        .init();\n                })\n                .catch(function(err){\n                    onError(err, __('An error occurred during the test initialization!'));\n                });\n        }\n    };\n});\n\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA ;\n *\n */\n\n/**\n * This module allows adding extra buttons in the action bar of the test runner\n *\n */\ndefine('taoQtiTest/testRunner/actionBarHook',[\n    'jquery',\n    'lodash',\n    'core/errorHandler',\n    'core/promise'\n], function ($, _, errorHandler, Promise) {\n\n    'use strict';\n\n    /**\n     * Events namespace\n     * @type {String}\n     * @private\n     */\n    var _ns = '.actionBarHook';\n\n    /**\n     * We need to access the root document to listen for some events\n     * @type {jQuery}\n     * @private\n     */\n    var $doc = $(document);\n\n    /**\n     * List of loaded and visible hooks\n     * @type {Object}\n     * @private\n     */\n    var tools = {};\n\n    /**\n     * Flag set to true when the item is loaded\n     * @type {Boolean}\n     * @private\n     */\n    var itemIsLoaded = false;\n\n    // catch the item loaded event\n    $doc.off(_ns).on('serviceloaded' + _ns, function() {\n        itemIsLoaded = true;\n        _.forEach(tools, function(tool) {\n            triggerItemLoaded(tool);\n        });\n    });\n\n    /**\n     * Check that the toolConfig is correct\n     *\n     * @param {Object} toolconfig\n     * @param {String} toolconfig.hook - the amd module to be loaded to initialize the button\n     * @param {String} [toolconfig.label] - the label to be displayed in the button\n     * @param {String} [toolconfig.icon] - the icon to be displayed in the button\n     * @param {String} [toolconfig.title] - the title to be displayed in the button\n     * @param {Array} [toolconfig.items] - an optional list of menu items\n     * @returns {Boolean}\n     */\n    function isValidConfig(toolconfig) {\n        return !!(_.isObject(toolconfig) && toolconfig.hook);\n    }\n\n    /**\n     * Triggers the itemLoaded event inside the provided actionBar hook\n     * @param {Object} tool\n     */\n    function triggerItemLoaded(tool) {\n        if (tool && tool.itemLoaded) {\n            tool.itemLoaded();\n        }\n    }\n\n    /**\n     * Init a test runner button from its config\n     *\n     * @param {String} id\n     * @param {Object|String} toolconfig\n     * @param {String} toolconfig.hook - the amd module to be loaded to initialize the button\n     * @param {String} [toolconfig.label] - the label to be displayed in the button\n     * @param {String} [toolconfig.icon] - the icon to be displayed in the button\n     * @param {String} [toolconfig.title] - the title to be displayed in the button\n     * @param {Array} [toolconfig.items] - an optional list of menu items\n     * @param {Object} testContext - the complete state of the test\n     * @param {Object} testRunner - the test runner instance\n     * @fires ready.actionBarHook when the hook has been initialized\n     * @returns {Promise}\n     */\n    function initQtiTool($toolsContainer, id, toolconfig, testContext, testRunner) {\n\n        // the tool is always initialized before the item is loaded, so we can safely false the flag\n        itemIsLoaded = false;\n        tools[id] = null;\n\n        if (_.isString(toolconfig)) {\n            toolconfig = {\n                hook: toolconfig\n            };\n        }\n\n        return new Promise(function(resolve) {\n            if (isValidConfig(toolconfig)) {\n\n                require([toolconfig.hook], function (hook) {\n\n                    var $button;\n                    var $existingBtn;\n\n                    if (isValidHook(hook)) {\n                        //init the control\n                        hook.init(id, toolconfig, testContext, testRunner);\n\n                        //if an instance of the tool is already attached, remove it:\n                        $existingBtn = $toolsContainer.children('[data-control=\"' + id + '\"]');\n                        if ($existingBtn.length) {\n                            hook.clear($existingBtn);\n                            $existingBtn.remove();\n                        }\n\n                        //check if the tool is to be available\n                        if (hook.isVisible()) {\n                            //keep access to the tool\n                            tools[id] = hook;\n\n                            // renders the button from the config\n                            $button = hook.render();\n\n                            //only attach the button to the dom when everything is ready\n                            _appendInOrder($toolsContainer, $button);\n\n                            //ready !\n                            $button.trigger('ready' + _ns, [hook]);\n\n                            //fires the itemLoaded event if the item has already been loaded\n                            if (itemIsLoaded) {\n                                triggerItemLoaded(hook);\n                            }\n                        }\n\n                        resolve(hook);\n                    } else {\n                        errorHandler.throw(_ns, 'invalid hook format');\n                        resolve(null);\n                    }\n\n                }, function (e) {\n                    errorHandler.throw(_ns, 'the hook amd module cannot be found');\n                    resolve(null);\n                });\n\n            } else {\n                errorHandler.throw(_ns, 'invalid tool config format');\n                resolve(null);\n            }\n        });\n    }\n\n    /**\n     * Append a dom element $button to a $container in a specific order\n     * The orders are provided by data-order attribute set to the $button\n     *\n     * @param {JQuery} $container\n     * @param {JQuery} $button\n     */\n    function _appendInOrder($container, $button) {\n\n        var $after, $before;\n        var order = $button.data('order');\n\n        if ('last' === order) {\n\n            $container.append($button);\n\n        } else if ('first' === order) {\n\n            $container.prepend($button);\n\n        } else {\n\n            order = _.parseInt(order);\n            if (!_.isNaN(order)) {\n\n                $container.children('.action').each(function () {\n\n                    var $btn = $(this),\n                        _order = $btn.data('order');\n\n                    if ('last' === _order) {\n\n                        $before = $btn;\n                        $after = null;\n\n                    } else if ('first' === _order) {\n\n                        $before = null;\n                        $after = $btn;\n\n                    } else {\n\n                        _order = _.parseInt(_order);\n\n                        if (_.isNaN(_order) || _order > order) {\n                            $before = $btn;\n                            $after = null;\n                            //stops here because $container children returns the dom elements in the dom order\n                            return false;\n                        } else if (_order === order) {\n                            $after = $btn;\n                        } else if (_order < order) {\n                            $after = $btn;\n                            $before = null;\n                        }\n\n                    }\n\n                });\n\n                if ($after) {\n                    $after.after($button);\n                } else if ($before) {\n                    $before.before($button);\n                } else {\n                    $container.append($button);\n                }\n\n            } else {\n                //unordered buttons are append at the end (including when order equals 0)\n                $container.append($button);\n            }\n        }\n    }\n\n    /**\n     * Check if the hook object is valid\n     *\n     * @param {Object} hook\n     * @param {Function} hook.init\n     * @param {Function} hook.clear\n     * @param {Function} hook.isVisible\n     * @returns {Boolean}\n     */\n    function isValidHook(hook) {\n        return (_.isObject(hook) && _(['init', 'render', 'clear', 'isVisible']).reduce(function (result, method) {\n            return result && _.isFunction(hook[method]);\n        }, true));\n    }\n\n    return {\n        isValid: isValidConfig,\n        initQtiTool: initQtiTool\n    };\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA ;\n */\n/**\n * @author Jean-Sébastien Conan <jean-sebastien.conan@vesperiagroup.com>\n */\ndefine('taoQtiTest/testRunner/actionBarTools',[\n    'jquery',\n    'lodash',\n    'core/eventifier',\n    'core/promise',\n    'taoQtiTest/testRunner/actionBarHook'\n], function ($, _, eventifier, Promise, actionBarHook) {\n    'use strict';\n\n    /**\n     * The list of registered actionBar tools\n     * @type {Object}\n     */\n    var registeredQtiTools;\n\n    /**\n     * The list of actionBar tools instances\n     * @type {Object}\n     */\n    var qtiTools;\n\n    /**\n     * Manages the actionBar tools\n     * @type {Object}\n     */\n    var actionBarTools = {\n        /**\n         * Registers the actionBar tools\n         * @param {Object} tools\n         */\n        register : function register(tools) {\n            var registerTools = tools || {};\n\n            /**\n             * @event actionBarTools#beforeregister\n             * @param {Object} tools\n             * @param {actionBarTools} this\n             */\n            this.trigger('beforeregister', registerTools, this);\n\n            registeredQtiTools = registerTools;\n\n            /**\n             * @event actionBarTools#afterregister\n             * @param {Object} tools\n             * @param {actionBarTools} this\n             */\n            this.trigger('afterregister', registerTools, this);\n        },\n\n        /**\n         * Gets the list of registered tools\n         * @returns {Object}\n         */\n        getRegisteredTools : function getRegisteredTools() {\n            return registeredQtiTools || {};\n        },\n\n        /**\n         * Gets a particular tool config\n         * @param {String} id\n         * @returns {Object}\n         */\n        getRegistered : function getRegistered(id) {\n            return registeredQtiTools && registeredQtiTools[id];\n        },\n\n        /**\n         * Checks if a particular tool is registered\n         * @param {String} id\n         * @returns {Boolean}\n         */\n        isRegistered : function isRegistered(id) {\n            return !!(registeredQtiTools && registeredQtiTools[id]);\n        },\n\n        /**\n         * Gets a particular tool\n         * @param {String} id\n         * @returns {Object}\n         */\n        get : function get(id) {\n            return qtiTools && qtiTools[id];\n        },\n\n        /**\n         * Gets the list of tools instances\n         * @returns {Array}\n         */\n        list : function list() {\n            return _.values(qtiTools || {});\n        },\n\n        /**\n         * Renders the actionBar\n         * @param {String|jQuery|HTMLElement} container - The container in which renders the tools\n         * @param {Object} testContext - The assessment test context\n         * @param {Object} testRunner - The assessment test runner\n         * @param {Function} [callback] - An optional callback fired when all tools have been rendered\n         */\n        render : function render(container, testContext, testRunner, callback) {\n            var self = this;\n            var $container = $(container);\n            var promises = [];\n\n            /**\n             * @event actionBarTools#beforerender\n             * @param {jQuery} $container\n             * @param {Object} testContext\n             * @param {Object} testRunner\n             * @param {actionBarTools} this\n             */\n            this.trigger('beforerender', $container, testContext, testRunner, this);\n\n            _.forIn(this.getRegisteredTools(), function(toolconfig, id){\n                promises.push(actionBarHook.initQtiTool($container, id, toolconfig, testContext, testRunner));\n            });\n\n            Promise.all(promises).then(function(values) {\n                var tools = [];\n                qtiTools = {};\n\n                _.forEach(values, function(tool) {\n                    if (tool) {\n                        tools.push(tool);\n                        qtiTools[tool.getId()] = tool;\n                    }\n                });\n\n                if (_.isFunction(callback)) {\n                    callback.call(self, tools, $container, testContext, testRunner, self);\n                }\n\n                /**\n                 * @event actionBarTools#afterrender\n                 * @param {Array} tools\n                 * @param {jQuery} $container\n                 * @param {Object} testContext\n                 * @param {Object} testRunner\n                 * @param {actionBarTools} this\n                 */\n                self.trigger('afterrender', tools, $container, testContext, testRunner, self);\n            });\n        }\n    };\n\n    return eventifier(actionBarTools);\n});\n\n","\ndefine('tpl!taoQtiTest/testRunner/tpl/navigator', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, functionType=\"function\", escapeExpression=this.escapeExpression, self=this, helperMissing=helpers.helperMissing;\n\nfunction program1(depth0,data) {\n  \n  \n  return \" hidden\";\n  }\n\n  buffer += \"<aside class=\\\"test-sidebar test-sidebar-\";\n  if (helper = helpers.region) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.region); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \" flex-container-navi qti-navigator\";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.hidden), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\\">\\n            <div class=\\\"qti-navigator-collapsible\\\">\\n                <span class=\\\"qti-navigator-collapse icon icon-left\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Collapse the review panel\", options) : helperMissing.call(depth0, \"__\", \"Collapse the review panel\", options)))\n    + \"\\\"></span>\\n                <span class=\\\"qti-navigator-expand icon icon-right\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Expand the review panel\", options) : helperMissing.call(depth0, \"__\", \"Expand the review panel\", options)))\n    + \"\\\"></span>\\n            </div>\\n\\n            <div class=\\\"qti-navigator-info collapsible\\\">\\n                <span class=\\\"qti-navigator-label\\\">\\n                    <span class=\\\"qti-navigator-text\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Test status\", options) : helperMissing.call(depth0, \"__\", \"Test status\", options)))\n    + \"</span>\\n                    <span class=\\\"icon-up\\\"></span>\\n                    <span class=\\\"icon-down\\\"></span>\\n                </span>\\n                <ul class=\\\"collapsible-panel plain\\\">\\n                    <li class=\\\"qti-navigator-viewed\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Viewed items\", options) : helperMissing.call(depth0, \"__\", \"Viewed items\", options)))\n    + \"\\\">\\n                        <span class=\\\"qti-navigator-label\\\">\\n                            <span class=\\\"qti-navigator-icon icon-viewed\\\"></span>\\n                            <span class=\\\"qti-navigator-text\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Viewed\", options) : helperMissing.call(depth0, \"__\", \"Viewed\", options)))\n    + \"</span>\\n                            <span class=\\\"qti-navigator-counter\\\">-/-</span>\\n                        </span>\\n                    </li>\\n                    <li class=\\\"qti-navigator-answered\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Completed items\", options) : helperMissing.call(depth0, \"__\", \"Completed items\", options)))\n    + \"\\\">\\n                        <span class=\\\"qti-navigator-label\\\">\\n                            <span class=\\\"qti-navigator-icon icon-answered\\\"></span>\\n                            <span class=\\\"qti-navigator-text\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Answered\", options) : helperMissing.call(depth0, \"__\", \"Answered\", options)))\n    + \"</span>\\n                            <span class=\\\"qti-navigator-counter\\\">-/-</span>\\n                        </span>\\n                    </li>\\n                    <li class=\\\"qti-navigator-unanswered\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Unanswered items\", options) : helperMissing.call(depth0, \"__\", \"Unanswered items\", options)))\n    + \"\\\">\\n                        <span class=\\\"qti-navigator-label\\\">\\n                            <span class=\\\"qti-navigator-icon icon-unanswered\\\"></span>\\n                            <span class=\\\"qti-navigator-text\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Unanswered\", options) : helperMissing.call(depth0, \"__\", \"Unanswered\", options)))\n    + \"</span>\\n                            <span class=\\\"qti-navigator-counter\\\">-/-</span>\\n                        </span>\\n                    </li>\\n                    <li class=\\\"qti-navigator-flagged\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Items marked for later review\", options) : helperMissing.call(depth0, \"__\", \"Items marked for later review\", options)))\n    + \"\\\">\\n                        <span class=\\\"qti-navigator-label\\\">\\n                            <span class=\\\"qti-navigator-icon icon-flagged\\\"></span>\\n                            <span class=\\\"qti-navigator-text\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Flagged\", options) : helperMissing.call(depth0, \"__\", \"Flagged\", options)))\n    + \"</span>\\n                            <span class=\\\"qti-navigator-counter\\\">-/-</span>\\n                        </span>\\n                    </li>\\n                </ul>\\n            </div>\\n\\n            <div class=\\\"qti-navigator-filters\\\">\\n                <ul role=\\\"tablist\\\" class=\\\"plain clearfix\\\">\\n                    <li role=\\\"tab\\\" aria-selected=\\\"true\\\" class=\\\"qti-navigator-filter active\\\" data-mode=\\\"all\\\">\\n                        <span title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Reset filters\", options) : helperMissing.call(depth0, \"__\", \"Reset filters\", options)))\n    + \"\\\" class=\\\"qti-navigator-tab\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"All\", options) : helperMissing.call(depth0, \"__\", \"All\", options)))\n    + \"</span>\\n                    </li>\\n                    <li role=\\\"tab\\\" class=\\\"qti-navigator-filter\\\" data-mode=\\\"unanswered\\\">\\n                        <span class=\\\"icon-unanswered qti-navigator-tab\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Only display the unanswered items\", options) : helperMissing.call(depth0, \"__\", \"Only display the unanswered items\", options)))\n    + \"\\\"></span>\\n                    </li>\\n                    <li role=\\\"tab\\\" class=\\\"qti-navigator-filter\\\" data-mode=\\\"flagged\\\">\\n                        <span class=\\\"icon-flagged qti-navigator-tab\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Only display the items marked for review\", options) : helperMissing.call(depth0, \"__\", \"Only display the items marked for review\", options)))\n    + \"\\\"></span>\\n                    </li>\\n                </ul>\\n            </div>\\n\\n            <nav class=\\\"qti-navigator-tree\\\">\\n            </nav>\\n\\n            <div id=\\\"qti-navigator-linear\\\" class=\\\"qti-navigator-linear\\\">\\n                <span class=\\\"icon icon-info\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"In this part of the test navigation is not allowed.\", options) : helperMissing.call(depth0, \"__\", \"In this part of the test navigation is not allowed.\", options)))\n    + \"\\\"></span>\\n                <p class=\\\"qti-navigator-message\\\">\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"In this part of the test navigation is not allowed.\", options) : helperMissing.call(depth0, \"__\", \"In this part of the test navigation is not allowed.\", options)))\n    + \"\\n                </p>\\n            </div>\\n        </aside>\";\n  return buffer;\n  });\n});\n\n","\ndefine('tpl!taoQtiTest/testRunner/tpl/navigatorTree', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, self=this, functionType=\"function\", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\n                    <li class=\\\"qti-navigator-part collapsible \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.active), {hash:{},inverse:self.program(4, program4, data),fn:self.program(2, program2, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\\" data-id=\\\"\";\n  if (helper = helpers.id) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.id); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\n                        <span class=\\\"qti-navigator-label\\\" title=\\\"\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\n                            <span class=\\\"qti-navigator-text\\\">\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</span>\\n                            <span class=\\\"icon-up\\\"></span>\\n                            <span class=\\\"icon-down\\\"></span>\\n                        </span>\\n                        \";\n  stack1 = helpers['if'].call(depth0, ((stack1 = (depth0 && depth0.sections)),stack1 == null || stack1 === false ? stack1 : stack1.length), {hash:{},inverse:self.program(29, program29, data),fn:self.program(6, program6, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n                    </li>\\n                    \";\n  return buffer;\n  }\nfunction program2(depth0,data) {\n  \n  \n  return \"active\";\n  }\n\nfunction program4(depth0,data) {\n  \n  \n  return \"collapsed\";\n  }\n\nfunction program6(depth0,data) {\n  \n  var buffer = \"\", stack1;\n  buffer += \"\\n                        <ul class=\\\"qti-navigator-sections collapsible-panel plain\\\">\\n                            \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.sections), {hash:{},inverse:self.noop,fn:self.program(7, program7, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n                        </ul>\\n                        \";\n  return buffer;\n  }\nfunction program7(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\n                            <li class=\\\"qti-navigator-section collapsible \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.active), {hash:{},inverse:self.program(4, program4, data),fn:self.program(2, program2, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\\" data-id=\\\"\";\n  if (helper = helpers.id) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.id); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\n                                <span class=\\\"qti-navigator-label\\\" title=\\\"\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\n                                    <span class=\\\"qti-navigator-text\\\">\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</span>\\n                                    <span class=\\\"qti-navigator-counter\\\">\";\n  if (helper = helpers.answered) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.answered); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"/\"\n    + escapeExpression(((stack1 = ((stack1 = (depth0 && depth0.items)),stack1 == null || stack1 === false ? stack1 : stack1.length)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))\n    + \"</span>\\n                                </span>\\n                                <ul class=\\\"qti-navigator-items collapsible-panel plain\\\">\\n                                    \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.items), {hash:{},inverse:self.noop,fn:self.program(8, program8, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n                                </ul>\\n                            </li>\\n                            \";\n  return buffer;\n  }\nfunction program8(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\n                                    <li class=\\\"qti-navigator-item\";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.active), {hash:{},inverse:self.noop,fn:self.program(9, program9, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.flagged), {hash:{},inverse:self.noop,fn:self.program(11, program11, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.answered), {hash:{},inverse:self.noop,fn:self.program(13, program13, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.viewed), {hash:{},inverse:self.program(17, program17, data),fn:self.program(15, program15, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\\" data-id=\\\"\";\n  if (helper = helpers.id) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.id); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" data-position=\\\"\";\n  if (helper = helpers.position) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.position); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\n                                        <span class=\\\"qti-navigator-label truncate\\\" title=\\\"\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\n                                            <span class=\\\"qti-navigator-icon icon-\";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.flagged), {hash:{},inverse:self.program(21, program21, data),fn:self.program(19, program19, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\\"></span>\\n                                            <span class=\\\"qti-navigator-number\\\">\"\n    + escapeExpression(((stack1 = (data == null || data === false ? data : data.index)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))\n    + \"</span>\\n                                            \";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\n                                        </span>\\n                                    </li>\\n                                    \";\n  return buffer;\n  }\nfunction program9(depth0,data) {\n  \n  \n  return \" active\";\n  }\n\nfunction program11(depth0,data) {\n  \n  \n  return \" flagged\";\n  }\n\nfunction program13(depth0,data) {\n  \n  \n  return \" answered\";\n  }\n\nfunction program15(depth0,data) {\n  \n  \n  return \" viewed\";\n  }\n\nfunction program17(depth0,data) {\n  \n  \n  return \" unseen\";\n  }\n\nfunction program19(depth0,data) {\n  \n  \n  return \"flagged\";\n  }\n\nfunction program21(depth0,data) {\n  \n  var stack1;\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.answered), {hash:{},inverse:self.program(24, program24, data),fn:self.program(22, program22, data),data:data});\n  if(stack1 || stack1 === 0) { return stack1; }\n  else { return ''; }\n  }\nfunction program22(depth0,data) {\n  \n  \n  return \"answered\";\n  }\n\nfunction program24(depth0,data) {\n  \n  var stack1;\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.viewed), {hash:{},inverse:self.program(27, program27, data),fn:self.program(25, program25, data),data:data});\n  if(stack1 || stack1 === 0) { return stack1; }\n  else { return ''; }\n  }\nfunction program25(depth0,data) {\n  \n  \n  return \"viewed\";\n  }\n\nfunction program27(depth0,data) {\n  \n  \n  return \"unseen\";\n  }\n\nfunction program29(depth0,data) {\n  \n  var buffer = \"\", stack1, helper, options;\n  buffer += \"\\n                        <div class=\\\"qti-navigator-linear-part collapsible-panel\\\">\\n                            <span class=\\\"icon icon-info\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"In this part of the test navigation is not allowed.\", options) : helperMissing.call(depth0, \"__\", \"In this part of the test navigation is not allowed.\", options)))\n    + \"\\\"></span>\\n                            <p class=\\\"qti-navigator-message\\\">\\n                                \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"In this part of the test navigation is not allowed.\", options) : helperMissing.call(depth0, \"__\", \"In this part of the test navigation is not allowed.\", options)))\n    + \"\\n                            </p>\\n                            <p class=\\\"qti-navigator-actions\\\">\\n                                <button class=\\\"btn-info small\\\" data-id=\\\"\";\n  if (helper = helpers.itemId) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.itemId); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" data-position=\\\"\";\n  if (helper = helpers.position) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.position); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Start Test-part\", options) : helperMissing.call(depth0, \"__\", \"Start Test-part\", options)))\n    + \"\\\">\\n                                    <span class=\\\"qti-navigator-text\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Start Test-part\", options) : helperMissing.call(depth0, \"__\", \"Start Test-part\", options)))\n    + \"</span>\\n                                    <span class=\\\"icon-play r\\\"></span>\\n                                </button>\\n                            </p>\\n                        </div>\\n                        \";\n  return buffer;\n  }\n\n  buffer += \"<ul class=\\\"qti-navigator-parts plain\\\">\\n                    \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.parts), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n                </ul>\";\n  return buffer;\n  });\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA ;\n */\n/**\n * @author Jean-Sébastien Conan <jean-sebastien.conan@vesperiagroup.com>\n */\ndefine('taoQtiTest/testRunner/testReview',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'tpl!taoQtiTest/testRunner/tpl/navigator',\n    'tpl!taoQtiTest/testRunner/tpl/navigatorTree',\n    'util/capitalize'\n], function ($, _, __, navigatorTpl, navigatorTreeTpl, capitalize) {\n    'use strict';\n\n    /**\n     * List of CSS classes\n     * @type {Object}\n     * @private\n     */\n    var _cssCls = {\n        active : 'active',\n        collapsed : 'collapsed',\n        collapsible : 'collapsible',\n        hidden : 'hidden',\n        disabled : 'disabled',\n        flagged : 'flagged',\n        answered : 'answered',\n        viewed : 'viewed',\n        unseen : 'unseen',\n        icon : 'qti-navigator-icon',\n        scope : {\n            test : 'scope-test',\n            testPart : 'scope-test-part',\n            testSection : 'scope-test-section'\n        }\n    };\n\n    /**\n     * List of common CSS selectors\n     * @type {Object}\n     * @private\n     */\n    var _selectors = {\n        component : '.qti-navigator',\n        filterBar : '.qti-navigator-filters',\n        tree : '.qti-navigator-tree',\n        collapseHandle : '.qti-navigator-collapsible',\n        linearState : '.qti-navigator-linear',\n        infoAnswered : '.qti-navigator-answered .qti-navigator-counter',\n        infoViewed : '.qti-navigator-viewed .qti-navigator-counter',\n        infoUnanswered : '.qti-navigator-unanswered .qti-navigator-counter',\n        infoFlagged : '.qti-navigator-flagged .qti-navigator-counter',\n        infoPanel : '.qti-navigator-info',\n        infoPanelLabels : '.qti-navigator-info > .qti-navigator-label',\n        parts : '.qti-navigator-part',\n        partLabels : '.qti-navigator-part > .qti-navigator-label',\n        sections : '.qti-navigator-section',\n        sectionLabels : '.qti-navigator-section > .qti-navigator-label',\n        items : '.qti-navigator-item',\n        itemLabels : '.qti-navigator-item > .qti-navigator-label',\n        itemIcons : '.qti-navigator-item > .qti-navigator-icon',\n        icons : '.qti-navigator-icon',\n        linearStart : '.qti-navigator-linear-part button',\n        counters : '.qti-navigator-counter',\n        actives : '.active',\n        collapsible : '.collapsible',\n        collapsiblePanels : '.collapsible-panel',\n        unseen : '.unseen',\n        answered : '.answered',\n        flagged : '.flagged',\n        notFlagged : ':not(.flagged)',\n        notAnswered : ':not(.answered)',\n        hidden : '.hidden'\n    };\n\n    /**\n     * Maps the filter mode to filter criteria.\n     * Each filter criteria is a CSS selector used to find and mask the items to be discarded by the filter.\n     * @type {Object}\n     * @private\n     */\n    var _filterMap = {\n        all : \"\",\n        unanswered : _selectors.answered,\n        flagged : _selectors.notFlagged,\n        answered : _selectors.notAnswered,\n        filtered : _selectors.hidden\n    };\n\n    /**\n     * Maps of config options translated from the context object to the local options\n     * @type {Object}\n     * @private\n     */\n    var _optionsMap = {\n        'reviewScope' : 'reviewScope',\n        'reviewPreventsUnseen' : 'preventsUnseen',\n        'canCollapse' : 'canCollapse'\n    };\n\n    /**\n     * Maps the handled review scopes\n     * @type {Object}\n     * @private\n     */\n    var _reviewScopes = {\n        test : 'test',\n        testPart : 'testPart',\n        testSection : 'testSection'\n    };\n\n    /**\n     * Provides a test review manager\n     * @type {Object}\n     */\n    var testReview = {\n        /**\n         * Initializes the component\n         * @param {String|jQuery|HTMLElement} element The element on which install the component\n         * @param {Object} [options] A list of extra options\n         * @param {String} [options.region] The region on which put the component: left or right\n         * @param {String} [options.reviewScope] Limit the review screen to a particular scope:\n         * the whole test, the current test part or the current test section)\n         * @param {Boolean} [options.preventsUnseen] Prevents the test taker to access unseen items\n         * @returns {testReview}\n         */\n        init: function init(element, options) {\n            var initOptions = _.isObject(options) && options || {};\n            var putOnRight = 'right' === initOptions.region;\n            var insertMethod = putOnRight ? 'append' : 'prepend';\n\n            this.options = initOptions;\n            this.disabled = false;\n            this.hidden = !!initOptions.hidden;\n            this.currentFilter = 'all';\n\n            // clean the DOM if the init method is called after initialisation\n            if (this.$component) {\n                this.$component.remove();\n            }\n\n            // build the component structure and inject it into the DOM\n            this.$container = $(element);\n            insertMethod = this.$container[insertMethod];\n            if (insertMethod) {\n                insertMethod.call(this.$container, navigatorTpl({\n                    region: putOnRight ? 'right' : 'left',\n                    hidden: this.hidden\n                }));\n            } else {\n                throw new Error(\"Unable to inject the component structure into the DOM\");\n            }\n\n            // install the component behaviour\n            this._loadDOM();\n            this._initEvents();\n            this._updateDisplayOptions();\n\n            return this;\n        },\n\n        /**\n         * Links the component to the underlying DOM elements\n         * @private\n         */\n        _loadDOM: function() {\n            this.$component = this.$container.find(_selectors.component);\n\n            // access to info panel displaying counters\n            this.$infoAnswered = this.$component.find(_selectors.infoAnswered);\n            this.$infoViewed = this.$component.find(_selectors.infoViewed);\n            this.$infoUnanswered = this.$component.find(_selectors.infoUnanswered);\n            this.$infoFlagged = this.$component.find(_selectors.infoFlagged);\n\n            // access to filter switches\n            this.$filterBar = this.$component.find(_selectors.filterBar);\n            this.$filters = this.$filterBar.find('li');\n\n            // access to the tree of parts/sections/items\n            this.$tree = this.$component.find(_selectors.tree);\n\n            // access to the panel displayed when a linear part is reached\n            this.$linearState = this.$component.find(_selectors.linearState);\n        },\n\n        /**\n         * Installs the event handlers on the underlying DOM elements\n         * @private\n         */\n        _initEvents: function() {\n            var self = this;\n\n            // click on the collapse handle: collapse/expand the review panel\n            this.$component.on('click' + _selectors.component, _selectors.collapseHandle, function() {\n                if (self.disabled) {\n                    return;\n                }\n\n                self.$component.toggleClass(_cssCls.collapsed);\n                if (self.$component.hasClass(_cssCls.collapsed)) {\n                    self._openSelected();\n                }\n            });\n\n            // click on the info panel title: toggle the related panel\n            this.$component.on('click' + _selectors.component, _selectors.infoPanelLabels, function() {\n                if (self.disabled) {\n                    return;\n                }\n\n                var $panel = $(this).closest(_selectors.infoPanel);\n                self._togglePanel($panel, _selectors.infoPanel);\n            });\n\n            // click on a part title: toggle the related panel\n            this.$tree.on('click' + _selectors.component, _selectors.partLabels, function() {\n                if (self.disabled) {\n                    return;\n                }\n\n                var $panel = $(this).closest(_selectors.parts);\n                var open = self._togglePanel($panel, _selectors.parts);\n\n                if (open) {\n                    if ($panel.hasClass(_cssCls.active)) {\n                        self._openSelected();\n                    } else {\n                        self._openOnly($panel.find(_selectors.sections).first(), $panel);\n                    }\n                }\n            });\n\n            // click on a section title: toggle the related panel\n            this.$tree.on('click' + _selectors.component, _selectors.sectionLabels, function() {\n                if (self.disabled) {\n                    return;\n                }\n\n                var $panel = $(this).closest(_selectors.sections);\n\n                self._togglePanel($panel, _selectors.sections);\n            });\n\n            // click on an item: jump to the position\n            this.$tree.on('click' + _selectors.component, _selectors.itemLabels, function(event) {\n                if (self.disabled) {\n                    return;\n                }\n\n                var $item = $(this).closest(_selectors.items);\n                var $target;\n\n                if (!$item.hasClass(_cssCls.disabled)) {\n                    $target = $(event.target);\n                    if ($target.is(_selectors.icons) && !self.$component.hasClass(_cssCls.collapsed)) {\n                        if (!$item.hasClass(_cssCls.unseen)) {\n                            self._mark($item);\n                        }\n                    } else {\n                        self._select($item);\n                        self._jump($item);\n                    }\n                }\n            });\n\n            // click on the start button inside a linear part: jump to the position\n            this.$tree.on('click' + _selectors.component, _selectors.linearStart, function() {\n                if (self.disabled) {\n                    return;\n                }\n\n                var $btn = $(this);\n\n                if (!$btn.hasClass(_cssCls.disabled)) {\n                    $btn.addClass(_cssCls.disabled);\n                    self._jump($btn);\n                }\n            });\n\n            // click on a filter button\n            this.$filterBar.on('click' + _selectors.component, 'li', function() {\n                if (self.disabled) {\n                    return;\n                }\n\n                var $btn = $(this);\n                var mode = $btn.data('mode');\n\n                self.$filters.removeClass(_cssCls.active);\n                self.$component.removeClass(_cssCls.collapsed);\n                $btn.addClass(_cssCls.active);\n\n                self._filter(mode);\n            });\n        },\n\n        /**\n         * Filters the items by a criteria\n         * @param {String} criteria\n         * @private\n         */\n        _filter: function(criteria) {\n            var $items = this.$tree.find(_selectors.items).removeClass(_cssCls.hidden);\n            var filter = _filterMap[criteria];\n            if (filter) {\n                $items.filter(filter).addClass(_cssCls.hidden);\n            }\n            this._updateSectionCounters(!!filter);\n            this.currentFilter = criteria;\n        },\n\n        /**\n         * Selects an item\n         * @param {String|jQuery} position The item's position\n         * @param {Boolean} [open] Forces the tree to be opened on the selected item\n         * @returns {jQuery} Returns the selected item\n         * @private\n         */\n        _select: function(position, open) {\n            // find the item to select and extract its hierarchy\n            var selected = position && position.jquery ? position : this.$tree.find('[data-position=' + position + ']');\n            var hierarchy = selected.parentsUntil(this.$tree);\n\n            // collapse the full tree and open only the hierarchy of the selected item\n            if (open) {\n                this._openOnly(hierarchy);\n            }\n\n            // select the item\n            this.$tree.find(_selectors.actives).removeClass(_cssCls.active);\n            hierarchy.add(selected).addClass(_cssCls.active);\n            return selected;\n        },\n\n        /**\n         * Opens the tree on the selected item only\n         * @returns {jQuery} Returns the selected item\n         * @private\n         */\n        _openSelected: function() {\n            // find the selected item and extract its hierarchy\n            var selected = this.$tree.find(_selectors.items + _selectors.actives);\n            var hierarchy = selected.parentsUntil(this.$tree);\n\n            // collapse the full tree and open only the hierarchy of the selected item\n            this._openOnly(hierarchy);\n\n            return selected;\n        },\n\n        /**\n         * Collapses the full tree and opens only the provided branch\n         * @param {jQuery} opened The element to be opened\n         * @param {jQuery} [root] The root element from which collapse the panels\n         * @private\n         */\n        _openOnly: function(opened, root) {\n            (root || this.$tree).find(_selectors.collapsible).addClass(_cssCls.collapsed);\n            opened.removeClass(_cssCls.collapsed);\n        },\n\n        /**\n         * Toggles a panel\n         * @param {jQuery} panel The panel to toggle\n         * @param {String} [collapseSelector] Selector of panels to collapse\n         * @returns {Boolean} Returns `true` if the panel just expanded now\n         */\n        _togglePanel: function(panel, collapseSelector) {\n            var collapsed = panel.hasClass(_cssCls.collapsed);\n\n            if (collapseSelector) {\n                this.$tree.find(collapseSelector).addClass(_cssCls.collapsed);\n            }\n\n            if (collapsed) {\n                panel.removeClass(_cssCls.collapsed);\n            } else {\n                panel.addClass(_cssCls.collapsed);\n            }\n            return collapsed;\n        },\n\n        /**\n         * Sets the icon of a particular item\n         * @param {jQuery} $item\n         * @param {String} icon\n         * @private\n         */\n        _setItemIcon: function($item, icon) {\n            $item.find(_selectors.icons).attr('class', _cssCls.icon + ' icon-' + icon);\n        },\n\n        /**\n         * Sets the icon of a particular item according to its state\n         * @param {jQuery} $item\n         * @private\n         */\n        _adjustItemIcon: function($item) {\n            var icon = null;\n            var defaultIcon = _cssCls.unseen;\n            var iconCls = [\n                _cssCls.flagged,\n                _cssCls.answered,\n                _cssCls.viewed\n            ];\n\n            _.forEach(iconCls, function(cls) {\n                if ($item.hasClass(cls)) {\n                    icon = cls;\n                    return false;\n                }\n            });\n\n            this._setItemIcon($item, icon || defaultIcon);\n        },\n\n        /**\n         * Toggle the marked state of an item\n         * @param {jQuery} $item\n         * @param {Boolean} [flag]\n         * @private\n         */\n        _toggleFlag: function($item, flag) {\n            $item.toggleClass(_cssCls.flagged, flag);\n            this._adjustItemIcon($item);\n        },\n\n        /**\n         * Marks an item for later review\n         * @param {jQuery} $item\n         * @private\n         */\n        _mark: function($item) {\n            var itemId = $item.data('id');\n            var itemPosition = $item.data('position');\n            var flag = !$item.hasClass(_cssCls.flagged);\n\n            this._toggleFlag($item);\n\n            /**\n             * A storage of the flag is required\n             * @event testReview#mark\n             * @param {Boolean} flag - Tells whether the item is marked for review or not\n             * @param {Number} position - The item position on which jump\n             * @param {String} itemId - The identifier of the target item\n             * @param {testReview} testReview - The client testReview component\n             */\n            this.trigger('mark', [flag, itemPosition, itemId]);\n        },\n\n        /**\n         * Jumps to an item\n         * @param {jQuery} $item\n         * @private\n         */\n        _jump: function($item) {\n            var itemId = $item.data('id');\n            var itemPosition = $item.data('position');\n\n            /**\n             * A jump to a particular item is required\n             * @event testReview#jump\n             * @param {Number} position - The item position on which jump\n             * @param {String} itemId - The identifier of the target item\n             * @param {testReview} testReview - The client testReview component\n             */\n            this.trigger('jump', [itemPosition, itemId]);\n        },\n\n        /**\n         * Updates the sections related items counters\n         * @param {Boolean} filtered\n         */\n        _updateSectionCounters: function(filtered) {\n            var self = this;\n            var filter = _filterMap[filtered ? 'filtered' : 'answered'];\n            this.$tree.find(_selectors.sections).each(function() {\n                var $section = $(this);\n                var $items = $section.find(_selectors.items);\n                var $filtered = $items.filter(filter);\n                var total = $items.length;\n                var nb = total - $filtered.length;\n                self._writeCount($section.find(_selectors.counters), nb, total);\n            });\n        },\n\n        /**\n         * Updates the display according to options\n         * @private\n         */\n        _updateDisplayOptions: function() {\n            var reviewScope = _reviewScopes[this.options.reviewScope] || 'test';\n            var scopeClass = _cssCls.scope[reviewScope];\n            var $root = this.$component;\n            _.forEach(_cssCls.scope, function(cls) {\n                $root.removeClass(cls);\n            });\n            if (scopeClass) {\n                $root.addClass(scopeClass);\n            }\n            $root.toggleClass(_cssCls.collapsible, this.options.canCollapse);\n        },\n\n        /**\n         * Updates the local options from the provided context\n         * @param {Object} testContext The progression context\n         * @private\n         */\n        _updateOptions: function(testContext) {\n            var options = this.options;\n            _.forEach(_optionsMap, function(optionKey, contextKey) {\n                if (undefined !== testContext[contextKey]) {\n                    options[optionKey] = testContext[contextKey];\n                }\n            });\n        },\n\n        /**\n         * Updates the info panel\n         */\n        _updateInfos: function() {\n            var progression = this.progression,\n                unanswered = Number(progression.total) - Number(progression.answered);\n\n            // update the info panel\n            this._writeCount(this.$infoAnswered, progression.answered, progression.total);\n            this._writeCount(this.$infoUnanswered, unanswered, progression.total);\n            this._writeCount(this.$infoViewed, progression.viewed, progression.total);\n            this._writeCount(this.$infoFlagged, progression.flagged, progression.total);\n        },\n\n        /**\n         * Updates a counter\n         * @param {jQuery} $place\n         * @param {Number} count\n         * @param {Number} total\n         * @private\n         */\n        _writeCount: function($place, count, total) {\n            $place.text(count + '/' + total);\n        },\n\n        /**\n         * Gets the progression stats for the whole test\n         * @param {Object} testContext The progression context\n         * @returns {{total: (Number), answered: (Number), viewed: (Number), flagged: (Number)}}\n         * @private\n         */\n        _getProgressionOfTest: function(testContext) {\n            return {\n                total : testContext.numberItems || 0,\n                answered : testContext.numberCompleted || 0,\n                viewed : testContext.numberPresented || 0,\n                flagged : testContext.numberFlagged || 0\n            };\n        },\n\n        /**\n         * Gets the progression stats for the current test part\n         * @param {Object} testContext The progression context\n         * @returns {{total: (Number), answered: (Number), viewed: (Number), flagged: (Number)}}\n         * @private\n         */\n        _getProgressionOfTestPart: function(testContext) {\n            return {\n                total : testContext.numberItemsPart || 0,\n                answered : testContext.numberCompletedPart || 0,\n                viewed : testContext.numberPresentedPart || 0,\n                flagged : testContext.numberFlaggedPart || 0\n            };\n        },\n\n        /**\n         * Gets the progression stats for the current test section\n         * @param {Object} testContext The progression context\n         * @returns {{total: (Number), answered: (Number), viewed: (Number), flagged: (Number)}}\n         * @private\n         */\n        _getProgressionOfTestSection: function(testContext) {\n            return {\n                total : testContext.numberItemsSection || 0,\n                answered : testContext.numberCompletedSection || 0,\n                viewed : testContext.numberPresentedSection || 0,\n                flagged : testContext.numberFlaggedSection || 0\n            };\n        },\n\n        /**\n         * Updates the navigation tre\n         * @param {Object} testContext The progression context\n         */\n        _updateTree: function(testContext) {\n            var navigatorMap = testContext.navigatorMap;\n            var reviewScope = this.options.reviewScope;\n            var reviewScopePart = reviewScope === 'testPart';\n            var reviewScopeSection = reviewScope === 'testSection';\n            var _partsFilter = function(part) {\n                if (reviewScopeSection && part.sections) {\n                    part.sections = _.filter(part.sections, _partsFilter);\n                }\n                return part.active;\n            };\n\n            // rebuild the tree\n            if (navigatorMap) {\n                if (reviewScopePart || reviewScopeSection) {\n                    // display only the current section\n                    navigatorMap = _.filter(navigatorMap, _partsFilter);\n                }\n\n                this.$filterBar.show();\n                this.$linearState.hide();\n                this.$tree.html(navigatorTreeTpl({\n                    parts: navigatorMap\n                }));\n\n                if (this.options.preventsUnseen) {\n                    // disables all unseen items to prevent the test taker has access to.\n                    this.$tree.find(_selectors.unseen).addClass(_cssCls.disabled);\n                }\n            } else {\n                this.$filterBar.hide();\n                this.$linearState.show();\n                this.$tree.empty();\n            }\n\n            // apply again the current filter\n            this._filter(this.$filters.filter(_selectors.actives).data('mode'));\n        },\n\n        /**\n         * Set the marked state of an item\n         * @param {Number|String|jQuery} position\n         * @param {Boolean} flag\n         */\n        setItemFlag: function setItemFlag(position, flag) {\n            var $item = position && position.jquery ? position : this.$tree.find('[data-position=' + position + ']');\n            var progression = this.progression;\n\n            // update the item flag\n            this._toggleFlag($item, flag);\n\n            // update the info panel\n            progression.flagged = this.$tree.find(_selectors.flagged).length;\n            this._writeCount(this.$infoFlagged, progression.flagged, progression.total);\n            this._filter(this.currentFilter);\n        },\n\n        /**\n         * Update the number of flagged items in the test context\n         * @param {Object} testContext The test context\n         * @param {Number} position The position of the flagged item\n         * @param {Boolean} flag The flag state\n         */\n        updateNumberFlagged: function(testContext, position, flag) {\n            var fields = ['numberFlagged'];\n            var currentPosition = testContext.itemPosition;\n            var currentFound = false, currentSection = null, currentPart = null;\n            var itemFound = false, itemSection = null, itemPart = null;\n\n            if (testContext.navigatorMap) {\n                // find the current item and the marked item inside the navigator map\n                // check if the marked item is in the current section\n                _.forEach(testContext.navigatorMap, function(part) {\n                    _.forEach(part && part.sections, function(section) {\n                        _.forEach(section && section.items, function(item) {\n                            if (item) {\n                                if (item.position === position) {\n                                    itemPart = part;\n                                    itemSection = section;\n                                    itemFound = true;\n                                }\n                                if (item.position === currentPosition) {\n                                    currentPart = part;\n                                    currentSection = section;\n                                    currentFound = true;\n\n                                }\n                                if (itemFound && currentFound) {\n                                    return false;\n                                }\n                            }\n                        });\n\n                        if (itemFound && currentFound) {\n                            return false;\n                        }\n                    });\n\n                    if (itemFound && currentFound) {\n                        return false;\n                    }\n                });\n\n                // select the context to update\n                if (itemFound && currentPart === itemPart) {\n                    fields.push('numberFlaggedPart');\n                }\n                if (itemFound && currentSection === itemSection) {\n                    fields.push('numberFlaggedSection');\n                }\n            } else {\n                // no navigator map, the current the marked item is in the current section\n                fields.push('numberFlaggedPart');\n                fields.push('numberFlaggedSection');\n            }\n\n            _.forEach(fields, function(field) {\n                if (field in testContext) {\n                    testContext[field] += flag ? 1 : -1;\n                }\n            });\n        },\n\n        /**\n         * Get progression\n         * @param {Object} testContext The progression context\n         * @returns {object} progression\n         */\n        getProgression: function getProgression(testContext) {\n            var reviewScope = _reviewScopes[this.options.reviewScope] || 'test',\n                progressInfoMethod = '_getProgressionOf' + capitalize(reviewScope),\n                getProgression = this[progressInfoMethod] || this._getProgressionOfTest,\n                progression = getProgression && getProgression(testContext) || {};\n\n            return progression;\n        },\n\n        /**\n         * Updates the review screen\n         * @param {Object} testContext The progression context\n         * @returns {testReview}\n         */\n        update: function update(testContext) {\n            this.progression = this.getProgression(testContext);\n            this._updateOptions(testContext);\n            this._updateInfos(testContext);\n            this._updateTree(testContext);\n            this._updateDisplayOptions(testContext);\n            return this;\n        },\n\n        /**\n         * Disables the component\n         * @returns {testReview}\n         */\n        disable: function disable() {\n            this.disabled = true;\n            this.$component.addClass(_cssCls.disabled);\n            return this;\n        },\n\n        /**\n         * Enables the component\n         * @returns {testReview}\n         */\n        enable: function enable() {\n            this.disabled = false;\n            this.$component.removeClass(_cssCls.disabled);\n            return this;\n        },\n\n        /**\n         * Hides the component\n         * @returns {testReview}\n         */\n        hide: function hide() {\n            this.disabled = true;\n            this.hidden = true;\n            this.$component.addClass(_cssCls.hidden);\n            return this;\n        },\n\n        /**\n         * Shows the component\n         * @returns {testReview}\n         */\n        show: function show() {\n            this.disabled = false;\n            this.hidden = false;\n            this.$component.removeClass(_cssCls.hidden);\n            return this;\n        },\n\n        /**\n         * Toggles the display state of the component\n         * @param {Boolean} [show] External condition that's tells if the component must be shown or hidden\n         * @returns {testReview}\n         */\n        toggle: function toggle(show) {\n            if (undefined === show) {\n                show = this.hidden;\n            }\n\n            if (show) {\n                this.show();\n            } else {\n                this.hide();\n            }\n\n            return this;\n        },\n\n        /**\n         * Install an event handler on the underlying DOM element\n         * @param {String} eventName\n         * @returns {testReview}\n         */\n        on: function on(eventName) {\n            var dom = this.$component;\n            if (dom) {\n                dom.on.apply(dom, arguments);\n            }\n\n            return this;\n        },\n\n        /**\n         * Uninstall an event handler from the underlying DOM element\n         * @param {String} eventName\n         * @returns {testReview}\n         */\n        off: function off(eventName) {\n            var dom = this.$component;\n            if (dom) {\n                dom.off.apply(dom, arguments);\n            }\n\n            return this;\n        },\n\n        /**\n         * Triggers an event on the underlying DOM element\n         * @param {String} eventName\n         * @param {Array|Object} extraParameters\n         * @returns {testReview}\n         */\n        trigger : function trigger(eventName, extraParameters) {\n            var dom = this.$component;\n\n            if (undefined === extraParameters) {\n                extraParameters = [];\n            }\n            if (!_.isArray(extraParameters)) {\n                extraParameters = [extraParameters];\n            }\n\n            extraParameters.push(this);\n\n            if (dom) {\n                dom.trigger(eventName, extraParameters);\n            }\n\n            return this;\n        }\n    };\n\n    /**\n     * Builds an instance of testReview\n     * @param {String|jQuery|HTMLElement} element The element on which install the component\n     * @param {Object} [options] A list of extra options\n     * @param {String} [options.region] The region on which put the component: left or right\n     * @param {String} [options.reviewScope] Limit the review screen to a particular scope:\n     * the whole test, the current test part or the current test section)\n     * @param {Boolean} [options.preventsUnseen] Prevents the test taker to access unseen items\n     * @returns {testReview}\n     */\n    var testReviewFactory = function(element, options) {\n        var component = _.clone(testReview, true);\n        return component.init(element, options);\n    };\n\n    return testReviewFactory;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA ;\n */\n/**\n * @author Jean-Sébastien Conan <jean-sebastien.conan@vesperiagroup.com>\n */\ndefine('taoQtiTest/testRunner/progressUpdater',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'ui/progressbar'\n], function ($, _, __) {\n    'use strict';\n\n    /**\n     * Provides a versatile progress bar updater\n     * @type {{init: Function, update: Function}}\n     */\n    var progressUpdaters = {\n        /**\n         * Initializes the progress updater\n         *\n         * @param {String|jQuery|HTMLElement} progressBar The element on which put the progress bar\n         * @param {String|jQuery|HTMLElement} progressLabel The element on which put the progress label\n         * @returns {progressUpdaters}\n         */\n        init: function(progressBar, progressLabel) {\n            this.progressBar = $(progressBar).progressbar();\n            this.progressLabel = $(progressLabel);\n            return this;\n        },\n\n        /**\n         * Writes the progress label and update the progress by ratio\n         * @param {String} label\n         * @param {Number} ratio\n         * @returns {progressUpdaters}\n         */\n        write: function(label, ratio) {\n            this.progressLabel.text(label);\n            this.progressBar.progressbar('value', ratio);\n            return this;\n        },\n\n        /**\n         * Updates the progress bar\n         * @param {Object} testContext The progression context\n         * @returns {{ratio: number, label: string}}\n         */\n        update: function(testContext) {\n            var progressIndicator = testContext.progressIndicator || 'percentage';\n            var progressIndicatorMethod = progressIndicator + 'Progression';\n            var getProgression = this[progressIndicatorMethod] || this.percentageProgression;\n            var progression = getProgression && getProgression(testContext) || {};\n\n            this.write(progression.label, progression.ratio);\n            return progression;\n        },\n\n        /**\n         * Updates the progress bar displaying the percentage\n         * @param {Object} testContext The progression context\n         * @returns {{ratio: number, label: string}}\n         */\n        percentageProgression: function(testContext) {\n            var total = Math.max(1, testContext.numberItems);\n            var ratio = Math.floor(testContext.numberCompleted / total * 100);\n            return {\n                ratio : ratio,\n                label : ratio + '%'\n            };\n        },\n\n        /**\n         * Updates the progress bar displaying the position\n         * @param {Object} testContext The progression context\n         * @returns {{ratio: number, label: string}}\n         */\n        positionProgression: function(testContext) {\n            var progressScope = testContext.progressIndicatorScope;\n            var progressScopeCounter = {\n                test : {\n                    total : 'numberItems',\n                    position : 'itemPosition'\n                },\n                testPart : {\n                    total : 'numberItemsPart',\n                    position : 'itemPositionPart'\n                },\n                testSection : {\n                    total : 'numberItemsSection',\n                    position : 'itemPositionSection'\n                }\n            };\n            var counter = progressScopeCounter[progressScope] || progressScopeCounter.test;\n            var total = Math.max(1, testContext[counter.total]);\n            var position = testContext[counter.position] + 1;\n            return {\n                ratio : Math.floor(position / total * 100),\n                label : __('Item %d of %d', position, total)\n            };\n        }\n    };\n\n    /**\n     * Builds an instance of progressUpdaters\n     * @param {String|jQuery|HTMLElement} progressBar The element on which put the progress bar\n     * @param {String|jQuery|HTMLElement} progressLabel The element on which put the progress label\n     * @returns {progressUpdaters}\n     */\n    var progressUpdaterFactory = function(progressBar, progressLabel) {\n        var updater = _.clone(progressUpdaters, true);\n        return updater.init(progressBar, progressLabel);\n    };\n\n    return progressUpdaterFactory;\n});\n\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA;\n *\n */\n\n/**\n * Metadata to be sent to the server. Will be saved in result storage as a trace variable.\n * Usage example:\n * <pre>\n * var testMetaData = testMetaDataFactory({\n *   testServiceCallId : this.itemServiceApi.serviceCallId\n * });\n *\n * testMetaData.setData({\n *   'TEST' : {\n *      'TEST_EXIT_CODE' : 'T'\n *   },\n *   'SECTION' : {\n *      'SECTION_EXIT_CODE' : 704\n *   }\n * });\n *\n * testMetaData.addData({'ITEM' : {\n *      'ITEM_START_TIME_CLIENT' : 1443596730143,\n *      'ITEM_END_TIME_CLIENT' : 1443596731301\n *    }\n * });\n * </pre>\n *\n * Data for each service call id will be stored in local storage to be able get data\n * after reloading the page or resuming the test session.\n *\n * To clear all data related to current test_call_id used <i>clearData</i> method.\n */\ndefine('taoQtiTest/testRunner/testMetaData',[\n    'lodash'\n], function (_) {\n    'use strict';\n\n    /**\n     * @param {Object} options\n     * @param {string} options.testServiceCallId - test call id.\n     */\n     var testMetaDataFactory = function testMetaDataFactory(options) {\n        var _testServiceCallId,\n            _storageKeyPrefix = 'testMetaData_',\n            _data = {};\n\n        if (!options || options.testServiceCallId === undefined) {\n            throw new TypeError(\"testServiceCallId option is required\");\n        }\n\n        var testMetaData = {\n            SECTION_EXIT_CODE : {\n                'COMPLETED_NORMALLY': 700,\n                'QUIT': 701,\n                'COMPLETE_TIMEOUT': 703,\n                'TIMEOUT': 704,\n                'FORCE_QUIT': 705,\n                'IN_PROGRESS': 706,\n                'ERROR': 300\n            },\n            TEST_EXIT_CODE : {\n                'COMPLETE': 'C',\n                'TERMINATED': 'T',\n                'INCOMPLETE': 'IC',\n                'INCOMPLETE_QUIT': 'IQ',\n                'INACTIVE': 'IA',\n                'CANDIDATE_DISAGREED_WITH_NDA': 'DA'\n            },\n            /**\n             * Return test call id.\n             * @returns {string}- Test call id\n             */\n            getTestServiceCallId : function getTestServiceCallId () {\n                return _testServiceCallId;\n            },\n\n            /**\n             * Set test call id.\n             * @param {string} value\n             */\n            setTestServiceCallId : function setTestServiceCallId (value) {\n                _testServiceCallId = value;\n            },\n\n            /**\n             * Set meta data. Current data object will be overwritten.\n             * @param {Object} data - metadata object\n             */\n            setData : function setData(data) {\n                _data = data;\n                setLocalStorageData(JSON.stringify(_data));\n            },\n\n            /**\n             * Add data.\n             * @param {Object} data - metadata object\n             * @param {Boolean} overwrite - whether the same data should be overwritten. Default - <i>false</i>\n             */\n            addData : function addData(data, overwrite) {\n                data = _.clone(data);\n                if (overwrite === undefined) {\n                    overwrite = false;\n                }\n\n                if (overwrite) {\n                    _.merge(_data, data);\n                } else {\n                    _data = _.merge(data, _data);\n                }\n                setLocalStorageData(JSON.stringify(_data));\n            },\n\n            /**\n             * Get the saved data.\n             * The cloned object will be returned to avoid unwanted affecting of the original data.\n             * @returns {Object} - metadata object.\n             */\n            getData : function getData() {\n                return _.clone(_data);\n            },\n\n            /**\n             * Clear all data saved in current object and in local storage related to current test call id.\n             * @returns {Object} - metadata object.\n             */\n            clearData : function clearData() {\n                _data = {};\n                window.localStorage.removeItem(testMetaData.getLocalStorageKey());\n            },\n\n            getLocalStorageKey : function getLocalStorageKey () {\n                return _storageKeyPrefix + _testServiceCallId;\n            }\n        };\n\n        /**\n         * Initialize test meta data manager\n         */\n        function init() {\n            _testServiceCallId = options.testServiceCallId;\n            testMetaData.setData(getLocalStorageData());\n        }\n\n        /**\n         * Set data to local storage\n         * @param {string} val - data to be stored.\n         */\n        function setLocalStorageData(val) {\n            var currentKey = testMetaData.getLocalStorageKey();\n            try {\n                window.localStorage.setItem(currentKey, val);\n            } catch(domException) {\n                if (domException.name === 'QuotaExceededError' ||\n                    domException.name === 'NS_ERROR_DOM_QUOTA_REACHED') {\n                    var removed = 0,\n                        i = window.localStorage.length,\n                        key;\n                    while (i--) {\n                        key  = localStorage.key(i);\n                        if (/^testMetaData_.*/.test(key) && key !== currentKey) {\n                            window.localStorage.removeItem(key);\n                            removed++;\n                        }\n                    }\n                    if (removed) {\n                        setLocalStorageData(val);\n                    } else {\n                        throw domException;\n                    }\n                } else {\n                    throw domException;\n                }\n            }\n        }\n\n        /**\n         * Get data from local storage stored for current call id\n         * @returns {*} saved data or empty object\n         */\n        function getLocalStorageData() {\n            var data = window.localStorage.getItem(testMetaData.getLocalStorageKey()),\n                result = JSON.parse(data) || {};\n\n            return result;\n        }\n\n        init();\n\n        return testMetaData;\n    };\n\n    return testMetaDataFactory;\n});\n","/*\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA;\n *\n */\n\ndefine('taoQtiTest/controller/runtime/testRunner',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'module',\n    'taoQtiTest/testRunner/actionBarTools',\n    'taoQtiTest/testRunner/testReview',\n    'taoQtiTest/testRunner/progressUpdater',\n    'taoQtiTest/testRunner/testMetaData',\n    'serviceApi/ServiceApi',\n    'serviceApi/UserInfoService',\n    'serviceApi/StateStorage',\n    'iframeNotifier',\n    'mathJax',\n    'ui/feedback',\n    'ui/deleter',\n    'moment',\n    'ui/modal',\n    'ui/progressbar'\n],\nfunction (\n    $,\n    _,\n    __,\n    module,\n    actionBarTools,\n    testReview,\n    progressUpdater,\n    testMetaDataFactory,\n    ServiceApi,\n    UserInfoService,\n    StateStorage,\n    iframeNotifier,\n    MathJax,\n    feedback,\n    deleter,\n    moment,\n    modal\n) {\n\n    'use strict';\n\n    var timerIds = [],\n        currentTimes = [],\n        lastDates = [],\n        timeDiffs = [],\n        waitingTime = 0,\n        $timers,\n        $controls,\n        timerIndex,\n        testMetaData,\n        sessionStateService,\n        $doc = $(document),\n        optionNextSection = 'x-tao-option-nextSection',\n        optionNextSectionWarning = 'x-tao-option-nextSectionWarning',\n        optionReviewScreen = 'x-tao-option-reviewScreen',\n        optionEndTestWarning = 'x-tao-option-endTestWarning',\n        optionNoExitTimedSectionWarning = 'x-tao-option-noExitTimedSectionWarning',\n        TestRunner = {\n            // Constants\n            'TEST_STATE_INITIAL': 0,\n            'TEST_STATE_INTERACTING': 1,\n            'TEST_STATE_MODAL_FEEDBACK': 2,\n            'TEST_STATE_SUSPENDED': 3,\n            'TEST_STATE_CLOSED': 4,\n            'TEST_NAVIGATION_LINEAR': 0,\n            'TEST_NAVIGATION_NONLINEAR': 1,\n            'TEST_ITEM_STATE_INTERACTING': 1,\n\n            /**\n             * Prepare a transition to another item\n             * @param {Function} [callback]\n             */\n            beforeTransition: function (callback) {\n                // Ask the top window to start the loader.\n                iframeNotifier.parent('loading');\n\n                // Disable buttons.\n                this.disableGui();\n\n                $controls.$itemFrame.hide();\n                $controls.$rubricBlocks.hide();\n                $controls.$timerWrapper.hide();\n\n                // Wait at least waitingTime ms for a better user experience.\n                if (typeof callback === 'function') {\n                    setTimeout(callback, waitingTime);\n                }\n            },\n\n            /**\n             * Complete a transition to another item\n             */\n            afterTransition: function () {\n                this.enableGui();\n\n                //ask the top window to stop the loader\n                iframeNotifier.parent('unloading');\n                testMetaData.addData({\n                    'ITEM' : {'ITEM_START_TIME_CLIENT' : Date.now() / 1000}\n                });\n            },\n\n            /**\n             * Jumps to a particular item in the test\n             * @param {Number} position The position of the item within the test\n             */\n            jump: function(position) {\n                var self = this,\n                    action = 'jump',\n                    params = {position: position};\n                this.disableGui();\n\n                if( this.isJumpOutOfSection(position)  && this.isCurrentItemActive() && this.isTimedSection() ){\n                    this.exitTimedSection(action, params);\n                } else {\n                    this.killItemSession(function() {\n                        self.actionCall(action, params);\n                    });\n                }\n            },\n\n            /**\n             * Push to server how long user seen that item before to track duration\n             * @param {Number} duration\n             */\n            keepItemTimed: function(duration){\n                if (duration) {\n                    var self = this,\n                        action = 'keepItemTimed',\n                        params = {duration: duration};\n                    self.actionCall(action, params);\n                }\n            },\n\n            /**\n             * Marks an item for later review\n             * @param {Boolean} flag The state of the flag\n             * @param {Number} position The position of the item within the test\n             */\n            markForReview: function(flag, position) {\n                var self = this;\n\n                // Ask the top window to start the loader.\n                iframeNotifier.parent('loading');\n\n                // Disable buttons.\n                this.disableGui();\n\n                $.ajax({\n                    url: self.testContext.markForReviewUrl,\n                    cache: false,\n                    async: true,\n                    type: 'POST',\n                    dataType: 'json',\n                    data: {\n                        flag: flag,\n                        position: position\n                    },\n                    success: function(data) {\n                        // update the item flagged state\n                        if (self.testReview) {\n                            self.testReview.setItemFlag(position, flag);\n                            self.testReview.updateNumberFlagged(self.testContext, position, flag);\n                            if (self.testContext.itemPosition === position) {\n                                self.testContext.itemFlagged = flag;\n                            }\n                            self.updateTools(self.testContext);\n                        }\n\n                        // Enable buttons.\n                        self.enableGui();\n\n                        //ask the top window to stop the loader\n                        iframeNotifier.parent('unloading');\n                    }\n                });\n            },\n\n            /**\n             * Move to the next available item\n             */\n            moveForward: function () {\n                var self = this,\n                    action = 'moveForward';\n\n                function doExitSection() {\n                    if( self.isTimedSection() && !self.testContext.isTimeout){\n                        self.exitTimedSection(action);\n                    } else {\n                        self.exitSection(action);\n                    }\n                }\n\n                this.disableGui();\n\n                if( (( this.testContext.numberItemsSection - this.testContext.itemPositionSection - 1) == 0) && this.isCurrentItemActive()){\n                    if (this.shouldDisplayEndTestWarning()) {\n                        this.displayEndTestWarning(doExitSection);\n                        this.enableGui();\n                    } else {\n                        doExitSection();\n                    }\n\n                } else {\n                    this.killItemSession(function () {\n                        self.actionCall(action);\n                    });\n                }\n            },\n\n            /**\n             * Check if necessary to display an end test warning\n             */\n            shouldDisplayEndTestWarning: function(){\n                return (this.testContext.isLast === true && this.hasOption(optionEndTestWarning));\n            },\n\n            /**\n             * Warns upon exiting test\n             */\n            displayEndTestWarning: function(nextAction){\n                var options = {\n                    confirmLabel: __('OK'),\n                    cancelLabel: __('Cancel'),\n                    showItemCount: false\n                };\n\n                this.displayExitMessage(\n                    __('You are about to submit the test. You will not be able to access this test once submitted. Click OK to continue and submit the test.'),\n                    nextAction,\n                    options\n                );\n            },\n\n            /**\n             * Move to the previous available item\n             */\n            moveBackward: function () {\n                var self = this,\n                    action = 'moveBackward';\n\n                this.disableGui();\n\n                if( (this.testContext.itemPositionSection == 0) && this.isCurrentItemActive() && this.isTimedSection() ){\n                    this.exitTimedSection(action);\n                } else {\n                this.killItemSession(function () {\n                        self.actionCall(action);\n                    });\n                }\n            },\n\n            /**\n             * Checks if a position is out of the current section\n             * @param {Number} jumpPosition\n             * @returns {Boolean}\n             */\n            isJumpOutOfSection: function(jumpPosition){\n                var items = this.getCurrentSectionItems(),\n                    isJumpToOtherSection = true,\n                    isValidPosition = (jumpPosition >= 0) && ( jumpPosition < this.testContext.numberItems );\n\n                if( isValidPosition){\n                    for(var i in items ) {\n                        if (!items.hasOwnProperty(i)) {\n                            continue;\n                        }\n                        if( items[i].position == jumpPosition ){\n                            isJumpToOtherSection = false;\n                            break;\n                        }\n                    }\n                } else {\n                    isJumpToOtherSection = false;\n                }\n\n                return isJumpToOtherSection;\n            },\n\n            /**\n             * Exit from the current section. Set the exit code.de\n             * @param {String} action\n             * @param {Object} params\n             * @param {Number} [exitCode]\n             */\n            exitSection: function(action, params, exitCode){\n                var self = this;\n\n                testMetaData.addData({\"SECTION\" : {\"SECTION_EXIT_CODE\" : exitCode || testMetaData.SECTION_EXIT_CODE.COMPLETED_NORMALLY}});\n                self.killItemSession(function () {\n                    self.actionCall(action, params);\n                });\n            },\n\n            /**\n             * Tries to exit a timed section. Display a confirm message.\n             * @param {String} action\n             * @param {Object} params\n             */\n            exitTimedSection: function(action, params){\n                var self = this,\n                    qtiRunner = this.getQtiRunner(),\n                    doExitTimedSection = function() {\n                        if (qtiRunner) {\n                            qtiRunner.updateItemApi();\n                        }\n                        self.exitSection(action, params);\n                    };\n\n                if ((action === 'moveForward' && this.shouldDisplayEndTestWarning())    // prevent duplicate warning\n                    || this.hasOption(optionNoExitTimedSectionWarning)                  // check if warning is disabled\n                    || this.testContext.keepTimerUpToTimeout                            // no need to display the message as we may be able to go back\n                ) {\n                    doExitTimedSection();\n                } else {\n                    this.displayExitMessage(\n                        __('After you complete the section it would be impossible to return to this section to make changes. Are you sure you want to end the section?'),\n                        doExitTimedSection,\n                        { scope: 'testSection' }\n                    );\n                }\n\n                this.enableGui();\n            },\n\n            /**\n             * Tries to leave the current section and go to the next\n             */\n            nextSection: function(){\n                var self = this;\n                var qtiRunner = this.getQtiRunner();\n                var doNextSection = function() {\n                    self.exitSection('nextSection', null, testMetaData.SECTION_EXIT_CODE.QUIT);\n                };\n\n                if (qtiRunner) {\n                    qtiRunner.updateItemApi();\n                }\n\n                if (this.hasOption(optionNextSectionWarning)) {\n                    this.displayExitMessage(\n                        __('After you complete the section it would be impossible to return to this section to make changes. Are you sure you want to end the section?'),\n                        doNextSection,\n                        { scope: 'testSection' }\n                    );\n                } else {\n                    doNextSection();\n                }\n\n                this.enableGui();\n            },\n\n            /**\n             * Gets the current progression within a particular scope\n             * @param {String} [scope]\n             * @returns {Object}\n             */\n            getProgression: function(scope) {\n                var scopeSuffixMap = {\n                    test : '',\n                    testPart : 'Part',\n                    testSection : 'Section'\n                };\n                var scopeSuffix = scope && scopeSuffixMap[scope] || '';\n\n                return {\n                    total : this.testContext['numberItems' + scopeSuffix] || 0,\n                    answered : this.testContext['numberCompleted' + scopeSuffix] || 0,\n                    viewed : this.testContext['numberPresented' + scopeSuffix] || 0,\n                    flagged : this.testContext['numberFlagged' + scopeSuffix] || 0\n                };\n            },\n\n            /**\n             * Displays an exit message for a particular scope\n             * @param {String} message\n             * @param {Function} [action]\n             * @param {Object} [options]\n             * @param {String} [options.scope]\n             * @param {String} [options.confirmLabel] - label of confirm button\n             * @param {String} [options.cancelLabel] - label of cancel button\n             * @param {Boolean} [options.showItemCount] - display the number of unanswered / flagged items in modal\n             * @returns {jQuery} Returns the message box\n             */\n            displayExitMessage: function(message, action, options) {\n                var self = this,\n                    options = options || {},\n                    scope = options.scope,\n                    confirmLabel = options.confirmLabel || __('Yes'),\n                    cancelLabel = options.cancelLabel || __('No'),\n                    showItemCount = typeof options.showItemCount !== 'undefined' ? options.showItemCount : true;\n\n                var $confirmBox = $('.exit-modal-feedback');\n                var progression = this.getProgression(scope);\n                var unansweredCount = (progression.total - progression.answered);\n                var flaggedCount = progression.flagged;\n\n                if (showItemCount) {\n                    if (unansweredCount && this.isCurrentItemAnswered()) {\n                        unansweredCount--;\n                    }\n\n                    if (flaggedCount && unansweredCount) {\n                        message = __('You have %s unanswered question(s) and have %s item(s) marked for review.',\n                                unansweredCount.toString(),\n                                flaggedCount.toString()\n                            ) + ' ' + message;\n                    } else {\n                        if (flaggedCount) {\n                            message = __('You have %s item(s) marked for review.', flaggedCount.toString()) + ' ' + message;\n                        }\n\n                        if (unansweredCount) {\n                            message = __('You have %s unanswered question(s).', unansweredCount.toString()) + ' ' + message;\n                        }\n                    }\n                }\n\n                $confirmBox.find('.message').html(message);\n                $confirmBox.find('.js-exit-confirm').html(confirmLabel);\n                $confirmBox.find('.js-exit-cancel').html(cancelLabel);\n                $confirmBox.modal({ width: 500 });\n\n                $confirmBox.find('.js-exit-cancel, .modal-close').off('click').on('click', function () {\n                    $confirmBox.modal('close');\n                });\n\n                $confirmBox.find('.js-exit-confirm').off('click').on('click', function () {\n                    $confirmBox.modal('close');\n                    if (_.isFunction(action)) {\n                        action.call(self);\n                    }\n                });\n\n                return $confirmBox;\n            },\n\n            /**\n             * Kill current item section and execute callback function given as first parameter.\n             * Item end execution time will be stored in metadata object to be sent to the server.\n             * @param {function} callback\n             */\n            killItemSession : function (callback) {\n                testMetaData.addData({\n                    'ITEM' : {\n                        'ITEM_END_TIME_CLIENT' : Date.now() / 1000,\n                        'ITEM_TIMEZONE' : moment().utcOffset(moment().utcOffset()).format('Z')\n                    }\n                });\n                if (typeof callback !== 'function') {\n                    callback = _.noop;\n                }\n                this.itemServiceApi.kill(callback);\n            },\n\n            /**\n             * Checks if the current item is active\n             * @returns {Boolean}\n             */\n            isCurrentItemActive: function(){\n                return (this.testContext.itemSessionState !=4);\n            },\n\n            /**\n             * Tells is the current item has been answered or not\n             * The item is considered answered when at least one response has been set to not empty {base : null}\n             *\n             * @returns {Boolean}\n             */\n            isCurrentItemAnswered: function(){\n                var answered = false;\n                _.each(this.getCurrentItemState(), function(state){\n                    if(state && _.isObject(state.response) && state.response.base !== null){\n                        answered = true;//at least one response is not null so consider the item answered\n                        return false;\n                    }\n                });\n                return answered;\n            },\n\n            /**\n             * Checks if a particular option is enabled for the current item\n             * @param {String} option\n             * @returns {Boolean}\n             */\n            hasOption: function(option) {\n                return _.indexOf(this.testContext.categories, option) >= 0;\n            },\n\n            /**\n             * Gets access to the qtiRunner instance\n             * @returns {Object}\n             */\n            getQtiRunner: function(){\n                var itemFrame = document.getElementById('qti-item');\n                var itemWindow = itemFrame && itemFrame.contentWindow;\n                var itemContainerFrame = itemWindow && itemWindow.document.getElementById('item-container');\n                var itemContainerWindow = itemContainerFrame && itemContainerFrame.contentWindow;\n                return itemContainerWindow && itemContainerWindow.qtiRunner;\n            },\n\n            /**\n             * Checks if the current section is timed\n             * @returns {Boolean}\n             */\n            isTimedSection: function(){\n                var timeConstraints = this.testContext.timeConstraints,\n                    isTimedSection = false;\n                for( var index in timeConstraints ){\n                    if(timeConstraints.hasOwnProperty(index) &&\n                        timeConstraints[index].qtiClassName === 'assessmentSection' ){\n                        isTimedSection = true;\n                    }\n                }\n\n                return isTimedSection;\n            },\n\n            /**\n             * Gets the list of items owned by the current section\n             * @returns {Array}\n             */\n            getCurrentSectionItems: function(){\n                var partId  = this.testContext.testPartId,\n                    navMap  = this.testContext.navigatorMap,\n                    sectionItems;\n\n                for( var partIndex in navMap ){\n                    if( !navMap.hasOwnProperty(partIndex)){\n                        continue;\n                    }\n                    if( navMap[partIndex].id !== partId ){\n                        continue;\n                    }\n\n                    for(var sectionIndex in navMap[partIndex].sections){\n                        if( !navMap[partIndex].sections.hasOwnProperty(sectionIndex)){\n                            continue;\n                        }\n                        if( navMap[partIndex].sections[sectionIndex].active === true ){\n                            sectionItems = navMap[partIndex].sections[sectionIndex].items;\n                            break;\n                        }\n                    }\n                }\n\n                return sectionItems;\n            },\n\n            /**\n             * Skips the current item\n             */\n            skip: function () {\n                var self = this,\n                    doSkip = function() {\n                        self.disableGui();\n                        self.actionCall('skip');\n                    };\n\n                if (this.shouldDisplayEndTestWarning()) {\n                    this.displayEndTestWarning(doSkip);\n                } else {\n                    doSkip();\n                }\n            },\n\n            /**\n             * Handles the timeout state\n             */\n            timeout: function () {\n                var self = this;\n                this.disableGui();\n                this.testContext.isTimeout = true;\n                this.updateTimer();\n\n                this.killItemSession(function () {\n                    var confirmBox = $('.timeout-modal-feedback'),\n                        testContext = self.testContext,\n                        confirmBtn = confirmBox.find('.js-timeout-confirm, .modal-close');\n\n                    if (testContext.numberCompletedSection === testContext.numberItemsSection) {\n                        testMetaData.addData({\"SECTION\" : {\"SECTION_EXIT_CODE\" : testMetaData.SECTION_EXIT_CODE.COMPLETE_TIMEOUT}});\n                    } else {\n                        testMetaData.addData({\"SECTION\" : {\"SECTION_EXIT_CODE\" : testMetaData.SECTION_EXIT_CODE.TIMEOUT}});\n                    }\n\n                    self.enableGui();\n                    confirmBox.modal({width: 500});\n                    confirmBtn.off('click').on('click', function () {\n                        confirmBox.modal('close');\n                        self.actionCall('timeout');\n                    });\n                });\n            },\n\n            /**\n             * Sets the assessment test context object\n             * @param {Object} testContext\n             */\n            setTestContext: function(testContext) {\n                this.testContext = testContext;\n                this.itemServiceApi = eval(testContext.itemServiceApiCall);\n                this.itemServiceApi.setHasBeenPaused(testContext.hasBeenPaused);\n            },\n\n\n            /**\n             * Handles Metadata initialization\n             */\n            initMetadata: function (){\n                testMetaData = testMetaDataFactory({\n                    testServiceCallId: this.itemServiceApi.serviceCallId\n                });\n            },\n\n            /**\n             * Retrieve service responsible for broken session tracking\n             * @returns {*}\n             */\n            getSessionStateService: function () {\n                if (!sessionStateService) {\n                    sessionStateService = this.testContext.sessionStateService({accuracy: 1000});\n                }\n                return sessionStateService;\n            },\n\n            /**\n             * Updates the GUI\n             * @param {Object} testContext\n             */\n            update: function (testContext) {\n                var self = this;\n                $controls.$itemFrame.remove();\n\n                var $runner = $('#runner');\n                $runner.css('height', 'auto');\n\n                this.getSessionStateService().restart();\n\n                this.setTestContext(testContext);\n                this.updateContext();\n                this.updateProgress();\n                this.updateNavigation();\n                this.updateTestReview();\n                this.updateInformation();\n                this.updateRubrics();\n                this.updateTools(testContext);\n                this.updateTimer();\n                this.updateExitButton();\n                this.resetCurrentItemState();\n                this.initMetadata();\n\n                $controls.$itemFrame = $('<iframe id=\"qti-item\" frameborder=\"0\" scrollbars=\"no\"/>');\n                $controls.$itemFrame.appendTo($controls.$contentBox);\n\n                if (this.testContext.itemSessionState === this.TEST_ITEM_STATE_INTERACTING && self.testContext.isTimeout === false) {\n                    $doc.off('.testRunner').on('serviceloaded.testRunner', function () {\n                        self.afterTransition();\n                        self.adjustFrame();\n                        $controls.$itemFrame.css({visibility: 'visible'});\n                    });\n\n                    // Inject API into the frame.\n                    this.itemServiceApi.loadInto($controls.$itemFrame[0], function () {\n                        // We now rely on the 'serviceloaded' event.\n                    });\n                }\n                else {\n                    // e.g. no more attempts or timeout! Simply consider the transition is finished,\n                    // but do not load the item.\n                    self.afterTransition();\n                }\n            },\n\n            /**\n             * Displays feedback on the current state of the test\n             */\n            updateInformation: function () {\n\n                if (this.testContext.isTimeout === true) {\n                    feedback().error(__('Time limit reached for item \"%s\".', this.testContext.itemIdentifier));\n                }\n                else if (this.testContext.itemSessionState !== this.TEST_ITEM_STATE_INTERACTING) {\n                    feedback().error(__('No more attempts allowed for item \"%s\".', this.testContext.itemIdentifier));\n                }\n            },\n\n            /**\n             * Updates the displayed tools\n             * @param {Object} testContext\n             */\n            updateTools: function updateTools(testContext) {\n                var showSkip = false;\n                var showSkipEnd = false;\n                var showNextSection = !!testContext.nextSection && (this.hasOption(optionNextSection) || this.hasOption(optionNextSectionWarning));\n\n                if (this.testContext.allowSkipping === true) {\n                    if (this.testContext.isLast === false) {\n                        showSkip = true;\n                    } else {\n                        showSkipEnd = true;\n                    }\n                }\n\n                $controls.$skip.toggle(showSkip);\n                $controls.$skipEnd.toggle(showSkipEnd);\n                $controls.$nextSection.toggle(showNextSection);\n\n                actionBarTools.render('.tools-box-list', testContext, TestRunner);\n            },\n\n            /**\n             * Displays a timer\n             * @param {Object} cst\n             * @returns {*|jQuery|HTMLElement}\n             */\n            createTimer: function(cst) {\n                var $timer = $('<div>', {'class': 'qti-timer qti-timer__type-' + cst.qtiClassName }),\n                    $label = $('<div>', {'class': 'qti-timer_label truncate', text: cst.label }),\n                    $time  = $('<div>', {'class': 'qti-timer_time', text: this.formatTime(cst.seconds) });\n\n                $timer.append($label);\n                $timer.append($time);\n                return $timer;\n            },\n\n            /**\n             * Updates the timers\n             */\n            updateTimer: function () {\n                var self = this;\n                var hasTimers;\n                $controls.$timerWrapper.empty();\n\n                for (var i = 0; i < timerIds.length; i++) {\n                    clearTimeout(timerIds[i]);\n                }\n\n                timerIds = [];\n                currentTimes = [];\n                lastDates = [];\n                timeDiffs = [];\n\n                if (self.testContext.isTimeout === false &&\n                    self.testContext.itemSessionState === self.TEST_ITEM_STATE_INTERACTING) {\n\n                    hasTimers = !!this.testContext.timeConstraints.length;\n                    $controls.$topActionBar.toggleClass('has-timers', hasTimers);\n\n                    if (hasTimers) {\n\n                        // Insert QTI Timers container.\n                        // self.formatTime(cst.seconds)\n                        for (i = 0; i < this.testContext.timeConstraints.length; i++) {\n\n                            var cst = this.testContext.timeConstraints[i];\n\n                            if (cst.allowLateSubmission === false) {\n\n                                // Set up a timer for this constraint\n                                $controls.$timerWrapper.append(self.createTimer(cst));\n\n                                // Set up a timer and update it with setInterval.\n                                currentTimes[i] = cst.seconds;\n                                lastDates[i] = new Date();\n                                timeDiffs[i] = 0;\n                                timerIndex = i;\n\n                                if (self.testContext.timerWarning && self.testContext.timerWarning[cst.qtiClassName]) {\n                                    cst.warnings = {};\n                                    _(self.testContext.timerWarning[cst.qtiClassName]).forEach(function (value, key) {\n                                        if (_.contains(['info', 'warning', 'danger'], value)) {\n                                            cst.warnings[key] = {\n                                                type: value,\n                                                showed: cst.seconds <= key,\n                                                point: parseInt(key, 10)\n                                            };\n                                        }\n                                    });\n                                    var closestPreviousWarning = _.find(cst.warnings, { showed: true });\n                                    if (!_.isEmpty(closestPreviousWarning) && closestPreviousWarning.point) {\n                                        cst.warnings[closestPreviousWarning.point].showed = false;\n                                    }\n                                }\n\n                                (function (timerIndex, cst) {\n                                    timerIds[timerIndex] = setInterval(function () {\n\n                                        timeDiffs[timerIndex] += (new Date()).getTime() - lastDates[timerIndex].getTime();\n\n                                        if (timeDiffs[timerIndex] >= 1000) {\n                                            var seconds = timeDiffs[timerIndex] / 1000;\n                                            currentTimes[timerIndex] -= seconds;\n                                            timeDiffs[timerIndex] = 0;\n                                        }\n\n                                        $timers.eq(timerIndex)\n                                            .html(self.formatTime(Math.round(currentTimes[timerIndex])));\n\n                                        if (currentTimes[timerIndex] <= 0) {\n                                            // The timer expired...\n                                            currentTimes[timerIndex] = 0;\n                                            clearInterval(timerIds[timerIndex]);\n\n                                            // Hide item to prevent any further interaction with the candidate.\n                                            $controls.$itemFrame.hide();\n                                            self.timeout();\n                                        } else {\n                                            lastDates[timerIndex] = new Date();\n                                        }\n\n                                        var warning = _.findLast(cst.warnings, { showed: false });\n\n                                        if (!_.isEmpty(warning) && _.isFinite(warning.point) && currentTimes[timerIndex] <= warning.point) {\n                                            self.timeWarning(cst, warning);\n                                        }\n\n                                    }, 1000);\n                                }(timerIndex, cst));\n                            }\n                        }\n\n                        $timers = $controls.$timerWrapper.find('.qti-timer .qti-timer_time');\n                        $controls.$timerWrapper.show();\n                    }\n                }\n            },\n\n            /**\n             * Mark appropriate timer by warning colors and show feedback message\n             *\n             * @param {object} cst - Time constraint\n             * @param {integer} cst.warningTime - Warning time in seconds.\n             * @param {integer} cst.qtiClassName - Class name of qti instance for which the timer is set (assessmentItemRef | assessmentSection | testPart | assessmentTest).\n             * @param {integer} cst.seconds - Initial timer value.\n             * @param {object} warning - Current actual warning\n             * @param {integer} warning.point - Warning time point in seconds, when show message\n             * @param {boolean} warning.showed - boolean flag for mark already showed warnings\n             * @param {string} warning.type - type of warning (from config), can be info, warning or error\n             *\n             * @returns {undefined}\n             */\n            timeWarning: function (cst, warning) {\n                var message = '',\n                    remaining,\n                    $timer = $controls.$timerWrapper.find('.qti-timer__type-' + cst.qtiClassName),\n                    $time = $timer.find('.qti-timer_time');\n\n                $time.removeClass('txt-info txt-warning txt-danger').addClass('txt-' + warning.type);\n\n                remaining = moment.duration(warning.point, \"seconds\").humanize();\n\n                switch (cst.qtiClassName) {\n                    case 'assessmentItemRef':\n                        message = __(\"Warning – You have %s remaining to complete this item.\", remaining);\n                        break;\n                    case 'assessmentSection':\n                        message = __(\"Warning – You have %s remaining to complete this section.\", remaining);\n                        break;\n                    case 'testPart':\n                        message = __(\"Warning – You have %s remaining to complete this test part.\", remaining);\n                        break;\n                    case 'assessmentTest':\n                        message = __(\"Warning – You have %s remaining to complete the test.\", remaining);\n                        break;\n                }\n\n                feedback()[warning.type](message);\n\n                cst.warnings[warning.point].showed = true;\n            },\n\n            /**\n             * Displays or hides the rubric block\n             */\n            updateRubrics: function () {\n                $controls.$rubricBlocks.remove();\n\n                if (this.testContext.rubrics.length > 0) {\n\n                    $controls.$rubricBlocks = $('<div id=\"qti-rubrics\"/>');\n\n                    for (var i = 0; i < this.testContext.rubrics.length; i++) {\n                        $controls.$rubricBlocks.append(this.testContext.rubrics[i]);\n                    }\n\n                    // modify the <a> tags in order to be sure it\n                    // opens in another window.\n                    $controls.$rubricBlocks.find('a').bind('click keypress', function () {\n                        window.open(this.href);\n                        return false;\n                    });\n\n                    $controls.$rubricBlocks.prependTo($controls.$contentBox);\n\n                    if (MathJax) {\n                        MathJax.Hub.Queue([\"Typeset\", MathJax.Hub], $controls.$rubricBlocks[0]);\n                    }\n\n                }\n            },\n\n            /**\n             * Updates the list of navigation buttons (previous, next, skip, etc.)\n             */\n            updateNavigation: function () {\n                $controls.$exit.show();\n\n                if(this.testContext.isLast === true) {\n                    $controls.$moveForward.hide();\n                    $controls.$moveEnd.show();\n                }\n                else {\n                    $controls.$moveForward.show();\n                    $controls.$moveEnd.hide();\n                }\n                if (this.testContext.navigationMode === this.TEST_NAVIGATION_LINEAR) {\n                    // LINEAR\n                    $controls.$moveBackward.hide();\n                }\n                else {\n                    // NONLINEAR\n                    $controls.$controls.show();\n                    if(this.testContext.canMoveBackward === true) {\n                        $controls.$moveBackward.show();\n                    }\n                    else {\n                        $controls.$moveBackward.hide();\n                    }\n                }\n            },\n\n            /**\n             * Updates the test taker review screen\n             */\n            updateTestReview: function() {\n                var considerProgress = this.testContext.considerProgress === true;\n\n                if (this.testReview) {\n                    this.testReview.toggle(considerProgress && this.hasOption(optionReviewScreen));\n                    this.testReview.update(this.testContext);\n                }\n            },\n\n            /**\n             * Updates the progress bar\n             */\n            updateProgress: function () {\n                var considerProgress = this.testContext.considerProgress === true;\n\n                $controls.$progressBox.css('visibility', considerProgress ? 'visible' : 'hidden');\n\n                if (considerProgress) {\n                    this.progressUpdater.update(this.testContext);\n                }\n            },\n\n            /**\n             * Updates the test informations\n             */\n            updateContext: function () {\n\n                $controls.$title.text(this.testContext.testTitle);\n\n                // Visibility of section?\n                var sectionText = (this.testContext.isDeepestSectionVisible === true) ? (' - ' + this.testContext.sectionTitle) : '';\n\n                $controls.$position.text(sectionText);\n                $controls.$titleGroup.show();\n            },\n\n            /**\n             * Displays the right exit button\n             */\n            updateExitButton : function(){\n\n                $controls.$logout.toggleClass('hidden', !this.testContext.logoutButton);\n                $controls.$exit.toggleClass('hidden', !this.testContext.exitButton);\n            },\n\n            /**\n             * Ensures the frame has the right size\n             */\n            adjustFrame: function () {\n                var rubricHeight = $controls.$rubricBlocks.outerHeight(true) || 0;\n                var frameContentHeight;\n                var finalHeight = $(window).innerHeight() - $controls.$topActionBar.outerHeight() - $controls.$bottomActionBar.outerHeight();\n                var itemFrame = $controls.$itemFrame.get(0);\n                $controls.$contentBox.height(finalHeight);\n                if($controls.$sideBars.length){\n                    $controls.$sideBars.each(function() {\n                        var $sideBar = $(this);\n                        $sideBar.height(finalHeight - $sideBar.outerHeight() + $sideBar.height());\n                    });\n                }\n\n                if(itemFrame && itemFrame.contentWindow){\n                    frameContentHeight = $controls.$itemFrame.contents().outerHeight(true);\n\n                    if (frameContentHeight < finalHeight) {\n                        if (rubricHeight) {\n                            frameContentHeight = Math.max(frameContentHeight, finalHeight - rubricHeight);\n                        } else {\n                            frameContentHeight = finalHeight;\n                        }\n                    }\n                    if (itemFrame.contentWindow.$) {\n                        itemFrame.contentWindow.$('body').trigger('setheight', [frameContentHeight]);\n                    }\n                    $controls.$itemFrame.height(frameContentHeight);\n                }\n            },\n\n            /**\n             * Locks the GUI\n             */\n            disableGui: function () {\n                $controls.$naviButtons.addClass('disabled');\n                if (this.testReview) {\n                    this.testReview.disable();\n                }\n            },\n\n            /**\n             * Unlocks the GUI\n             */\n            enableGui: function () {\n                $controls.$naviButtons.removeClass('disabled');\n                if (this.testReview) {\n                    this.testReview.enable();\n                }\n            },\n\n            /**\n             * Hides the GUI\n             */\n            hideGui: function () {\n                $controls.$naviButtons.addClass('hidden');\n                if (this.testReview) {\n                    this.testReview.hide();\n                }\n            },\n\n            /**\n             * Shows the GUI\n             */\n            showGui: function () {\n                $controls.$naviButtons.removeClass('hidden');\n                if (this.testReview) {\n                    this.testReview.show();\n                }\n            },\n\n            /**\n             * Formats a timer\n             * @param {Number} totalSeconds\n             * @returns {String}\n             */\n            formatTime: function (totalSeconds) {\n                var sec_num = totalSeconds;\n                var hours = Math.floor(sec_num / 3600);\n                var minutes = Math.floor((sec_num - (hours * 3600)) / 60);\n                var seconds = Math.floor(sec_num - (hours * 3600) - (minutes * 60));\n\n                if (hours < 10) {\n                    hours = \"0\" + hours;\n                }\n                if (minutes < 10) {\n                    minutes = \"0\" + minutes;\n                }\n                if (seconds < 10) {\n                    seconds = \"0\" + seconds;\n                }\n\n                var time = hours + ':' + minutes + ':' + seconds;\n\n                return time;\n            },\n\n            /**\n             * Processes an error\n             * @param {Object} error\n             */\n            processError : function processError(error) {\n                var self = this;\n\n                // keep disabled\n                this.hideGui();\n                this.beforeTransition();\n\n                // ask the parent to display a message\n                iframeNotifier.parent('messagealert', {\n                    message : error.message,\n                    action : function() {\n                        if (testMetaData) {\n                            testMetaData.clearData();\n                        }\n                        if (error.state === self.TEST_STATE_CLOSED) {\n                            // test is closed, finish it\n                            self.serviceApi.finish();\n                        } else {\n                            // test is still open, just exit to the index\n                            self.serviceApi.exit();\n                        }\n                    }\n                });\n            },\n\n            /**\n             * Call action specified in testContext. A postfix <i>Url</i> will be added to the action name.\n             * To specify actions see {@link https://github.com/oat-sa/extension-tao-testqti/blob/master/helpers/class.TestRunnerUtils.php}\n             * @param {String} action - Action name\n             * @param {Object} [extraParams] - Additional parameters to be sent to the server\n             * @returns {undefined}\n             */\n            actionCall: function (action, extraParams) {\n                var self = this,\n                    params = {metaData: testMetaData ? testMetaData.getData() : {}};\n\n                if (extraParams) {\n                    params = _.assign(params, extraParams);\n                }\n                this.beforeTransition(function () {\n                    $.ajax({\n                        url: self.testContext[action + 'Url'],\n                        cache: false,\n                        data: params,\n                        async: true,\n                        dataType: 'json',\n                        success: function (testContext) {\n                            testMetaData.clearData();\n\n                            if (!testContext.success) {\n                                self.processError(testContext);\n                            }\n                            else if (testContext.state === self.TEST_STATE_CLOSED) {\n                                self.serviceApi.finish();\n                            }\n                            else {\n                                self.update(testContext);\n                            }\n                        }\n                    });\n                });\n            },\n\n            /**\n             * Exit from test (after confirmation). All answered questions will be submitted.\n             *\n             * @returns {undefined}\n             */\n            exit: function () {\n                var self = this;\n                testMetaData.addData({\n                    \"TEST\" : {\"TEST_EXIT_CODE\" : testMetaData.TEST_EXIT_CODE.INCOMPLETE},\n                    \"SECTION\" : {\"SECTION_EXIT_CODE\" : testMetaData.SECTION_EXIT_CODE.QUIT}\n                });\n                this.displayExitMessage(\n                    __('Are you sure you want to end the test?'),\n                    function() {\n                    self.killItemSession(function () {\n                        self.actionCall('endTestSession');\n                        testMetaData.clearData();\n                    });\n                    },\n                    { scope: this.testReview ? this.testContext.reviewScope : null }\n                );\n            },\n\n            /**\n             * Set the state of the current item in the test runner\n             *\n             * @param {string} id\n             * @param {object} state\n             */\n            setCurrentItemState : function(id, state){\n                if(id){\n                    this.currentItemState[id] = state;\n                }\n            },\n\n            /**\n             * Reset the state of the current item in the test runner\n             */\n            resetCurrentItemState : function(){\n                this.currentItemState = {};\n            },\n\n            /**\n             * Get the state of the current item as stored in the test runner\n             * @returns {Object}\n             */\n            getCurrentItemState : function(){\n                return this.currentItemState;\n            }\n        };\n\n        var config = module.config();\n        if (config) {\n            actionBarTools.register(config.qtiTools);\n        }\n\n        return {\n            start: function (testContext) {\n\n                $controls = {\n                    // navigation\n                    $moveForward: $('[data-control=\"move-forward\"]'),\n                    $moveEnd: $('[data-control=\"move-end\"]'),\n                    $moveBackward: $('[data-control=\"move-backward\"]'),\n                    $nextSection: $('[data-control=\"next-section\"]'),\n                    $skip: $('[data-control=\"skip\"]'),\n                    $skipEnd: $('[data-control=\"skip-end\"]'),\n                    $exit: $(window.parent.document).find('[data-control=\"exit\"]'),\n                    $logout: $(window.parent.document).find('[data-control=\"logout\"]'),\n                    $naviButtons: $('.bottom-action-bar .action'),\n                    $skipButtons: $('.navi-box .skip'),\n                    $forwardButtons: $('.navi-box .forward'),\n\n                    // progress bar\n                    $progressBar: $('[data-control=\"progress-bar\"]'),\n                    $progressLabel: $('[data-control=\"progress-label\"]'),\n                    $progressBox: $('.progress-box'),\n\n                    // title\n                    $title:  $('[data-control=\"qti-test-title\"]'),\n                    $position:  $('[data-control=\"qti-test-position\"]'),\n\n                    // timers\n                    $timerWrapper:  $('[data-control=\"qti-timers\"]'),\n\n                    // other zones\n                    $contentPanel: $('.content-panel'),\n                    $controls: $('.qti-controls'),\n                    $itemFrame: $('#qti-item'),\n                    $rubricBlocks: $('#qti-rubrics'),\n                    $contentBox: $('#qti-content'),\n                    $sideBars: $('.test-sidebar'),\n                    $topActionBar: $('.horizontal-action-bar.top-action-bar'),\n                    $bottomActionBar: $('.horizontal-action-bar.bottom-action-bar')\n                };\n\n                // title\n                $controls.$titleGroup = $controls.$title.add($controls.$position);\n\n                $doc.ajaxError(function (event, jqxhr) {\n                    if (jqxhr.status === 403) {\n                        iframeNotifier.parent('serviceforbidden');\n                    }\n                });\n\n                window.onServiceApiReady = function onServiceApiReady(serviceApi) {\n                    TestRunner.serviceApi = serviceApi;\n\n                    if (!testContext.success) {\n                        TestRunner.processError(testContext);\n                    }\n\n                    // If the assessment test session is in CLOSED state,\n                    // we give the control to the delivery engine by calling finish.\n                    else if (testContext.state === TestRunner.TEST_STATE_CLOSED) {\n                        serviceApi.finish();\n                        testMetaData.clearData();\n                    }\n                    else {\n\n                        if (TestRunner.getSessionStateService().getDuration()) {\n                            TestRunner.setTestContext(testContext);\n                            TestRunner.initMetadata();\n\n                            TestRunner.keepItemTimed(TestRunner.getSessionStateService().getDuration());\n                            TestRunner.getSessionStateService().restart();\n                        } else {\n                            TestRunner.update(testContext);\n                        }\n                    }\n                };\n\n                TestRunner.beforeTransition();\n                TestRunner.testContext = testContext;\n\n                $controls.$skipButtons.click(function () {\n                    if (!$(this).hasClass('disabled')) {\n                        TestRunner.skip();\n                    }\n                });\n\n                $controls.$forwardButtons.click(function () {\n                    if (!$(this).hasClass('disabled')) {\n                        TestRunner.moveForward();\n                    }\n                });\n\n                $controls.$moveBackward.click(function () {\n                    if (!$(this).hasClass('disabled')) {\n                        TestRunner.moveBackward();\n                    }\n                });\n\n                $controls.$nextSection.click(function () {\n                    if (!$(this).hasClass('disabled')) {\n                        TestRunner.nextSection();\n                    }\n                });\n\n                $controls.$exit.click(function (e) {\n                    e.preventDefault();\n                    TestRunner.exit();\n                });\n\n                $(window).on('resize', _.throttle(function () {\n                    TestRunner.adjustFrame();\n                    $controls.$titleGroup.show();\n                }, 250));\n\n                $doc.on('loading', function () {\n                    iframeNotifier.parent('loading');\n                });\n\n\n                $doc.on('unloading', function () {\n                    iframeNotifier.parent('unloading');\n                });\n\n                TestRunner.progressUpdater = progressUpdater($controls.$progressBar, $controls.$progressLabel);\n\n                if (testContext.reviewScreen) {\n                    TestRunner.testReview = testReview($controls.$contentPanel, {\n                        region: testContext.reviewRegion || 'left',\n                        hidden: !TestRunner.hasOption(optionReviewScreen),\n                        reviewScope: testContext.reviewScope,\n                        preventsUnseen: !!testContext.reviewPreventsUnseen,\n                        canCollapse: !!testContext.reviewCanCollapse\n                    }).on('jump', function(event, position) {\n                        TestRunner.jump(position);\n                    }).on('mark', function(event, flag, position) {\n                        TestRunner.markForReview(flag, position);\n                    });\n                    $controls.$sideBars = $('.test-sidebar');\n                }\n\n                TestRunner.updateProgress();\n                TestRunner.updateTestReview();\n\n                iframeNotifier.parent('serviceready');\n\n\n                TestRunner.adjustFrame();\n\n                $controls.$topActionBar.add($controls.$bottomActionBar).animate({ opacity: 1 }, 600);\n\n                deleter($('#feedback-box'));\n                modal($('body'));\n\n                //listen to state change in the current item\n                $(document).on('responsechange', function(e, responseId, response){\n                    if(responseId && response){\n                        TestRunner.setCurrentItemState(responseId, {response:response});\n                    }\n                }).on('stateready', function(e, id, state){\n                    if(id && state){\n                        TestRunner.setCurrentItemState(id, state);\n                    }\n                }).on('heightchange', function(e, height) {\n                    $controls.$itemFrame.height(height);\n                });\n\n            }\n        };\n    });\n\n","\n(function(c){var d=document,a='appendChild',i='styleSheet',s=d.createElement('style');s.type='text/css';d.getElementsByTagName('head')[0][a](s);s[i]?s[i].cssText=c:s[a](d.createTextNode(c));})\n('.qti-navigator-default{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch;-webkit-flex-direction:column;-moz-flex-direction:column;-ms-flex-direction:column;-o-flex-direction:column;flex-direction:column;padding:0;cursor:default;min-width:calc(18rem - 8px);height:100%;position:relative}.qti-navigator-default span{display:inline-block}.qti-navigator-default .collapsed .collapsible-panel{display:none !important}.qti-navigator-default .collapsed .qti-navigator-label .icon-up{display:none}.qti-navigator-default .collapsed .qti-navigator-label .icon-down{display:inline-block}.qti-navigator-default .collapsible>.qti-navigator-label,.qti-navigator-default .qti-navigator-item>.qti-navigator-label{cursor:pointer}.qti-navigator-default.scope-test-section .qti-navigator-part>.qti-navigator-label{display:none !important}.qti-navigator-default .qti-navigator-label{display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch;min-width:calc(100% - 12px);padding:0 6px;line-height:3rem}.qti-navigator-default .qti-navigator-label .icon-up,.qti-navigator-default .qti-navigator-label .icon-down{line-height:3rem;margin-left:auto}.qti-navigator-default .qti-navigator-label .icon-down{display:none}.qti-navigator-default .qti-navigator-label .qti-navigator-number{display:none}.qti-navigator-default .qti-navigator-icon,.qti-navigator-default .icon{position:relative;top:1px;display:inline-block;width:2rem;line-height:2.8rem}.qti-navigator-default .unseen .qti-navigator-icon{cursor:default}.qti-navigator-default.prevents-unseen:not(.skipahead-enabled) .unseen .qti-navigator-icon,.qti-navigator-default.prevents-unseen:not(.skipahead-enabled) .unseen .qti-navigator-label{cursor:not-allowed !important}.qti-navigator-default .icon-answered:before{content:\\\"\\\\e69a\\\"}.qti-navigator-default .icon-viewed:before{content:\\\"\\\\e631\\\"}.qti-navigator-default .icon-flagged:before{content:\\\"\\\\e64e\\\"}.qti-navigator-default .icon-unanswered:before,.qti-navigator-default .icon-unseen:before{content:\\\"\\\\e6a5\\\"}.qti-navigator-default .qti-navigator-counter{text-align:right;margin-left:auto;font-size:12px;font-size:1.2rem}.qti-navigator-default .qti-navigator-actions{text-align:center}.qti-navigator-default .qti-navigator-info.collapsed{height:calc(3rem + 1px)}.qti-navigator-default .qti-navigator-info{height:calc(5 * (3rem + 1px));overflow:hidden}.qti-navigator-default .qti-navigator-info>.qti-navigator-label{min-width:calc(100% - 16px);padding:0 8px}.qti-navigator-default .qti-navigator-info ul{padding:0 4px}.qti-navigator-default .qti-navigator-info ul .qti-navigator-label span.qti-navigator-text{padding:0 6px;min-width:10rem}.qti-navigator-default .qti-navigator-info ul .qti-navigator-label span.qti-navigator-icon{min-width:1.5rem}.qti-navigator-default .qti-navigator-info ul .qti-navigator-label span.qti-navigator-counter{min-width:5rem}.qti-navigator-default .qti-navigator-filters{margin-top:1rem;text-align:center;width:15rem;height:calc(3rem + (2 * 1px))}.qti-navigator-default .qti-navigator-filters ul{display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch}.qti-navigator-default .qti-navigator-filters li{display:block}.qti-navigator-default .qti-navigator-filters li .qti-navigator-tab{border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px;border-left:none;line-height:3rem;min-width:5rem;cursor:pointer;white-space:nowrap}.qti-navigator-default .qti-navigator-tree{-webkit-flex:1;-moz-flex:1;-ms-flex:1;-o-flex:1;flex:1;overflow-y:auto}.qti-navigator-default .qti-navigator-linear,.qti-navigator-default .qti-navigator-linear-part{padding:8px}.qti-navigator-default .qti-navigator-linear .icon,.qti-navigator-default .qti-navigator-linear-part .icon{display:none}.qti-navigator-default .qti-navigator-linear .qti-navigator-label,.qti-navigator-default .qti-navigator-linear-part .qti-navigator-label{font-size:14px;font-size:1.4rem}.qti-navigator-default .qti-navigator-linear .qti-navigator-title,.qti-navigator-default .qti-navigator-linear-part .qti-navigator-title{font-size:14px;font-size:1.4rem;margin:8px 0}.qti-navigator-default .qti-navigator-linear .qti-navigator-message,.qti-navigator-default .qti-navigator-linear-part .qti-navigator-message{font-size:14px;font-size:1.4rem}.qti-navigator-default .qti-navigator-part>.qti-navigator-label{padding:0 8px}.qti-navigator-default .qti-navigator-part:not(:first-child){margin-top:1px}.qti-navigator-default .qti-navigator-section>.qti-navigator-label{padding:0 8px}.qti-navigator-default .qti-navigator-item{margin:1px 0;padding-left:10px}.qti-navigator-default .qti-navigator-item:first-child{margin-top:0}.qti-navigator-default .qti-navigator-item.disabled>.qti-navigator-label{cursor:not-allowed}.qti-navigator-default .qti-navigator-collapsible{cursor:pointer;text-align:center;display:none;position:absolute;top:0;bottom:0;right:0;padding-top:50%}.qti-navigator-default .qti-navigator-collapsible .icon{font-size:20px;font-size:2rem;width:1rem !important;height:2rem !important}.qti-navigator-default .qti-navigator-collapsible .qti-navigator-expand{display:none}.qti-navigator-default.collapsible{padding-right:calc(1rem + 10px) !important}.qti-navigator-default.collapsible .qti-navigator-collapsible{display:block}.qti-navigator-default.collapsed{width:calc(8rem + 1rem + 10px);min-width:8rem}.qti-navigator-default.collapsed ul{padding:0 !important}.qti-navigator-default.collapsed .qti-navigator-text,.qti-navigator-default.collapsed .qti-navigator-info>.qti-navigator-label,.qti-navigator-default.collapsed .qti-navigator-part>.qti-navigator-label,.qti-navigator-default.collapsed .qti-navigator-section>.qti-navigator-label,.qti-navigator-default.collapsed .qti-navigator-message{display:none !important}.qti-navigator-default.collapsed .qti-navigator-label{padding:0 2px !important;width:calc(8rem - 4px);min-width:calc(8rem - 4px)}.qti-navigator-default.collapsed .qti-navigator-icon,.qti-navigator-default.collapsed .icon{width:auto}.qti-navigator-default.collapsed .qti-navigator-counter{margin-left:0;min-width:4rem !important}.qti-navigator-default.collapsed .qti-navigator-collapsible .qti-navigator-collapse{display:none}.qti-navigator-default.collapsed .qti-navigator-collapsible .qti-navigator-expand{display:block}.qti-navigator-default.collapsed .qti-navigator-info{height:calc(4 * (3rem + 1px))}.qti-navigator-default.collapsed .qti-navigator-info.collapsed .collapsible-panel{display:block !important}.qti-navigator-default.collapsed .qti-navigator-filters{width:calc(8rem - 16px)}.qti-navigator-default.collapsed .qti-navigator-filter span{display:none}.qti-navigator-default.collapsed .qti-navigator-filter.active span{display:block;border:0 none;width:calc(8rem - 16px)}.qti-navigator-default.collapsed .qti-navigator-item,.qti-navigator-default.collapsed .qti-navigator-linear,.qti-navigator-default.collapsed .qti-navigator-linear-part{padding-left:2px;text-align:center}.qti-navigator-default.collapsed .qti-navigator-item{overflow:hidden}.qti-navigator-default.collapsed .qti-navigator-item .qti-navigator-icon{padding-left:6px;width:2rem}.qti-navigator-default.collapsed .qti-navigator-item .qti-navigator-number{display:inline-block;margin-left:6px;margin-right:8rem}.qti-navigator-default.collapsed .qti-navigator-linear,.qti-navigator-default.collapsed .qti-navigator-linear-part{padding:0 0 8px 0}.qti-navigator-default.collapsed .qti-navigator-linear .icon,.qti-navigator-default.collapsed .qti-navigator-linear-part .icon{display:block}.qti-navigator-default.collapsed .qti-navigator-actions button{padding:0 9px 0 5px}.qti-navigator-default .qti-navigator-info>.qti-navigator-label{background-color:#d4d5d7;color:#222;border-top:1px solid #d4d5d7}.qti-navigator-default .qti-navigator-info li{border-bottom:1px solid #fff}.qti-navigator-default .qti-navigator-filter .qti-navigator-tab{background-color:#fff}.qti-navigator-default .qti-navigator-filter .qti-navigator-tab:hover{background-color:#3e7da7;color:#fff}.qti-navigator-default .qti-navigator-filter.active .qti-navigator-tab{background-color:#a4a9b1;color:#fff}.qti-navigator-default .qti-navigator-linear,.qti-navigator-default .qti-navigator-linear-part{background:#fff}.qti-navigator-default .qti-navigator-part>.qti-navigator-label{background-color:#dddfe2}.qti-navigator-default .qti-navigator-part>.qti-navigator-label:hover{background-color:#c6cacf}.qti-navigator-default .qti-navigator-part.active>.qti-navigator-label{background-color:#c0c4ca}.qti-navigator-default .qti-navigator-section>.qti-navigator-label{border-bottom:1px solid #fff}.qti-navigator-default .qti-navigator-section>.qti-navigator-label:hover{background-color:#ebe8e4}.qti-navigator-default .qti-navigator-section.active>.qti-navigator-label{background-color:#ded9d4}.qti-navigator-default .qti-navigator-item{background:#fff}.qti-navigator-default .qti-navigator-item.active{background:#0e5d91;color:#fff}.qti-navigator-default .qti-navigator-item:hover{background:#0a3f62;color:#fff}.qti-navigator-default .qti-navigator-item.disabled{background-color:#e2deda !important}.qti-navigator-default .qti-navigator-collapsible{background-color:#dfe1e4;color:#222}.qti-navigator-default .qti-navigator-collapsible .icon{color:#fff}.qti-navigator-fizzy{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch;-webkit-flex-direction:column;-moz-flex-direction:column;-ms-flex-direction:column;-o-flex-direction:column;flex-direction:column;cursor:default;min-width:calc(18rem - 8px);height:100%;position:relative;background-color:#f2f2f2 !important;width:30rem}.qti-navigator-fizzy .qti-navigator-tree{overflow-y:auto;max-height:100%;display:block;background:none;margin:0 5px}.qti-navigator-fizzy .qti-navigator-linear{padding:8px;margin:0 5px;background:#fff}.qti-navigator-fizzy .qti-navigator-linear .qti-navigator-message{font-size:14px;font-size:1.4rem}.qti-navigator-fizzy .qti-navigator-section{display:block}.qti-navigator-fizzy .qti-navigator-section .qti-navigator-label{background-color:initial;border:none;padding:0;line-height:initial;margin:13px 0 10px 0;font-size:15px;font-size:1.5rem}.qti-navigator-fizzy .qti-navigator-header{display:flex;justify-content:space-between;border-bottom:1px solid #cec7bf;padding:15px 0 5px 0;margin:0 5px;line-height:initial}.qti-navigator-fizzy .qti-navigator-header .qti-navigator-text{font-size:20px;font-size:2rem;font-weight:bold}.qti-navigator-fizzy .qti-navigator-header .icon-close{font-size:28px;font-size:2.8rem;line-height:3rem;color:#1f1f1f}.qti-navigator-fizzy .qti-navigator-header .icon-close:hover{color:#1f1f1f;text-decoration:none;cursor:pointer}.document-viewer-plugin{position:relative}.document-viewer-plugin .viewer-overlay{position:fixed;top:0;left:0;bottom:0;right:0;z-index:10000;width:100%;opacity:.5;background-color:#e4ecef}.document-viewer-plugin .viewer-panel{position:fixed;top:10px;left:10px;bottom:10px;right:10px;z-index:100000;color:#222;background:#f3f1ef;font-size:14px;font-size:1.4rem;border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px}.document-viewer-plugin .viewer-header{position:relative;width:100%;height:30px;padding:5px 0;z-index:1}.document-viewer-plugin .viewer-header .viewer-title{font-size:15px;font-size:1.5rem;padding:0;margin:0 0 0 1.6rem}.document-viewer-plugin .viewer-header .icon{float:right;font-size:20px;font-size:2rem;color:#266d9c;margin:1px 6px;top:3px}.document-viewer-plugin .viewer-header .icon:hover{cursor:pointer;opacity:.75}.document-viewer-plugin .viewer-content{padding:0 20px;margin-top:4px;position:relative;height:calc(100% - 40px);overflow:auto}.qti-choiceInteraction.maskable .qti-choice .answer-mask{position:absolute;top:0;right:0;height:100%;padding:5px 10px 0 10px;z-index:10;color:#0e5d91;border:solid 1px #222;background-color:#c8d6dc;text-align:right;vertical-align:middle}.qti-choiceInteraction.maskable .qti-choice .answer-mask:hover{color:#568eb2}.qti-choiceInteraction.maskable .qti-choice .answer-mask .answer-mask-toggle:before{font-family:\\'tao\\' !important;speak:never;font-style:normal;font-weight:normal;font-variant:normal;text-transform:none;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;content:\\\"\\\\e643\\\"}.qti-choiceInteraction.maskable .qti-choice .label-content{padding-right:40px}.qti-choiceInteraction.maskable .qti-choice.masked .answer-mask{width:100%}.qti-choiceInteraction.maskable .qti-choice.masked .answer-mask .answer-mask-toggle:before{font-family:\\'tao\\' !important;speak:never;font-style:normal;font-weight:normal;font-variant:normal;text-transform:none;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;content:\\\"\\\\e631\\\"}.qti-choiceInteraction.maskable .qti-choice.masked .answer-mask:hover{background-color:#d2dde2}.mask-container.mask-container{background-color:transparent}.mask-container.mask-container .dynamic-component-title-bar{border-top-left-radius:5px;border-top-right-radius:5px;background-color:transparent;border:none;position:absolute;width:100%;z-index:1}.mask-container.mask-container .dynamic-component-title-bar.moving{background:#f3f1ef;border-bottom:1px solid #8d949e}.mask-container.mask-container .dynamic-component-title-bar .closer{display:none}.mask-container.mask-container .dynamic-component-resize-container .dynamic-component-resize-wrapper{bottom:0}.mask-container.mask-container .dynamic-component-resize-container .dynamic-component-resize-wrapper:hover,.mask-container.mask-container .dynamic-component-resize-container .dynamic-component-resize-wrapper.resizing{bottom:20px}.mask-container.mask-container .dynamic-component-content .mask{position:absolute;width:100%;height:100%;-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px;background:transparent;opacity:1}.mask-container.mask-container .dynamic-component-content .mask .inner{-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px;position:relative;width:100%;height:100%;background-color:#fff;opacity:1;box-sizing:content-box;padding-bottom:30px}.mask-container.mask-container .dynamic-component-content .mask .controls{background:#f3f1ef;position:absolute;top:0;right:0;padding:0 5px 0 10px;border-radius:5px;border-top-left-radius:0;border-bottom-right-radius:0;border-bottom:1px solid #8d949e;border-left:1px solid #8d949e;height:30px;z-index:2}.mask-container.mask-container .dynamic-component-content .mask .controls a{text-decoration:none;margin-right:5px;vertical-align:middle}.mask-container.mask-container .dynamic-component-content .mask .controls a:hover{color:#0a4166}.mask-container.mask-container .dynamic-component-content .mask .controls .view{font-size:20px;font-size:2rem}.mask-container.mask-container .dynamic-component-content .mask .controls .close{font-size:20px;font-size:2rem}.mask-container.mask-container .dynamic-component-content.moving .mask .inner{border-color:rgba(14,93,145,0.5);opacity:.55}.mask-container.mask-container .dynamic-component-content.moving .mask .controls{border-left:none;border-bottom-left-radius:0;z-index:2}.mask-container.mask-container .dynamic-component-content.sizing .mask{border-color:rgba(14,93,145,0.5)}.mask-container.mask-container .dynamic-component-content.sizing .mask .inner{opacity:.55}.mask-container.mask-container .dynamic-component-content.sizing .mask .controls{background-color:transparent;border-bottom:none;border-left:none}.mask-container.mask-container.previewing .dynamic-component-content .mask .inner{opacity:.15;-webkit-transition:opacity, 600ms, ease, 0s;-moz-transition:opacity, 600ms, ease, 0s;-ms-transition:opacity, 600ms, ease, 0s;-o-transition:opacity, 600ms, ease, 0s;transition:opacity, 600ms, ease, 0s}.mask-container.mask-container.previewing .dynamic-component-content .mask .controls{background-color:transparent;border-bottom:none;border-left:none}.connectivity-box{display:none;width:40px;margin-left:40px}.connectivity-box.with-message{width:60px}.connectivity-box .icon-connect,.connectivity-box .icon-disconnect{display:none;line-height:2;font-size:16px;font-size:1.6rem;text-shadow:0 1px 0 rgba(0,0,0,0.9)}.connectivity-box .message-connect,.connectivity-box .message-disconnected{display:none;font-size:14px;font-size:1.4rem;text-shadow:none;margin-right:3px}.connectivity-box.connected,.connectivity-box.disconnected{display:inline-block}.connectivity-box.connected .icon-connect,.connectivity-box.connected .message-connect{display:inline-block}.connectivity-box.disconnected .icon-disconnect,.connectivity-box.disconnected .message-disconnected{display:inline-block}.line-reader-mask{box-sizing:border-box;border:0 solid #0e5d91;background-color:#f3f7fa}.line-reader-mask.hidden{display:none}.line-reader-mask.resizing{background-color:rgba(243,247,250,0.8);border-color:rgba(14,93,145,0.5)}.line-reader-mask.resizer{z-index:99999 !important}.line-reader-mask.resizer.se .resize-control{border-right:2px solid #0e5d91;border-bottom:2px solid #0e5d91;width:40px;height:40px}.line-reader-mask.border-top{border-top-width:1px}.line-reader-mask.border-right{border-right-width:1px}.line-reader-mask.border-bottom{border-bottom-width:1px}.line-reader-mask.border-left{border-left-width:1px}.line-reader-mask.ne{-webkit-border-top-right-radius:5px;-moz-border-radius-topright:5px;border-top-right-radius:5px}.line-reader-mask.se{-webkit-border-bottom-right-radius:5px;-moz-border-radius-bottomright:5px;border-bottom-right-radius:5px}.line-reader-mask.sw{-webkit-border-bottom-left-radius:5px;-moz-border-radius-bottomleft:5px;border-bottom-left-radius:5px}.line-reader-mask.nw{-webkit-border-top-left-radius:5px;-moz-border-radius-topleft:5px;border-top-left-radius:5px}.line-reader-mask.se .resize-control{width:20px;height:20px;margin-bottom:10px;margin-right:10px;border-right:1px solid #0e5d91;border-bottom:1px solid #0e5d91;position:absolute;right:0;bottom:0;cursor:nwse-resize}.line-reader-mask.e .resize-control{position:absolute;width:20px;height:20px;bottom:-10px;left:-10px;border-right:1px solid #0e5d91;border-bottom:1px solid #0e5d91;cursor:nesw-resize}.line-reader-mask.s .resize-control{position:absolute;width:20px;height:10px;right:-10px;border-bottom:1px solid #0e5d91}.line-reader-overlay{box-sizing:border-box;opacity:0}.line-reader-overlay.hidden{display:none}.line-reader-overlay.moving{-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px}.line-reader-overlay.moving.n{max-height:none}.line-reader-overlay.moving,.line-reader-overlay .inner-window{overflow:hidden;position:absolute;opacity:1;background-color:transparent;border:1px solid rgba(14,93,145,0.5)}.line-reader-overlay .inner-window{box-sizing:content-box}.line-reader-overlay .mask-bg{box-sizing:border-box;border:0 solid rgba(243,247,250,0.8);background-color:transparent;position:absolute}.line-reader-overlay.n{max-height:30px;opacity:1}.line-reader-overlay.n .icon-mobile-menu{font-size:22px;font-size:2.2rem;display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch;-webkit-justify-content:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;border-bottom:1px solid #0e5d91;color:#0e5d91;position:absolute;left:0;top:0;height:30px;width:100%;z-index:1}.line-reader-overlay.n .icon-mobile-menu:hover{color:#0a4166}.line-reader-overlay.n .icon-mobile-menu:before{position:relative;top:3px}.line-reader-overlay .icon-mobile-menu{display:none}.line-reader-inner-drag{-moz-border-radius:3px;-webkit-border-radius:3px;border-radius:3px;display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch;-webkit-justify-content:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;text-align:center;padding-top:3px;color:#0e5d91}.line-reader-inner-drag.hidden{display:none}.line-reader-inner-drag:hover{background-color:#87aec8;color:#0a4166}.line-reader-inner-drag.moving{background-color:transparent;color:#9fbed3}.line-reader-inner-drag .icon{text-shadow:none !important;border-bottom-left-radius:110px;border-bottom-right-radius:110px;border:1px solid #0e5d91;border-top:0;width:50px;height:25px;position:relative;bottom:10px}.line-reader-inner-drag .icon:before{position:relative;top:5px;left:1px}.line-reader-closer{font-size:22px;font-size:2.2rem;cursor:pointer;color:#0e5d91;width:12px;height:12px}.line-reader-closer:hover{color:#0a4166}.line-reader-closer .icon{text-shadow:none !important}.magnifier-container.magnifier-container{background-color:transparent}.magnifier-container.magnifier-container .dynamic-component-title-bar{border-top-left-radius:5px;border-top-right-radius:5px;background-color:transparent;border:none;position:absolute;width:100%;z-index:3}.magnifier-container.magnifier-container .dynamic-component-title-bar.moving{background:#f3f1ef;border-bottom:1px solid #8d949e}.magnifier-container.magnifier-container .dynamic-component-title-bar .closer{display:none}.magnifier-container.magnifier-container .dynamic-component-resize-container .dynamic-component-resize-wrapper{bottom:0}.magnifier-container.magnifier-container .dynamic-component-resize-container .dynamic-component-resize-wrapper:hover,.magnifier-container.magnifier-container .dynamic-component-resize-container .dynamic-component-resize-wrapper.resizing{bottom:20px}.magnifier-container.magnifier-container .dynamic-component-content .magnifier{position:absolute;width:100%;height:100%;overflow:hidden;background-color:#fff;opacity:1;-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px;box-sizing:content-box;padding-bottom:30px}@-o-keyframes fadeIn{0%{opacity:0;visibility:visible}100%{opacity:1;visibility:visible}}@-moz-keyframes fadeIn{0%{opacity:0;visibility:visible}100%{opacity:1;visibility:visible}}@-webkit-keyframes fadeIn{0%{opacity:0;visibility:visible}100%{opacity:1;visibility:visible}}@keyframes fadeIn{0%{opacity:0;visibility:visible}100%{opacity:1;visibility:visible}}@-o-keyframes fadeOut{0%{opacity:1;visibility:visible}100%{opacity:0;visibility:hidden}}@-moz-keyframes fadeOut{0%{opacity:1;visibility:visible}100%{opacity:0;visibility:hidden}}@-webkit-keyframes fadeOut{0%{opacity:1;visibility:visible}100%{opacity:0;visibility:hidden}}@keyframes fadeOut{0%{opacity:1;visibility:visible}100%{opacity:0;visibility:hidden}}@-o-keyframes pop{0%{opacity:0;visibility:visible}50%{opacity:.5;visibility:visible;transform:scale(2)}100%{opacity:0;visibility:hidden;transform:scale(3)}}@-moz-keyframes pop{0%{opacity:0;visibility:visible}50%{opacity:.5;visibility:visible;transform:scale(2)}100%{opacity:0;visibility:hidden;transform:scale(3)}}@-webkit-keyframes pop{0%{opacity:0;visibility:visible}50%{opacity:.5;visibility:visible;transform:scale(2)}100%{opacity:0;visibility:hidden;transform:scale(3)}}@keyframes pop{0%{opacity:0;visibility:visible}50%{opacity:.5;visibility:visible;transform:scale(2)}100%{opacity:0;visibility:hidden;transform:scale(3)}}.magnifier-container.magnifier-container .dynamic-component-content .magnifier .level{position:absolute;overflow:hidden;z-index:1;top:0;left:0;bottom:0;right:0;background:transparent;color:#3e7da7;opacity:1;font-size:50px;font-size:5rem;display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch;-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-webkit-justify-content:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;-webkit-animation:pop 400ms forwards;-moz-animation:pop 400ms forwards;-ms-animation:pop 400ms forwards;-o-animation:pop 400ms forwards;animation:pop 400ms forwards}.magnifier-container.magnifier-container .dynamic-component-content .magnifier .level:before{content:\\\"x\\\"}.magnifier-container.magnifier-container .dynamic-component-content .magnifier .overlay{position:absolute;overflow:hidden;z-index:2;top:0;left:0;bottom:0;right:0;background:transparent}.magnifier-container.magnifier-container .dynamic-component-content .magnifier>.controls{position:absolute;background-color:#f3f1ef;border:0 solid #8d949e;min-height:29px;z-index:4}.magnifier-container.magnifier-container .dynamic-component-content .magnifier>.controls a{color:#222;text-decoration:none;font-size:20px;font-size:2rem;margin:0 2px}.magnifier-container.magnifier-container .dynamic-component-content .magnifier>.controls a:hover{color:#0a4166}.magnifier-container.magnifier-container .dynamic-component-content .magnifier>.controls.close{top:0;right:0;border-bottom-width:1px;border-left-width:1px;-webkit-border-bottom-left-radius:5px;-moz-border-radius-bottomleft:5px;border-bottom-left-radius:5px}.magnifier-container.magnifier-container .dynamic-component-content .magnifier .inner{position:absolute}.magnifier-container.magnifier-container .dynamic-component-content.moving .magnifier .controls{border-left:none;border-bottom-left-radius:0}.magnifier-container.magnifier-container .dynamic-component-content.sizing{border-color:rgba(14,93,145,0.5)}.magnifier-container.magnifier-container .dynamic-component-content.sizing .inner,.magnifier-container.magnifier-container .dynamic-component-content.sizing .controls,.magnifier-container.magnifier-container .dynamic-component-content.sizing .level{opacity:0.45 !important}.progress-box .progressbar .progressbar-points{display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch}.progress-box .progressbar .progressbar-points>span.progressbar-point{flex:1;display:inline-block;border:1px solid #0e5d91;background-color:#f3f1ef;height:calc(1rem - 4px);margin:0 1px 0 0}.progress-box .progressbar .progressbar-points>span.progressbar-point:last-child{margin-right:0}.progress-box .progressbar .progressbar-points>span.progressbar-point.reached{background-color:#0e5d91}.progress-box .progressbar .progressbar-points>span.progressbar-point.current{background-color:#a4a9b1}.tts-container .tts-controls{display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch;background-color:#f3f1ef;-webkit-box-shadow:0 2px 3px 1px rgba(0,0,0,0.2);-moz-box-shadow:0 2px 3px 1px rgba(0,0,0,0.2);-ms-box-shadow:0 2px 3px 1px rgba(0,0,0,0.2);-o-box-shadow:0 2px 3px 1px rgba(0,0,0,0.2);box-shadow:0 2px 3px 1px rgba(0,0,0,0.2)}.tts-container .tts-controls .tts-control{display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch;-webkit-justify-content:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;color:#222;height:100%;padding:6px 8.5px;text-decoration:none}.tts-container .tts-controls .tts-control .tts-control-label{padding-left:7.5px}.tts-container .tts-controls .tts-control .tts-icon{font-size:18px;text-align:center;width:18px}.tts-container .tts-controls .tts-control .icon-pause{display:none}.tts-container .tts-controls .tts-control.tts-control-drag{cursor:move}.tts-container .tts-controls .tts-control.tts-control-drag .tts-icon{color:#555}.tts-container .tts-controls .tts-control.tts-control-drag:hover{background-color:transparent}.tts-container .tts-controls .tts-control:hover{background-color:#ddd8d2}.tts-container .tts-controls .tts-control-container{display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch}.tts-container .tts-controls .tts-control-container .tts-slider-container{display:none}.tts-container .tts-controls .tts-control-container .tts-slider-container .tts-slider{margin:0 8.5px;width:80px}.tts-container.playing .tts-controls .tts-control .icon-pause{display:block}.tts-container.playing .tts-controls .tts-control .icon-play{display:none}.tts-container.sfhMode .tts-controls .tts-control.tts-control-mode{-webkit-box-shadow:inset 2px 2px 4px rgba(0,0,0,0.2);-moz-box-shadow:inset 2px 2px 4px rgba(0,0,0,0.2);-ms-box-shadow:inset 2px 2px 4px rgba(0,0,0,0.2);-o-box-shadow:inset 2px 2px 4px rgba(0,0,0,0.2);box-shadow:inset 2px 2px 4px rgba(0,0,0,0.2);background-color:#ddd8d2}.tts-container.settings .tts-controls .tts-control-container .tts-slider-container{display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch;-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center}.tts-container.settings .tts-controls .tts-control-container:last-child{-webkit-box-shadow:inset 2px 2px 4px rgba(0,0,0,0.2);-moz-box-shadow:inset 2px 2px 4px rgba(0,0,0,0.2);-ms-box-shadow:inset 2px 2px 4px rgba(0,0,0,0.2);-o-box-shadow:inset 2px 2px 4px rgba(0,0,0,0.2);box-shadow:inset 2px 2px 4px rgba(0,0,0,0.2);background-color:#ddd8d2}.tts-container.settings .tts-controls .tts-control-container .tts-control-settings:hover{background-color:transparent}.tts-content-node{outline:none}.tts-visible.tts-component-container .test-runner-sections .tts-content-node:hover,.tts-visible.tts-component-container .test-runner-sections .tts-content-node:focus{background-color:transparent !important;color:#222 !important}.tts-visible.tts-component-container .test-runner-sections .tts-content-node .label-box,.tts-visible.tts-component-container .test-runner-sections .tts-content-node .qti-choice{cursor:default !important}.tts-sfhMode.tts-component-container .test-runner-sections{cursor:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c3ZnIHdpZHRoPSIxNHB4IiBoZWlnaHQ9IjE0cHgiIHZpZXdCb3g9IjAgMCAxNCAxNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4gICAgICAgIDx0aXRsZT5Hcm91cCAyPC90aXRsZT4gICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+ICAgIDxnIGlkPSJQYWdlLTEiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPiAgICAgICAgPGcgaWQ9IkFydGJvYXJkIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjQuMDAwMDAwLCAtMTYuMDAwMDAwKSI+ICAgICAgICAgICAgPGcgaWQ9Ikdyb3VwLTIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIzLjAwMDAwMCwgMTUuMDAwMDAwKSI+ICAgICAgICAgICAgICAgIDxyZWN0IGlkPSJSZWN0YW5nbGUtQ29weS02IiB4PSIwIiB5PSIwIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjwvcmVjdD4gICAgICAgICAgICAgICAgPGcgaWQ9Imljb24tLy0xNi0vLWNoZXZyb24tYm90dG9tLWNvcHkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEuMDAwMDAwLCAyLjAwMDAwMCkiIGZpbGw9IiMyRDJEMkQiPiAgICAgICAgICAgICAgICAgICAgPHBvbHlnb24gaWQ9InN3YXAtaWNvbi1jb2xvciIgcG9pbnRzPSIwIDAgMCA4IDYgNCI+PC9wb2x5Z29uPiAgICAgICAgICAgICAgICA8L2c+ICAgICAgICAgICAgICAgIDxyZWN0IGlkPSJSZWN0YW5nbGUtQ29weSIgZmlsbD0iIzJEMkQyRCIgeD0iOSIgeT0iNSIgd2lkdGg9IjYiIGhlaWdodD0iMiI+PC9yZWN0PiAgICAgICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlLUNvcHktNCIgZmlsbD0iIzJEMkQyRCIgeD0iOSIgeT0iMSIgd2lkdGg9IjYiIGhlaWdodD0iMiI+PC9yZWN0PiAgICAgICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlLUNvcHktMiIgZmlsbD0iIzJEMkQyRCIgeD0iOSIgeT0iOSIgd2lkdGg9IjYiIGhlaWdodD0iMiI+PC9yZWN0PiAgICAgICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlLUNvcHktMyIgZmlsbD0iIzJEMkQyRCIgeD0iMSIgeT0iMTMiIHdpZHRoPSIxNCIgaGVpZ2h0PSIyIj48L3JlY3Q+ICAgICAgICAgICAgPC9nPiAgICAgICAgPC9nPiAgICA8L2c+PC9zdmc+) 0 32,auto !important}.tts-sfhMode.tts-component-container .test-runner-sections .tts-content-node.tts-active-content-node:hover{color:#222 !important;background-color:#ff0 !important}.tts-sfhMode.tts-component-container .test-runner-sections .tts-content-node:hover,.tts-sfhMode.tts-component-container .test-runner-sections .tts-content-node:focus{color:#222 !important;background-color:#f3f1ef !important}.tts-sfhMode.tts-component-container .test-runner-sections .tts-content-node .label-box,.tts-sfhMode.tts-component-container .test-runner-sections .tts-content-node .qti-choice{cursor:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c3ZnIHdpZHRoPSIxNHB4IiBoZWlnaHQ9IjE0cHgiIHZpZXdCb3g9IjAgMCAxNCAxNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4gICAgICAgIDx0aXRsZT5Hcm91cCAyPC90aXRsZT4gICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+ICAgIDxnIGlkPSJQYWdlLTEiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPiAgICAgICAgPGcgaWQ9IkFydGJvYXJkIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjQuMDAwMDAwLCAtMTYuMDAwMDAwKSI+ICAgICAgICAgICAgPGcgaWQ9Ikdyb3VwLTIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIzLjAwMDAwMCwgMTUuMDAwMDAwKSI+ICAgICAgICAgICAgICAgIDxyZWN0IGlkPSJSZWN0YW5nbGUtQ29weS02IiB4PSIwIiB5PSIwIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjwvcmVjdD4gICAgICAgICAgICAgICAgPGcgaWQ9Imljb24tLy0xNi0vLWNoZXZyb24tYm90dG9tLWNvcHkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEuMDAwMDAwLCAyLjAwMDAwMCkiIGZpbGw9IiMyRDJEMkQiPiAgICAgICAgICAgICAgICAgICAgPHBvbHlnb24gaWQ9InN3YXAtaWNvbi1jb2xvciIgcG9pbnRzPSIwIDAgMCA4IDYgNCI+PC9wb2x5Z29uPiAgICAgICAgICAgICAgICA8L2c+ICAgICAgICAgICAgICAgIDxyZWN0IGlkPSJSZWN0YW5nbGUtQ29weSIgZmlsbD0iIzJEMkQyRCIgeD0iOSIgeT0iNSIgd2lkdGg9IjYiIGhlaWdodD0iMiI+PC9yZWN0PiAgICAgICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlLUNvcHktNCIgZmlsbD0iIzJEMkQyRCIgeD0iOSIgeT0iMSIgd2lkdGg9IjYiIGhlaWdodD0iMiI+PC9yZWN0PiAgICAgICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlLUNvcHktMiIgZmlsbD0iIzJEMkQyRCIgeD0iOSIgeT0iOSIgd2lkdGg9IjYiIGhlaWdodD0iMiI+PC9yZWN0PiAgICAgICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlLUNvcHktMyIgZmlsbD0iIzJEMkQyRCIgeD0iMSIgeT0iMTMiIHdpZHRoPSIxNCIgaGVpZ2h0PSIyIj48L3JlY3Q+ICAgICAgICAgICAgPC9nPiAgICAgICAgPC9nPiAgICA8L2c+PC9zdmc+) 0 32,auto !important}.tts-sfhMode.tts-component-container .test-runner-sections img.tts-content-node:hover,.tts-sfhMode.tts-component-container .test-runner-sections img.tts-content-node:focus{padding:5px}.tts-playing.tts-component-container .test-runner-sections .tts-content-node.tts-active-content-node,.tts-playing.tts-component-container .test-runner-sections .tts-content-node.tts-active-content-node *{color:#222 !important;background-color:#ff0 !important}.tts-playing.tts-component-container .test-runner-sections .tts-content-node.tts-active-content-node:hover,.tts-playing.tts-component-container .test-runner-sections .tts-content-node.tts-active-content-node *:hover{color:#222 !important;background-color:#ff0 !important}.tts-playing.tts-component-container .test-runner-sections img.tts-content-node.tts-active-content-node{padding:5px}body.delivery-scope{min-height:100vh;max-height:100vh;margin-bottom:0}.runner{position:relative}.qti-choiceInteraction .overlay-answer-eliminator{display:none}.test-runner-scope{position:relative;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;height:calc(100vh - 99px)}.test-runner-scope .landmark-title-hidden{width:1px;height:1px;overflow:hidden;position:absolute}.test-runner-scope .test-runner-sections{-webkit-flex:1 1 0%;-ms-flex:1 1 0%;flex:1 1 0%;overflow:hidden;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row}.test-runner-scope .test-sidebar{background:#f3f1ef;-webkit-flex:0 1 auto;-ms-flex:0 1 auto;flex:0 1 auto;overflow-y:auto;max-width:350px}.test-runner-scope .test-sidebar>.qti-panel{max-width:350px;padding:10px}@media only screen and (max-device-width: 800px){.test-runner-scope .test-sidebar{max-width:200px}.test-runner-scope .test-sidebar>.qti-panel{max-width:200px}}@media only screen and (min-device-width: 800px) and (max-device-width: 1280px){.test-runner-scope .test-sidebar{max-width:250px}.test-runner-scope .test-sidebar>.qti-panel{max-width:250px}}@media only screen and (min-device-width: 1280px) and (max-device-width: 1440px){.test-runner-scope .test-sidebar{max-width:300px}.test-runner-scope .test-sidebar>.qti-panel{max-width:300px}}.test-runner-scope .test-sidebar-left{border-right:1px #ddd solid}.test-runner-scope .test-sidebar-right{border-left:1px #ddd solid}.test-runner-scope .content-wrapper{position:relative;-webkit-flex:1 1 0%;-ms-flex:1 1 0%;flex:1 1 0%;overflow:auto;padding:0}.test-runner-scope .content-wrapper .overlay{position:absolute;left:0;right:0;top:0;bottom:0;width:100%;opacity:.9}.test-runner-scope .content-wrapper .overlay-full{background-color:#fff;opacity:1}.test-runner-scope #qti-content{-webkit-overflow-scrolling:touch;max-width:1024px;width:100%;margin:auto}.test-runner-scope #qti-item{width:100%;min-width:100%;height:auto;overflow:visible}.test-runner-scope .qti-item{padding:30px}.test-runner-scope .size-wrapper{max-width:1280px;margin:auto;width:100%}.test-runner-scope #qti-rubrics{margin:auto;max-width:1024px;width:100%}.test-runner-scope #qti-rubrics .qti-rubricBlock{margin:20px 0}.test-runner-scope #qti-rubrics .hidden{display:none}.test-runner-scope .visible-hidden{position:absolute;overflow:hidden;height:1px;width:1px;word-wrap:normal}.no-controls .test-runner-scope{height:100vh}.test-runner-scope .action-bar.content-action-bar{padding:2px}.test-runner-scope .action-bar.content-action-bar li{margin:2px 0 0 10px;border:none}.test-runner-scope .action-bar.content-action-bar li.btn-info{padding-top:6px;height:36px;margin-top:0;border-bottom:solid 2px transparent;border-radius:0}.test-runner-scope .action-bar.content-action-bar li.btn-info.btn-group{border:none !important;overflow:hidden;padding:0}.test-runner-scope .action-bar.content-action-bar li.btn-info.btn-group a{float:left;margin:0 2px;padding:0 15px;border:1px solid rgba(255,255,255,0.3);border-radius:0px;display:inline-block;height:inherit}.test-runner-scope .action-bar.content-action-bar li.btn-info.btn-group a:first-of-type{border-top-left-radius:3px;border-bottom-left-radius:3px;margin-left:0}.test-runner-scope .action-bar.content-action-bar li.btn-info.btn-group a:last-of-type{border-top-right-radius:3px;border-bottom-right-radius:3px;margin-right:0}.test-runner-scope .action-bar.content-action-bar li.btn-info.btn-group a:hover,.test-runner-scope .action-bar.content-action-bar li.btn-info.btn-group a.active{border-color:rgba(255,255,255,0.8)}.test-runner-scope .action-bar.content-action-bar li.btn-info.btn-group a .no-label{padding-right:0}.test-runner-scope .action-bar.content-action-bar li.btn-info:hover,.test-runner-scope .action-bar.content-action-bar li.btn-info.active{border-bottom-color:rgba(255,255,255,0.8)}.test-runner-scope .action-bar.content-action-bar li.btn-info:active,.test-runner-scope .action-bar.content-action-bar li.btn-info.active{background:#e7eff4;border-color:rgba(255,255,255,0.8)}.test-runner-scope .action-bar.content-action-bar li.btn-info:active a,.test-runner-scope .action-bar.content-action-bar li.btn-info.active a{color:#266d9c;text-shadow:none}.test-runner-scope .action-bar.content-action-bar li.btn-info:active:hover,.test-runner-scope .action-bar.content-action-bar li.btn-info.active:hover{background:#fff}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar{opacity:1;height:40px;flex-basis:40px}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.top-action-bar>.control-box{height:38px;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-wrap:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:space-between;-ms-flex-pack:space-between;justify-content:space-between;padding-left:10px;padding-right:10px}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.top-action-bar>.control-box .title-box{font-size:14px;font-size:1.4rem;padding:4px 0 0;-ms-flex:0 1 auto;-webkit-flex:0 1 auto;flex:0 1 auto}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.top-action-bar>.control-box .progress-box,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.top-action-bar>.control-box .item-number-box{padding-top:4px;white-space:nowrap;-ms-flex:0 1 auto;-webkit-flex:0 1 auto;flex:0 1 auto}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.top-action-bar>.control-box .progress-box .qti-controls,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.top-action-bar>.control-box .item-number-box .qti-controls{display:inline-block;margin-left:20px;white-space:nowrap}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.top-action-bar>.control-box .timer-box{-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.top-action-bar>.control-box .progressbar{margin-top:5px;min-width:150px;max-width:200px;height:0.6em}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box{color:rgba(255,255,255,0.9);text-shadow:1px 1px 0 black}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box .lft,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box .rgt{padding-left:20px}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box .lft:first-child,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box .rgt:first-child{padding-left:0}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box .lft:last-child ul,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box .rgt:last-child ul{display:inline-block}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box [class^=\\\"btn-\\\"],.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box [class*=\\\" btn-\\\"]{white-space:nowrap}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .action{position:relative;overflow:visible}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu{color:#222;background:#f3f1ef;border:1px solid #aaa9a7;overflow:auto;list-style:none;min-width:150px;margin:0;padding:0;position:absolute;bottom:36px;left:-3px}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action{display:inline-block;text-align:left;width:100%;white-space:nowrap;overflow:hidden;color:#222;border-bottom:1px solid #c2c1bf;margin:0;-moz-border-radius:0px;-webkit-border-radius:0px;border-radius:0px;height:auto;padding:8px 15px 9px;line-height:1;border-left:solid 3px transparent}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action .icon-checkbox-checked{display:none}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.active{background-color:#dbd9d7;font-weight:bold}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.hover .icon-checkbox,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:hover .icon-checkbox,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.active .icon-checkbox{display:none}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.hover .icon-checkbox-checked,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:hover .icon-checkbox-checked,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.active .icon-checkbox-checked{display:inline-block}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:focus,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.hover,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:hover{background-color:#0e5d91;color:#fff;border-left-color:#313030 !important}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:focus .label,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:focus .icon,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.hover .label,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.hover .icon,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:hover .label,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:hover .icon{color:#fff}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:focus .icon,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.hover .icon,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:hover .icon{color:#e7eff4}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action .label,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action .icon{font-size:14px;font-size:1.4rem;text-shadow:none;color:#222}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar{overflow:visible;position:relative}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .action{line-height:1.6}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .icon.no-label{padding-right:0}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .tool-label-collapsed .btn-info .text,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .tool-label-collapsed-hover .btn-info:not(:hover) .text,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .btn-info.no-tool-label .text,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .btn-info.tool-label-collapsed .text,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .btn-info.tool-label-collapsed-over:not(:hover) .text{display:none}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .tool-label-collapsed .btn-info .icon,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .tool-label-collapsed-hover .btn-info:not(:hover) .icon,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .btn-info.no-tool-label .icon,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .btn-info.tool-label-collapsed .icon,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .btn-info.tool-label-collapsed-over:not(:hover) .icon{padding:0}.test-runner-scope [data-control=\\\"exit\\\"]{margin-left:20px}.test-runner-scope [data-control=\\\"comment-toggle\\\"]{display:none}.test-runner-scope.non-lti-context .title-box{display:none}.test-runner-scope [data-control=\\\"qti-comment\\\"]{background-color:#f3f1ef;position:absolute;bottom:33px;left:8px;text-align:right;padding:5px;border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px;-webkit-box-shadow:0 0 15px 1px rgba(0,0,0,0.2);-moz-box-shadow:0 0 15px 1px rgba(0,0,0,0.2);-ms-box-shadow:0 0 15px 1px rgba(0,0,0,0.2);-o-box-shadow:0 0 15px 1px rgba(0,0,0,0.2);box-shadow:0 0 15px 1px rgba(0,0,0,0.2)}.test-runner-scope [data-control=\\\"qti-comment\\\"] textarea{display:block;height:100px;resize:none;width:350px;padding:3px;margin:0  0 10px 0;border:none;font-size:13px;font-size:1.3rem;border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px}.test-runner-scope .tools-box{position:relative;overflow:visible}.wait-content .wait-content_text--centered{text-align:center}.wait-content .wait-content_actions-list{display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch;-webkit-flex-direction:column;-moz-flex-direction:column;-ms-flex-direction:column;-o-flex-direction:column;flex-direction:column}.wait-content .wait-content_actions-list .wait-content_text--centered{position:relative;right:15px}body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box>.lft{float:right;margin:2px 10px 0 0}body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .rgt{float:left}body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .tools-box-list>.action>.li-inner>.icon,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .navi-box-list>.action>.li-inner>.icon{display:inline-block}body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .tools-box-list>.action .action,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .navi-box-list>.action .action{text-align:right}body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .tools-box-list>.action .action.active .icon.icon-checkbox-checked,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .navi-box-list>.action .action.active .icon.icon-checkbox-checked{display:inline-block}body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .tools-box-list>.action .action:not(.active) .icon.icon-checkbox,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .navi-box-list>.action .action:not(.active) .icon.icon-checkbox{display:inline-block}body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .tools-box-list>.action .action:not(.active):hover .icon.icon-checkbox,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .navi-box-list>.action .action:not(.active):hover .icon.icon-checkbox{display:none}body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .tools-box-list>.action .action:not(.active):hover .icon.icon-checkbox-checked,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .navi-box-list>.action .action:not(.active):hover .icon.icon-checkbox-checked{display:inline-block}body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .tools-box-list>.action .menu,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .navi-box-list>.action .menu{left:auto;right:-3px}body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .tools-box-list .action,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .navi-box-list .action{float:right}body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .tools-box-list .action .icon,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .navi-box-list .action .icon{padding:0 0 0 9px}body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .tools-box-list .action .icon.icon-right:before,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .tools-box-list .action .icon.icon-left:before,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .tools-box-list .action .icon.icon-fast-forward:before,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .tools-box-list .action .icon.icon-step-forward:before,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .tools-box-list .action .icon.icon-forward:before,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .tools-box-list .action .icon.icon-fast-backward:before,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .tools-box-list .action .icon.icon-step-backward:before,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .tools-box-list .action .icon.icon-external:before,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .tools-box-list .action .icon.icon-backward:before,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .navi-box-list .action .icon.icon-right:before,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .navi-box-list .action .icon.icon-left:before,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .navi-box-list .action .icon.icon-fast-forward:before,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .navi-box-list .action .icon.icon-step-forward:before,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .navi-box-list .action .icon.icon-forward:before,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .navi-box-list .action .icon.icon-fast-backward:before,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .navi-box-list .action .icon.icon-step-backward:before,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .navi-box-list .action .icon.icon-external:before,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .navi-box-list .action .icon.icon-backward:before{display:inline-block;transform:scaleX(-1)}body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .tools-box-list .action .action,body.delivery-scope[dir=rtl] .runner .test-runner-scope .bottom-action-bar .control-box .navi-box-list .action .action{text-align:right}body.delivery-scope[dir=rtl] .qti-navigator .icon-up,body.delivery-scope[dir=rtl] .qti-navigator .icon-down{margin-left:0;margin-right:auto}body.delivery-scope[dir=rtl] .qti-navigator .qti-navigator-counter{margin-left:0;margin-right:auto;text-align:left}body.delivery-scope[dir=rtl] .qti-item [class^=\\\"feedback-\\\"].small,body.delivery-scope[dir=rtl] .qti-item [class*=\\\" feedback-\\\"].small{padding:8px 45px 8px 20px;text-align:right}body.delivery-scope[dir=rtl] .qti-item [class^=\\\"feedback-\\\"].small>[class^=\\\"icon-\\\"],body.delivery-scope[dir=rtl] .qti-item [class^=\\\"feedback-\\\"].small>[class*=\\\" icon-\\\"],body.delivery-scope[dir=rtl] .qti-item [class*=\\\" feedback-\\\"].small>[class^=\\\"icon-\\\"],body.delivery-scope[dir=rtl] .qti-item [class*=\\\" feedback-\\\"].small>[class*=\\\" icon-\\\"]{left:auto;right:10px}body.delivery-scope[dir=rtl] .runner .test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.top-action-bar .control-box>.connectivity-box{margin-left:0px;margin-right:40px}body.delivery-scope[dir=rtl] .runner .test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.top-action-bar .control-box>.connectivity-box.with-message .message-connect{margin-left:3px;margin-right:0px}body.delivery-scope[dir=rtl] .runner .test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.top-action-bar .control-box>.progress-box>.qti-controls{margin-left:0px;margin-right:20px}body.delivery-scope[dir=rtl] .runner .test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.top-action-bar .control-box>.timer-box .timer-toggler{right:20px}body.delivery-scope[dir=rtl] .runner .test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.top-action-bar .control-box>.timer-box .timer-wrapper .countdown:first-child::before{content:\\' \\'}body.delivery-scope[dir=rtl] .runner .test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.top-action-bar .control-box>.timer-box .timer-wrapper .countdown:last-child::before{content:none}.action-bar .shortcuts-list-wrapper{width:100%;height:100%;position:fixed;top:0;left:0;display:flex;align-items:center;align-content:center;justify-content:center;overflow:auto;background:rgba(0,0,0,0.5);z-index:10001}.action-bar .shortcuts-list-wrapper .shortcuts-list{width:auto;min-width:400px;height:auto;min-height:300px;padding:30px !important;color:#222 !important;text-shadow:none !important;position:relative;background-color:#fff;border:1px solid #ddd}.action-bar .shortcuts-list-wrapper .shortcuts-list .shortcuts-list-description{width:450px}.action-bar .shortcuts-list-wrapper .shortcuts-list .shortcuts-list-title{font-size:24px;margin-top:0}.action-bar .shortcuts-list-wrapper .shortcuts-list .shortcuts-group-title{font-size:18px;margin-top:20px}.action-bar .shortcuts-list-wrapper .shortcuts-list .shortcuts-group-title:focus{outline:3px solid #276d9b;outline-offset:3px}.action-bar .shortcuts-list-wrapper .shortcuts-list .shortcuts-group-list{list-style:none;margin:0;padding:0}.action-bar .shortcuts-list-wrapper .shortcuts-list .shortcuts-group-list .shortcut-item{display:-ms-flexbox;display:-webkit-flex;display:flex;float:none;margin:0}.action-bar .shortcuts-list-wrapper .shortcuts-list .shortcuts-group-list .shortcut-item .shortcut-item-action,.action-bar .shortcuts-list-wrapper .shortcuts-list .shortcuts-group-list .shortcut-item .shortcut-item-shortcut{-ms-flex:0 1 50%;-webkit-flex:0 1 50%;flex:0 1 50%;margin:0;text-align:center}.action-bar .shortcuts-list-wrapper .shortcuts-list .shortcuts-group-list .shortcut-item .shortcut-item-action{text-align:left}.action-bar .shortcuts-list-wrapper .shortcuts-list .btn-close{background-color:transparent;box-shadow:none;height:20px;padding:0;position:absolute;right:12px;top:10px;width:20px}.action-bar .shortcuts-list-wrapper .shortcuts-list .btn-close .icon-close{color:#222;font-size:20px;padding:0}.action-bar .shortcuts-list-wrapper .shortcuts-list .btn-close:focus{outline:3px solid #276d9b;outline-offset:3px}.jump-links-container .jump-links-box{display:block;width:0;height:0;position:absolute}.jump-links-container .jump-links-box .jump-link-item{position:fixed;display:block;z-index:1001}.jump-links-container .jump-links-box .jump-link{z-index:1002;position:fixed;display:block;overflow:hidden;top:10px;left:10px;width:0;padding:0 !important;font-size:2.4rem !important}.jump-links-container .jump-links-box .jump-link:focus{width:auto;height:auto;padding:30px !important;background:#f3f1ef;color:#222 !important;border:3px solid #222;outline:none;text-shadow:none !important}.jump-links-container .jump-links-box .jump-link:focus:hover{background:#f3f1ef;text-decoration:underline}\\n\\n/*# sourceMappingURL=../../../taoQtiTest/views/css/new-test-runner.css.map */');\n","\ndefine(\"taoQtiTest/loader/taoQtiTest.bundle\", function(){});\n","define(\"taoQtiTest/loader/taoQtiTest.min\", [\"taoItems/loader/taoItems.min\",\"taoQtiItem/loader/taoQtiItem.min\",\"taoTests/loader/taoTests.min\"], function(){});\n"]}