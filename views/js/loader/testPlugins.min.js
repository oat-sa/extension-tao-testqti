define("taoTests/runner/plugin",["lodash","core/plugin"],function(_,pluginFactory){"use strict";return _.partialRight(pluginFactory,{hostName:"testRunner"})}),define("css!taoQtiTestCss/plugins/key-navigation",[],function(){}),define("taoQtiTest/runner/plugins/content/accessibility/keyNavigation",["jquery","lodash","ui/keyNavigation/navigator","ui/keyNavigation/navigableDomElement","ui/keyNavigation/navigableGroupElement","util/shortcut","util/namespace","taoTests/runner/plugin","css!taoQtiTestCss/plugins/key-navigation"],function($,_,keyNavigator,navigableDomElement,navigableGroupElement,shortcut,namespaceHelper,pluginFactory){"use strict";function initToolbarNavigation(){
var $navigationBar=$(".bottom-action-bar"),$focusables=$navigationBar.find(".action:not(.btn-group):visible, .action.btn-group .li-inner:visible"),navigables=navigableDomElement.createFromDoms($focusables);return navigables.length?[keyNavigator({id:"bottom-toolbar",replace:!0,group:$navigationBar,elements:navigables,defaultPosition:navigables.length-1}).on("right down",function(){this.next()}).on("left up",function(){this.previous()}).on("activate",function(cursor){cursor.navigable.getElement().click().mousedown()})]:[]}function initHeaderNavigation(){var $headerElements=$('[data-control="exit"]:visible a'),navigables=navigableDomElement.createFromDoms($headerElements);
return navigables.length?[keyNavigator({id:"header-toolbar",group:$headerElements.closest(".infoControl"),elements:navigables,loop:!0,replace:!0}).on("activate",function(cursor){cursor.navigable.getElement().click()})]:[]}function initNavigatorNavigation(testRunner){var filtersNavigator,itemsNavigator,$filters,$trees,navigableFilters,navigableTrees,filterCursor,$panel=testRunner.getAreaBroker().getPanelArea(),$navigator=$panel.find(".qti-navigator"),navigators=[],itemListingVisited=!1;return $navigator.length&&!$navigator.hasClass("disabled")&&($filters=$navigator.find(".qti-navigator-filters .qti-navigator-filter"),navigableFilters=navigableDomElement.createFromDoms($filters),
navigableFilters.length&&(filtersNavigator=keyNavigator({keepState:!0,id:"navigator-filters",replace:!0,elements:navigableFilters,group:$navigator}).on("right",function(){this.next()}).on("left",function(){this.previous()}).on("down",function(){itemsNavigator&&_.defer(function(){itemListingVisited?itemsNavigator.focus().first():itemsNavigator.focus()})}).on("up",function(){itemsNavigator&&_.defer(function(){itemsNavigator.last()})}).on("focus",function(cursor,origin){cursor.navigable.getElement().click(),(filterCursor&&filterCursor.position!==cursor.position||origin)&&(itemListingVisited=!1),filterCursor=cursor}),navigators.push(filtersNavigator)),$trees=$navigator.find(".qti-navigator-tree .qti-navigator-item:not(.unseen) .qti-navigator-label"),
navigableTrees=navigableDomElement.createFromDoms($trees),navigableTrees.length&&(itemsNavigator=keyNavigator({id:"navigator-items",replace:!0,elements:navigableTrees,defaultPosition:function(navigables){var pos=0;return filterCursor&&"flagged"!==filterCursor.navigable.getElement().data("mode")&&_.forIn(navigables,function(navigable,i){var $parent=navigable.getElement().parent(".qti-navigator-item");if($parent.hasClass("active")&&$parent.is(":visible"))return pos=i,!1}),pos}}).on("down",function(){this.next()}).on("up",function(){this.previous()}).on("right",function(){filtersNavigator&&filtersNavigator.focus().next()}).on("left",function(){filtersNavigator&&filtersNavigator.focus().previous();
}).on("activate",function(cursor){cursor.navigable.getElement().click()}).on("lowerbound upperbound",function(){filtersNavigator&&filtersNavigator.focus()}).on("focus",function(cursor){itemListingVisited=!0,cursor.navigable.getElement().parent().addClass("key-navigation-highlight")}).on("blur",function(cursor){cursor.navigable.getElement().parent().removeClass("key-navigation-highlight")}))),navigators}function initContentNavigation(testRunner){var itemNavigators=[],$content=testRunner.getAreaBroker().getContentArea();return $content.find(".key-navigation-focusable").addClass("key-navigation-scrollable"),$content.find(".key-navigation-focusable,.qti-interaction").filter(function(){
return!$(this).parents(".qti-interaction").length}).each(function(){var $itemElement=$(this);$itemElement.hasClass("qti-interaction")?itemNavigators=_.union(itemNavigators,initInteractionNavigation($itemElement)):itemNavigators.push(keyNavigator({elements:navigableDomElement.createFromDoms($itemElement),group:$itemElement,propagateTab:!1}))}),itemNavigators}function initInteractionNavigation($interaction){var $inputs,interactionNavigables,interactionNavigators=[];return $interaction.find(".key-navigation-focusable").each(function(){var $nav=$(this);$nav.closest(".qti-choice").length||interactionNavigators.push(keyNavigator({elements:navigableDomElement.createFromDoms($nav),
group:$nav,propagateTab:!1}))}),$interaction.off(".keyNavigation"),$inputs=$interaction.is(":input")?$interaction:$interaction.find(":input"),interactionNavigables=navigableDomElement.createFromDoms($inputs),interactionNavigables.length&&interactionNavigators.push(keyNavigator({elements:interactionNavigables,group:$interaction,loop:!1}).on("right down",function(){this.next()}).on("left up",function(){this.previous()}).on("activate",function(cursor){cursor.navigable.getElement().click()}).on("focus",function(cursor){cursor.navigable.getElement().closest(".qti-choice").addClass("key-navigation-highlight")}).on("blur",function(cursor){cursor.navigable.getElement().closest(".qti-choice").removeClass("key-navigation-highlight");
})),interactionNavigators}function initRubricNavigation(){var $itemElements,rubricNavigators=[],$rubricArea=$("#qti-rubrics");return $itemElements=$rubricArea.find(".qti-rubricBlock"),$itemElements.each(function(){var $itemElement=$(this),id="rubric_element_navigation_group_"+rubricNavigators.length;rubricNavigators.push(keyNavigator({id:id,elements:navigableDomElement.createFromDoms($itemElement),group:$itemElement,replace:!0}))}),rubricNavigators}function initTestRunnerNavigation(testRunner){var navigators;return document.activeElement&&document.activeElement.blur(),navigators=_.union(initRubricNavigation(testRunner),initContentNavigation(testRunner),initToolbarNavigation(testRunner),initNavigatorNavigation(testRunner),initHeaderNavigation(testRunner)),
navigators=navigableGroupElement.createFromNavigators(navigators),keyNavigator({id:"test-runner",replace:!0,loop:!0,elements:navigators}).on("tab",function(){this.next()}).on("shift+tab",function(){this.previous()})}return pluginFactory({name:"keyNavigation",init:function(){var self=this,testRunner=this.getTestRunner();shortcut.add("tab shift+tab",function(){self.groupNavigator.isFocused()||self.groupNavigator.focus()}),this.disable(),testRunner.after("renderitem",function(){self.groupNavigator=initTestRunnerNavigation(testRunner),self.enable()}).on("unloaditem",function(){self.disable()})},destroy:function(){shortcut.remove("."+this.getName()),this.groupNavigator&&this.groupNavigator.destroy();
}})}),define("taoQtiTest/runner/plugins/content/dialog/dialog",["jquery","lodash","i18n","taoTests/runner/plugin","ui/dialog/alert","ui/dialog/confirm","util/shortcut/registry","util/shortcut","util/namespace"],function($,_,__,pluginFactory,dialogAlert,dialogConfirm,shortcutRegistry,globalShortcut,namespaceHelper){"use strict";var pluginName="dialog",actionPrefix="tool-"+pluginName+"-";return pluginFactory({name:pluginName,init:function(){function closeAccept(dialog){dialog.trigger("okbtn.modal").hide()}function closeReject(dialog){dialog.hide()}function closeLast(accept,shortcut){var handle=opened.length&&opened[opened.length-1];handle&&(handle.shortcut=shortcut,
accept?closeAccept(handle.dialog):closeReject(handle.dialog))}function addHandle(namespace,stack,dialog,message,accept,reject){function doAccept(e,reason){_.isFunction(accept)&&accept(handle.shortcut||reason)}function doReject(e,reason){_.isFunction(reject)&&reject(handle.shortcut||reason)}var handle={context:namespace,dialog:dialog(message,doAccept,doReject)};globalShortcut.disable(),dialogShortcut.enable(),stack.push(handle),opened.push(handle),handle.dialog.focus(),handle.dialog.on("closed.modal",function(){removeHandle(stack,handle.dialog),removeHandle(opened,handle.dialog),opened.length||(globalShortcut.enable(),dialogShortcut.disable())})}function removeHandle(stack,dialog){
dialog&&_.remove(stack,function(handle){if(handle&&dialog===handle.dialog)return!0})}function closeDialogs(namespace,accept,stack){stack?_.forEach(stack,function(handle){!handle||"@"!==namespace&&namespace!==handle.context||(accept?closeAccept(handle.dialog):closeReject(handle.dialog))}):(closeDialogs(namespace,accept,alerts),closeDialogs(namespace,accept,confirms))}var testRunner=this.getTestRunner(),testData=testRunner.getTestData()||{},testConfig=testData.config||{},pluginShortcuts=(testConfig.shortcuts||{})[pluginName]||{},alerts=[],confirms=[],opened=[],dialogShortcut=shortcutRegistry($("body"),{propagate:!1,prevent:!0});dialogShortcut.disable().set("Tab Shift+Tab"),
testConfig.allowShortcuts&&_.forEach(pluginShortcuts,function(command,key){dialogShortcut.add(namespaceHelper.namespaceAll(command,pluginName,!0),function(e,shortcut){testRunner.trigger(actionPrefix+key,shortcut)})}),testRunner.before("alert.*",function(e,msg,accept){addHandle(e.namespace,alerts,dialogAlert,msg,accept,accept)}).before("confirm.*",function(e,msg,accept,reject){addHandle(e.namespace,confirms,dialogConfirm,msg,accept,reject)}).before("closedialog.*",function(e,accept){closeDialogs(e.namespace,accept)}).on(actionPrefix+"accept",function(shortcut){closeLast(!0,shortcut)}).on(actionPrefix+"reject",function(shortcut){closeLast(!1,shortcut)}).on("destroy",function(){
closeDialogs(".@"),dialogShortcut.clear(),dialogShortcut=null})}})}),define("taoQtiTest/runner/plugins/content/dialog/exitMessages",["lodash","core/promise","taoTests/runner/plugin"],function(_,Promise,pluginFactory){"use strict";return pluginFactory({name:"exitMessages",init:function(){},install:function(){var testRunner=this.getTestRunner();testRunner.before("leave",function(e,data){if(_.isObject(data)&&data.message)return new Promise(function(resolve){var context=testRunner.getTestContext();context&&context.itemIdentifier&&testRunner.disableItem(context.itemIdentifier),testRunner.trigger("alert.leave",data.message,resolve)})})}})}),define("taoQtiTest/runner/plugins/content/dialog/itemAlertMessage",["jquery","i18n","ui/hider","taoTests/runner/plugin"],function($,__,hider,pluginFactory){
"use strict";return pluginFactory({name:"itemAlertMessage",init:function(){var self=this;this.$element=$(this.getContent().dom),this.$element.on("closed.modal",function(){$(this).modal("destroy")}).on("destroyed.modal",function(){self.$element=null,self.trigger("resume",self)})},render:function(){var testRunner=this.getTestRunner(),itemRunner=testRunner.itemRunner,$modalsContainer=this.getContent().$container;$modalsContainer||($modalsContainer=$("#modalFeedbacks",itemRunner._item.container)),$modalsContainer.append(this.$element),this.$element.modal()},destroy:function(){this.$element&&this.$element.length&&this.$element.modal("close")}})}),define("tpl!taoQtiTest/runner/plugins/templates/button",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+=" ",(helper=helpers.className)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.className,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)}function program3(depth0,data){var stack1,helper,buffer="";return buffer+='<span class="icon icon-',(helper=helpers.icon)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.icon,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1),
stack1=helpers.unless.call(depth0,depth0&&depth0.text,{hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='"></span>'}function program4(depth0,data){return" no-label"}function program6(depth0,data){var stack1,helper,buffer="";return buffer+='<span class="text">',(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;
return buffer+='<li data-control="',(helper=helpers.control)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.control,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" class="small btn-info action',stack1=helpers.if.call(depth0,depth0&&depth0.className,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" title="',(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <a class="li-inner" href="#">\n        ',
stack1=helpers.if.call(depth0,depth0&&depth0.icon,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        ",stack1=helpers.if.call(depth0,depth0&&depth0.text,{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </a>\n</li>\n"})}),define("taoQtiTest/runner/plugins/content/dialog/itemInlineMessage",["jquery","i18n","ui/hider","taoTests/runner/plugin","tpl!taoQtiTest/runner/plugins/templates/button"],function($,__,hider,pluginFactory,buttonTpl){"use strict";var buttonData={next:{control:"move-forward",title:__("Submit and go to the next item"),
icon:"forward",text:__("OK")},end:{control:"move-end",title:__("Submit and go to the end of the test"),icon:"fast-forward",text:__("OK & End test")}};return pluginFactory({name:"itemInlineMessage",init:function(){var self=this,testRunner=this.getTestRunner(),createOkButton=function(){var dataType=testRunner.getTestContext().isLast?"end":"next",$btn=$(buttonTpl(buttonData[dataType]));return $btn.addClass("modalFeedback-button"),$btn.on("click",function(e){e.preventDefault(),self.disable(),"move-end"===$(this).data("control")&&self.trigger("end"),$btn.remove(),self.$element.remove(),self.trigger("resume",self)}),$btn};this.$button=createOkButton(),this.$element=$(this.getContent().dom);
},render:function(){var $navigationContainer=this.getAreaBroker().getNavigationArea(),testRunner=this.getTestRunner(),itemRunner=testRunner.itemRunner,$inlineContainer=this.getContent().$container;!$inlineContainer&&itemRunner._item.container&&($inlineContainer=$(".qti-itemBody",itemRunner._item.container)),$inlineContainer.append(this.$element),$(".modalFeedback-button",$navigationContainer).length||$navigationContainer.append(this.$button)},enable:function(){this.$button.removeProp("disabled").removeClass("disabled")},disable:function(){this.$button.prop("disabled",!0).addClass("disabled")},destroy:function(){this.$button.click()}})}),define("taoQtiTest/runner/plugins/content/feedback/feedback",["jquery","i18n","taoTests/runner/plugin","ui/feedback"],function($,__,pluginFactory,feedback){
"use strict";return pluginFactory({name:"feedback",init:function(){var currentFeedback,testRunner=this.getTestRunner(),closeCurrent=function(){currentFeedback&&currentFeedback.close()};testRunner.on("error",function(err){var message=err,type="error";if("object"==typeof err&&(message=err.message,type=err.type),!message)switch(type){case"TestState":message=__("The test has been closed/suspended!");break;case"FileNotFound":message=__("File not found!");break;default:message=__("An error occurred!")}currentFeedback=feedback().error(message)}).on("danger",function(message){currentFeedback=feedback().danger(message)}).on("warning",function(message){currentFeedback=feedback().warning(message);
}).on("info",function(message){currentFeedback=feedback().info(message)}).on("alert.* confirm.* unloaditem",closeCurrent)}})}),define("taoQtiTest/runner/plugins/content/loading/loading",["layout/loading-bar","taoTests/runner/plugin"],function(loadingBar,pluginFactory){"use strict";return pluginFactory({name:"loading",init:function(){var testRunner=this.getTestRunner();testRunner.on("unloaditem",function(){loadingBar.start()}).on("renderitem",function(){loadingBar.stop()})}})}),define("taoQtiTest/runner/plugins/content/modalFeedback/modalFeedback",["jquery","lodash","module","taoTests/runner/plugin","taoQtiTest/runner/plugins/content/dialog/itemInlineMessage","taoQtiTest/runner/plugins/content/dialog/itemAlertMessage","ui/autoscroll"],function($,_,module,pluginFactory,inlineMessage,alertMessage,autoscroll){
"use strict";function destroyFeedback(feedback){var removed=!1;_.remove(renderedFeedbacks,function(storedFeedback){var found=storedFeedback===feedback;return found&&(removed=!0),found}),removed&&(feedback.destroy(),renderedFeedbacks.length||nextStep())}function defineMode(inline){inlineMode=inline,messagePlugin=inlineMode?inlineMessage:alertMessage}var inlineMode,messagePlugin,renderedFeedbacks,isDestroyed,nextStep;return pluginFactory({name:"QtiModalFeedback",init:function(){nextStep=function(){},defineMode(!!module.config().inlineModalFeedback)},render:function(){var self=this,testRunner=this.getTestRunner(),createMessages=function(renderingQueue,inline){var bInlineMode=inlineMode;
isDestroyed=!1,renderedFeedbacks=[],_.isBoolean(inline)&&defineMode(inline),renderingQueue.length?(_.forEach(renderingQueue,function(renderingToken){var feedback=messagePlugin(testRunner,testRunner.getAreaBroker());feedback.init({dom:renderingToken.feedback.render({inline:inlineMode}),$container:inlineMode?renderingToken.$container:null}),feedback.render(),renderedFeedbacks.push(feedback)}),inlineMode&&renderedFeedbacks&&autoscroll($(".qti-modalFeedback",testRunner.getAreaBroker().getContentArea()).first(),testRunner.getAreaBroker().getContentArea().parents(".content-wrapper"))):nextStep(),defineMode(bInlineMode)};inlineMode?testRunner.off("plugin-resume.itemInlineMessage").on("plugin-resume.itemInlineMessage",function(){
self.destroy()}):testRunner.off("plugin-resume.itemAlertMessage").on("plugin-resume.itemAlertMessage",function(feedback){destroyFeedback(feedback)}),testRunner.on("modalFeedbacks",function(renderingQueue,done,inline){nextStep=done,createMessages(renderingQueue,inline)})},destroy:function(){var tFeedbacks,i;if(!isDestroyed)if(isDestroyed=!0,renderedFeedbacks){tFeedbacks=renderedFeedbacks.slice(0);for(i in tFeedbacks)destroyFeedback(tFeedbacks[i])}else nextStep()}})}),define("taoQtiTest/runner/plugins/content/overlay/overlay",["jquery","i18n","taoTests/runner/plugin"],function($,__,pluginFactory){"use strict";return pluginFactory({name:"overlay",init:function(){
var self=this,testRunner=this.getTestRunner();this.$element=$("<div />"),this.$element.on("click mousedown mouseup touchstart touchend keyup keydow keypress scroll drop",function(e){e.stopImmediatePropagation(),e.stopPropagation()});var shield=function(){self.enable()},unshield=function(itemRef){self.disable()};testRunner.on("disableitem",shield).on("enableitem unloaditem",unshield)},render:function(){var $contentArea=this.getTestRunner().getAreaBroker().getContentArea();$contentArea.after(this.$element)},destroy:function(){this.$element.remove()},enable:function(){var testRunner=this.getTestRunner(),testData=testRunner.getTestData()||{},testConfig=testData.config||{},pluginsConfig=testConfig.plugins||{},overlayConfig=pluginsConfig.overlay||{};
this.$element.addClass("overlay"),overlayConfig.full&&this.$element.addClass("overlay-full")},disable:function(){this.$element.removeClass("overlay overlay-full")},show:function(){this.enable()},hide:function(){this.disable()}})}),define("taoQtiTest/runner/plugins/content/responsiveness/collapser",["lodash","jquery","taoTests/runner/plugin"],function(_,$,pluginFactory){"use strict";var ns=".collapser",noLabelCls="tool-label-collapsed",noLabelHoverCls="tool-label-collapsed-hover",labelHiddenCls="no-tool-label",defaults={collapseTools:!0,collapseNavigation:!1,collapseInOrder:!1,hover:!1,collaspeOrder:[]},$window=$(window);return pluginFactory({name:"collapser",
init:function(){function buildCollapsiblesList(){shouldCollapseInOrder()?(allCollapsibles=config.collapseOrder.map(function(selector){var $elements=$(selector).not("."+labelHiddenCls),extraWidth=0;return!!$elements.length&&($elements.each(function(){extraWidth+=getExtraWidth($(this))}),{$elements:$elements,extraWidth:extraWidth})}),allCollapsibles=_.compact(allCollapsibles)):(allCollapsibles=[],config.collapseTools&&allCollapsibles.push({$elements:$toolbox,extraWidth:getExtraWidth($toolbox)}),config.collapseNavigation&&allCollapsibles.push({$elements:$navigation,extraWidth:getExtraWidth($navigation)}),totalExtraWidth=allCollapsibles.reduce(function(total,collapsible){
return total+=collapsible.extraWidth},0))}function getExtraWidth($element){var expandedWidth,collapsedWidth;return $element.removeClass(collapseCls),expandedWidth=$element.outerWidth(!0),$element.addClass(collapseCls),collapsedWidth=$element.outerWidth(!0),$element.removeClass(collapseCls),expandedWidth-collapsedWidth}function toggleCollapsibles(){availableWidth=getAvailableWidth(),availableWidth<previousAvailableWidth?shouldCollapseInOrder()?collapseInOrder():collapseAll(collapseNeeded()):shouldCollapseInOrder()?expandInOrder():expandAll(),previousAvailableWidth=availableWidth}function shouldCollapseInOrder(){return config.collapseInOrder&&_.isArray(config.collapseOrder)&&config.collapseOrder.length;
}function collapseAll(yes){config.collapseTools&&$toolbox.toggleClass(collapseCls,yes),config.collapseNavigation&&$navigation.toggleClass(collapseCls,yes)}function collapseInOrder(){for(var toCollapse,collapsiblesCopy=_.clone(allCollapsibles);collapseNeeded()&&collapsiblesCopy.length;)toCollapse=collapsiblesCopy.shift(),toCollapse.$elements.addClass(collapseCls)}function collapseNeeded(){return getToolbarWidth()>getAvailableWidth()}function expandAll(){expandPossible(totalExtraWidth)&&allCollapsibles.forEach(function(collapsible){collapsible.$elements.removeClass(collapseCls)})}function expandInOrder(){_.forEachRight(allCollapsibles,function(toExpand){if(toExpand.$elements.hasClass(collapseCls)){
if(!expandPossible(toExpand.extraWidth))return!1;toExpand.$elements.removeClass(collapseCls)}})}function expandPossible(extraWidth){return getToolbarWidth()+extraWidth<=getAvailableWidth()}function getAvailableWidth(){return $actionsBar.width()}function getToolbarWidth(){return $toolbox.outerWidth(!0)+$navigation.outerWidth(!0)}var allCollapsibles,availableWidth,previousAvailableWidth,totalExtraWidth,testRunner=this.getTestRunner(),testData=testRunner.getTestData()||{},testConfig=testData.config||{},pluginsConfig=testConfig.plugins||{},config=_.defaults(pluginsConfig.collapser||{},defaults),collapseCls=config.hover?noLabelHoverCls:noLabelCls,areaBroker=testRunner.getAreaBroker(),$actionsBar=areaBroker.getArea("actionsBar"),$toolbox=areaBroker.getToolboxArea(),$navigation=areaBroker.getNavigationArea();
$window.on("resize"+ns,_.throttle(function(){testRunner.trigger("collapseTools")},100)),testRunner.after("renderitem loaditem",function(){previousAvailableWidth=1/0,buildCollapsiblesList(),testRunner.trigger("collapseTools")}).on("collapseTools"+ns,function(){toggleCollapsibles()})},destroy:function(){$window.off(ns)}})}),define("tpl!taoQtiTest/runner/plugins/content/rubricBlock/rubricBlock",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},'<div id="qti-rubrics"></div>\n'})}),define("taoQtiTest/runner/plugins/content/rubricBlock/rubricBlock",["jquery","i18n","core/promise","ui/hider","taoTests/runner/plugin","tpl!taoQtiTest/runner/plugins/content/rubricBlock/rubricBlock"],function($,__,Promise,hider,pluginFactory,containerTpl){
"use strict";var blankifyLinks=function($container){$("a",$container).attr("target","_blank")},mathify=function($container){return new Promise(function(resolve){$("math",$container).length>0?require(["mathJax"],function(MathJax){MathJax?(MathJax.Hub.Queue(["Typeset",MathJax.Hub],$container[0]),MathJax.Hub.Queue(resolve)):resolve()},resolve):resolve()})};return pluginFactory({name:"rubricBlock",init:function(){var self=this,testRunner=this.getTestRunner();this.$element=$(containerTpl()),this.hide(),testRunner.on("ready",function(){self.hide()}).on("loaditem",function(){var context=testRunner.getTestContext();context.rubrics&&(self.$element.html(context.rubrics),
blankifyLinks(self.$element),mathify(self.$element).then(function(){testRunner.trigger("rubricblock")}))}).on("renderitem",function(){self.show()}).on("unloaditem",function(){self.hide(),self.$element.empty()})},render:function(){var $container=this.getAreaBroker().getContentArea();$container.before(this.$element)},destroy:function(){this.$element.remove()},enable:function(){this.$element.removeProp("disabled").removeClass("disabled")},disable:function(){this.$element.prop("disabled",!0).addClass("disabled")},show:function(){hider.show(this.$element)},hide:function(){hider.hide(this.$element)}})}),define("tpl!taoQtiTest/runner/plugins/controls/connectivity/connectivity",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;return buffer+='<div class="connectivity-box ',(helper=helpers.state)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.state,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <span data-control="connectivity-connected" class="qti-controls icon-connect" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Connected to server",options):helperMissing.call(depth0,"__","Connected to server",options)))+'"></span>\n    <span data-control="connectivity-disconnected" class="qti-controls icon-disconnect" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Disconnected from server",options):helperMissing.call(depth0,"__","Disconnected from server",options)))+'"></span>\n</div>\n'})}),define("taoQtiTest/runner/plugins/controls/connectivity/connectivity",["jquery","i18n","taoTests/runner/plugin","tpl!taoQtiTest/runner/plugins/controls/connectivity/connectivity"],function($,__,pluginFactory,connectivityTpl){
"use strict";return pluginFactory({name:"connectivity",init:function(){},install:function(){var self=this,testRunner=this.getTestRunner(),proxy=testRunner.getProxy();this.$element=$(connectivityTpl({state:proxy.isOnline()?"connected":"disconnected"})),proxy.on("disconnect",function(source){testRunner.getState("disconnected")||(testRunner.setState("disconnected",!0),testRunner.trigger("disconnect",source),self.$element.removeClass("connected").addClass("disconnected"))}).on("reconnect",function(){testRunner.getState("disconnected")&&(testRunner.setState("disconnected",!1),testRunner.trigger("reconnect"),self.$element.removeClass("disconnected").addClass("connected"));
}),testRunner.before("error",function(e,err){return!proxy.isConnectivityError(err)&&("navigator"===err.source&&"proxy"===err.purpose&&404===err.code?(testRunner.trigger("disconnectpause").trigger("pause",{reasons:{category:__("technical"),subCategory:__("network")},message:err.message}),!1):void 0)})},render:function(){var $container=this.getAreaBroker().getControlArea();$container.append(this.$element)}})}),define("taoQtiTest/runner/plugins/controls/duration/duration",["lodash","core/polling","core/timer","core/store","core/promise","taoTests/runner/plugin"],function(_,pollingFactory,timerFactory,store,Promise,pluginFactory){"use strict";var refresh=1e3;return pluginFactory({
name:"duration",init:function(){var self=this,testRunner=this.getTestRunner(),initContext=testRunner.getTestContext(),initItemAttemptId=initContext.itemIdentifier+"#"+initContext.attempt;return store("duration-"+testRunner.getConfig().serviceCallId).then(function(durationStore){function getItemDuration(attemptId){return/^(.*)+#+\d+$/.test(attemptId)?durationStore.getItem(attemptId):Promise.reject(new Error('Is it really an attempt id, like "itemid#attempt"'))}return self.stopwatch=timerFactory({autoStart:!1}),durationStore.getItem(initItemAttemptId).then(function(initDuration){if(initDuration=_.isNumber(initDuration)?initDuration:0,!initDuration&&initContext.attemptDuration)return durationStore.setItem(initItemAttemptId,initContext.attemptDuration||0);
}).then(function(){self.polling=pollingFactory({action:function(){var elapsed=self.stopwatch.tick(),context=testRunner.getTestContext(),itemAttemptId=context.itemIdentifier+"#"+context.attempt;durationStore.getItem(itemAttemptId).then(function(duration){duration=_.isNumber(duration)?duration:0,elapsed=_.isNumber(elapsed)&&elapsed>0?elapsed/1e3:0,durationStore.setItem(itemAttemptId,duration+elapsed)})},interval:refresh,autoStart:!1}),testRunner.after("renderitem enableitem",function(){self.enable()}).before("move disableitem skip error",function(){self.getState("enabled")&&self.disable()}).before("move skip exit timeout",function(){var context=testRunner.getTestContext(),itemAttemptId=context.itemIdentifier+"#"+context.attempt;
return getItemDuration(itemAttemptId).then(function(duration){var params={itemDuration:0};_.isNumber(duration)&&duration>0&&(params.itemDuration=duration),testRunner.getProxy().addCallActionParams(params)})}).on("plugin-get.duration",function(e,attemptId,getDuration){_.isFunction(getDuration)&&getDuration(getItemDuration(attemptId))}).before("finish",function(){return new Promise(function(resolve){durationStore.removeStore().then(resolve).catch(resolve)})})})})},destroy:function(){this.polling.stop(),this.stopwatch.stop()},enable:function(){this.polling.start(),this.stopwatch.resume()},disable:function(){this.polling.stop(),this.stopwatch.pause()}})}),define("tpl!taoQtiTest/runner/plugins/controls/progressbar/progressbar",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},'<div class="progress-box">\n    <div data-control="progress-bar" class="qti-controls progressbar info"></div>\n    <div data-control="progress-label" class="qti-controls"></div>\n</div>\n'})}),define("taoQtiTest/runner/plugins/controls/progressbar/progressbar",["jquery","lodash","i18n","taoTests/runner/plugin","tpl!taoQtiTest/runner/plugins/controls/progressbar/progressbar","ui/progressbar"],function($,_,__,pluginFactory,progressTpl){"use strict";var progressUpdater=function(testContext,testMap,progressConfig){
var updater={percentage:function(){var total=Math.max(1,testContext.numberItems),ratio=Math.floor(testContext.numberCompleted/total*100);return{ratio:ratio,label:ratio+"%"}},position:function(){var getTestPart=function(){if(testMap&&testMap.parts)return testMap.parts[testContext.testPartId]},getTestSection=function(){var testPart=getTestPart();if(testPart&&testPart.sections)return testPart.sections[testContext.sectionId]},progressScopeCounter={test:{total:function(){return Math.max(1,testContext.numberItems)},position:function(){return testContext.itemPosition+1}},testPart:{total:function(){var testPart=getTestPart();return testPart?_.reduce(testMap.parts[testContext.testPartId].sections,function(acc,section){
return acc+_.size(section.items)},0):0},position:function(){var testSection=getTestSection();return testSection?testSection.items[testContext.itemIdentifier].positionInPart+1:0}},testSection:{total:function(){var testSection=getTestSection();return testSection?_.size(testSection.items):0},position:function(){var testSection=getTestSection();return testSection?testSection.items[testContext.itemIdentifier].positionInSection+1:0}}},counter=progressScopeCounter[progressConfig.scope]||progressScopeCounter.test,total=counter.total(),currentPosition=counter.position();return{ratio:total>0?Math.floor(currentPosition/total*100):0,label:progressConfig.showTotal?__("Item %d of %d",currentPosition,total):__("Item %d",currentPosition)
}}};return updater[progressConfig.indicator]()};return pluginFactory({name:"progressBar",init:function(){var $progressLabel,$progressControl,testRunner=this.getTestRunner(),testData=testRunner.getTestData(),config=testData.config.progressIndicator||{},progressConfig={indicator:config.type||"percentage",scope:config.scope||"test",showTotal:!!config.showTotal},update=function(){var progressData=progressUpdater(testRunner.getTestContext(),testRunner.getTestMap(),progressConfig);progressData&&$progressLabel&&$progressControl&&($progressLabel.text(progressData.label),$progressControl.progressbar("value",progressData.ratio))};this.$element=$(progressTpl()),$progressLabel=$('[data-control="progress-label"]',this.$element),
$progressControl=$('[data-control="progress-bar"]',this.$element),$progressControl.progressbar(),update(),testRunner.on("ready",update).on("loaditem",update)},render:function(){var $container=this.getAreaBroker().getControlArea();$container.append(this.$element)}})}),define("taoQtiTest/runner/plugins/controls/testState/testState",["lodash","taoTests/runner/plugin"],function(_,pluginFactory){"use strict";return pluginFactory({name:"testState",install:function(){var testRunner=this.getTestRunner();testRunner.getProxy().use(function(req,res,next){var data=res&&res.data;return data&&data.type&&"TestState"===data.type?(testRunner.setState("closedOrSuspended",!0),void(testRunner.getState("ready")?!_.isEmpty(data.messages)&&_.find(data.messages,{
channel:"teststate"})||testRunner.trigger("leave",data):testRunner.trigger("destroy"))):void next()})},init:function(){var testRunner=this.getTestRunner(),isLeaving=!1;testRunner.getProxy().channel("teststate",function(data){isLeaving||!data||"close"!==data.type&&"pause"!==data.type||testRunner.getState("closedOrSuspended")||(isLeaving=!0,testRunner.setState("closedOrSuspended",!0),testRunner.trigger("leave",data))})}})}),define("tpl!taoQtiTest/runner/plugins/controls/timer/timer",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){return" disabled"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<span class="qti-timer qti-timer__type-',(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+" qti-controls ",stack1=helpers.unless.call(depth0,depth0&&depth0.running,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-control="',(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,
stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" title="',(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n    <span class="qti-timer_label truncate">',(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</span>\n    <span class="qti-timer_time"></span>\n</span>\n';
})}),define("taoQtiTest/runner/plugins/controls/timer/timerComponent",["jquery","lodash","i18n","moment","core/encoder/time","tpl!taoQtiTest/runner/plugins/controls/timer/timer"],function($,_,__,moment,timeEncoder,timerTpl){"use strict";var hasAnimationFrame="requestAnimationFrame"in window,precision=1e3,timerTypes={test:"assessmentTest",testPart:"testPart",section:"assessmentSection",item:"assessmentItemRef"},timerComponentFactory=function(config){var data;if(!_.isPlainObject(config))throw new TypeError("A timer needs to be configured using a config object");if(_.isEmpty(config.id))throw new TypeError("A timer needs and identifier");if(!_.contains(timerTypes,config.type))throw new TypeError("Invalid type configured");
return data=_.defaults(config,{label:"",remaining:0,warnings:{},running:!0}),{init:function(){return this.$element=$(timerTpl(data)),this.$display=$(".qti-timer_time",this.$element),this},render:function($container){return $container.append(this.$element),this},destroy:function(){return this.$element.remove(),this},refresh:function(){var self=this,update=function(){self.$display.text(timeEncoder.encode(data.remaining/precision))};return hasAnimationFrame?window.requestAnimationFrame(update):update(),this},warn:function(){var remaining,message={},warning=_.findLast(data.warnings,{showed:!1});if(!_.isEmpty(warning)&&_.isFinite(warning.point)&&data.remaining<=warning.point){
switch(remaining=moment.duration(data.remaining/precision,"seconds").humanize(),this.$display.removeClass("txt-info txt-warning txt-danger").addClass("txt-"+warning.type),data.type){case"assessmentItemRef":message.text=__("Warning – You have %s remaining to complete this item.",remaining);break;case"assessmentSection":message.text=__("Warning – You have %s remaining to complete this section.",remaining);break;case"testPart":message.text=__("Warning – You have %s remaining to complete this test part.",remaining);break;case"assessmentTest":message.text=__("Warning – You have %s remaining to complete the test.",remaining)}var showed=_.find(data.warnings,{point:warning.point
});showed&&showed.point&&data.warnings[showed.point/precision]&&(data.warnings[showed.point/precision].showed=!0),message.type=warning.type}return message},id:function(){return data.id},val:function(value){return"undefined"!=typeof value?(data.remaining=value,this):data.remaining},running:function(value){return"undefined"!=typeof value?(data.running=!!value,this):!!data.running}}};return timerComponentFactory}),define("taoQtiTest/runner/helpers/map",["lodash"],function(_){"use strict";function getEmptyStats(){return{questions:0,answered:0,flagged:0,viewed:0,total:0}}return{getJumps:function(map){return map&&map.jumps},getParts:function(map){return map&&map.parts;
},getJump:function(map,position){var jumps=this.getJumps(map);return jumps&&jumps[position]},getPart:function(map,partName){var parts=this.getParts(map);return parts&&parts[partName]},getSection:function(map,sectionName){var parts=this.getParts(map),section=null;return _.forEach(parts,function(part){var sections=part.sections;if(sections&&sections[sectionName])return section=sections[sectionName],!1}),section},getItem:function(map,itemName){var jump=_.find(this.getJumps(map),{identifier:itemName});return this.getItemAt(map,jump&&jump.position)},getTestStats:function(map){return map&&map.stats},getPartStats:function(map,partName){var part=this.getPart(map,partName);
return part&&part.stats},getSectionStats:function(map,sectionName){var section=this.getSection(map,sectionName);return section&&section.stats},getScopeStats:function(map,position,scope){var jump=this.getJump(map,position);switch(scope){case"section":case"testSection":return this.getSectionStats(map,jump&&jump.section);case"part":case"testPart":return this.getPartStats(map,jump&&jump.part);default:case"test":return this.getTestStats(map)}},getScopeMap:function(map,position,scope){var scopeMap=_.cloneDeep(map||{}),jump=this.getJump(map,position),part=this.getPart(scopeMap,jump&&jump.part),section=this.getSection(scopeMap,jump&&jump.section);return scope&&"test"!==scope&&(scopeMap.parts={},
part&&(scopeMap.parts[jump.part]=part)),!part||"section"!==scope&&"testSection"!==scope||(part.sections={},section&&(part.sections[jump.section]=section)),section&&(section.stats=this.computeItemStats(section.items)),part&&(part.stats=this.computeStats(part.sections)),scopeMap.stats=this.computeStats(scopeMap.parts),scopeMap},getItemPart:function(map,position){var jump=this.getJump(map,position);return this.getPart(map,jump&&jump.part)},getItemSection:function(map,position){var jump=this.getJump(map,position),part=this.getPart(map,jump&&jump.part),sections=part&&part.sections;return sections&&sections[jump&&jump.section]},getItemAt:function(map,position){var jump=this.getJump(map,position),part=this.getPart(map,jump&&jump.part),sections=part&&part.sections,section=sections&&sections[jump&&jump.section],items=section&&section.items;
return items&&items[jump&&jump.identifier]},getItemIdentifier:function(map,position){var item;return item=_.isFinite(position)?this.getItemAt(map,position):this.getItem(map,position),item&&item.id},each:function(map,callback){return _.isFunction(callback)&&_.forEach(map&&map.parts,function(part){_.forEach(part&&part.sections,function(section){_.forEach(section&&section.items,function(item){callback(item,section,part,map)})})}),map},updateItemStats:function(map,position){var jump=this.getJump(map,position),part=this.getPart(map,jump&&jump.part),sections=part&&part.sections,section=sections&&sections[jump&&jump.section];return section&&(section.stats=this.computeItemStats(section.items)),
part&&(part.stats=this.computeStats(part.sections)),map&&(map.stats=this.computeStats(map.parts)),map},computeItemStats:function(items){return _.reduce(items,function(acc,item){return item.informational||acc.questions++,item.answered&&acc.answered++,item.flagged&&acc.flagged++,item.viewed&&acc.viewed++,acc.total++,acc},getEmptyStats())},computeStats:function(collection){return _.reduce(collection,function(acc,item){return acc.questions+=item.stats.questions,acc.answered+=item.stats.answered,acc.flagged+=item.stats.flagged,acc.viewed+=item.stats.viewed,acc.total+=item.stats.total,acc},getEmptyStats())}}}),define("taoQtiTest/runner/helpers/currentItem",["lodash"],function(_){
"use strict";var responseCardinalities={single:"base",multiple:"list",ordered:"list",record:"record"},currentItemHelper={getDeclarations:function(runner){var itemRunner=runner.itemRunner;return itemRunner._item&&itemRunner._item.responses},getResponseDeclaration:function(runner,identifier){var found=null;return _.forEach(currentItemHelper.getDeclarations(runner),function(declaration){var attributes=declaration.attributes||{};if(attributes.identifier===identifier)return found=declaration,!1}),found},toResponse:function(value,baseType,cardinality){var mappedCardinality=responseCardinalities[cardinality],response={};return _.isString(value)&&(value=[value]),value=_.map(value||[],function(v){
return"boolean"===baseType?v===!0||"true"===v:v}),mappedCardinality&&("base"===mappedCardinality?0===value.length?response.base=null:(response.base={},response.base[baseType]=value[0]):(response[mappedCardinality]={},response[mappedCardinality][baseType]=value)),response},isQtiValueNull:function(value,baseType,cardinality){var mappedCardinality=responseCardinalities[cardinality];return _.isObject(value)&&value[mappedCardinality]&&"undefined"!=typeof value[mappedCardinality][baseType]&&(value=value[mappedCardinality][baseType]),null===value||"string"===baseType&&_.isEmpty(value)||"single"!==cardinality&&_.isEmpty(value)},isQuestionAnswered:function(response,baseType,cardinality,defaultValue){
var answered;return defaultValue=defaultValue||null,answered=currentItemHelper.isQtiValueNull(response,baseType,cardinality)?!currentItemHelper.isQtiValueNull(defaultValue,baseType,cardinality):!_.isEqual(response,currentItemHelper.toResponse(defaultValue,baseType,cardinality))},isAnswered:function(runner,partially){var itemRunner=runner.itemRunner,responses=itemRunner&&itemRunner.getResponses(),count=0,empty=0;return itemRunner&&_.forEach(currentItemHelper.getDeclarations(runner),function(declaration){var attributes=declaration.attributes||{},response=responses[attributes.identifier],baseType=attributes.baseType,cardinality=attributes.cardinality;count++,currentItemHelper.isQuestionAnswered(response,baseType,cardinality,declaration.defaultValue)||empty++;
}),partially===!1?count>0&&0===empty:count>0&&empty<count}};return currentItemHelper}),define("taoQtiTest/runner/helpers/stats",["lodash","taoQtiTest/runner/helpers/map","taoQtiTest/runner/helpers/currentItem"],function(_,mapHelper,currentItemHelper){"use strict";function getInstantStats(scope,runner){var map=runner.getTestMap(),context=runner.getTestContext(),stats=_.clone(mapHelper.getScopeStats(map,context.itemPosition,scope)),isItemCurrentlyAnswered=currentItemHelper.isAnswered(runner);return isItemCurrentlyAnswered&&(!isItemCurrentlyAnswered&&context.itemAnswered&&stats.answered--,isItemCurrentlyAnswered&&!context.itemAnswered&&stats.answered++),stats}return{
getInstantStats:getInstantStats}}),define("taoQtiTest/runner/helpers/messages",["i18n","taoQtiTest/runner/helpers/map","taoQtiTest/runner/helpers/stats"],function(__,mapHelper,statsHelper){"use strict";function getExitMessage(message,scope,runner){var stats=statsHelper.getInstantStats(scope,runner),unansweredCount=stats&&stats.questions-stats.answered,flaggedCount=stats&&stats.flagged,itemsCountMessage="",testData=runner.getTestData(),testConfig=testData&&testData.config,messageEnabled=!testConfig||testConfig.enableUnansweredItemsWarning;return messageEnabled&&(flaggedCount&&unansweredCount?itemsCountMessage=__("You have %s unanswered question(s) and have %s item(s) marked for review.",unansweredCount.toString(),flaggedCount.toString()):flaggedCount?itemsCountMessage=__("You have %s item(s) marked for review.",flaggedCount.toString()):unansweredCount&&(itemsCountMessage=__("You have %s unanswered question(s).",unansweredCount.toString()))),
(itemsCountMessage+" "+message).trim()}return{getExitMessage:getExitMessage}}),define("tpl!taoQtiTest/runner/plugins/controls/timer/timers",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression;return buffer+='<div class="timer-box">\n    <a href="#" class="timer-toggler hidden" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Hide timers",options):helperMissing.call(depth0,"__","Hide timers",options)))+'"><span class="icon-clock"></span></a>\n    <div class="timer-wrapper"></div>\n</div>\n';
})}),define("taoQtiTest/runner/plugins/controls/timer/timer",["jquery","lodash","i18n","core/promise","core/polling","core/timer","core/store","ui/hider","taoTests/runner/plugin","taoQtiTest/runner/plugins/controls/timer/timerComponent","taoQtiTest/runner/helpers/messages","tpl!taoQtiTest/runner/plugins/controls/timer/timers"],function($,_,__,Promise,pollingFactory,timerFactory,store,hider,pluginFactory,timerComponentFactory,messages,timerBoxTpl){"use strict";var timerRefresh=1e3,precision=1e3,exitMessage=__("After you complete the section it would be impossible to return to this section to make changes. Are you sure you want to end the section?"),timerTypes={
test:"assessmentTest",testPart:"testPart",section:"assessmentSection",item:"assessmentItemRef"},isTimedSection=function(context){var timeConstraints=context.timeConstraints||[];return _.some(timeConstraints,function(constraint){return"assessmentSection"===constraint.qtiClassName})};return pluginFactory({name:"timer",install:function(){var self=this,testRunner=this.getTestRunner();testRunner.on("storechange",function(){self.shouldClearStorage=!0})},init:function(){function doEnable(){self.getState("enabled")||self.enable()}function doDisable(){self.getState("enabled")&&self.disable()}function toggleZenMode(){self.$element.hasClass("zen-mode")?(self.$element.removeClass("zen-mode"),
self.$toggler.attr("title",__("Hide timers")),self.storage.removeItem("zen-mode")):(self.$element.addClass("zen-mode"),self.$toggler.attr("title",__("Show timers")),self.storage.setItem("zen-mode",!0))}function toggleToggler(){self.$toggler.length&&(_.size(timers)>0?hider.show(self.$toggler):hider.hide(self.$toggler))}var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData()||{},itemStates=testData.itemStates||{},timerWarning=testData.config&&testData.config.timerWarning||{},displayedTimers={},timers={},extraTime=0,consumedExtraTime=0,lastConsumedExtraTime=0,getRemainingExtraTime=function(extra){return extra&&(extraTime=extra),Math.max(0,extraTime-consumedExtraTime)*precision;
},setRemainingTime=function(timerConfig,remaining){return timerConfig.remaining=remaining+getRemainingExtraTime(timerConfig.extra),timerConfig.regular=remaining,timerConfig},getTimerConfig=function(type){var timeConstraint,timer,closestPreviousWarning,context=testRunner.getTestContext();return context.isTimeout||context.itemSessionState!==itemStates.interacting||(timeConstraint=_.findLast(context.timeConstraints,{qtiClassName:type}),timeConstraint&&(timer=setRemainingTime({label:timeConstraint.label,extra:timeConstraint.extraTime,type:timeConstraint.qtiClassName,id:timeConstraint.source,running:!0,warnings:{}},timeConstraint.seconds*precision),_(timerWarning[timeConstraint.qtiClassName]).forEach(function(value,key){
_.contains(["info","warning","danger"],value)&&(timer.warnings[key]={type:value,showed:timer.remaining/precision<=key,point:parseInt(key,10)*precision})}),closestPreviousWarning=_.find(timer.warnings,{showed:!0}),!_.isEmpty(closestPreviousWarning)&&closestPreviousWarning.point&&timer.warnings[closestPreviousWarning.point/precision]&&(timer.warnings[closestPreviousWarning.point/precision].showed=!1))),timer},leaveTimedSection=function(type,scope,position){var context=testRunner.getTestContext(),map=testRunner.getTestMap(),section=map.parts[context.testPartId].sections[context.sectionId],nbItems=_.size(section.items),item=_.find(section.items,{position:context.itemPosition
});return!(context.isTimeout||context.itemSessionState===itemStates.closed||!isTimedSection(context)||!item)&&!!("next"===type&&("assessmentSection"===scope||item.positionInSection+1===nbItems)||"previous"===type&&0===item.positionInSection||"jump"===type&&position>0&&(position<section.position||position>=section.position+nbItems))},removeTimer=function(type){displayedTimers[type]&&(self.storage.removeItem(displayedTimers[type].id()),displayedTimers[type].destroy(),displayedTimers=_.omit(displayedTimers,type),timers=_.omit(timers,type),self.trigger("removetimer",type))},addTimer=function(type,config){config&&(timers[type]=config.regular,displayedTimers[type]=timerComponentFactory(config),
displayedTimers[type].init().render(self.$element.find(".timer-wrapper")),self.trigger("addtimer",type,displayedTimers[type]))},updateTimers=function(checkStorage){var timerUpdatePromises=[],context=testRunner.getTestContext();return context.extraTime&&(extraTime=context.extraTime.total,consumedExtraTime=Math.max(consumedExtraTime,context.extraTime.consumed)),_.forEach(timerTypes,function(type){timerUpdatePromises.push(new Promise(function(resolve){var timerConfig=getTimerConfig(type);return displayedTimers[type]?(timerConfig?displayedTimers[type].id()!==timerConfig.id?(removeTimer(type),addTimer(type,timerConfig)):(setRemainingTime(timerConfig,timers[type]),
displayedTimers[type].val(timerConfig.remaining)):removeTimer(type),resolve()):timerConfig?checkStorage?void self.storage.getItem(timerConfig.id).then(function(savedTime){return _.isNumber(savedTime)&&savedTime>=0&&setRemainingTime(timerConfig,savedTime),addTimer(type,timerConfig),resolve()}).catch(function(){return addTimer(type,timerConfig),resolve()}):(addTimer(type,timerConfig),resolve()):resolve()}))}),Promise.all(timerUpdatePromises).then(function(data){return toggleToggler(),data})};return store("timer-"+testRunner.getConfig().serviceCallId).then(function(timeStore){return self.shouldClearStorage?timeStore.clear().then(function(){return timeStore}):Promise.resolve(timeStore);
}).then(function(timeStore){self.storage=timeStore,self.$element=$(timerBoxTpl()),self.$toggler=self.$element.find(".timer-toggler"),self.storage.getItem("zen-mode").then(function(zenMode){zenMode&&!self.$element.hasClass("zen-mode")&&toggleZenMode()}),self.$toggler.on("click",function(e){e.preventDefault(),toggleZenMode()}),self.stopwatch=timerFactory({autoStart:!1}),self.polling=pollingFactory({action:function(){var timeoutScope,timeoutRef,elapsed=self.stopwatch.tick(),elapsedExtraTime=0,timeout=!1;_.forEach(displayedTimers,function(timer,type){var regularVal,displayedVal,warning,runTimeout=function(){testRunner.timeout(timeoutScope,timeoutRef)};timer.running()&&(regularVal=timers[type]-elapsed,
displayedVal=timer.val()-elapsed,timers[type]=Math.max(regularVal,0),timer.val(Math.max(displayedVal,0)).refresh(),regularVal<=0&&(elapsedExtraTime=Math.max(elapsedExtraTime,Math.abs(regularVal))),displayedVal<=0?(timer.running(!1),timeout=!0,timeoutRef=timer.id(),timeoutScope=type,self.storage.setItem(timer.id(),0).then(runTimeout).catch(runTimeout)):(self.storage.setItem(timer.id(),timers[type]),warning=timer.warn(),_.isEmpty(warning)||testRunner.trigger(warning.type,warning.text)))}),elapsedExtraTime&&(consumedExtraTime+=elapsedExtraTime/precision,lastConsumedExtraTime+=elapsedExtraTime),timeout&&self.disable()},interval:timerRefresh,autoStart:!1}),testRunner.before("renderitem resumeitem",function(){
return updateTimers(!0)}).on("enableitem",doEnable).on("disableitem disconnect",doDisable).after("renderitem",doEnable).before("move",function(e,type,scope,position){var context=testRunner.getTestContext(),testData=testRunner.getTestData(),config=testData&&testData.config,timerConfig=config&&config.timer||{},options=context&&context.options||{},movePromise=new Promise(function(resolve,reject){context.isLast&&options.endTestWarning?resolve():!leaveTimedSection(type,scope,position)||options.noExitTimedSectionWarning||timerConfig.keepUpToTimeout?resolve():testRunner.trigger("confirm.exittimed",messages.getExitMessage(exitMessage,"section",testRunner),resolve,reject);
});return movePromise.then(function(){doDisable(),removeTimer(timerTypes.item)}).catch(function(){_.defer(function(){testRunner.trigger("enableitem enablenav")})}),movePromise}).before("move skip exit timeout",function(){testRunner.getProxy().addCallActionParams({consumedExtraTime:lastConsumedExtraTime/precision}),lastConsumedExtraTime=0}).before("finish",function(){return new Promise(function(resolve){self.storage.removeStore().then(resolve).catch(resolve)})})})},render:function(){var $container=this.getAreaBroker().getControlArea();$container.append(this.$element)},destroy:function(){this.polling.stop(),this.stopwatch.stop(),this.$element.remove()},enable:function(){
this.polling.start(),this.stopwatch.resume()},disable:function(){this.polling.stop(),this.stopwatch.pause()},show:function(){hider.show(this.$element)},hide:function(){hider.hide(this.$element)}})}),define("tpl!taoQtiTest/runner/plugins/controls/title/title",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+='\n        <span data-control="',(helper=helpers.control)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.control,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" class="qti-controls" title="',
(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">',stack1=helpers.unless.call(depth0,null==data||data===!1?data:data.first,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n    "}function program2(depth0,data){return" - ";
}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this;return buffer+='<div class="title-box truncate">\n    ',stack1=helpers.each.call(depth0,depth0&&depth0.titles,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</div>\n"})}),define("taoQtiTest/runner/plugins/controls/title/title",["jquery","i18n","taoTests/runner/plugin","tpl!taoQtiTest/runner/plugins/controls/title/title"],function($,__,pluginFactory,titleTpl){"use strict";return pluginFactory({name:"title",
init:function(){var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData(),createElement=function(){var context=testRunner.getTestContext(),titles=[{control:"qti-test-title",text:testData.title}];return context.isDeepestSectionVisible&&titles.push({control:"qti-test-position",text:context.sectionTitle}),$(titleTpl({titles:titles}))};this.$element=createElement(),testRunner.after("renderitem",function(){var $element=createElement();self.$element.replaceWith($element),self.$element=$element})},render:function(){var $container=this.getAreaBroker().getControlArea();$container.append(this.$element)}})}),define("taoQtiTest/runner/plugins/controls/trace/itemTraceVariables",["lodash","moment","core/store","taoTests/runner/plugin"],function(_,moment,storeFactory,pluginFactory){
"use strict";function timestamp(){return Date.now()/precision}var precision=1e3;return pluginFactory({name:"itemTraceVariables",install:function(){var self=this;self.getTestRunner().on("storechange",function(){self.shouldClearStorage=!0})},init:function(){function onError(err){testRunner.trigger("error",err)}var self=this,testRunner=this.getTestRunner(),variables={};return storeFactory("trace-"+testRunner.getConfig().serviceCallId).then(function(tracesStore){return self.shouldClearStorage?tracesStore.clear().then(function(){return tracesStore}):tracesStore}).then(function(tracesStore){testRunner.after("renderitem enableitem",function(){var context=testRunner.getTestContext();
variables={ITEM_START_TIME_CLIENT:timestamp()},tracesStore.getItem(context.itemUri).then(function(data){return data&&_.merge(variables,data),tracesStore.setItem(context.itemUri,variables)}).catch(onError)}).before("move skip exit timeout",function(){var context=testRunner.getTestContext();return variables.ITEM_END_TIME_CLIENT=timestamp(),variables.ITEM_TIMEZONE=moment().utcOffset(moment().utcOffset()).format("Z"),tracesStore.setItem(context.itemUri,variables).catch(onError)}).before("unloaditem",function(){var context=testRunner.getTestContext();return testRunner.getProxy().callItemAction(context.itemIdentifier,"storeTraceData",{traceData:JSON.stringify(variables)
})}).before("finish",function(){return new Promise(function(resolve){tracesStore.removeStore().then(resolve).catch(resolve)})})})}})}),define("taoQtiTest/runner/plugins/navigation/allowSkipping",["lodash","i18n","taoTests/runner/plugin","taoQtiTest/runner/helpers/currentItem"],function(_,__,pluginFactory,currentItemHelper){"use strict";return pluginFactory({name:"allowSkipping",init:function(){var testRunner=this.getTestRunner();return testRunner.before("move",function(){var testContext=testRunner.getTestContext();if(testContext.enableAllowSkipping&&!testContext.allowSkipping)return this.trigger("disablenav disabletools"),new Promise(function(resolve,reject){
return 0===_.size(currentItemHelper.getDeclarations(testRunner))?resolve():currentItemHelper.isAnswered(testRunner,!0)?resolve():void(testRunner.getState("alerted.notallowed")||(testRunner.setState("alerted.notallowed",!0),testRunner.trigger("alert.notallowed",__("A response to this item is required."),function(){testRunner.trigger("resumeitem"),reject(),testRunner.setState("alerted.notallowed",!1)})))})}),this}})}),define("taoQtiTest/runner/plugins/navigation/next/nextWarningHelper",[],function(){"use strict";var toBoolean=function(value,defaultValue){return"undefined"==typeof value?defaultValue:value===!0||"true"===value},nextWarningHelper=function(options){
function shouldWarnBeforeNext(){return nextItemWarning&&!itemCanBeTriedAtWill()}function itemCanBeTriedAtWill(){return isLast===!1&&isLinear===!1&&remainingAttempts===-1&&!isNextItemInLinearPart()}function isNextItemInLinearPart(){return nextPart&&"undefined"!=typeof nextPart.isLinear&&isLastOfPart()&&nextPart.isLinear===!0}function shouldWarnBeforeEnd(){return shouldWarnOnTestEnd()||shouldWarnOnPartChange()}function shouldWarnOnTestEnd(){return isLast&&(endTestWarning||warnBeforeNext)&&shouldWarnForUnansweredItems()}function shouldWarnForUnansweredItems(){var hasUnanswered=stats&&stats.questions-stats.answered!==0,hasFlagged=stats&&0!==stats.flagged;return!unansweredOnly||(hasUnanswered||hasFlagged);
}function shouldWarnOnPartChange(){return nextPartWarning&&isLastOfPart()&&shouldWarnForUnansweredItems()}function isLastOfPart(){return nextPart&&nextPart.id&&testPartId!==nextPart.id}var endTestWarning=toBoolean(options.endTestWarning,!1),isLast=toBoolean(options.isLast,!1),isLinear=toBoolean(options.isLinear,!1),nextItemWarning=toBoolean(options.nextItemWarning,!1),nextPartWarning=toBoolean(options.nextPartWarning,!1),stats=options.stats,nextPart=options.nextPart||{},remainingAttempts="undefined"==typeof options.remainingAttempts?-1:options.remainingAttempts,testPartId=options.testPartId||"",unansweredOnly=toBoolean(options.unansweredOnly,!1),warnBeforeNext=shouldWarnBeforeNext(),warnBeforeEnd=shouldWarnBeforeEnd();
return{shouldWarnBeforeEnd:function(){return warnBeforeEnd},shouldWarnBeforeNext:function(){return warnBeforeNext}}};return nextWarningHelper}),define("taoQtiTest/runner/plugins/navigation/next",["jquery","lodash","i18n","ui/hider","taoTests/runner/plugin","taoQtiTest/runner/plugins/navigation/next/nextWarningHelper","taoQtiTest/runner/helpers/messages","taoQtiTest/runner/helpers/map","taoQtiTest/runner/helpers/stats","util/shortcut","util/namespace","tpl!taoQtiTest/runner/plugins/templates/button"],function($,_,__,hider,pluginFactory,nextWarningHelper,messages,mapHelper,statsHelper,shortcut,namespaceHelper,buttonTpl){"use strict";var buttonData={next:{control:"move-forward",
title:__("Submit and go to the next item"),icon:"forward",text:__("Next")},end:{control:"move-end",title:__("Submit and go to the end of the test"),icon:"fast-forward",text:__("End test")}},createElement=function(context){var dataType=context.isLast?"end":"next";return $(buttonTpl(buttonData[dataType]))},updateElement=function($element,context){var dataType=context.isLast?"end":"next";$element.data("control")!==buttonData[dataType].control&&($element.data("control",buttonData[dataType].control).attr("title",buttonData[dataType].title).find(".text").text(buttonData[dataType].text),"next"===dataType?$element.find(".icon-"+buttonData.end.icon).removeClass("icon-"+buttonData.end.icon).addClass("icon-"+buttonData.next.icon):$element.find(".icon-"+buttonData.next.icon).removeClass("icon-"+buttonData.next.icon).addClass("icon-"+buttonData.end.icon));
};return pluginFactory({name:"next",init:function(){function doNext(nextItemWarning){function enable(){testRunner.trigger("enablenav enabletools")}var context=testRunner.getTestContext(),testOptions=context.options||{},map=testRunner.getTestMap(),nextItemPosition=context.itemPosition+1,nextPartWarning=testOptions.nextPartWarning||testOptions.unansweredWarning,unansweredOnly=!testOptions.endTestWarning&&testOptions.unansweredWarning,warningScope=nextPartWarning?"part":"test",warningHelper=nextWarningHelper({endTestWarning:testOptions.endTestWarning,isLast:context.isLast,isLinear:context.isLinear,nextItemWarning:nextItemWarning,nextPartWarning:nextPartWarning,nextPart:mapHelper.getItemPart(map,nextItemPosition),
remainingAttempts:context.remainingAttempts,testPartId:context.testPartId,unansweredWarning:testOptions.unansweredWarning,stats:statsHelper.getInstantStats(warningScope,testRunner),unansweredOnly:unansweredOnly});self.getState("enabled")!==!1&&(testRunner.trigger("disablenav disabletools"),warningHelper.shouldWarnBeforeEnd()?testRunner.trigger("confirm.endTest",messages.getExitMessage(__("You are about to submit the test. You will not be able to access this test once submitted. Click OK to continue and submit the test."),warningScope,testRunner),_.partial(triggerNextAction,context),enable):warningHelper.shouldWarnBeforeNext()?testRunner.trigger("confirm.next",__("You are about to go to the next item. Click OK to continue and go to the next item."),_.partial(triggerNextAction,context),enable):triggerNextAction(context));
}function triggerNextAction(context){context.isLast&&self.trigger("end"),testRunner.next()}var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData(),testConfig=testData.config||{},pluginShortcuts=(testConfig.shortcuts||{})[this.getName()]||{};this.$element=createElement(testRunner.getTestContext()),this.$element.on("click",function(e){e.preventDefault(),testRunner.trigger("nav-next")}),testConfig.allowShortcuts&&pluginShortcuts.trigger&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.trigger,this.getName(),!0),function(e){self.getState("enabled")===!0&&testRunner.trigger("nav-next",!0)},{avoidInput:!0,prevent:!0}),this.disable(),
testRunner.on("loaditem",function(){updateElement(self.$element,testRunner.getTestContext())}).on("enablenav",function(){self.enable()}).on("disablenav",function(){self.disable()}).on("nav-next",function(nextItemWarning){doNext(nextItemWarning)})},render:function(){var $container=this.getAreaBroker().getNavigationArea();$container.append(this.$element)},destroy:function(){shortcut.remove("."+this.getName()),this.$element.remove()},enable:function(){this.$element.removeProp("disabled").removeClass("disabled")},disable:function(){this.$element.prop("disabled",!0).addClass("disabled")},show:function(){hider.show(this.$element)},hide:function(){hider.hide(this.$element);
}})}),define("taoQtiTest/runner/plugins/navigation/nextSection",["jquery","lodash","i18n","ui/hider","taoTests/runner/plugin","taoQtiTest/runner/helpers/messages","tpl!taoQtiTest/runner/plugins/templates/button"],function($,_,__,hider,pluginFactory,messages,buttonTpl){"use strict";return pluginFactory({name:"nextsection",init:function(){function toggle(){var options=testRunner.getTestContext().options;testConfig.nextSection&&(options.nextSection||options.nextSectionWarning)?self.show():self.hide()}function nextSection(){testRunner.next("section")}var self=this,testRunner=this.getTestRunner(),testConfig=testRunner.getTestData().config;this.$element=$(buttonTpl({
control:"next-section",title:__("Skip to the next section"),icon:"fast-forward",text:__("Next Section")})),this.$element.on("click",function(e){var context=testRunner.getTestContext(),enable=_.bind(self.enable,self);e.preventDefault(),self.getState("enabled")!==!1&&(self.disable(),context.options.nextSectionWarning?testRunner.trigger("confirm.nextsection",messages.getExitMessage(__("After you complete the section it would be impossible to return to this section to make changes. Are you sure you want to end the section?"),"section",testRunner),nextSection,enable):nextSection())}),this.disable(),toggle(),testRunner.on("loaditem",toggle).on("enablenav",function(){
self.enable()}).on("disablenav",function(){self.disable()})},render:function(){var $container=this.getAreaBroker().getNavigationArea();$container.append(this.$element)},destroy:function(){this.$element.remove()},enable:function(){this.$element.removeProp("disabled").removeClass("disabled")},disable:function(){this.$element.prop("disabled",!0).addClass("disabled")},show:function(){hider.show(this.$element)},hide:function(){hider.hide(this.$element)}})}),define("taoQtiTest/runner/plugins/navigation/previous",["jquery","lodash","i18n","ui/hider","taoTests/runner/plugin","util/shortcut","util/namespace","tpl!taoQtiTest/runner/plugins/templates/button"],function($,_,__,hider,pluginFactory,shortcut,namespaceHelper,buttonTpl){
"use strict";return pluginFactory({name:"previous",init:function(){function doPrevious(previousItemWarning){function enable(){testRunner.trigger("enablenav enabletools")}var context=testRunner.getTestContext();self.getState("enabled")!==!1&&(testRunner.trigger("disablenav disabletools"),previousItemWarning&&context.remainingAttempts!==-1?testRunner.trigger("confirm.previous",__("You are about to go to the previous item. Click OK to continue and go to the previous item."),testRunner.previous,enable):testRunner.previous())}var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData(),testConfig=testData.config||{},pluginShortcuts=(testConfig.shortcuts||{})[this.getName()]||{},canDoPrevious=function(){
var context=testRunner.getTestContext();return context.isLinear===!1&&context.canMoveBackward===!0},toggle=function(){canDoPrevious()?self.show():self.hide()};this.$element=$(buttonTpl({control:"move-backward",title:__("Submit and go to the previous item"),icon:"backward",text:__("Previous")})),this.$element.on("click",function(e){e.preventDefault(),testRunner.trigger("nav-previous")}),testConfig.allowShortcuts&&pluginShortcuts.trigger&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.trigger,this.getName(),!0),function(e){canDoPrevious()&&self.getState("enabled")===!0&&testRunner.trigger("nav-previous",[!0])},{avoidInput:!0,prevent:!0}),toggle(),self.disable(),
testRunner.on("loaditem",toggle).on("enablenav",function(){self.enable()}).on("disablenav",function(){self.disable()}).on("nav-previous",function(previousItemWarning){doPrevious(previousItemWarning)})},render:function(){var $container=this.getAreaBroker().getNavigationArea();$container.append(this.$element)},destroy:function(){shortcut.remove("."+this.getName()),this.$element.remove()},enable:function(){this.$element.removeProp("disabled").removeClass("disabled")},disable:function(){this.$element.prop("disabled",!0).addClass("disabled")},show:function(){hider.show(this.$element)},hide:function(){hider.hide(this.$element)}})}),define("tpl!taoQtiTest/runner/plugins/navigation/review/navigator",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){return" hidden"}function program3(depth0,data){var helper,options,buffer="";return buffer+='\n    <div class="qti-navigator-info collapsible">\n                <span class="qti-navigator-label">\n                    <span class="qti-navigator-text">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Test status",options):helperMissing.call(depth0,"__","Test status",options)))+'</span>\n                    <span class="icon-up"></span>\n                    <span class="icon-down"></span>\n                </span>\n        <ul class="collapsible-panel plain">\n            <li class="qti-navigator-viewed" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Viewed items",options):helperMissing.call(depth0,"__","Viewed items",options)))+'">\n                        <span class="qti-navigator-label">\n                            <span class="qti-navigator-icon icon-viewed"></span>\n                            <span class="qti-navigator-text">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Viewed",options):helperMissing.call(depth0,"__","Viewed",options)))+'</span>\n                            <span class="qti-navigator-counter">-/-</span>\n                        </span>\n            </li>\n            <li class="qti-navigator-answered" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Completed items",options):helperMissing.call(depth0,"__","Completed items",options)))+'">\n                        <span class="qti-navigator-label">\n                            <span class="qti-navigator-icon icon-answered"></span>\n                            <span class="qti-navigator-text">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Answered",options):helperMissing.call(depth0,"__","Answered",options)))+'</span>\n                            <span class="qti-navigator-counter">-/-</span>\n                        </span>\n            </li>\n            <li class="qti-navigator-unanswered" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Unanswered items",options):helperMissing.call(depth0,"__","Unanswered items",options)))+'">\n                        <span class="qti-navigator-label">\n                            <span class="qti-navigator-icon icon-unanswered"></span>\n                            <span class="qti-navigator-text">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Unanswered",options):helperMissing.call(depth0,"__","Unanswered",options)))+'</span>\n                            <span class="qti-navigator-counter">-/-</span>\n                        </span>\n            </li>\n            <li class="qti-navigator-flagged" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Items marked for later review",options):helperMissing.call(depth0,"__","Items marked for later review",options)))+'">\n                        <span class="qti-navigator-label">\n                            <span class="qti-navigator-icon icon-flagged"></span>\n                            <span class="qti-navigator-text">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Flagged",options):helperMissing.call(depth0,"__","Flagged",options)))+'</span>\n                            <span class="qti-navigator-counter">-/-</span>\n                        </span>\n            </li>\n        </ul>\n    </div>\n    ';
}function program5(depth0,data){return'(<span class="qti-navigator-counter">0</span>)'}function program7(depth0,data){return"icon-unanswered "}function program9(depth0,data){var helper,options,buffer="";return buffer+=escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Unanswered",options):helperMissing.call(depth0,"__","Unanswered",options)))+' (<span class="qti-navigator-counter">0</span>)'}function program11(depth0,data){return"icon-flagged "}function program13(depth0,data){var helper,options,buffer="";return buffer+=escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},
helper?helper.call(depth0,"Flagged",options):helperMissing.call(depth0,"__","Flagged",options)))+' (<span class="qti-navigator-counter">0</span>)'}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this;return buffer+='<div class="qti-panel qti-navigator',stack1=helpers.if.call(depth0,depth0&&depth0.hidden,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='">\n    <div class="qti-navigator-collapsible">\n        <span class="qti-navigator-collapse icon icon-left" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Collapse the review panel",options):helperMissing.call(depth0,"__","Collapse the review panel",options)))+'"></span>\n        <span class="qti-navigator-expand icon icon-right" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Expand the review panel",options):helperMissing.call(depth0,"__","Expand the review panel",options)))+'"></span>\n    </div>\n    ',stack1=helpers.if.call(depth0,depth0&&depth0.showLegend,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n\n\n    <div class="qti-navigator-filters">\n        <ul class="plain clearfix">\n            <li class="qti-navigator-filter active" data-mode="all">\n                <span title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Reset filters",options):helperMissing.call(depth0,"__","Reset filters",options)))+'" class="qti-navigator-tab">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"All",options):helperMissing.call(depth0,"__","All",options)))+"\n                    ",stack1=helpers.unless.call(depth0,depth0&&depth0.showLegend,{hash:{},inverse:self.noop,fn:self.program(5,program5,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n                </span>\n            </li>\n\n            <li class="qti-navigator-filter" data-mode="unanswered">\n                <span class="',
stack1=helpers.if.call(depth0,depth0&&depth0.showLegend,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='qti-navigator-tab" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Only display the unanswered items",options):helperMissing.call(depth0,"__","Only display the unanswered items",options)))+'">\n                    ',stack1=helpers.unless.call(depth0,depth0&&depth0.showLegend,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n                </span>\n            </li>\n\n            <li class="qti-navigator-filter" data-mode="flagged">\n                <span class="',
stack1=helpers.if.call(depth0,depth0&&depth0.showLegend,{hash:{},inverse:self.noop,fn:self.program(11,program11,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='qti-navigator-tab" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Only display the items marked for review",options):helperMissing.call(depth0,"__","Only display the items marked for review",options)))+'">\n                    ',stack1=helpers.unless.call(depth0,depth0&&depth0.showLegend,{hash:{},inverse:self.noop,fn:self.program(13,program13,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='\n                </span>\n            </li>\n        </ul>\n    </div>\n\n    <nav class="qti-navigator-tree"></nav>\n\n    <div id="qti-navigator-linear" class="qti-navigator-linear">\n        <span class="icon icon-info" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"In this part of the test navigation is not allowed.",options):helperMissing.call(depth0,"__","In this part of the test navigation is not allowed.",options)))+'"></span>\n        <p class="qti-navigator-message">\n            '+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"In this part of the test navigation is not allowed.",options):helperMissing.call(depth0,"__","In this part of the test navigation is not allowed.",options)))+"\n        </p>\n    </div>\n</div>\n"})}),define("tpl!taoQtiTest/runner/plugins/navigation/review/navigatorTree",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var stack1,helper,buffer="";return buffer+='\n    <li class="qti-navigator-part collapsible ',stack1=helpers.if.call(depth0,depth0&&depth0.active,{hash:{},inverse:self.program(4,program4,data),fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-id="',(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n        <span class="qti-navigator-label" title="',(helper=helpers.label)?stack1=helper.call(depth0,{
hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n            <span class="qti-navigator-text">',(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</span>\n            <span class="icon-up"></span>\n            <span class="icon-down"></span>\n        </span>\n        ',stack1=helpers.if.call(depth0,depth0&&depth0.isLinear,{hash:{},inverse:self.program(8,program8,data),fn:self.program(6,program6,data),
data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </li>\n    "}function program2(depth0,data){return"active"}function program4(depth0,data){return"collapsed"}function program6(depth0,data){var stack1,helper,options,buffer="";return buffer+='\n        <div class="qti-navigator-linear-part collapsible-panel">\n            <span class="icon icon-info" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"In this part of the test navigation is not allowed.",options):helperMissing.call(depth0,"__","In this part of the test navigation is not allowed.",options)))+'"></span>\n            <p class="qti-navigator-message">\n                '+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"In this part of the test navigation is not allowed.",options):helperMissing.call(depth0,"__","In this part of the test navigation is not allowed.",options)))+'\n            </p>\n            <p class="qti-navigator-actions">\n                <button class="btn-info small" data-position="',(helper=helpers.position)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.position,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Start Test-part",options):helperMissing.call(depth0,"__","Start Test-part",options)))+'">\n                    <span class="qti-navigator-text">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Start Test-part",options):helperMissing.call(depth0,"__","Start Test-part",options)))+'</span>\n                    <span class="icon-play r"></span>\n                </button>\n            </p>\n        </div>\n        '}function program8(depth0,data){var stack1,buffer="";return buffer+='\n        <ul class="qti-navigator-sections collapsible-panel plain">\n            ',stack1=helpers.each.call(depth0,depth0&&depth0.sections,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </ul>\n        "}function program9(depth0,data){var stack1,helper,buffer="";
return buffer+='\n            <li class="qti-navigator-section collapsible ',stack1=helpers.if.call(depth0,depth0&&depth0.active,{hash:{},inverse:self.program(4,program4,data),fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+='" data-id="',(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n                <span class="qti-navigator-label" title="',(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n                    <span class="qti-navigator-text">',(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</span>\n                    <span class="qti-navigator-counter">'+escapeExpression((stack1=depth0&&depth0.stats,stack1=null==stack1||stack1===!1?stack1:stack1.answered,typeof stack1===functionType?stack1.apply(depth0):stack1))+"/"+escapeExpression((stack1=depth0&&depth0.stats,stack1=null==stack1||stack1===!1?stack1:stack1.total,
typeof stack1===functionType?stack1.apply(depth0):stack1))+'</span>\n                </span>\n                <ul class="qti-navigator-items collapsible-panel plain">\n                    ',stack1=helpers.each.call(depth0,depth0&&depth0.items,{hash:{},inverse:self.noop,fn:self.program(10,program10,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n                </ul>\n            </li>\n            "}function program10(depth0,data){var stack1,helper,buffer="";return buffer+='\n                    <li class="qti-navigator-item ',(helper=helpers.cls)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.cls,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-id="',(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'" data-position="',(helper=helpers.position)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.position,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n                        <span class="qti-navigator-label truncate" title="',(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data
}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'">\n                            <span class="qti-navigator-icon icon-',(helper=helpers.icon)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.icon,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'"></span>\n                            <span class="qti-navigator-number">',(helper=helpers.index)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.index,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n                            ",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\n                        </span>\n                    </li>\n                    "}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,functionType="function",self=this;return buffer+='<ul class="qti-navigator-parts plain">\n    ',
stack1=helpers.each.call(depth0,depth0&&depth0.parts,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</ul>\n"})}),define("taoQtiTest/runner/plugins/navigation/review/navigator",["jquery","lodash","i18n","ui/component","ui/autoscroll","taoQtiTest/runner/helpers/map","tpl!taoQtiTest/runner/plugins/navigation/review/navigator","tpl!taoQtiTest/runner/plugins/navigation/review/navigatorTree"],function($,_,__,component,autoscroll,mapHelper,navigatorTpl,navigatorTreeTpl){"use strict";function navigatorFactory(config,map,context){function flagItem($item){var position=$item.data("position"),flagged=!$item.hasClass(_cssCls.flagged);
navigator.setItemFlag(position,flagged),navigator.trigger("flag",position,flagged)}function jump($item){var position=$item.data("position");navigator.trigger("jump",position)}var navigator;return navigator=component(navigatorApi,_defaults).setTemplate(navigatorTpl).on("destroy",function(){this.controls=null}).on("show",function(){this.autoScroll()}).on("render",function(){var self=this,$component=this.getElement(),$filterBar=$component.find(_selectors.filterBar),$filters=$filterBar.find("li"),$tree=$component.find(_selectors.tree);this.controls={$infoAnswered:$component.find(_selectors.infoAnswered),$infoViewed:$component.find(_selectors.infoViewed),$infoAll:$component.find(_selectors.tabInfoAll),
$infoUnanswered:this.config.showLegend?$component.find(_selectors.infoUnanswered):$component.find(_selectors.tabInfoUnanswered),$infoFlagged:this.config.showLegend?$component.find(_selectors.infoFlagged):$component.find(_selectors.tabInfoFlagged),$filterBar:$filterBar,$filters:$filters,$tree:$tree,$linearState:$component.find(_selectors.linearState)},this.updateConfig(),$component.on("click"+_selectors.component,_selectors.collapseHandle,function(){self.is("disabled")||($component.toggleClass(_cssCls.collapsed),$component.hasClass(_cssCls.collapsed)&&self.openSelected())}),$component.on("click"+_selectors.component,_selectors.infoPanelLabels,function(){self.is("disabled")||self.togglePanel($(this).closest(_selectors.infoPanel),_selectors.infoPanel);
}),$tree.on("click"+_selectors.component,_selectors.partLabels,function(){var $panel;self.is("disabled")||($panel=$(this).closest(_selectors.parts),self.togglePanel($panel,_selectors.parts)&&($panel.hasClass(_cssCls.active)?self.openSelected():self.openOnly($panel.find(_selectors.sections).first(),$panel)))}),$tree.on("click"+_selectors.component,_selectors.sectionLabels,function(){self.is("disabled")||self.togglePanel($(this).closest(_selectors.sections),_selectors.sections)}),$tree.on("click"+_selectors.component,_selectors.itemLabels,function(event){var $item,$target;self.is("disabled")||($item=$(this).closest(_selectors.items),$item.hasClass(_cssCls.disabled)||($target=$(event.target),
self.config.canFlag&&$target.is(_selectors.icons)&&!$component.hasClass(_cssCls.collapsed)?$item.hasClass(_cssCls.unseen)||$item.hasClass(_cssCls.info)||flagItem($item):$item.hasClass(_cssCls.active)||(self.select($item),jump($item))))}),$tree.on("click"+_selectors.component,_selectors.linearStart,function(){var $btn;self.is("disabled")||($btn=$(this),$btn.hasClass(_cssCls.disabled)||($btn.addClass(_cssCls.disabled),jump($btn)))}),$filterBar.on("click"+_selectors.component,_selectors.filter,function(){var $btn,mode;self.is("disabled")||($btn=$(this),mode=$btn.data("mode"),$filters.removeClass(_cssCls.active),$component.removeClass(_cssCls.collapsed),$btn.addClass(_cssCls.active),
self.filter(mode),self.autoScroll())}),this.update(map,context)}),navigator.currentFilter="all",navigator.init(config)}var _defaults={scope:"test",canCollapse:!1,preventsUnseen:!0,hidden:!1},_cssCls={active:"active",collapsed:"collapsed",collapsible:"collapsible",hidden:"hidden",disabled:"disabled",flagged:"flagged",answered:"answered",viewed:"viewed",unseen:"unseen",info:"info",icon:"qti-navigator-icon",scope:{test:"scope-test",testPart:"scope-test-part",testSection:"scope-test-section"}},_iconCls=[_cssCls.info,_cssCls.flagged,_cssCls.answered,_cssCls.viewed],_selectors={component:".qti-navigator",filterBar:".qti-navigator-filters",filter:".qti-navigator-filter",
tree:".qti-navigator-tree",collapseHandle:".qti-navigator-collapsible",linearState:".qti-navigator-linear",infoAnswered:".qti-navigator-answered .qti-navigator-counter",infoViewed:".qti-navigator-viewed .qti-navigator-counter",infoUnanswered:".qti-navigator-unanswered .qti-navigator-counter",infoFlagged:".qti-navigator-flagged .qti-navigator-counter",infoPanel:".qti-navigator-info",infoPanelLabels:".qti-navigator-info > .qti-navigator-label",tabInfoAll:'[data-mode="all"] .qti-navigator-counter',tabInfoUnanswered:'[data-mode="unanswered"] .qti-navigator-counter',tabInfoFlagged:'[data-mode="flagged"] .qti-navigator-counter',parts:".qti-navigator-part",partLabels:".qti-navigator-part > .qti-navigator-label",
sections:".qti-navigator-section",sectionLabels:".qti-navigator-section > .qti-navigator-label",items:".qti-navigator-item",itemLabels:".qti-navigator-item > .qti-navigator-label",itemIcons:".qti-navigator-item > .qti-navigator-icon",activeItem:".qti-navigator-item.active",icons:".qti-navigator-icon",linearStart:".qti-navigator-linear-part button",counters:".qti-navigator-counter",actives:".active",collapsible:".collapsible",collapsiblePanels:".collapsible-panel",unseen:".unseen",answered:".answered",flagged:".flagged",notFlagged:":not(.flagged)",notAnswered:":not(.answered)",notInformational:":not(.info)",informational:".info",hidden:".hidden",disabled:".disabled"
},_filterMap={all:"",unanswered:[_selectors.answered,_selectors.informational].join(","),flagged:_selectors.notFlagged,answered:_selectors.notAnswered,filtered:_selectors.hidden},navigatorApi={updateStats:function(position,flag){var item,map=this.map;map&&(item=mapHelper.getItemAt(map,position),item&&(item.flagged=flag,mapHelper.updateItemStats(map,position)))},getProgressionTotal:function(progression,target){var total;return total="questions"===target?progression.questions:progression.total},setItemFlag:function(position,flag){var icon,$item=position&&position.jquery?position:this.controls.$tree.find("[data-position="+position+"]"),progression=this.progression;
this.updateStats(position,flag),$item.toggleClass(_cssCls.flagged,flag),icon=_.find(_iconCls,_.bind($item.hasClass,$item))||_cssCls.unseen,$item.find(_selectors.icons).attr("class",_cssCls.icon+" icon-"+icon),progression.flagged=this.controls.$tree.find(_selectors.flagged).length,this.writeCount(this.controls.$infoFlagged,progression.flagged,this.getProgressionTotal(progression,"questions")),this.filter(this.currentFilter)},filter:function(criteria){var self=this,$items=this.controls.$tree.find(_selectors.items).removeClass(_cssCls.hidden),filterCb=_filterMap[criteria];filterCb&&$items.filter(filterCb).addClass(_cssCls.hidden),this.controls.$tree.find(_selectors.sections).each(function(){
var $section=$(this),$itemsFound=$section.find(_selectors.items).not(_selectors.hidden),$filtered=$itemsFound.not(_selectors.disabled);self.writeCount($section.find(_selectors.counters),$filtered.length,$itemsFound.length)}),this.currentFilter=criteria},updateConfig:function(config){var $component=this.getElement(),scopeClass=_cssCls.scope[this.config.scope||_defaults.scope];return config=_.merge(this.config,config||{}),$component.toggleClass(_cssCls.collapsible,config.canCollapse),$component.removeClass(scopeClass),scopeClass=_cssCls.scope[this.config.scope||_defaults.scope],$component.addClass(scopeClass),this},autoScroll:function(){autoscroll(this.controls.$tree.find(_selectors.activeItem),this.controls.$tree);
},update:function(map,context){var scopedMap=this.getScopedMap(map,context),progression=scopedMap.stats||{questions:0,answered:0,flagged:0,viewed:0,total:0},totalQuestions=this.getProgressionTotal(progression,"questions");return this.map=map,this.progression=progression,this.writeCount(this.controls.$infoAnswered,progression.answered,totalQuestions),this.writeCount(this.controls.$infoUnanswered,totalQuestions-progression.answered,totalQuestions),this.writeCount(this.controls.$infoViewed,progression.viewed,this.getProgressionTotal(progression,"total")),this.writeCount(this.controls.$infoFlagged,progression.flagged,totalQuestions),this.writeCount(this.controls.$infoAll,totalQuestions,null),
context.isLinear?(this.controls.$filterBar.hide(),this.controls.$linearState.show(),this.controls.$tree.empty()):(this.controls.$filterBar.show(),this.controls.$linearState.hide(),this.controls.$tree.html(navigatorTreeTpl(scopedMap)),this.autoScroll(),this.setState("prevents-unseen",this.config.preventsUnseen),this.config.preventsUnseen&&this.controls.$tree.find(_selectors.unseen).addClass(_cssCls.disabled)),this.filter(this.controls.$filters.filter(_selectors.actives).data("mode")),this.trigger("update"),this},getScopedMap:function(map,context){var scopedMap=mapHelper.getScopeMap(map,context.itemPosition,this.config.scope),testPart=mapHelper.getPart(scopedMap,context.testPartId)||{},section=mapHelper.getSection(scopedMap,context.sectionId)||{},item=mapHelper.getItem(scopedMap,context.itemIdentifier)||{};
return testPart.active=!0,section.active=!0,item.active=!0,mapHelper.each(scopedMap,function(itm){var cls=[],icon="";itm.active&&cls.push("active"),itm.informational&&(cls.push("info"),icon=icon||"info"),itm.flagged&&(cls.push("flagged"),icon=icon||"flagged"),itm.answered&&(cls.push("answered"),icon=icon||"answered"),itm.viewed?(cls.push("viewed"),icon=icon||"viewed"):(cls.push("unseen"),icon=icon||"unseen"),itm.cls=cls.join(" "),itm.icon=icon})},writeCount:function($place,count,total){var display=0;$place.parent().hasClass("qti-navigator-tab")?display=Math.max(count,0):total>0&&(display=Math.min(count,total)+"/"+total),$place.text(display)},select:function(position,open){
var $tree=this.controls.$tree,selected=position&&position.jquery?position:$tree.find("[data-position="+position+"]"),hierarchy=selected.parentsUntil($tree),previousPosition=0,$previous=$tree.find(_selectors.activeItem);return $previous.length&&(previousPosition=$previous.data("position")),open&&this.openOnly(hierarchy),$tree.find(_selectors.actives).removeClass(_cssCls.active),hierarchy.add(selected).addClass(_cssCls.active),position=selected.data("position"),this.trigger("selected",position,previousPosition),selected},openSelected:function(){var $tree=this.controls.$tree,selected=$tree.find(_selectors.items+_selectors.actives),hierarchy=selected.parentsUntil($tree);
return this.openOnly(hierarchy),selected},openOnly:function(opened,root){(root||this.controls.$tree).find(_selectors.collapsible).addClass(_cssCls.collapsed),opened.removeClass(_cssCls.collapsed)},togglePanel:function(panel,collapseSelector){var collapsed=panel.hasClass(_cssCls.collapsed);return collapseSelector&&this.controls.$tree.find(collapseSelector).addClass(_cssCls.collapsed),collapsed?panel.removeClass(_cssCls.collapsed):panel.addClass(_cssCls.collapsed),collapsed},toggle:function(show){return"undefined"==typeof show&&(show=this.is("hidden")),show?this.show():this.hide(),this}};return navigatorFactory}),define("taoQtiTest/runner/plugins/navigation/review/review",["jquery","lodash","i18n","ui/hider","util/shortcut","util/namespace","taoTests/runner/plugin","taoQtiTest/runner/helpers/map","taoQtiTest/runner/plugins/navigation/review/navigator"],function($,_,__,hider,shortcut,namespaceHelper,pluginFactory,mapHelper,navigatorFactory){
"use strict";function getFlagItemButtonData(context){var dataType=context.itemFlagged?"unsetFlag":"setFlag";return buttonData[dataType]}function getToggleButtonData(navigator){var dataType=navigator.is("hidden")?"showReview":"hideReview";return buttonData[dataType]}function updateButton(button,data){var $button=button.getElement();button.is("rendered")&&$button.data("control")!==data.control&&($button.data("control",data.control).attr("title",data.title),$button.find(".icon").attr("class","icon icon-"+data.icon),$button.find(".text").text(data.text),_.contains(data.control,"flag")&&(button.is("active")?button.turnOff():button.turnOn()))}function canFlag(testRunner){
var context=testRunner.getTestContext(),map=testRunner.getTestMap(),item=mapHelper.getItemAt(map,context.itemPosition);return!(context.isLinear||!context.options.markReview||item&&item.informational)}var buttonData={setFlag:{control:"set-item-flag",title:__("Flag the current item for later review"),icon:"anchor",text:__("Flag for Review")},unsetFlag:{control:"unset-item-flag",title:__("Do not flag the current item for later review"),icon:"anchor",text:__("Unflag for Review")},showReview:{control:"show-review",title:__("Show the review screen"),icon:"right",text:__("Show Review")},hideReview:{control:"hide-review",title:__("Hide the review screen"),icon:"left",
text:__("Hide Review")}};return pluginFactory({name:"review",init:function(){function isPluginAllowed(){var context=testRunner.getTestContext();return navigatorConfig.enabled&&context&&context.options&&context.options.reviewScreen}function flagItem(position,flag){return self.disable(),testRunner.getProxy().callTestAction("flagItem",{position:position,flag:flag}).then(function(){var context=testRunner.getTestContext();context.itemPosition===position&&(context.itemFlagged=flag),updateButton(self.flagItemButton,getFlagItemButtonData(context)),self.navigator.setItemFlag(position,flag),self.enable()}).catch(function(){self.navigator.setItemFlag(position,!flag),self.enable();
})}function flagCurrentItem(){var context=testRunner.getTestContext();self.getState("enabled")!==!1&&flagItem(context.itemPosition,!context.itemFlagged)}function togglePanel(forcedState){var isHidden=_.isUndefined(forcedState)?self.navigator.is("hidden"):forcedState;isHidden?(self.explicitlyHidden=!1,self.navigator.show()):(self.explicitlyHidden=!0,self.navigator.hide()),updateButton(self.toggleButton,getToggleButtonData(self.navigator))}var previousItemPosition,self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData(),testContext=testRunner.getTestContext(),testMap=testRunner.getTestMap(),testConfig=testData.config||{},pluginShortcuts=(testConfig.shortcuts||{})[this.getName()]||{},navigatorConfig=testConfig.review||{};
this.navigator=navigatorFactory(navigatorConfig,testMap,testContext).on("selected",function(position,previousPosition){previousItemPosition=previousPosition}).on("jump",function(position){self.getState("enabled")!==!1&&(self.disable(),testRunner.jump(position,"item"))}).on("flag",function(position,flag){self.getState("enabled")!==!1&&flagItem(position,flag)}).render(),testRunner.on("alert.notallowed",function(){self.navigator.select(previousItemPosition)}),this.explicitlyHidden=!1,this.toggleButton=this.getAreaBroker().getToolbox().createEntry(getToggleButtonData(this.navigator)),this.toggleButton.on("click",function(e){e.preventDefault(),testRunner.trigger("tool-reviewpanel");
}),this.flagItemButton=this.getAreaBroker().getToolbox().createEntry(getFlagItemButtonData(testContext)),this.flagItemButton.on("click",function(e){e.preventDefault(),testRunner.trigger("tool-flagitem")}),testConfig.allowShortcuts&&(pluginShortcuts.flag&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.flag,this.getName(),!0),function(){testRunner.trigger("tool-flagitem")},{avoidInput:!0}),pluginShortcuts.toggle&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.toggle,this.getName(),!0),function(){testRunner.trigger("tool-reviewpanel")},{avoidInput:!0})),isPluginAllowed()||this.hide(),this.disable(),togglePanel(testConfig.review.defaultOpen),
testRunner.on("render",function(){isPluginAllowed()?(self.show(),updateButton(self.toggleButton,getToggleButtonData(self.navigator))):self.hide()}).on("loaditem",function(){var context=testRunner.getTestContext(),map=testRunner.getTestMap();isPluginAllowed()?(updateButton(self.flagItemButton,getFlagItemButtonData(context)),self.navigator.update(map,context).updateConfig({canFlag:!context.isLinear&&context.options.markReview}),self.show(),updateButton(self.toggleButton,getToggleButtonData(self.navigator))):self.hide()}).on("enabletools",function(){isPluginAllowed()&&self.enable()}).on("disabletools",function(){isPluginAllowed()&&self.disable()}).on("tool-flagitem",function(){
isPluginAllowed()&&canFlag(testRunner)&&flagCurrentItem()}).on("tool-reviewpanel",function(){isPluginAllowed()&&self.getState("enabled")&&togglePanel()})},render:function(){var areaBroker=this.getAreaBroker(),$panelContainer=areaBroker.getPanelArea();$panelContainer.append(this.navigator.getElement())},destroy:function(){shortcut.remove("."+this.getName()),this.navigator.destroy()},enable:function(){var testRunner=this.getTestRunner(),testContext=testRunner.getTestContext();this.flagItemButton.enable(),this.toggleButton.enable(),this.navigator.enable(),testContext.itemFlagged?this.flagItemButton.turnOn():this.flagItemButton.turnOff()},disable:function(){this.flagItemButton.disable(),
this.flagItemButton.turnOff(),this.toggleButton.disable(),this.navigator.disable()},show:function(){var testRunner=this.getTestRunner();canFlag(testRunner)?this.flagItemButton.show():this.flagItemButton.hide(),this.toggleButton.show(),this.explicitlyHidden?this.navigator.hide():this.navigator.show()},hide:function(){this.flagItemButton.hide(),this.toggleButton.hide(),this.navigator.hide()}})}),define("taoQtiTest/runner/plugins/navigation/skip",["jquery","lodash","i18n","ui/hider","taoTests/runner/plugin","taoQtiTest/runner/helpers/messages","tpl!taoQtiTest/runner/plugins/templates/button"],function($,_,__,hider,pluginFactory,messages,buttonTpl){"use strict";var buttonData={
skip:{control:"skip",title:__("Skip  and go to the next item"),icon:"external",text:__("Skip")},end:{control:"skip-end",title:__("Skip and go to the end of the test"),icon:"external",text:__("Skip and end test")}},createElement=function(context){var dataType=context.isLast?"end":"skip";return $(buttonTpl(buttonData[dataType]))},updateElement=function($element,context){var dataType=context.isLast?"end":"skip";$element.data("control")!==buttonData[dataType].control&&$element.data("control",buttonData[dataType].control).attr("title",buttonData[dataType].title).find(".text").text(buttonData[dataType].text)};return pluginFactory({name:"skip",init:function(){function doSkip(){
testRunner.skip()}var self=this,testRunner=this.getTestRunner(),toggle=function(){var context=testRunner.getTestContext();return context.options.allowSkipping===!0?(self.show(),!0):(self.hide(),!1)};this.$element=createElement(testRunner.getTestContext()),this.$element.on("click",function(e){var enable=_.bind(self.enable,self),context=testRunner.getTestContext();e.preventDefault(),self.getState("enabled")!==!1&&(self.disable(),context.options.endTestWarning&&context.isLast?testRunner.trigger("confirm.endTest",messages.getExitMessage(__("You are about to submit the test. You will not be able to access this test once submitted. Click OK to continue and submit the test."),"test",testRunner),doSkip,enable):doSkip());
}),toggle(),self.disable(),testRunner.on("loaditem",function(){toggle()&&updateElement(self.$element,testRunner.getTestContext())}).on("enablenav",function(){self.enable()}).on("disablenav",function(){self.disable()})},render:function(){var $container=this.getAreaBroker().getNavigationArea();$container.append(this.$element)},destroy:function(){this.$element.remove()},enable:function(){this.$element.removeProp("disabled").removeClass("disabled")},disable:function(){this.$element.prop("disabled",!0).addClass("disabled")},show:function(){hider.show(this.$element)},hide:function(){hider.hide(this.$element)}})}),define("taoQtiTest/runner/plugins/navigation/validateResponses",["lodash","i18n","taoTests/runner/plugin","taoQtiTest/runner/helpers/currentItem"],function(_,__,pluginFactory,currentItemHelper){
"use strict";return pluginFactory({name:"validateResponses",init:function(){var testRunner=this.getTestRunner();return testRunner.before("move",function(){var testContext=testRunner.getTestContext();if(testContext.enableValidateResponses&&testContext.validateResponses)return this.trigger("disablenav disabletools"),new Promise(function(resolve,reject){return 0===_.size(currentItemHelper.getDeclarations(testRunner))?resolve():currentItemHelper.isAnswered(testRunner,!1)?resolve():void(testRunner.getState("alerted.notallowed")||(testRunner.setState("alerted.notallowed",!0),testRunner.trigger("alert.notallowed",__("A valid response to this item is required."),function(){
testRunner.trigger("resumeitem"),reject(),testRunner.setState("alerted.notallowed",!1)})))})}),this}})}),define("taoQtiTest/runner/plugins/navigation/warnBeforeLeaving",["i18n","taoTests/runner/plugin"],function(__,pluginFactory){"use strict";var warnMessage=__("Please confirm you want to leave the test."),warnListener=function(e){return e.returnValue=warnMessage,warnMessage};return pluginFactory({name:"warnBeforeLeaving",init:function(){this.enable()},destroy:function(){this.disable()},enable:function(){window.addEventListener("beforeunload",warnListener)},disable:function(){window.removeEventListener("beforeunload",warnListener)}})}),define("taoQtiTest/runner/plugins/security/disableRightClick",["taoTests/runner/plugin"],function(pluginFactory){
"use strict";return pluginFactory({name:"disableRightClick",init:function(){var rightClickEvents=["contextmenu","mousedown","mouseup"];rightClickEvents.forEach(function(eventName){window.document.addEventListener(eventName,function(event){2===event.button&&event.preventDefault()})})}})}),define("taoQtiTest/runner/plugins/tools/answerElimination/eliminator",["jquery","lodash","i18n","ui/hider","util/shortcut","util/namespace","taoTests/runner/plugin"],function($,_,__,hider,shortcut,namespaceHelper,pluginFactory){"use strict";var pluginName="eliminator",actionPrefix="tool-"+pluginName+"-",defaultConfig={removeEliminationsOnClose:!1,restoreEliminationsOnOpen:!1};
return pluginFactory({name:pluginName,init:function(){function isPluginEnabled(){var context=testRunner.getTestContext()||{},options=context.options||{};return!!options.eliminator}function togglePluginButton(){isPluginEnabled()?self.show():self.hide()}function togglePlugin(){self.$choiceInteractions&&(self.$choiceInteractions.toggleClass("eliminable"),isEliminable()?enableEliminator():disableEliminator())}function isEliminable(){if(self.$choiceInteractions)return self.$choiceInteractions.hasClass("eliminable")}function enableEliminator(){var $choices;self.$choiceInteractions&&($choices=self.$choiceInteractions.find(".qti-choice"),self.button.turnOn(),self.trigger("start"),
config.restoreEliminationsOnOpen&&$choices.each(function(){var input=this.querySelector(".real-label input");this.dataset.wasEliminated&&(this.dataset.wasEliminated=null,this.classList.add("eliminated"),input.setAttribute("disabled","disabled"),input.checked=!1)}))}function disableEliminator(){var $choices;self.$choiceInteractions&&($choices=self.$choiceInteractions.find(".qti-choice"),self.$choiceInteractions.removeClass("eliminable"),self.button.turnOff(),self.trigger("end"),$choices.each(function(){this.classList.contains("eliminated")&&(this.dataset.wasEliminated=!0,this.classList.remove("eliminated"),this.querySelector(".real-label input").removeAttribute("disabled"));
}))}var self=this,testRunner=this.getTestRunner(),$container=testRunner.getAreaBroker().getContentArea().parent(),testConfig=testRunner.getTestData().config||{},pluginShortcuts=(testConfig.shortcuts||{})[pluginName]||{},config=_.defaults(_.clone((testConfig.plugins||{})[pluginName])||{},defaultConfig);this.button=this.getAreaBroker().getToolbox().createEntry({control:"eliminator",title:__("Eliminate choices"),icon:"eliminate",text:__("Answer Eliminator")}),this.button.on("click",function(e){e.preventDefault(),testRunner.trigger(actionPrefix+"toggle")}),testConfig.allowShortcuts&&_.forEach(pluginShortcuts,function(command,key){shortcut.add(namespaceHelper.namespaceAll(command,pluginName,!0),function(){
testRunner.trigger(actionPrefix+key)},{avoidInput:!0})}),this.disable(),testRunner.on("loaditem",togglePluginButton).on("renderitem",function(){return self.$choiceInteractions=$container.find(".qti-choiceInteraction"),self.$choiceInteractions.length?void(isPluginEnabled()&&self.show()):void self.hide()}).on("enabletools renderitem",function(){self.enable()}).on("disabletools unloaditem",function(){self.disable(),disableEliminator()}).on(actionPrefix+"toggle",function(){isPluginEnabled()&&togglePlugin()}).on("tool-answer-masking-toggle",function(){isEliminable()&&disableEliminator()})},destroy:function(){shortcut.remove("."+pluginName)},enable:function(){this.button.enable();
},disable:function(){this.button.disable()},show:function(){this.button.show()},hide:function(){this.button.hide()}})}),define("tpl!taoQtiTest/runner/plugins/tools/answerMasking/tpl/mask",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},'<div class="answer-mask">\n    <span class="answer-mask-toggle"></span>\n</div>'})}),define("taoQtiTest/runner/plugins/tools/answerMasking/answerMasking",["lodash","jquery","core/statifier","ui/component","tpl!taoQtiTest/runner/plugins/tools/answerMasking/tpl/mask"],function(_,$,statifier,componentFactory,maskTpl){
"use strict";var ns=".answerMasking";return function($contentArea){function createMask($container){return componentFactory(maskApi).setTemplate(maskTpl).on("render",function(){var self=this,$component=this.getElement();$component.on("click"+ns,function(e){e.stopPropagation(),e.preventDefault(),self.toggle()})}).on("destroy",function(){var $component=this.getElement();$component.off(ns)}).init().render($container).mask()}var answerMasking,allMasks=[],maskApi={toggle:function(){return this.is("masked")?this.reveal():this.mask()},reveal:function(){var $container=this.getContainer();return $container.removeClass("masked"),$container.find("input").removeAttr("disabled"),
this.setState("masked",!1),this},mask:function(){var $container=this.getContainer();return $container.addClass("masked"),$container.find("input").attr("disabled","disabled"),this.setState("masked",!0),this}};return answerMasking={enable:function(){var $choiceInteractions=$contentArea.find(".qti-choiceInteraction"),$qtiChoices=$contentArea.find(".qti-choice");allMasks=[],$choiceInteractions.addClass("maskable"),$qtiChoices.each(function(){var $choice=$(this);allMasks.push(createMask($choice))}),this.setState("enabled",!0)},disable:function(){var $choiceInteractions=$contentArea.find(".qti-choiceInteraction");$choiceInteractions.removeClass("maskable"),allMasks.forEach(function(mask){
mask.reveal(),mask.destroy()}),allMasks=[],this.setState("enabled",!1)},getMasksState:function(){var state=allMasks.map(function(mask){return mask.is("masked")});return state},setMasksState:function(state){state=state||[],state.forEach(function(masked,index){var mask=allMasks[index];_.isObject(mask)&&_.isFunction(mask.reveal)&&!masked&&mask.reveal()})}},statifier(answerMasking),answerMasking}}),define("taoQtiTest/runner/plugins/tools/answerMasking/plugin",["jquery","lodash","i18n","taoTests/runner/plugin","ui/hider","util/shortcut","util/namespace","taoQtiTest/runner/plugins/tools/answerMasking/answerMasking"],function($,_,__,pluginFactory,hider,shortcut,namespaceHelper,answerMaskingFactory){
"use strict";var pluginName="answer-masking",actionPrefix="tool-"+pluginName+"-",itemStates={},defaultConfig={restoreStateOnToggle:!0,restoreStateOnMove:!0};return pluginFactory({name:pluginName,init:function(){function isPluginEnabled(){var context=testRunner.getTestContext()||{},options=context.options||{};return options.answerMasking&&itemContainsChoiceInteraction()}function itemContainsChoiceInteraction(){var $container=self.getAreaBroker().getContentArea().parent();return $container.find(".qti-choiceInteraction").length}function togglePluginButton(){isPluginEnabled()?self.show():self.hide()}function togglePlugin(){answerMasking.getState("enabled")?disableMasking():enableMasking();
}function enableMasking(){var testContext=testRunner.getTestContext(),itemId=testContext.itemIdentifier;answerMasking.enable(),pluginConfig.restoreStateOnToggle&&answerMasking.setMasksState(itemStates[itemId]),self.button.turnOn(),self.trigger("start")}function disableMasking(){var testContext=testRunner.getTestContext(),itemId=testContext.itemIdentifier;answerMasking.getState("enabled")&&(itemStates[itemId]=answerMasking.getMasksState()),answerMasking.disable(),self.button.turnOff(),self.trigger("end")}var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData()||{},testConfig=testData.config||{},pluginConfig=_.defaults((testConfig.plugins||{})[pluginName]||{},defaultConfig),pluginShortcuts=(testConfig.shortcuts||{})[pluginName]||{},$contentArea=this.getAreaBroker().getContentArea(),answerMasking=answerMaskingFactory($contentArea);
this.button=this.getAreaBroker().getToolbox().createEntry({title:__("Answer Masking"),icon:"result-nok",control:"answer-masking",text:__("Answer Masking")}),this.button.on("click",function(e){e.preventDefault(),testRunner.trigger(actionPrefix+"toggle")}),testConfig.allowShortcuts&&pluginShortcuts.toggle&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.toggle,this.getName(),!0),function(){testRunner.trigger(actionPrefix+"toggle")},{avoidInput:!0,prevent:!0}),this.disable(),testRunner.on("loaditem",function(){var testContext=testRunner.getTestContext(),itemId=testContext.itemIdentifier;pluginConfig.restoreStateOnMove||(itemStates[itemId]=[]),togglePluginButton();
}).on("enabletools renderitem",function(){togglePluginButton(),self.enable()}).on("beforeunloaditem",function(){disableMasking()}).on("disabletools unloaditem",function(){self.disable(),disableMasking()}).on(actionPrefix+"toggle",function(){isPluginEnabled()&&togglePlugin()}).on("tool-eliminator-toggle",function(){disableMasking()})},destroy:function(){shortcut.remove("."+this.getName())},enable:function(){this.button.enable()},disable:function(){this.button.disable()},show:function(){this.button.show()},hide:function(){this.button.hide()}})}),define("tpl!taoQtiTest/runner/plugins/tools/areaMasking/mask",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){
this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression;return buffer+='<div class="mask">\n   <div class="inner"></div>\n   <div class="controls">\n        <a href="#" class="view"  title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Preview the covered area",options):helperMissing.call(depth0,"__","Preview the covered area",options)))+'"><span class="icon-preview"></span></a>\n        <a href="#" class="close" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Close the mask",options):helperMissing.call(depth0,"__","Close the mask",options)))+'"><span class="icon-result-nok"></span></a>\n   </div>\n</div>\n'})}),define("taoQtiTest/runner/plugins/tools/areaMasking/mask",["lodash","ui/movableComponent","tpl!taoQtiTest/runner/plugins/tools/areaMasking/mask"],function(_,movableComponent,areaMaskingTpl){"use strict";function maskingComponentFactory(){var maskComponent=movableComponent({preview:function(){var self=this,delay=this.config.previewDelay||1e3;return!this.is("rendered")||this.is("disabled")||this.is("previewing")||(this.setState("previewing",!0).trigger("preview"),
_.delay(function(){self.setState("previewing",!1)},delay)),this}},defaultConfig);return maskComponent.setTemplate(areaMaskingTpl).on("render",function(){var self=this,$element=this.getElement();$element.on("click touchstart",".view",function(e){e.preventDefault(),self.preview()}).on("click touchstart",".close",function(e){e.preventDefault(),self.destroy()})}),maskComponent}var defaultConfig={previewDelay:3e3,stackingScope:"test-runner"};return maskingComponentFactory}),define("taoQtiTest/runner/plugins/tools/areaMasking/areaMasking",["jquery","lodash","i18n","ui/hider","util/shortcut","util/namespace","taoTests/runner/plugin","taoQtiTest/runner/plugins/tools/areaMasking/mask"],function($,_,__,hider,shortcut,namespaceHelper,pluginFactory,maskComponent){
"use strict";var pluginName="area-masking",actionPrefix="tool-"+pluginName+"-",defaultConfig={max:5,foo:!0};return pluginFactory({name:pluginName,init:function(){function addMask(){maskComponent().on("render",function(){self.masks.push(this),self.button.turnOn(),self.trigger("maskadd")}).on("destroy",function(){self.masks=_.without(self.masks,this),self.masks.length<config.max&&self.enable(),0===self.masks.length&&(self.button.turnOff(),self.trigger("close")),self.trigger("maskclose")}).init({x:10*self.masks.length,y:10*self.masks.length}).render($container)}function isEnabled(){var context=testRunner.getTestContext(),options=context.options||{};return!!options.areaMasking;
}function togglePlugin(){isEnabled()?self.show():self.hide()}var self=this,testRunner=this.getTestRunner(),$container=testRunner.getAreaBroker().getContentArea().parent(),testConfig=testRunner.getTestData().config||{},config=_.defaults(_.clone((testConfig.plugins||{})[pluginName])||{},defaultConfig),pluginShortcuts=(testConfig.shortcuts||{})[pluginName]||{};this.masks=[],this.button=this.getAreaBroker().getToolbox().createEntry({control:"area-masking",text:__("Masking"),title:__("Covers parts of the item"),icon:"eye-slash"}),this.button.on("click",function(e){e.preventDefault(),testRunner.trigger(actionPrefix+"toggle")}),testConfig.allowShortcuts&&_.forEach(pluginShortcuts,function(command,key){
shortcut.add(namespaceHelper.namespaceAll(command,pluginName,!0),function(){testRunner.trigger(actionPrefix+key)},{avoidInput:!0})}),this.disable(),testRunner.on("loaditem",togglePlugin).on("enabletools renderitem",function(){self.enable()}).on("disabletools unloaditem",function(){self.disable(),_.invoke(self.masks,"destroy")}).on(actionPrefix+"toggle",function(){isEnabled()&&(0===self.masks.length&&self.trigger("open"),self.masks.length<config.max?addMask():1===config.max&&_.invoke(self.masks,"destroy"))})},destroy:function(){shortcut.remove("."+pluginName)},enable:function(){this.button.enable()},disable:function(){this.button.disable()},show:function(){this.button.show();
},hide:function(){this.button.hide()}})}),define("taoQtiTest/runner/plugins/tools/calculator",["jquery","lodash","i18n","ui/hider","ui/calculator","util/shortcut","util/namespace","taoTests/runner/plugin"],function($,_,__,hider,calculatorFactory,shortcut,namespaceHelper,pluginFactory){"use strict";var _default={height:360,width:240,top:50,left:10,stackingScope:"test-runner"};return pluginFactory({name:"calculator",init:function(){function isEnabled(){var context=testRunner.getTestContext()||{},options=context.options||{};return!!options.calculator}function togglePlugin(){isEnabled()?self.show():self.hide()}function buildCalculator(calcTpl){self.calculator=calculatorFactory(_.defaults({
renderTo:self.$calculatorContainer,replace:!0,draggableContainer:areaBroker.getContainer(),alternativeTemplate:calcTpl||null},_default)).on("show",function(){self.trigger("open"),self.button.turnOn()}).on("hide",function(){self.trigger("close"),self.button.turnOff()}).show()}function toggleCalculator(){self.getState("enabled")!==!1&&(self.calculator?self.calculator.is("hidden")?self.calculator.show():self.calculator.hide():config.template?require(["tpl!"+config.template.replace(/\.tpl$/,"")],function(calcTpl){buildCalculator(calcTpl)},function(){buildCalculator()}):buildCalculator())}var self=this,testRunner=this.getTestRunner(),areaBroker=this.getAreaBroker(),testData=testRunner.getTestData()||{},testConfig=testData.config||{},pluginsConfig=testConfig.plugins||{},config=pluginsConfig.calculator||{},pluginShortcuts=(testConfig.shortcuts||{})[this.getName()]||{};
this.button=this.getAreaBroker().getToolbox().createEntry({control:"calculator",title:__("Open Calculator"),icon:"table",text:__("Calculator")}),this.$calculatorContainer=$('<div class="widget-calculator">'),this.calculator=null,this.button.on("click",function(e){$(e.target).closest(".widget-calculator").length||(e.preventDefault(),testRunner.trigger("tool-calculator"))}),testConfig.allowShortcuts&&pluginShortcuts.toggle&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.toggle,this.getName(),!0),function(){testRunner.trigger("tool-calculator")},{avoidInput:!0,allowIn:".widget-calculator"}),togglePlugin(),this.disable(),testRunner.on("loaditem",togglePlugin).on("enabletools renderitem",function(){
self.enable()}).on("disabletools unloaditem",function(){self.disable(),self.calculator&&(self.calculator.destroy(),self.calculator=null)}).on("tool-calculator",function(){isEnabled()&&toggleCalculator()})},render:function(){var areaBroker=this.getAreaBroker();areaBroker.getContainer().append(this.$calculatorContainer)},destroy:function(){shortcut.remove("."+this.getName()),this.$calculatorContainer.remove(),this.calculator&&this.calculator.destroy()},enable:function(){this.button.enable()},disable:function(){this.button.disable(),this.calculator&&this.calculator.hide()},show:function(){this.button.show()},hide:function(){this.button.hide(),this.calculator&&this.calculator.hide();
}})}),define("tpl!taoQtiTest/runner/plugins/tools/comment/comment",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var helper,options,buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression;return buffer+='<div data-control="qti-comment" class="hidden">\n    <textarea data-control="qti-comment-text" placeholder="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Your comment…",options):helperMissing.call(depth0,"__","Your comment…",options)))+'"></textarea>\n    <button data-control="qti-comment-cancel" class="btn-info small"></span>'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Cancel",options):helperMissing.call(depth0,"__","Cancel",options)))+'</button>\n    <button data-control="qti-comment-send" class="btn-info small">'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Send",options):helperMissing.call(depth0,"__","Send",options)))+"</button>\n</div>\n"})}),define("taoQtiTest/runner/plugins/tools/comment/comment",["jquery","i18n","taoTests/runner/plugin","ui/hider","ui/stacker","util/shortcut","util/namespace","tpl!taoQtiTest/runner/plugins/tools/comment/comment"],function($,__,pluginFactory,hider,stackerFactory,shortcut,namespaceHelper,commentTpl){
"use strict";return pluginFactory({name:"comment",init:function(){function isEnabled(){var context=testRunner.getTestContext();return!!context.options.allowComment}function togglePlugin(){isEnabled()?self.show():self.hide()}function toggleComment(){self.getState("enabled")!==!1&&(hider.toggle(self.$form),hider.isHidden(self.$form)?self.button.turnOff():(self.$input.val("").focus(),self.button.turnOn(),stacker.bringToFront(self.$form)))}var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData()||{},testConfig=testData.config||{},pluginShortcuts=(testConfig.shortcuts||{})[this.getName()]||{},stacker=stackerFactory("test-runner");this.button=this.getAreaBroker().getToolbox().createEntry({
control:"comment",title:__("Leave a comment"),icon:"tag",text:__("Comment")}),this.button.on("render",function(){self.$button=self.button.getElement(),self.$form=$(commentTpl()).appendTo(self.$button),self.$input=self.$button.find('[data-control="qti-comment-text"]'),self.$cancel=self.$button.find('[data-control="qti-comment-cancel"]'),self.$submit=self.$button.find('[data-control="qti-comment-send"]'),stacker.autoBringToFront(self.$form),self.$cancel.on("click",function(){hider.hide(self.$form),self.button.turnOff()}),self.$submit.on("click",function(){var comment=self.$input.val();comment&&(self.disable(),self.button.turnOff(),testRunner.getProxy().callTestAction("comment",{
comment:comment}).then(function(){hider.hide(self.$form),self.enable()}).catch(function(){hider.hide(self.$form),self.enable()}))})}),this.button.on("click",function(e){$(e.target).closest('[data-control="qti-comment"]').length||(e.preventDefault(),testRunner.trigger("tool-comment"))}),testConfig.allowShortcuts&&pluginShortcuts.toggle&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.toggle,this.getName(),!0),function(){testRunner.trigger("tool-comment")},{avoidInput:!0}),togglePlugin(),this.disable(),testRunner.on("loaditem",togglePlugin).on("renderitem enabletools",function(){self.enable()}).on("unloaditem disabletools",function(){self.disable()}).on("tool-comment",function(){
isEnabled()&&toggleComment()})},destroy:function(){shortcut.remove("."+this.getName())},enable:function(){this.button.enable()},disable:function(){this.$form&&hider.hide(this.$form),this.button.disable(),this.button.turnOff()},show:function(){this.button.show()},hide:function(){this.$form&&hider.hide(this.$form),this.button.hide()}})}),define("tpl!taoQtiTest/runner/plugins/tools/documentViewer/panel",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,buffer="",functionType="function",escapeExpression=this.escapeExpression;
return buffer+='<div class="document-viewer-plugin hidden">\n    <div class="viewer-overlay"></div>\n    <div class="viewer-panel">\n        <div class="viewer-header">\n            <span class="viewer-title">',(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</span>\n            <span class="icon icon-close"></span>\n        </div>\n        <div class="viewer-content">',(helper=helpers.content)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.content,stack1=typeof helper===functionType?helper.call(depth0,{
hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+='</div>\n        <div class="viewer-footer"></div>\n    </div>\n</div>\n'})}),define("taoQtiTest/runner/plugins/tools/documentViewer/documentViewer",["jquery","lodash","ui/hider","ui/documentViewer","ui/documentViewer/providers/pdfViewer","taoTests/runner/plugin","tpl!taoQtiTest/runner/plugins/tools/documentViewer/panel"],function($,_,hider,viewerFactory,pdfViewer,pluginFactory,panelTpl){"use strict";function showPanel(plugin){hider.show(plugin.controls.$panel),plugin.trigger("panelshow"),$(window).on("resize."+plugin.getName(),_.debounce(_.partial(resizeViewer,plugin),50))}function hidePanel(plugin){
hider.hide(plugin.controls.$panel),plugin.trigger("panelhide"),$(window).off("resize."+plugin.getName())}function hideIfVisible(plugin){var isVisible=!hider.isHidden(plugin.controls.$panel,!0);return isVisible&&hidePanel(plugin),isVisible}function initPanelEvents(plugin){function stopPropagation(e){e.stopImmediatePropagation(),e.stopPropagation()}var namespace="."+plugin.getName(),stopEvents=["click","mousedown","mouseup","touchstart","touchend","keyup","keydow","keypress","scroll","drop"].join(namespace+" ")+namespace,hideViewer=_.partial(hidePanel,plugin);plugin.controls.$overlay.off(namespace).on("click"+namespace,hideViewer).on(stopEvents,stopPropagation),
plugin.controls.$panel.off(namespace).on("click"+namespace,".icon-close",hideViewer).on(stopEvents,stopPropagation)}function resizeViewer(plugin){var $content=plugin.controls.$content;plugin.viewer.setSize($content.width(),$content.height())}var pluginName="documentViewer";return viewerFactory.registerProvider("pdf",pdfViewer),pluginFactory({name:pluginName,init:function(){function displayViewer(data){self.getState("enabled")!==!1&&(showPanel(self),self.controls.$title.text(data.label),resizeViewer(self),self.viewer.load(data.document,"pdf"))}var self=this,testRunner=this.getTestRunner(),$panel=$(panelTpl());this.controls={$panel:$panel,$overlay:$panel.find(".viewer-overlay"),
$title:$panel.find(".viewer-title"),$content:$panel.find(".viewer-content")},this.viewer=viewerFactory({renderTo:this.controls.$content,replace:!0,fitToWidth:!0,allowSearch:!0}),testRunner.on("renderitem enabletools",function(){self.enable()}).on("renderitem",function(){self.getAreaBroker().getContentArea().append(self.controls.$panel).off("."+self.getName()).on("viewDocument."+self.getName(),function(event){var data=event.originalEvent.detail;displayViewer(data)}),initPanelEvents(self)}).on("move",function(){hideIfVisible(self)}).on("skip",function(){hideIfVisible(self)}).on("unloaditem disabletools",function(){self.disable()}).on("tool-documentViewer",function(data){
displayViewer(data)})},render:function(){},destroy:function(){this.getAreaBroker().getContentArea().off("."+this.getName()),this.viewer&&this.viewer.destroy(),this.controls.$panel&&this.controls.$panel.remove(),this.viewer=null,this.controls={}},enable:function(){},disable:function(){hideIfVisible(this)},show:function(){},hide:function(){hideIfVisible(this)}})}),define("taoQtiTest/runner/plugins/tools/highlighter/highlighter",["lodash","jquery","ui/highlighter"],function(_,$,highlighterFactory){"use strict";function getAllRanges(){var i,allRanges=[];for(i=0;i<selection.rangeCount;i++)allRanges.push(selection.getRangeAt(i));return allRanges}var selection;if(!window.getSelection)throw new Error("Browser does not support getSelection()");
return selection=window.getSelection(),function(testRunner){var isHighlighting=!1,itemsHighlights={},highlightHelper=highlighterFactory({className:"txt-user-highlight",containerSelector:".qti-itemBody"});return $(document).on("mouseup.highlighter",function(){isHighlighting&&!selection.isCollapsed&&(highlightHelper.highlightRanges(getAllRanges()),selection.removeAllRanges())}),{toggleHighlighting:function(bool){isHighlighting=bool,isHighlighting?testRunner.trigger("plugin-start.highlighter"):testRunner.trigger("plugin-end.highlighter")},trigger:function(){isHighlighting?this.toggleHighlighting(!1):selection.isCollapsed?this.toggleHighlighting(!0):(testRunner.trigger("plugin-start.highlighter"),
highlightHelper.highlightRanges(getAllRanges()),testRunner.trigger("plugin-end.highlighter"),selection.removeAllRanges())},saveHighlight:function(itemId){var index=highlightHelper.getHighlightIndex();index&&index.length>0&&(itemsHighlights[itemId]=index)},restoreHighlight:function(itemId){var index=itemsHighlights[itemId];index&&index.length>0&&highlightHelper.highlightFromIndex(index)},clearHighlights:function(){highlightHelper.clearHighlights(),selection.removeAllRanges()}}}}),define("taoQtiTest/runner/plugins/tools/highlighter/plugin",["jquery","lodash","i18n","taoTests/runner/plugin","ui/hider","util/shortcut","util/namespace","taoQtiTest/runner/plugins/tools/highlighter/highlighter"],function($,_,__,pluginFactory,hider,shortcut,namespaceHelper,highlighterFactory){
"use strict";return pluginFactory({name:"highlighter",init:function(){function isEnabled(){var context=testRunner.getTestContext()||{},options=context.options||{};return!!options.highlighter}function togglePlugin(){isEnabled()?self.show():self.hide()}var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData()||{},testConfig=testData.config||{},pluginShortcuts=(testConfig.shortcuts||{})[this.getName()]||{},highlighter=highlighterFactory(testRunner);this.buttonMain=this.getAreaBroker().getToolbox().createEntry({title:__("Highlight Text"),icon:"text-marker",control:"highlight-trigger",text:__("Highlight")}),this.buttonRemove=this.getAreaBroker().getToolbox().createEntry({
title:__("Clear all active highlights"),icon:"result-nok",control:"highlight-clear",text:__("Clear Highlights")}),this.buttonMain.on("mousedown",function(e){e.preventDefault(),testRunner.trigger("tool-highlight")}),this.buttonRemove.on("click",function(e){e.preventDefault(),testRunner.trigger("tool-highlight-remove")}),testConfig.allowShortcuts&&pluginShortcuts.toggle&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.toggle,this.getName(),!0),function(){testRunner.trigger("tool-highlight")},{avoidInput:!0,prevent:!0}),this.disable(),testRunner.on("loaditem",togglePlugin).on("enabletools renderitem",function(){self.enable()}).on("renderitem",function(){
var testContext=testRunner.getTestContext();highlighter.restoreHighlight(testContext.itemIdentifier)}).on("beforeunloaditem",function(){var testContext=testRunner.getTestContext();highlighter.saveHighlight(testContext.itemIdentifier)}).on("disabletools unloaditem",function(){self.disable(),highlighter.toggleHighlighting(!1)}).on("tool-highlight",function(){isEnabled()&&highlighter.trigger()}).on("tool-highlight-remove",function(){highlighter.clearHighlights()}).on("plugin-start.highlighter",function(){self.buttonMain.turnOn()}).on("plugin-end.highlighter",function(){self.buttonMain.turnOff()})},destroy:function(){shortcut.remove("."+this.getName()),$(document).off(".highlighter");
},enable:function(){this.buttonMain.enable(),this.buttonRemove.enable()},disable:function(){this.buttonMain.disable(),this.buttonRemove.disable()},show:function(){this.buttonMain.show(),this.buttonRemove.show()},hide:function(){this.buttonMain.hide(),this.buttonRemove.hide()}})}),define("taoQtiTest/runner/plugins/tools/itemThemeSwitcher/itemThemeSwitcher",["jquery","lodash","i18n","taoTests/runner/plugin","ui/hider","ui/themes","util/shortcut","util/namespace"],function($,_,__,pluginFactory,hider,themeHandler,shortcut,namespaceHelper){"use strict";return pluginFactory({name:"itemThemeSwitcher",init:function(){function changeTheme(themeId){var $qtiItem=$(".qti-item");
state.selectedTheme=themeId,$qtiItem&&_.defer(function(){$qtiItem.trigger("themechange",[state.selectedTheme])})}var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData()||{},testConfig=testData.config||{},pluginShortcuts=(testConfig.shortcuts||{})[this.getName()]||{},themesConfig=themeHandler.get("items")||{},state={availableThemes:[],defaultTheme:"",selectedTheme:""};themesConfig&&(themesConfig.default&&(state.defaultTheme=themesConfig.default,state.selectedTheme=themesConfig.default),themesConfig.available&&_.forEach(themesConfig.available,function(theme){state.availableThemes.push({id:theme.id,label:theme.name})})),this.menuButton=this.getAreaBroker().getToolbox().createMenu({
control:"color-contrast",title:__("Change the current color preset"),icon:"contrast",text:__("Contrast")}),this.menuButton.on("click",function(e){e.preventDefault(),testRunner.trigger("tool-themeswitcher-toggle")}),state.availableThemes.forEach(function(theme){var themeEntry=self.getAreaBroker().getToolbox().createEntry({control:theme.id,title:theme.label,icon:"preview",text:__(theme.label)});themeEntry.setMenuId("color-contrast"),themeEntry.on("click",function(e){var themeId=this.config.control;e.preventDefault(),self.menuButton.turnOffAll(),this.turnOn(),changeTheme(themeId)}),state.defaultTheme===theme.id&&themeEntry.on("render",function(){this.turnOn()})}),
testConfig.allowShortcuts&&pluginShortcuts.toggle&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.toggle,this.getName(),!0),function(){testRunner.trigger("tool-themeswitcher-toggle")},{avoidInput:!0}),this.disable(),testRunner.on("loaditem",function(){self.show()}).on("renderitem",function(){self.enable(),changeTheme(state.selectedTheme)}).on("enabletools",function(){self.enable()}).on("disabletools unloaditem",function(){self.disable()}).on("tool-themeswitcher-toggle",function(){self.getState("enabled")!==!1&&self.menuButton.toggleMenu()})},destroy:function(){shortcut.remove("."+this.getName())},enable:function(){this.menuButton.enable()},disable:function(){
this.menuButton.disable()},show:function(){this.menuButton.show()},hide:function(){this.menuButton.hide()}})}),define("taoQtiTest/runner/plugins/tools/lineReader/compoundMask",["jquery","lodash","core/statifier","core/eventifier","ui/component","ui/component/placeable","ui/component/draggable","ui/component/resizable","ui/component/stackable"],function($,_,statifier,eventifier,componentFactory,makePlaceable,makeDraggable,makeResizable,makeStackable){"use strict";var constrains,defaultDimensions={outerWidth:600,outerHeight:400,innerWidth:500,innerHeight:20},defaultPosition={outerX:0,outerY:0,innerX:50,innerY:50},defaultOptions={dragMinWidth:10,dragMinHeight:10,
resizeHandleSize:10,innerDragHeight:20},stackingOptions={stackingScope:"test-runner"};return function(options,dimensions,position){function createMask(maskConfig){var mask,maskAPI={place:maskConfig.place,placeOverlay:maskConfig.placeOverlay,styleResizableEdges:function(){var $element=this.getElement();_.forOwn(this.config.edges,function(isResizable,edgeId){isResizable&&$element.addClass("border-"+edgeId)})}};return mask=componentFactory(maskAPI,maskConfig),makeResizable(mask),makeStackable(mask,stackingOptions),mask.on("render",function(){var $element=this.getElement();this.styleResizableEdges(),$element.addClass("line-reader-mask "+maskConfig.id).on("mousedown",function(){
bringAllToFront()})}).on("resizestart",function(){innerDrag.hide(),closer.hide(),invokeOnOverlays("hide"),invokeOnMasks("setState",["resizing",!0])}).on("beforeresize",maskConfig.beforeResize||_.noop).on("resize",maskConfig.onResize||_.noop).on("resizeend",function(){applyTransformsToOverlays(),applyTransformsToInnerDrag(),applyTransformsToCloser(),invokeOnMasks("setState",["resizing",!1]),invokeOnOverlays("show"),innerDrag.show(),closer.show()}).init()}function createOverlay(overlayConfig){var overlay,overlayAPI={transformOverlay:function(){var $element=this.getElement();this._sizeBackup=this.getSize(),this._posBackup=this.getPosition(),this.setSize(dimensions.outerWidth,dimensions.outerHeight).moveTo(position.outerX,position.outerY),
$element.addClass("moving"),this.setState("transformed",!0)},restoreOverlay:function(){var $element=this.getElement();this.is("transformed")&&(this.setSize(this._sizeBackup.width,this._sizeBackup.height).moveTo(this._posBackup.x,this._posBackup.y),$element.removeClass("moving"),this._sizeBackup=null,this._posBackup=null,this.setState("transformed",!1))},appendVisualGuides:function(){var $element=this.getElement(),borderWidth=1,borderOffset=2*borderWidth;$element.append(visualGuides.$maskBg),$element.append(visualGuides.$innerWindow),visualGuides.$maskBg.css({width:dimensions.outerWidth-borderOffset,height:dimensions.outerHeight-borderOffset,"border-top-width":dimensions.topHeight-borderOffset,
"border-right-width":dimensions.rightWidth-borderOffset,"border-bottom-width":dimensions.bottomHeight-borderOffset,"border-left-width":dimensions.leftWidth-borderOffset}),visualGuides.$innerWindow.css({width:dimensions.innerWidth,height:dimensions.innerHeight,left:dimensions.leftWidth-borderOffset,top:dimensions.topHeight-borderOffset})},removeVisualGuides:function(){visualGuides.$maskBg.remove(),visualGuides.$innerWindow.remove()}};return overlay=componentFactory(overlayAPI,overlayConfig),makeDraggable(overlay),makeStackable(overlay,stackingOptions),overlay.on("render",function(){var self=this,$element=this.getElement();$element.addClass("line-reader-overlay "+overlayConfig.id).on("mousedown",function(){
bringAllToFront(),self.transformOverlay()}).on("mouseup",function(){self.restoreOverlay()})}).on("dragstart",function(){innerDrag.hide(),closer.hide(),invokeOnMasks("hide"),this.appendVisualGuides()}).on("dragmove",function(xOffsetRelative,yOffsetRelative){position.outerX+=xOffsetRelative,position.outerY+=yOffsetRelative,position.innerX+=xOffsetRelative,position.innerY+=yOffsetRelative}).on("dragend",function(){this.removeVisualGuides(),invokeOnAll("show"),innerDrag.show(),closer.show(),applyTransforms()}).init()}function createInnerDragHandle(){innerDrag=componentFactory(),makeStackable(innerDrag,stackingOptions),makeDraggable(innerDrag,{dragRestriction:function(){
var rect,fixedXY=allParts.nw.mask.getElement().offset();return rect={x:fixedXY.left+constrains.minWidth,y:fixedXY.top+(constrains.minHeight+dimensions.innerHeight+options.resizeHandleSize),width:dimensions.outerWidth-2*constrains.minWidth,height:dimensions.outerHeight-(dimensions.innerHeight+constrains.minHeight+constrains.minBottomHeight-options.innerDragHeight)}}}).on("render",function(){var $element=this.getElement(),$dragIcon=$("<div>",{class:"icon icon-move"});$element.addClass("line-reader-inner-drag"),$element.append($dragIcon),$element.on("mousedown",function(e){e.stopPropagation(),bringAllToFront()})}).on("dragstart",function(){closer.hide(),invokeOnOverlays("hide"),
invokeOnMasks("setState",["resizing",!0])}).on("dragmove",function(xOffsetRelative,yOffsetRelative){position.innerX+=xOffsetRelative,position.innerY+=yOffsetRelative,dimensions.leftWidth+=xOffsetRelative,dimensions.topHeight+=yOffsetRelative,dimensions.rightWidth-=xOffsetRelative,dimensions.bottomHeight-=yOffsetRelative,applyTransformsToMasks()}).on("dragend",function(){invokeOnOverlays("show"),innerDrag.bringToFront(),closer.show(),invokeOnMasks("setState",["resizing",!1]),applyTransformsToOverlays()}).init()}function createCloser(){closer=componentFactory(),makeStackable(closer,stackingOptions),makePlaceable(closer).on("render",function(){var self=this,$element=this.getElement(),$closeIcon=$("<div>",{
class:"icon icon-result-nok"});$element.append($closeIcon),$element.addClass("line-reader-closer"),$element.on("mousedown",function(){bringAllToFront()}),$element.on("click",function(e){e.stopPropagation(),self.trigger("click")})}).init()}function bringAllToFront(){invokeOnAll("bringToFront"),innerDrag.bringToFront(),closer.bringToFront()}function invokeOnAll(fn,args){invokeOnMasks(fn,args),invokeOnOverlays(fn,args)}function invokeOnMasks(fn,args){invokeOn("mask",fn,args)}function invokeOnOverlays(fn,args){invokeOn("overlay",fn,args)}function invokeOn(target,fn,args){_.forOwn(allParts,function(part){_.isObject(part[target])&&_.isFunction(part[target][fn])&&part[target][fn].apply(part[target],args);
})}function applyTransforms(){applyTransformsToMasks(),applyTransformsToOverlays(),applyTransformsToInnerDrag(),applyTransformsToCloser()}function applyTransformsToMasks(){invokeOnMasks("place")}function applyTransformsToOverlays(){_.forOwn(allParts,function(part){part.mask.placeOverlay(part.overlay)})}function applyTransformsToInnerDrag(){innerDrag&&innerDrag.setSize(dimensions.innerWidth,options.innerDragHeight).moveTo(position.innerX,position.innerY+dimensions.innerHeight+options.resizeHandleSize)}function applyTransformsToCloser(){closer&&closer.setSize(constrains.minWidth-options.resizeHandleSize,constrains.minHeight-options.resizeHandleSize).moveTo(position.outerX+dimensions.outerWidth-constrains.minWidth+3,position.outerY+options.resizeHandleSize);
}function correctTransforms(){dimensions.topHeight<constrains.minHeight&&(dimensions.topHeight=constrains.minHeight,position.innerY=position.outerY+constrains.minHeight),dimensions.innerHeight<constrains.minHeight&&(dimensions.innerHeight=constrains.minHeight),dimensions.bottomHeight<constrains.minBottomHeight&&(dimensions.bottomHeight=constrains.minBottomHeight),dimensions.outerHeight=dimensions.topHeight+dimensions.innerHeight+dimensions.bottomHeight,dimensions.leftWidth<constrains.minWidth&&(dimensions.leftWidth=constrains.minWidth,position.innerX=position.outerX+constrains.minWidth),dimensions.innerWidth<constrains.minWidth&&(dimensions.innerWidth=constrains.minWidth),
dimensions.rightWidth<constrains.minWidth&&(dimensions.rightWidth=constrains.minWidth),dimensions.outerWidth=dimensions.leftWidth+dimensions.innerWidth+dimensions.rightWidth}function setTopHeight(newHeight,newY,fromTop){dimensions.topHeight=newHeight,fromTop?(dimensions.outerHeight=newHeight+dimensions.innerHeight+dimensions.bottomHeight,position.outerY=newY):(dimensions.innerHeight=dimensions.outerHeight-newHeight-dimensions.bottomHeight,position.innerY=position.outerY+newHeight)}function setRightWidth(newWidth,newX,fromLeft){dimensions.rightWidth=newWidth,fromLeft?dimensions.innerWidth=newX-position.innerX:dimensions.outerWidth=dimensions.leftWidth+dimensions.innerWidth+newWidth;
}function setBottomHeight(newHeight,newY,fromTop){dimensions.bottomHeight=newHeight,fromTop?(dimensions.innerHeight=newY-position.innerY,dimensions.bottomHeight=newHeight):dimensions.outerHeight=dimensions.topHeight+dimensions.innerHeight+newHeight}function setLeftWidth(newWidth,newX,fromLeft){dimensions.leftWidth=newWidth,fromLeft?(dimensions.outerWidth=newWidth+dimensions.innerWidth+dimensions.rightWidth,position.outerX=newX):(dimensions.innerWidth=dimensions.outerWidth-newWidth-dimensions.rightWidth,position.innerX=position.outerX+newWidth)}function createCompoundMask(){createPart({id:"n",edges:{top:!0,right:!1,bottom:!0,left:!1},place:function(){this.moveTo(position.innerX,position.outerY).setSize(dimensions.innerWidth,dimensions.topHeight);
},placeOverlay:function(overlay){var pos=this.getPosition(),size=this.getSize();overlay.moveTo(pos.x,pos.y+options.resizeHandleSize).setSize(size.width,size.height-2*options.resizeHandleSize)},beforeResize:function(width,height,fromLeft,fromTop){this.config.maxHeight=fromTop?null:dimensions.topHeight+(dimensions.innerHeight-constrains.minHeight)},onResize:function(width,height,fromLeft,fromTop,x,y){setTopHeight(height,y,fromTop),applyTransformsToMasks()}}),createPart({id:"ne",edges:{top:!0,right:!0,bottom:!1,left:!1},place:function(){this.moveTo(position.innerX+dimensions.innerWidth,position.outerY).setSize(dimensions.rightWidth,dimensions.topHeight)},placeOverlay:function(overlay){
var pos=this.getPosition(),size=this.getSize();overlay.moveTo(pos.x,pos.y+options.resizeHandleSize).setSize(size.width-options.resizeHandleSize,size.height-2*options.resizeHandleSize)},onResize:function(width,height,fromLeft,fromTop,x,y){setTopHeight(height,y,fromTop),setRightWidth(width,x,fromLeft),applyTransformsToMasks()}}),createPart({id:"e",edges:{top:!1,right:!0,bottom:!1,left:!0},place:function(){this.moveTo(position.innerX+dimensions.innerWidth,position.innerY).setSize(dimensions.rightWidth,dimensions.innerHeight)},placeOverlay:function(overlay){var pos=this.getPosition(),size=this.getSize();overlay.moveTo(pos.x+options.resizeHandleSize,pos.y-options.resizeHandleSize).setSize(size.width-2*options.resizeHandleSize,size.height+2*options.resizeHandleSize);
},beforeResize:function(width,height,fromLeft){this.config.maxWidth=fromLeft?dimensions.rightWidth+(dimensions.innerWidth-constrains.minWidth):null},onResize:function(width,height,fromLeft,fromTop,x){setRightWidth(width,x,fromLeft),applyTransformsToMasks()}}),createPart({id:"se",edges:{top:!1,right:!0,bottom:!0,left:!1},minHeight:constrains.minBottomHeight,place:function(){this.moveTo(position.innerX+dimensions.innerWidth,position.innerY+dimensions.innerHeight).setSize(dimensions.rightWidth,dimensions.bottomHeight)},placeOverlay:function(overlay){var pos=this.getPosition(),size=this.getSize();overlay.moveTo(pos.x,pos.y+options.resizeHandleSize).setSize(size.width-options.resizeHandleSize,size.height-2*options.resizeHandleSize);
},onResize:function(width,height,fromLeft,fromTop,x,y){setRightWidth(width,x,fromLeft),setBottomHeight(height,y,fromTop),applyTransformsToMasks()}}),createPart({id:"s",edges:{top:!0,right:!1,bottom:!0,left:!1},minHeight:constrains.minBottomHeight,place:function(){this.moveTo(position.innerX,position.innerY+dimensions.innerHeight).setSize(dimensions.innerWidth,dimensions.bottomHeight)},placeOverlay:function(overlay){var pos=this.getPosition(),size=this.getSize();overlay.moveTo(pos.x,pos.y+options.resizeHandleSize).setSize(size.width,size.height-2*options.resizeHandleSize)},beforeResize:function(width,height,fromLeft,fromTop){this.config.maxHeight=fromTop?dimensions.bottomHeight+(dimensions.innerHeight-constrains.minHeight):null;
},onResize:function(width,height,fromLeft,fromTop,x,y){setBottomHeight(height,y,fromTop),applyTransformsToMasks()}}),createPart({id:"sw",edges:{top:!1,right:!1,bottom:!0,left:!0},minHeight:constrains.minBottomHeight,place:function(){this.moveTo(position.outerX,position.innerY+dimensions.innerHeight).setSize(dimensions.leftWidth,dimensions.bottomHeight)},placeOverlay:function(overlay){var pos=this.getPosition(),size=this.getSize();overlay.moveTo(pos.x+options.resizeHandleSize,pos.y+options.resizeHandleSize).setSize(size.width-options.resizeHandleSize,size.height-2*options.resizeHandleSize)},onResize:function(width,height,fromLeft,fromTop,x,y){setBottomHeight(height,y,fromTop),
setLeftWidth(width,x,fromLeft),applyTransformsToMasks()}}),createPart({id:"w",edges:{top:!1,right:!0,bottom:!1,left:!0},place:function(){this.moveTo(position.outerX,position.innerY).setSize(dimensions.leftWidth,dimensions.innerHeight)},placeOverlay:function(overlay){var pos=this.getPosition(),size=this.getSize();overlay.moveTo(pos.x+options.resizeHandleSize,pos.y-options.resizeHandleSize).setSize(size.width-2*options.resizeHandleSize,size.height+2*options.resizeHandleSize)},beforeResize:function(width,height,fromLeft){this.config.maxWidth=fromLeft?null:dimensions.leftWidth+(dimensions.innerWidth-constrains.minWidth)},onResize:function(width,height,fromLeft,fromTop,x){
setLeftWidth(width,x,fromLeft),applyTransformsToMasks()}}),createPart({id:"nw",edges:{top:!0,right:!1,bottom:!1,left:!0},place:function(){this.moveTo(position.outerX,position.outerY).setSize(dimensions.leftWidth,dimensions.topHeight)},placeOverlay:function(overlay){var pos=this.getPosition(),size=this.getSize();overlay.moveTo(pos.x+options.resizeHandleSize,pos.y+options.resizeHandleSize).setSize(size.width-options.resizeHandleSize,size.height-2*options.resizeHandleSize)},onResize:function(width,height,fromLeft,fromTop,x,y){setTopHeight(height,y,fromTop),setLeftWidth(width,x,fromLeft),applyTransformsToMasks()}})}function createPart(partConfig){allParts[partConfig.id]={
mask:createMask(_.assign({},constrains,partConfig)),overlay:createOverlay(partConfig)}}function createVisualGuides(){visualGuides.$maskBg=$("<div>",{class:"mask-bg"}),visualGuides.$innerWindow=$("<div>",{class:"inner-window"})}var compoundMask,innerDrag,closer,allParts={},visualGuides={};return dimensions=_.defaults(dimensions||{},defaultDimensions),position=_.defaults(position||{},defaultPosition),options=_.defaults(options||{},defaultOptions),constrains={minWidth:2*options.resizeHandleSize+options.dragMinWidth,minHeight:2*options.resizeHandleSize+options.dragMinHeight,minBottomHeight:2*options.resizeHandleSize+options.innerDragHeight},compoundMask={init:function(){
var self=this;return this.setTransforms(dimensions,position),createCompoundMask(),createVisualGuides(),createInnerDragHandle(),createCloser(),closer.on("click",function(){self.hide(),self.trigger("close")}),this},render:function($container){return invokeOnAll("render",[$container]),innerDrag.render($container),closer.render($container),applyTransforms(),this},destroy:function(){return invokeOnAll("destroy"),visualGuides=null,innerDrag=null,closer=null,this},show:function(){return invokeOnAll("show"),innerDrag.show(),closer.show(),this.setState("hidden",!1),this},hide:function(){return invokeOnAll("hide"),innerDrag.hide(),closer.hide(),this.setState("hidden",!0),
this},setTransforms:function(dim,pos){dimensions=_.defaults(dim||{},dimensions),position=_.defaults(pos||{},position),dimensions.topHeight=pos.innerY-pos.outerY,dimensions.rightWidth=dim.outerWidth-(pos.innerX-pos.outerX)-dim.innerWidth,dimensions.bottomHeight=dim.outerHeight-(pos.innerY-pos.outerY)-dim.innerHeight,dimensions.leftWidth=pos.innerX-pos.outerX,correctTransforms(),applyTransforms()},getDimensions:function(){return dimensions},getPosition:function(){return position},getParts:function(){return allParts}},statifier(compoundMask),eventifier(compoundMask),compoundMask}}),define("taoQtiTest/runner/plugins/tools/lineReader/plugin",["jquery","lodash","i18n","taoTests/runner/plugin","ui/hider","util/shortcut","util/namespace","taoQtiTest/runner/plugins/tools/lineReader/compoundMask"],function($,_,__,pluginFactory,hider,shortcut,namespaceHelper,compoundMaskFactory){
"use strict";function getDimensions($container){var $qtiContent=$container.find("#qti-content"),$qtiItem=$qtiContent.find(".qti-item"),lineHeight=Math.ceil(parseFloat($qtiContent.css("line-height")))||20;return{outerWidth:$qtiItem.width()+4*maskOptions.resizeHandleSize+2*maskOptions.dragMinWidth,outerHeight:175,innerWidth:$qtiItem.width(),innerHeight:lineHeight}}function getPosition($container){var $qtiContent=$container.find("#qti-content"),$qtiItem=$qtiContent.find(".qti-item"),itemPosition=$qtiItem.position()||{},paddingLeft=parseInt($qtiItem.css("padding-left"),10),paddingTop=parseInt($qtiItem.css("padding-top"),10),textPadding=3,innerX=parseInt(itemPosition.left,10)+paddingLeft-textPadding,innerY=parseInt(itemPosition.top,10)+paddingTop-textPadding;
return{outerX:innerX-2*maskOptions.resizeHandleSize-maskOptions.dragMinWidth,outerY:0,innerX:innerX,innerY:innerY}}function containerWidthHasChanged($container){var newDimensions=getDimensions($container);return newDimensions.outerWidth!==dimensions.outerWidth}var dimensions,position,pluginName="line-reader",actionPrefix="tool-"+pluginName+"-",maskOptions={dragMinWidth:7,dragMinHeight:7,resizeHandleSize:7,innerDragHeight:20};return pluginFactory({name:pluginName,init:function(){function isEnabled(){var context=testRunner.getTestContext()||{},options=context.options||{};return!!options.lineReader}function toggleButton(){isEnabled()?self.show():self.hide()}function toggleMask(){
self.compoundMask.getState("hidden")?(containerWidthHasChanged($container)&&transformMask($container),openMask()):closeMask()}function openMask(){self.compoundMask.show(),self.trigger("start"),self.button.turnOn()}function closeMask(){self.compoundMask.getState("hidden")||self.compoundMask.hide(),self.trigger("end"),self.button.turnOff()}function transformMask($maskContainer){dimensions=getDimensions($maskContainer),position=getPosition($maskContainer),self.compoundMask.setTransforms(_.clone(dimensions),_.clone(position))}var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData()||{},testConfig=testData.config||{},pluginShortcuts=(testConfig.shortcuts||{})[pluginName]||{},$container=testRunner.getAreaBroker().getContentArea().parent();
this.compoundMask=compoundMaskFactory(maskOptions).init().render($container).on("close",function(){closeMask()}).hide(),this.button=this.getAreaBroker().getToolbox().createEntry({title:__("Line Reader"),icon:"insert-horizontal-line",control:"line-reader",text:__("Line Reader")}),this.button.on("click",function(e){e.preventDefault(),testRunner.trigger(actionPrefix+"toggle")}),testConfig.allowShortcuts&&pluginShortcuts.toggle&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.toggle,this.getName(),!0),function(){testRunner.trigger(actionPrefix+"toggle")},{avoidInput:!0,prevent:!0}),this.disable(),testRunner.on("loaditem",toggleButton).on("renderitem",function(){
transformMask($container)}).on("enabletools renderitem",function(){self.enable()}).on("disabletools unloaditem",function(){self.disable(),closeMask()}).on(actionPrefix+"toggle",function(){isEnabled()&&toggleMask()})},destroy:function(){this.compoundMask.destroy(),shortcut.remove("."+this.getName())},enable:function(){this.button.enable()},disable:function(){this.button.disable()},show:function(){this.button.show()},hide:function(){this.button.hide()}})}),define("tpl!taoQtiTest/runner/plugins/tools/magnifier/magnifierPanel",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing;return buffer+='<div class="magnifier">\n    <div class="level">',(helper=helpers.level)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.level,stack1=typeof helper===functionType?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+'</div>\n    <div class="overlay"></div>\n    <div class="inner"></div>\n    <div class="controls close">\n        <a href="#" class="closeMagnifier" data-control="closeMagnifier" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,
options={hash:{},data:data},helper?helper.call(depth0,"Close Magnifier",options):helperMissing.call(depth0,"__","Close Magnifier",options)))+'"><span class="icon-result-nok"></span></a>\n    </div>\n    <div class="controls zoom">\n        <a href="#" class="control"  data-control="zoomOut" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Magnify less",options):helperMissing.call(depth0,"__","Magnify less",options)))+'"><span class="icon-remove"></span></a>\n        <a href="#" class="control" data-control="zoomIn" title="'+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},
data:data},helper?helper.call(depth0,"Magnify more",options):helperMissing.call(depth0,"__","Magnify more",options)))+'"><span class="icon-add"></span></a>\n    </div>\n</div>\n'})}),define("taoQtiTest/runner/plugins/tools/magnifier/magnifierPanel",["jquery","lodash","ui/movableComponent","tpl!taoQtiTest/runner/plugins/tools/magnifier/magnifierPanel"],function($,_,movableComponent,magnifierPanelTpl){"use strict";function magnifierPanelFactory(config){function scrollInClone(scrollData){var $clonedTarget;controls&&controls.$clone&&scrollData&&scrollData.id&&($clonedTarget=controls.$clone.find("[data-magnifier-scroll="+scrollData.id+"]"),$clonedTarget.length&&(_.isNumber(scrollData.scrollTop)&&($clonedTarget[0].scrollTop=scrollData.scrollTop),
_.isNumber(scrollData.scrollLeft)&&($clonedTarget[0].scrollLeft=scrollData.scrollLeft)))}function setScrollingListener(){window.addEventListener("scroll",scrollingListenerCallback,!0)}function removeScrollingListener(){window.removeEventListener("scroll",scrollingListenerCallback,!0)}function applyScrolling(){_.forEach(scrolling,scrollInClone)}function adjustZoomLevel(level){return Math.max(zoomLevelMin,Math.min(parseFloat(level),zoomLevelMax))}function applyZoomLevel(){controls&&controls.$inner.css({transform:"scale("+zoomLevel+")"})}function showZoomLevel(){var $newZoomLevel;controls&&($newZoomLevel=controls.$zoomLevel.clone(!0).html(zoomLevel),controls.$zoomLevel.before($newZoomLevel).remove(),
controls.$zoomLevel=$newZoomLevel)}function updateMaxSize(){var $window=$(window);magnifierPanel.config.maxWidth=$window.width()*maxRatio,magnifierPanel.config.maxHeight=$window.height()*maxRatio}function applySize(){controls&&controls.$clone&&(targetWidth=controls.$target.width(),targetHeight=controls.$target.height(),controls.$clone.width(targetWidth).height(targetHeight))}function updateZoom(){var position;controls&&controls.$target&&(position=magnifierPanel.getPosition(),position.x+=dx+controls.$target.scrollLeft(),position.y+=dy+controls.$target.scrollTop(),magnifierPanel.zoomAt(position.x,position.y))}function createObserver(){observer=new window.MutationObserver(updateMagnifier);
}function startObserver(){controls&&controls.$target&&observer.observe(controls.$target.get(0),{childList:!0,attributes:!0,characterData:!0,subtree:!0}),setScrollingListener()}function stopObserver(){observer.disconnect(),removeScrollingListener()}function translateMagnifier(coordinate,actualSize,magnifierSize){var delta=0,ratio=zoomLevel;return actualSize&&(delta=actualSize*(zoomLevel-1)/2,ratio=(actualSize*zoomLevel-magnifierSize)/(actualSize-magnifierSize)),coordinate*ratio-delta}function getElementFromPoint(x,y){var el;return controls&&controls.$overlay.addClass("hidden"),el=document.elementFromPoint(x,y),controls&&controls.$overlay.removeClass("hidden"),
el}function findSourceNode(node,root,target){var $node=$(node),$root=$(root),$target=$(target),indexes=[$node.index()];return $node.parents().each(function(){var $this=$(this);return!$this.is($root)&&void indexes.push($this.index())}),indexes.pop(),indexes.length?($node=$target,_.forEachRight(indexes,function(index){if($node=$node.children().eq(index),!$node.length)return!1})):$node=$(),$node}var targetWidth,targetHeight,dx,dy,initConfig=_.defaults(config||{},defaultConfig),zoomLevelMin=parseFloat(initConfig.levelMin),zoomLevelMax=parseFloat(initConfig.levelMax),zoomLevelStep=parseFloat(initConfig.levelStep),zoomLevel=adjustZoomLevel(initConfig.level),maxRatio=parseFloat(initConfig.maxRatio),baseSize=parseInt(initConfig.baseSize,10),zoomSize=baseSize*zoomLevel,$initTarget=null,controls=null,observer=null,scrolling=[],magnifierPanel=movableComponent({
getZoomLevel:function(){return zoomLevel},getTarget:function(){return controls&&controls.$target},setTarget:function($newTarget){return controls?(controls.$target=$newTarget,controls.$viewTarget=null,setScrollingListener(),this.trigger("targetchange",controls.$target),this.update()):$initTarget=$newTarget,this},zoomTo:function(level){return level&&_.isFinite(level)&&(zoomLevel=adjustZoomLevel(level)),applyZoomLevel(),showZoomLevel(),updateMaxSize(),updateZoom(),this.trigger("zoom",zoomLevel),this},zoomBy:function(step){return step&&_.isFinite(step)&&this.zoomTo(zoomLevel+parseFloat(step)),this},zoomIn:function(){return this.zoomBy(zoomLevelStep)},zoomOut:function(){
return this.zoomBy(-zoomLevelStep)},zoomAt:function(x,y){var position;controls&&(position=this.translate(x,y),controls.$inner.css({top:-position.top,left:-position.left}))},translate:function(x,y){return{top:translateMagnifier(y,targetHeight,this.config.height),left:translateMagnifier(x,targetWidth,this.config.width)}},update:function(){return controls&&controls.$target&&(controls.$clone=controls.$target.clone().removeAttr("id"),controls.$clone.find("iframe").remove(),controls.$clone.find("[name],[id],[data-serial]").removeAttr("name id data-serial"),controls.$inner.empty().append(controls.$clone),applySize(),applyZoomLevel(),updateZoom(),updateMaxSize(),applyScrolling(),
this.trigger("update")),this}},defaultConfig),updateMagnifier=_.debounce(_.bind(magnifierPanel.update,magnifierPanel),debounceDelay),scrollingListenerCallback=_.throttle(function(event){var scrollId,scrollData,$target=$(event.target),scrollingTop=event.target.scrollTop,scrollLeft=event.target.scrollLeft;controls&&controls.$clone&&$target.data("magnifier-scroll")?(scrollId=$target.data("magnifier-scroll"),scrollData=_.find(scrolling,{id:scrollId}),scrollData.scrollTop=scrollingTop,scrollData.scrollLeft=scrollLeft,scrollInClone(scrollData)):(scrollId=_.uniqueId("scrolling_"),$target.attr("data-magnifier-scroll",scrollId),scrolling.push({id:scrollId,scrollTop:scrollingTop,
scrollLeft:scrollLeft}),magnifierPanel.update())},scrollingDelay);return initConfig.width=zoomSize,initConfig.height=zoomSize/screenRatio,initConfig.minWidth=baseSize*zoomLevelMin,initConfig.minHeight=baseSize*zoomLevelMin/screenRatio,magnifierPanel.setTemplate(magnifierPanelTpl).on("render",function(){var self=this,$component=this.getElement();this.setState("hidden",!0),dx=($component.outerWidth()-$component.width())/2,dy=($component.outerHeight()-$component.height())/2,controls={$target:$initTarget,$inner:$(".inner",$component),$zoomLevel:$(".level",$component),$overlay:$(".overlay",$component)},$initTarget=null,$component.on("click touchstart",".zoom",function(event){
var $button=$(event.target).closest(".control"),action=$button.data("control");event.preventDefault(),action&&self[action]&&self[action]()}),$component.on("click touchstart",".closeMagnifier",function(event){event.preventDefault(),self.hide(),self.trigger("close")}),$component.on("click touchstart",".overlay",function(event){self.is("noclick")?self.setState("noclick",!1):findSourceNode(getElementFromPoint(event.pageX,event.pageY),controls.$inner,controls.$target).click().focus()}),createObserver(),updateMaxSize(),applyZoomLevel()}).on("dragstart resizestart",function(){this.setState("noclick",!0)}).on("move resize",function(){updateZoom()}).on("show",function(){
updateMagnifier(),startObserver()}).on("hide",function(){stopObserver()}).on("resize",function(){updateMaxSize()}).on("destroy",function(){stopObserver(),$initTarget=null,controls=null,observer=null}).init(initConfig),magnifierPanel}var screenRatio=window.screen.width/window.screen.height,debounceDelay=50,scrollingDelay=20,defaultBaseSize=116,defaultLevelMin=2,defaultLevelMax=8,defaultLevel=defaultLevelMin,defaultConfig={level:defaultLevel,levelMin:defaultLevelMin,levelMax:defaultLevelMax,levelStep:.5,baseSize:defaultBaseSize,width:defaultBaseSize*defaultLevel,height:defaultBaseSize*defaultLevel/screenRatio,minWidth:defaultBaseSize*defaultLevelMin,minHeight:defaultBaseSize*defaultLevelMin/screenRatio,
maxRatio:.5,stackingScope:"test-runner"};return magnifierPanelFactory}),define("taoQtiTest/runner/plugins/tools/magnifier/magnifier",["jquery","lodash","i18n","taoTests/runner/plugin","ui/hider","util/shortcut","util/namespace","taoQtiTest/runner/plugins/tools/magnifier/magnifierPanel"],function($,_,__,pluginFactory,hider,shortcut,namespaceHelper,magnifierPanelFactory){"use strict";var pluginName="magnifier",actionPrefix="tool-"+pluginName+"-",defaultOptions={zoomMin:2,zoomMax:8,zoomStep:.5};return pluginFactory({name:pluginName,init:function(){function getMagnifierPanel(){var $container;return magnifierPanel||($container=testRunner.getAreaBroker().getContainer(),
magnifierPanel=magnifierPanelFactory({levelMin:pluginConfig.zoomMin,levelMax:pluginConfig.zoomMax,levelStep:pluginConfig.zoomStep}).on("show",function(){self.trigger("magnifier-show")}).on("hide",function(){self.trigger("magnifier-hide")}).on("zoom",function(level){self.trigger("magnifier-zoom",level)}).on("close",function(){hideMagnifier()}).setTarget($container).render($container.parent()),self.trigger("magnifier-create")),magnifierPanel}function isEnabled(){var context=testRunner.getTestContext()||{},options=context.options||{};return!!options.magnifier}function togglePlugin(){isEnabled()?self.show():self.hide()}function toggleMagnifier(){self.getState("enabled")&&(self.getState("active")?hideMagnifier():showMagnifier());
}function showMagnifier(){getMagnifierPanel(),magnifierPanel.is("hidden")&&magnifierPanel.show(),self.button.turnOn(),testRunner.trigger("plugin-open."+pluginName),self.setState("active",!0)}function hideMagnifier(){self.setState("active",!1),self.button.turnOff(),testRunner.trigger("plugin-close."+pluginName),magnifierPanel&&!magnifierPanel.is("hidden")&&magnifierPanel.hide()}var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData()||{},testConfig=testData.config||{},pluginConfig=_.defaults((testConfig.plugins||{})[pluginName]||{},defaultOptions),pluginShortcuts=(testConfig.shortcuts||{})[pluginName]||{},magnifierPanel=null;this.button=this.getAreaBroker().getToolbox().createEntry({
control:"magnify",title:__("Displays a customisable magnifier"),text:__("Magnifying Glass"),icon:"find"}),this.button.on("click",function(event){event.preventDefault(),testRunner.trigger(actionPrefix+"toggle")}),testConfig.allowShortcuts&&_.forEach(pluginShortcuts,function(command,key){shortcut.add(namespaceHelper.namespaceAll(command,pluginName,!0),function(){testRunner.trigger(actionPrefix+key)},{avoidInput:!0})}),togglePlugin(),this.disable(),testRunner.on("loaditem",function(){togglePlugin(),self.disable()}).on("renderitem",function(){magnifierPanel&&magnifierPanel.update().zoomTo(pluginConfig.zoomMin)}).on("enabletools renderitem",function(){self.enable();
}).on("disabletools unloaditem",function(){self.getState("active")&&hideMagnifier(),self.disable()}).on("destroy",function(){magnifierPanel&&magnifierPanel.destroy(),magnifierPanel=null}).on(actionPrefix+"toggle",function(){isEnabled()&&toggleMagnifier()}).on(actionPrefix+"in",function(){isEnabled()&&self.getState("enabled")&&self.getState("active")&&getMagnifierPanel().zoomIn()}).on(actionPrefix+"out",function(){isEnabled()&&self.getState("enabled")&&self.getState("active")&&getMagnifierPanel().zoomOut()}).on(actionPrefix+"close",function(){self.getState("active")&&hideMagnifier()})},destroy:function(){shortcut.remove("."+pluginName)},enable:function(){this.button.enable();
},disable:function(){this.button.disable()},show:function(){this.button.show()},hide:function(){this.button.hide()}})}),define("taoQtiTest/runner/plugins/tools/zoom",["jquery","i18n","ui/hider","ui/transformer","util/shortcut","util/namespace","taoTests/runner/plugin"],function($,__,hider,transformer,shortcut,namespaceHelper,pluginFactory){"use strict";var standard=100,increment=10,threshold={lower:10,upper:200},setZoomLevel=function($target,level){transformer.setTransformOrigin($target,"0 0"),transformer.scale($target,level/100)},resetZoom=function($target){transformer.reset($target)},forceRepaint=function($target){var sel=$target[0];sel&&(sel.style.display="none",
sel.offsetHeight,sel.style.display="")};return pluginFactory({name:"zoom",init:function(){function zoomAction(dir){var el,sx,sy,before,after,inc=increment*dir;self.$zoomTarget&&(el=self.$zoomTarget[0],before=el.getBoundingClientRect(),sx=self.$container.scrollLeft(),sy=self.$container.scrollTop(),self.zoom=Math.max(threshold.lower,Math.min(threshold.upper,self.zoom+inc)),self.zoom===standard?resetZoom(self.$zoomTarget):setZoomLevel(self.$zoomTarget,self.zoom),forceRepaint(self.$zoomTarget),after=el.getBoundingClientRect(),sx=Math.max(0,sx+(after.width-before.width)/2),sy=Math.max(0,sy+(after.height-before.height)/2),self.$container.scrollLeft(sx).scrollTop(sy));
}function zoomIn(){self.getState("enabled")!==!1&&zoomAction(1)}function zoomOut(){self.getState("enabled")!==!1&&zoomAction(-1)}var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData()||{},testConfig=testData.config||{},pluginShortcuts=(testConfig.shortcuts||{})[this.getName()]||{};this.buttonZoomOut=this.getAreaBroker().getToolbox().createEntry({control:"zoomOut",title:__("Zoom out"),icon:"remove"}),this.buttonZoomIn=this.getAreaBroker().getToolbox().createEntry({control:"zoomIn",title:__("Zoom in"),icon:"add"}),this.buttonZoomIn.on("click",function(e){e.preventDefault(),testRunner.trigger("tool-zoomin")}),this.buttonZoomOut.on("click",function(e){
e.preventDefault(),testRunner.trigger("tool-zoomout")}),testConfig.allowShortcuts&&(pluginShortcuts.in&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.in,this.getName(),!0),function(){testRunner.trigger("tool-zoomin")},{avoidInput:!0}),pluginShortcuts.out&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.out,this.getName(),!0),function(){testRunner.trigger("tool-zoomout")},{avoidInput:!0})),this.show(),this.disable(),testRunner.on("loaditem",function(){self.zoom=standard,self.show(),self.disable()}).on("renderitem",function(){self.$container=$("#qti-content"),self.$zoomTarget=$(".qti-item"),self.enable()}).on("enabletools",function(){self.enable();
}).on("disabletools unloaditem",function(){self.disable()}).on("tool-zoomin",zoomIn).on("tool-zoomout",zoomOut)},destroy:function(){shortcut.remove("."+this.getName())},enable:function(){this.buttonZoomIn.enable(),this.buttonZoomOut.enable()},disable:function(){this.buttonZoomIn.disable(),this.buttonZoomOut.disable()},show:function(){this.buttonZoomIn.show(),this.buttonZoomOut.show()},hide:function(){this.buttonZoomIn.hide(),this.buttonZoomOut.hide()}})}),function(c){var d=document,a="appendChild",i="styleSheet",s=d.createElement("style");s.type="text/css",d.getElementsByTagName("head")[0][a](s),s[i]?s[i].cssText=c:s[a](d.createTextNode(c))}(".test-runner-scope .content-wrapper p.key-navigation-group,.test-runner-scope .content-wrapper div.key-navigation-group{padding:5px !important}.test-runner-scope .content-wrapper .key-navigation-group:not(.qti-extendedTextInteraction):not(.qti-textEntryInteraction){border-width:1px !important;border-style:solid;border-color:transparent}.test-runner-scope .content-wrapper .key-navigation-group:not(.qti-extendedTextInteraction):not(.qti-textEntryInteraction).focusin{border-color:#0e5d91 !important;outline:none}.test-runner-scope .content-wrapper .key-navigation-group:not(.qti-extendedTextInteraction):not(.qti-textEntryInteraction).qti-interaction .qti-choice.key-navigation-highlight{background:#e7eff4 !important}.test-runner-scope .content-wrapper span.key-navigation-group{border:none !important}.test-runner-scope .content-wrapper span.key-navigation-group.focusin{outline:solid #0e5d91 1px !important;outline-offset:1px}.test-runner-scope .test-sidebar .key-navigation-group.focusin{background:#e7eff4}.test-runner-scope .test-sidebar .key-navigation-group .qti-navigator-filters .key-navigation-highlight .qti-navigator-tab{border-width:2px}.test-runner-scope .test-sidebar .key-navigation-group .qti-navigator-filters .key-navigation-highlight:focus{outline:none}.test-runner-scope .test-sidebar .key-navigation-group .qti-navigator-filters .key-navigation-highlight:focus .qti-navigator-tab{border-top-color:#222 !important;border-left-color:#222 !important;border-right-color:#222 !important}.test-runner-scope .test-sidebar .key-navigation-group li.qti-navigator-item.key-navigation-highlight{padding-left:8px;border-left:solid 2px #222}.test-runner-scope .test-sidebar .key-navigation-group li.qti-navigator-item.key-navigation-highlight .key-navigation-highlight:focus{outline:none}.test-runner-scope .bottom-action-bar.content-action-bar.key-navigation-group.focusin{-webkit-box-shadow:0 0 6px 2px #3e7da7;-moz-box-shadow:0 0 6px 2px #3e7da7;-ms-box-shadow:0 0 6px 2px #3e7da7;-o-box-shadow:0 0 6px 2px #3e7da7;box-shadow:0 0 6px 2px #3e7da7}.test-runner-scope .bottom-action-bar.content-action-bar.key-navigation-group .key-navigation-highlight:focus{margin-bottom:0;border-bottom-color:#e7eff4 !important;outline:none}.test-runner-scope .bottom-action-bar.content-action-bar.key-navigation-group .key-navigation-highlight:focus.active{border-bottom-color:transparent !important;background:#e7eff4 !important}.test-runner-scope .bottom-action-bar.content-action-bar.key-navigation-group .key-navigation-highlight:focus:not(.active) .li-inner{color:#e7eff4}header .settings-menu .key-navigation-group{padding-right:5px}header .settings-menu .key-navigation-group.focusin{background-color:rgba(14,93,145,0.5);padding-bottom:10px}header .settings-menu .key-navigation-highlight:focus{height:54px;color:white !important;border-bottom:solid 2px white !important}\n\n/*# sourceMappingURL=key-navigation.css.map */");
//# sourceMappingURL=testPlugins.min.js.map